<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Carrie Wu, John Powers, David Hopp, Diane Campbell" />

<meta name="date" content="2023-12-01" />

<title>Floral traits - Ipomopsis temperature experiments</title>

<script src="libs/header-attrs-2.20/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/navigation-1.1/codefolding.js"></script>
<link href="libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Floral traits - Ipomopsis temperature
experiments</h1>
<h4 class="author">Carrie Wu, John Powers, David Hopp, Diane
Campbell</h4>
<h4 class="date">2023-12-01</h4>

</div>


<style type="text/css">
.main-container { max-width: 1000px; margin-left: 0; margin-right: auto; }
img{ max-width:200%; height: auto; }
td, th { padding : 6px }
</style>
<pre class="r"><code>figs &lt;- read_tsv(&quot;fig_paths.tsv&quot;)
walk2(figs$path, figs$fig, ~system(paste0(&quot;cp &quot;, .x, &quot; ./figures/Figure&quot;, .y, &quot;.&quot;,tools::file_ext(.x))))
walk2(figs$path, figs$fig, ~system(paste0(&quot;inkscape -o ./figures/Figure&quot;, .y, &quot;.eps &quot;, .x)))</code></pre>
<div id="site-map" class="section level1">
<h1>Site Map</h1>
<div class="float">
<img src="plots/sitemap.jpg" alt="SiteMap" />
<div class="figcaption">SiteMap</div>
</div>
<pre class="r"><code># Load in all the Ipomopsis temperature experiment data
# Includes census, phenology, floral and leaf traits, and seeds
# census -------------------------------------------------------------------

census.maxf &lt;- read_csv(&quot;data/2021 Maxfield Rosettes - 2021OTCs.csv&quot;) %&gt;% 
  mutate(across(c(plant, plot), as.character),
         temp=fct_relevel(fct_recode(temp,&quot;warmed&quot;=&quot;OTC&quot;),&quot;control&quot;), site=&quot;Maxfield&quot;)

#TODO look at survival and flowering from 2021 to 2022 (2021 Maxfield Rosettes - 2021.csv)

# floral traits --------------------------------------------------------------

morph &lt;- bind_rows(GNA=read_csv(&quot;data/traits/GNA floral traits - 2021.csv&quot;, na=&quot;.&quot;),
                   SC=read_csv(&quot;data/traits/Spring Creek floral traits - 2021.csv&quot;, na=&quot;.&quot;), .id=&quot;site&quot;) %&gt;% 
  rename(plantid = plant, temp = location, plotid=OTC) %&gt;% drop_na(temp) %&gt;% 
  mutate(temp=fct_relevel(fct_recode(temp,&quot;warmed&quot;=&quot;in&quot;, &quot;control&quot;=&quot;out&quot;),&quot;control&quot;)) %&gt;% 
  bind_rows(read_csv(&quot;data/traits/2021 Maxfield Floral Traits - Morphology21.csv&quot;) %&gt;% 
              mutate(plant = as.character(plant), site=&quot;Maxfield&quot;) %&gt;% 
              left_join(census.maxf) %&gt;% drop_na(plot)) %&gt;% 
  mutate(species = if_else(site==&quot;SC&quot;, &quot;ten&quot;, &quot;agg&quot;), year=year(date))

nectar &lt;- read_csv(&quot;data/traits/2021 Maxfield Floral Traits - Nectar21.csv&quot;) %&gt;% 
  mutate(across(c(plant), as.character)) %&gt;% 
  left_join(census.maxf) %&gt;% 
  mutate(nectar_volume=nectar_48_h_mm*5/32,
         nectar_sugar=nectar_volume*nectar_conc,
         plantid=paste0(plotid,plant), 
         site=&quot;Maxfield&quot;, species=&quot;agg&quot;, year=year(date))

flrcol.raw &lt;- read_csv(&quot;data/traits/2021 Maxfield Flower Color - 2021.csv&quot;, name_repair=&quot;minimal&quot;) %&gt;% as.data.frame()
wl &lt;- flrcol.raw[,1] #350:1000
flrcol.raw &lt;- flrcol.raw[,seq(2,length(flrcol.raw),2)]

flrcol.long &lt;- cbind(wl,stack(flrcol.raw)) %&gt;% 
  mutate(red=wl&gt;=626&amp;wl&lt;=700, #sum red and green regions to calculate redness index
         green=wl&gt;=476&amp;wl&lt;=550,
         total=wl&gt;=401&amp;wl&lt;=750,
         color=ifelse(red,&quot;red&quot;,ifelse(green,&quot;green&quot;,NA)))
flrcol.total &lt;- flrcol.long %&gt;% group_by(color,total,ind) %&gt;% summarize(values=sum(values))

flrcol &lt;- pivot_wider(flrcol.total,names_from=c(&quot;color&quot;,&quot;total&quot;),values_from=&quot;values&quot;) %&gt;% 
  mutate(total = green_TRUE+red_TRUE+NA_TRUE,
         redness = (red_TRUE-green_TRUE)/total,
         ind = str_replace(ind,fixed(&quot;.&quot;),&quot;_&quot;)) %&gt;% 
  separate(ind, into=c(&quot;plantid&quot;,&quot;rep&quot;), sep=&quot;_&quot;, fill=&quot;right&quot;, remove=F) %&gt;%
  mutate(rep=as.integer(replace_na(rep, &quot;0&quot;))+1) %&gt;% 
  left_join(census.maxf) %&gt;% mutate(site=&quot;Maxfield&quot;, species=&quot;agg&quot;)

# phenology ---------------------------------------------------------------

phen.raw &lt;- read_csv(&quot;data/traits/2021 Maxfield Phenology - 2021.csv&quot;)%&gt;% 
  mutate(plot = as.character(plot), 
         plotid = paste0(plot, subplot),
         plantid = paste0(plotid, plant),
         plant = as.character(plant),
         julian = yday(date),
         year=&quot;2021&quot;,
         height_cm=as.integer(as.character(height_cm)),
         open = rowSums(select(., starts_with(&quot;open&quot;)), na.rm=T),
         buds = rowSums(select(., starts_with(&quot;buds&quot;)), na.rm=T),
         eggs = rowSums(select(., starts_with(&quot;eggs&quot;)), na.rm=T),
         eggs_per_flower = replace_na(eggs,0)/(open+buds)) %&gt;% 
  left_join(census.maxf) %&gt;% 
  mutate_if(is.character, as.factor) 

#some plants were measured late, merge with the earlier date
phen &lt;- phen.raw %&gt;% mutate(date=ymd(recode(as.character(date),
                                            &quot;2021-07-02&quot;=&quot;2021-06-30&quot;, &quot;2021-07-26&quot;=&quot;2021-07-20&quot;)),
                            julian=yday(date)) %&gt;% 
  complete(nesting(plantid, plotid, plot, subplot, snow, temp),nesting(julian, date), fill=list(open=0,buds=0)) %&gt;% #add zeros to weeks the plant was not counted
  mutate(flowering = open + buds &gt; 0,
         has_egg = eggs &gt; 0, 
         site=&quot;Maxfield&quot;, species=&quot;agg&quot;, year=year(date))

# seeds -------------------------------------------------------------------

counts_19_20 &lt;- c(&quot;seeds&quot;,&quot;fruits&quot;,&quot;fruits_split&quot;,&quot;aborts&quot;,&quot;fruits_fly_no_seeds&quot;,&quot;fruits_fly_with_seeds&quot;,&quot;seeds_fly&quot;,&quot;fruits_caterpillar&quot;,&quot;fruits_early_uncountable&quot;,&quot;flowers_buds&quot;,&quot;flowers_buds_collected_early&quot;,&quot;flowers_buds_collected_last&quot;)
sds21.date &lt;- read_csv(&quot;data/traits/2021 Maxfield Seeds - 2021.csv&quot;, skip=1) %&gt;% 
  mutate(plot = as.character(plot), 
         plotid = paste0(plot, subplot),
         plantid = paste0(plotid, plant),
         plant = as.character(plant),
         julian = factor(yday(date)),
         year = year(date), plantid = paste0(plotid,plant),
         species=&quot;agg&quot;, site=&quot;Maxfield&quot;) %&gt;% 
  mutate(flowers_buds_collected_last = ifelse(yday(date) &gt;= 235, flowers_buds, 0), #8/23
         flowers_buds_collected_early = ifelse(yday(date) &lt; 235, flowers_buds, 0)) %&gt;% 
  mutate(across(all_of(counts_19_20), replace_na, 0)) %&gt;% 
  left_join(census.maxf) %&gt;% drop_na(temp) %&gt;% #8 plants with no census record (also not in traits)
  mutate_if(is.character, as.factor) 

sds21 &lt;- sds21.date %&gt;% 
  group_by(across(c(&quot;plant&quot;, &quot;plantid&quot;, colnames(census.maxf)))) %&gt;% 
  summarize(across(all_of(counts_19_20), sum, na.rm=T), dates=n(), .groups=&quot;drop&quot;)

sds21.date.zeroed &lt;- sds21.date %&gt;% 
  filter(date %in% (sds21.date %&gt;% drop_na(date) %&gt;% count(date) %&gt;% filter(n&gt;2) %&gt;% pull(date))) %&gt;% 
  complete(nesting(plantid, plotid, plot, subplot, snow, temp), nesting(julian, date), fill=list(seeds=0, fruits=0, fruits_split=0, fruits_fly_no_seeds=0, fruits_fly_with_seeds=0, seeds_fly=0, fruits_caterpillar=0)) %&gt;% 
  mutate(julian=as.integer(as.character(julian)),
         seeds_per_fruit = seeds/fruits,
         fruits_with_seeds = fruits + fruits_split + fruits_fly_with_seeds,
         fruits_nonaborted = fruits_with_seeds + fruits_fly_no_seeds + fruits_caterpillar + fruits_split,
         prop_infested  = (fruits_fly_no_seeds + fruits_fly_with_seeds + fruits_caterpillar) / fruits_nonaborted,
         fruiting = fruits_nonaborted &gt; 0)

sds &lt;- sds21 %&gt;% 
  mutate(#flowers_volatiles = replace_na(flowers_volatiles, 0), #TODO get volatiles for 2018 &amp; 2019
    #TODO get all these counts
    #flowers_destroyed = flowers_morphology_nectar + flowers_volatiles + flowers_color,
    seeds_per_fruit = seeds / fruits,
    fruits_aborted  = aborts + flowers_buds_collected_last,
    seeds_est   = seeds + seeds_fly + (flowers_buds_collected_early + #flowers_destroyed + 
                                       fruits_early_uncountable) * (seeds/(fruits + fruits_aborted + fruits_fly_with_seeds + fruits_fly_no_seeds + fruits_caterpillar)) + fruits_split * seeds_per_fruit, 
    fruits_with_seeds   = fruits + fruits_split + fruits_fly_with_seeds, 
    fruits_nonaborted   = fruits_with_seeds + fruits_fly_no_seeds + fruits_caterpillar + fruits_split,
    flowers_est = fruits_nonaborted + aborts + flowers_buds, #+ flowers_destroyed,# aborts used to be fruits_aborted, which includes flowers_buds_collected_last, but these are already in flowers_buds
    prop_infested   = (fruits_fly_no_seeds + fruits_fly_with_seeds + fruits_caterpillar) / fruits_nonaborted,
    prop_aborted    = fruits_aborted / (fruits_nonaborted + fruits_aborted),
    prop_nonaborted = fruits_nonaborted / (fruits_nonaborted + fruits_aborted),
    seeds_per_flower = seeds_est / flowers_est) %&gt;% 
  filter(flowers_est &gt; 0)#one plant &quot;gone&quot;

write.csv(sds, &quot;data/2021_Maxfield_sds.csv&quot;)

# volatiles ---------------------------------------------------------------

vt &lt;- read_csv(&quot;data/volatiles/CWu_meta21.csv&quot;) %&gt;% 
  rename(date=Date, site=Site, VWC=SoilVWC, notes=Notes) %&gt;% 
  mutate(year=year(date)) %&gt;% filter(Expt==&quot;otc&quot;, temp !=&quot;air&quot;, site != &quot;bb&quot;)

svfl &lt;- read_csv(&quot;data/volatiles/svf_svl.csv&quot;) %&gt;% #final filtering for stats, both flowers and leaves
  rename(site=Site, VWC=SoilVWC, plantid=PlantID, species=PlantType, total_vols=TotalVols) %&gt;%
  mutate(plantid = paste(species, plantid)) %&gt;% 
  mutate(year=factor(year(date))) %&gt;% filter(Expt==&quot;otc&quot;, temp !=&quot;air&quot;, site != &quot;bb&quot;)

# soilmoisture ---------------------------------------------------------------

sm &lt;- bind_rows(general=bind_rows(read_csv(&quot;data/2019 &amp; 2021 SC &amp; GNA Soil Moisture - general.csv&quot;),
                read_csv(&quot;data/2021 Maxfield Soil Moisture - 2021.csv&quot;) %&gt;% 
                  filter(date!=ymd(&quot;2021-06-23&quot;)) %&gt;% #no OTCs at Maxfield yet
                  mutate(temp = ifelse(location %in% c(&quot;OTCV&quot;,&quot;OTCO&quot;) | !is.na(OTC),&quot;warmed&quot;, &quot;control&quot;),
                         site=&quot;Maxfield&quot;)),
                atplant=bind_rows(read_csv(&quot;data/2021 Maxfield Leaf Traits - 2021round1.csv&quot;) %&gt;% 
                  select(date=date_collected, plot, subplot, plant, temp, VWC, period=per_us) %&gt;% 
                  mutate(temp = ifelse(temp==&quot;OTC&quot;, &quot;warmed&quot;, &quot;control&quot;), site=&quot;Maxfield&quot;, plant=as.character(plant)),
                vt %&gt;% select(site, date, temp, chamber, plotid, plant, VWC, notes)), .id=&quot;type&quot;) %&gt;% 
                  mutate(year=year(date)) %&gt;% filter(date!=ymd(&quot;2019-08-05&quot;)) #only one warmed VWC at GNA that day

# OTCs ---------------------------------------------------------------
otc_duration &lt;- read_csv(&quot;./data/CWu OTC Hobos - duration.csv&quot;)

# meltdates ---------------------------------------------------------------

# 2021 Maxfield HOBO threshold=10,000 lux
# normal: plots
# 1 = 21-04-30 
# 3 = 21-04-30
# 6 = 21-05-02
# early plots
# 2 = 21-04-14
# 4 = 21-04-14
# 5 = 21-04-12

meltdates &lt;- tibble::tribble( ~year, ~sun_date, # average light level melt day in normal snowmelt plots (1,3,6) at Maxfield
                              2018,      119, # from Maxfield Results - timings sheet
                              2019,      158, # threshold = 10,000 lux
                              2021,      121) %&gt;% # Manually from lab drive: 2021 Maxfield Hobo overwinter
  mutate(site=&quot;Maxfield&quot;)

# names --------------------------------------------------------------

spnames &lt;- c(agg=&quot;I. aggregata&quot;, ten=&quot;I. tenuituba&quot;)
sitenames &lt;- c(GNA=&quot;Gothic Natural Area&quot;,Maxfield=&quot;Maxfield Meadow&quot;,SC=&quot;Spring Creek&quot;)
speciessitenames &lt;- c(GNA=&quot;I. aggregata\nGothic Natural Area&quot;,Maxfield=&quot;I. aggregata\nMaxfield Meadow&quot;,
                      SC=&quot;I. tenuituba\nSpring Creek&quot;)
year_pal &lt;- setNames(brewer.pal(3, name=&quot;Set2&quot;)[c(2,3,1)], meltdates$year)

traits &lt;- c(&quot;corolla_length&quot;, &quot;corolla_width&quot;, 
            &quot;nectar_volume&quot;, &quot;nectar_conc&quot;,
            &quot;height_cm&quot;,&quot;redness&quot;,
            &quot;open&quot;,&quot;seeds_per_fruit&quot;, &quot;seeds_est&quot;, &quot;fruits_nonaborted&quot;,  &quot;flowers_est&quot;, 
            &quot;prop_infested&quot;, &quot;prop_aborted&quot;, &quot;seeds_per_flower&quot;) 
floraltraits &lt;- traits[1:6]
seedtraits &lt;- traits[7:14] 
traitnames.units &lt;- set_names(c(
  &quot;Corolla length (mm)&quot;, &quot;Corolla width (mm)&quot;,
  &quot;Nectar production\n(\U00B5L/day)&quot;, &quot;Nectar conc.\n(% by mass)&quot;,
  &quot;Inflorescence height\n(cm)&quot;, &quot;Redness index&quot;, 
  &quot;Open flowers&quot;, &quot;Seeds per fruit&quot;, &quot;Estimated total\nseeds&quot;, &quot;Nonaborted fruits&quot;, &quot;Flower number&quot;, 
  &quot;Prop. nonaborted\nfruits infested&quot;,&quot;Prop. fruits\naborted&quot;,&quot;Estimated seeds\nper flower&quot;), traits)

traitnames &lt;- set_names(c(
  &quot;Corolla length&quot;, &quot;Corolla width&quot;,
  &quot;Nectar production&quot;, &quot;Nectar conc.&quot;,
  &quot;Inflorescence height&quot;, &quot;Redness index&quot;, 
  &quot;Open flowers&quot;, &quot;Seeds per fruit&quot;, &quot;Estimated total seeds&quot;, &quot;Nonaborted fruits&quot;, &quot;Flower number&quot;, 
  &quot;Prop. nonaborted fruits infested&quot;,&quot;Prop. fruits aborted&quot;,&quot;Estimated seeds per flower&quot;), traits)</code></pre>
</div>
<div id="sample-sizes" class="section level1">
<h1>Sample sizes</h1>
<div id="timings" class="section level2">
<h2>Timings</h2>
<pre class="r"><code>timings &lt;- bind_rows(
  meltdates=meltdates %&gt;% rename(begin=sun_date) %&gt;% mutate(end=begin),
  otc = otc_duration %&gt;% mutate(begin=yday(OTC_start), end=yday(OTC_end)), 
  hobo = otc_duration %&gt;% mutate(begin=yday(logger_start), end=yday(logger_end)),
  sm = sm %&gt;% filter(type==&quot;general&quot;) %&gt;% group_by(site, year) %&gt;% summarize(begin = min(yday(date)), end = max(yday(date))),
  vt = vt %&gt;% filter(Tissue==&quot;flower&quot;, !is.na(site)) %&gt;% group_by(site, year) %&gt;% 
    summarize(begin = min(yday(date)), end = max(yday(date))),
  vt.leaf = vt %&gt;% filter(Tissue==&quot;leaf&quot;, !is.na(site), year==&quot;2019&quot;) %&gt;% 
    group_by(site, year) %&gt;% summarize(begin = min(yday(date)), end = max(yday(date))),
  mt = morph %&gt;% drop_na(corolla_length) %&gt;% group_by(site, year) %&gt;% 
    summarize(begin = min(yday(date), na.rm=T), end = max(yday(date), na.rm=T)),
  nt = nectar %&gt;% group_by(site, year) %&gt;% summarize(begin = min(yday(date), na.rm=T), end = max(yday(date), na.rm=T)),
  flrcol = data.frame(year=2021, site=&quot;Maxfield&quot;, begin=yday(ymd(&quot;2021-07-14&quot;)), end=yday(ymd(&quot;2021-07-26&quot;))),
  ph = phen %&gt;% drop_na(height_cm) %&gt;% group_by(site, year) %&gt;% summarize(begin = min(yday(date)), end = max(yday(date))),
  sds = sds21.date %&gt;% group_by(site, year) %&gt;% summarize(begin = min(yday(date), na.rm=T), end = max(yday(date), na.rm=T)), 
  .id=&quot;variable&quot;) %&gt;% ungroup %&gt;% select(variable, year, site, begin, end)

timings_labels &lt;- c(meltdates=&quot;Snowmelt&quot;,      otc=&quot;Open top chambers&quot;, hobo=&quot;Loggers&quot;,
                   vt=&quot;Floral volatiles&quot;,      vt.leaf=&quot;Leaf volatiles&quot;,
                   sm=&quot;General soil moisture&quot;,         ph=&quot;Height, flowers, fly eggs&quot;,
                   mt=&quot;Floral morphology&quot;,     nt=&quot;Nectar&quot;, 
                   sds=&quot;Seeds&quot;,                flrcol=&quot;Flower color&quot;)

timings.otc &lt;- timings %&gt;% left_join(select(otc_duration, year, site, OTC_start)) %&gt;% 
  mutate(begin=begin-yday(OTC_start), end=end-yday(OTC_start))

timings.otc %&gt;% mutate(range=paste(begin, end=end, sep=&quot; : &quot;), .keep=&quot;unused&quot;) %&gt;% select(-OTC_start) %&gt;% 
  pivot_wider(names_from=year, values_from=range, names_sort=T) %&gt;% 
  mutate(variable=recode(variable, !!!timings_labels)) %&gt;% arrange(site) %&gt;% kable(caption=&quot;Days after OTCs deployed&quot;)</code></pre>
<table>
<caption>Days after OTCs deployed</caption>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="left">site</th>
<th align="left">2018</th>
<th align="left">2019</th>
<th align="left">2021</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Open top chambers</td>
<td align="left">GNA</td>
<td align="left">0 : 29</td>
<td align="left">0 : 27</td>
<td align="left">0 : 33</td>
</tr>
<tr class="even">
<td align="left">Loggers</td>
<td align="left">GNA</td>
<td align="left">5 : 29</td>
<td align="left">0 : 27</td>
<td align="left">0 : 33</td>
</tr>
<tr class="odd">
<td align="left">General soil moisture</td>
<td align="left">GNA</td>
<td align="left">NA</td>
<td align="left">0 : 14</td>
<td align="left">0 : 0</td>
</tr>
<tr class="even">
<td align="left">Floral volatiles</td>
<td align="left">GNA</td>
<td align="left">20 : 21</td>
<td align="left">22 : 27</td>
<td align="left">15 : 29</td>
</tr>
<tr class="odd">
<td align="left">Leaf volatiles</td>
<td align="left">GNA</td>
<td align="left">NA</td>
<td align="left">27 : 27</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">Floral morphology</td>
<td align="left">GNA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">7 : 7</td>
</tr>
<tr class="odd">
<td align="left">Snowmelt</td>
<td align="left">Maxfield</td>
<td align="left">NA : NA</td>
<td align="left">NA : NA</td>
<td align="left">-55 : -55</td>
</tr>
<tr class="even">
<td align="left">Open top chambers</td>
<td align="left">Maxfield</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">0 : 54</td>
</tr>
<tr class="odd">
<td align="left">Loggers</td>
<td align="left">Maxfield</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">3 : 39</td>
</tr>
<tr class="even">
<td align="left">General soil moisture</td>
<td align="left">Maxfield</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">5 : 25</td>
</tr>
<tr class="odd">
<td align="left">Floral volatiles</td>
<td align="left">Maxfield</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">13 : 31</td>
</tr>
<tr class="even">
<td align="left">Floral morphology</td>
<td align="left">Maxfield</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">7 : 31</td>
</tr>
<tr class="odd">
<td align="left">Nectar</td>
<td align="left">Maxfield</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">12 : 19</td>
</tr>
<tr class="even">
<td align="left">Flower color</td>
<td align="left">Maxfield</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">19 : 31</td>
</tr>
<tr class="odd">
<td align="left">Height, flowers, fly eggs</td>
<td align="left">Maxfield</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">-2 : 39</td>
</tr>
<tr class="even">
<td align="left">Seeds</td>
<td align="left">Maxfield</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">31 : 63</td>
</tr>
<tr class="odd">
<td align="left">Open top chambers</td>
<td align="left">SC</td>
<td align="left">NA</td>
<td align="left">0 : 27</td>
<td align="left">0 : 34</td>
</tr>
<tr class="even">
<td align="left">Loggers</td>
<td align="left">SC</td>
<td align="left">NA</td>
<td align="left">3 : 27</td>
<td align="left">0 : 34</td>
</tr>
<tr class="odd">
<td align="left">General soil moisture</td>
<td align="left">SC</td>
<td align="left">NA</td>
<td align="left">8 : 13</td>
<td align="left">0 : 0</td>
</tr>
<tr class="even">
<td align="left">Floral volatiles</td>
<td align="left">SC</td>
<td align="left">NA</td>
<td align="left">23 : 23</td>
<td align="left">14 : 29</td>
</tr>
<tr class="odd">
<td align="left">Leaf volatiles</td>
<td align="left">SC</td>
<td align="left">NA</td>
<td align="left">23 : 23</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">Floral morphology</td>
<td align="left">SC</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">7 : 7</td>
</tr>
<tr class="odd">
<td align="left">Open top chambers</td>
<td align="left">bb</td>
<td align="left">0 : 28</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">Loggers</td>
<td align="left">bb</td>
<td align="left">4 : 28</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<pre class="r"><code>dodging &lt;- position_dodge2(width=1, reverse = T, preserve=&quot;single&quot;)
shading &lt;- data.frame(ystart=0:6+0.5, yend=1:7+0.5, col=letters[c(1,2,1,2,1,2,1)])
timings.otc %&gt;% filter(site!=&quot;bb&quot;, !variable %in% c(&quot;meltdates&quot;,&quot;hobo&quot;,&quot;otc&quot;)) %&gt;% #sds
  mutate(variable=fct_reorder(variable, begin, na.rm=T) %&gt;% 
           fct_relevel(c(&quot;vt&quot;,&quot;vt.leaf&quot;,&quot;mt&quot;,&quot;nt&quot;,&quot;flrcol&quot;,&quot;ph&quot;)) %&gt;% fct_rev(), 
         year=factor(year)) %&gt;% 
  ggplot(aes(y=variable, color=year, shape=site))+ 
  geom_rect(data=shading, aes(ymin=ystart, ymax=yend, xmin=-Inf, xmax=Inf, fill=col), inherit.aes = F, alpha=0.05)+
  scale_fill_grey(start=0, end=1, guide=&quot;none&quot;)+
  geom_linerange(aes(xmin=begin, xmax=end), 
                 position = dodging, size=1, show.legend=FALSE) + 
  geom_point(aes(x=begin), position = dodging, size=2)+
  geom_point(aes(x=end), position = dodging, size=2) + 
  scale_y_discrete(labels=timings_labels, expand=expansion(mult=c(0,0.08)))+
  labs(color=&quot;Year&quot;, shape=&quot;Site&quot;, x=&quot;Days after OTCs deployed&quot;)+ scale_color_manual(values=year_pal)+
  theme_bw() + theme(panel.grid.major.y=element_blank(), axis.title.y=element_blank(), axis.text=element_text(color=&quot;black&quot;))</code></pre>
<p><img src="plots-traits/timings-1.svg" width="480" /></p>
</div>
<div id="measurements-per-plant" class="section level2">
<h2>Measurements per plant</h2>
<pre class="r"><code>morph %&gt;% drop_na(corolla_length) %&gt;% count(site, plantid, name=&quot;n_per_plant&quot;) %&gt;% count(site, n_per_plant) %&gt;%
  kable(caption=&quot;corolla_length&quot;)</code></pre>
<table>
<caption>corolla_length</caption>
<thead>
<tr class="header">
<th align="left">site</th>
<th align="right">n_per_plant</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GNA</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">GNA</td>
<td align="right">2</td>
<td align="right">63</td>
</tr>
<tr class="odd">
<td align="left">GNA</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Maxfield</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">Maxfield</td>
<td align="right">2</td>
<td align="right">18</td>
</tr>
<tr class="even">
<td align="left">Maxfield</td>
<td align="right">3</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">Maxfield</td>
<td align="right">4</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">Maxfield</td>
<td align="right">5</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">SC</td>
<td align="right">2</td>
<td align="right">31</td>
</tr>
</tbody>
</table>
<pre class="r"><code>morph %&gt;% drop_na(corolla_width) %&gt;% count(site, plantid, name=&quot;n_per_plant&quot;) %&gt;% count(site, n_per_plant) %&gt;%
  kable(caption=&quot;corolla_width&quot;)</code></pre>
<table>
<caption>corolla_width</caption>
<thead>
<tr class="header">
<th align="left">site</th>
<th align="right">n_per_plant</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GNA</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">GNA</td>
<td align="right">2</td>
<td align="right">63</td>
</tr>
<tr class="odd">
<td align="left">GNA</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Maxfield</td>
<td align="right">1</td>
<td align="right">26</td>
</tr>
<tr class="odd">
<td align="left">Maxfield</td>
<td align="right">2</td>
<td align="right">27</td>
</tr>
<tr class="even">
<td align="left">SC</td>
<td align="right">2</td>
<td align="right">31</td>
</tr>
</tbody>
</table>
<pre class="r"><code>nectar %&gt;% drop_na(nectar_volume) %&gt;% count(site, plantid, name=&quot;n_per_plant&quot;) %&gt;% count(site, n_per_plant) %&gt;% 
  kable(caption=&quot;nectar_volume&quot;)</code></pre>
<table>
<caption>nectar_volume</caption>
<thead>
<tr class="header">
<th align="left">site</th>
<th align="right">n_per_plant</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Maxfield</td>
<td align="right">1</td>
<td align="right">28</td>
</tr>
<tr class="even">
<td align="left">Maxfield</td>
<td align="right">2</td>
<td align="right">22</td>
</tr>
<tr class="odd">
<td align="left">Maxfield</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<pre class="r"><code>phen %&gt;% drop_na(height_cm) %&gt;% count(site, plantid, name=&quot;n_per_plant&quot;) %&gt;% count(site, n_per_plant) %&gt;% 
  kable(caption=&quot;height_cm&quot;)</code></pre>
<table>
<caption>height_cm</caption>
<thead>
<tr class="header">
<th align="left">site</th>
<th align="right">n_per_plant</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Maxfield</td>
<td align="right">1</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">Maxfield</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Maxfield</td>
<td align="right">3</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">Maxfield</td>
<td align="right">4</td>
<td align="right">27</td>
</tr>
<tr class="odd">
<td align="left">Maxfield</td>
<td align="right">5</td>
<td align="right">17</td>
</tr>
<tr class="even">
<td align="left">Maxfield</td>
<td align="right">6</td>
<td align="right">11</td>
</tr>
</tbody>
</table>
<pre class="r"><code>flrcol %&gt;% drop_na(redness) %&gt;% count(site, plantid, name=&quot;n_per_plant&quot;) %&gt;% count(site, n_per_plant) %&gt;% 
  kable(caption=&quot;redness&quot;)</code></pre>
<table>
<caption>redness</caption>
<thead>
<tr class="header">
<th align="left">site</th>
<th align="right">n_per_plant</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Maxfield</td>
<td align="right">1</td>
<td align="right">26</td>
</tr>
<tr class="even">
<td align="left">Maxfield</td>
<td align="right">2</td>
<td align="right">20</td>
</tr>
</tbody>
</table>
</div>
<div id="number-of-plants" class="section level2">
<h2>Number of plants</h2>
<pre class="r"><code>morph %&gt;% drop_na(corolla_length) %&gt;% count(site, temp, plantid) %&gt;% count(site, temp) %&gt;% kable(caption=&quot;corolla_length&quot;)</code></pre>
<table>
<caption>corolla_length</caption>
<thead>
<tr class="header">
<th align="left">site</th>
<th align="left">temp</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GNA</td>
<td align="left">control</td>
<td align="right">26</td>
</tr>
<tr class="even">
<td align="left">GNA</td>
<td align="left">warmed</td>
<td align="right">41</td>
</tr>
<tr class="odd">
<td align="left">Maxfield</td>
<td align="left">control</td>
<td align="right">29</td>
</tr>
<tr class="even">
<td align="left">Maxfield</td>
<td align="left">warmed</td>
<td align="right">30</td>
</tr>
<tr class="odd">
<td align="left">SC</td>
<td align="left">control</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">SC</td>
<td align="left">warmed</td>
<td align="right">20</td>
</tr>
</tbody>
</table>
<pre class="r"><code>morph %&gt;% drop_na(corolla_width) %&gt;% count(site, temp, plantid) %&gt;% count(site, temp) %&gt;% kable(caption=&quot;corolla_width&quot;)</code></pre>
<table>
<caption>corolla_width</caption>
<thead>
<tr class="header">
<th align="left">site</th>
<th align="left">temp</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GNA</td>
<td align="left">control</td>
<td align="right">26</td>
</tr>
<tr class="even">
<td align="left">GNA</td>
<td align="left">warmed</td>
<td align="right">41</td>
</tr>
<tr class="odd">
<td align="left">Maxfield</td>
<td align="left">control</td>
<td align="right">28</td>
</tr>
<tr class="even">
<td align="left">Maxfield</td>
<td align="left">warmed</td>
<td align="right">25</td>
</tr>
<tr class="odd">
<td align="left">SC</td>
<td align="left">control</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">SC</td>
<td align="left">warmed</td>
<td align="right">20</td>
</tr>
</tbody>
</table>
<pre class="r"><code>nectar%&gt;% drop_na(nectar_volume)  %&gt;% count(site, temp, plantid) %&gt;% count(site, temp) %&gt;% kable(caption=&quot;nectar_volume&quot;)</code></pre>
<table>
<caption>nectar_volume</caption>
<thead>
<tr class="header">
<th align="left">site</th>
<th align="left">temp</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Maxfield</td>
<td align="left">control</td>
<td align="right">26</td>
</tr>
<tr class="even">
<td align="left">Maxfield</td>
<td align="left">warmed</td>
<td align="right">25</td>
</tr>
</tbody>
</table>
<pre class="r"><code>phen  %&gt;% drop_na(height_cm, temp)  %&gt;% count(site, temp, plantid) %&gt;% count(site, temp) %&gt;% kable(caption=&quot;height_cm&quot;)</code></pre>
<table>
<caption>height_cm</caption>
<thead>
<tr class="header">
<th align="left">site</th>
<th align="left">temp</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Maxfield</td>
<td align="left">control</td>
<td align="right">31</td>
</tr>
<tr class="even">
<td align="left">Maxfield</td>
<td align="left">warmed</td>
<td align="right">30</td>
</tr>
</tbody>
</table>
<pre class="r"><code>flrcol%&gt;% drop_na(redness, temp)    %&gt;% count(site, temp, plantid) %&gt;% count(site, temp) %&gt;% kable(caption=&quot;redness&quot;)</code></pre>
<table>
<caption>redness</caption>
<thead>
<tr class="header">
<th align="left">site</th>
<th align="left">temp</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Maxfield</td>
<td align="left">control</td>
<td align="right">20</td>
</tr>
<tr class="even">
<td align="left">Maxfield</td>
<td align="left">warmed</td>
<td align="right">26</td>
</tr>
</tbody>
</table>
<pre class="r"><code>sds   %&gt;% drop_na(seeds, temp)    %&gt;% count(site, temp, plantid) %&gt;% count(site, temp) %&gt;% kable(caption=&quot;seeds&quot;)</code></pre>
<table>
<caption>seeds</caption>
<thead>
<tr class="header">
<th align="left">site</th>
<th align="left">temp</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Maxfield</td>
<td align="left">control</td>
<td align="right">31</td>
</tr>
<tr class="even">
<td align="left">Maxfield</td>
<td align="left">warmed</td>
<td align="right">31</td>
</tr>
</tbody>
</table>
<pre class="r"><code>#Average data by plant
morph.mean &lt;- morph %&gt;% drop_na(corolla_length) %&gt;% 
  group_by(species, site, temp, snow, plotid, plantid) %&gt;%
  summarize(across(c(corolla_length, corolla_width), mean, na.rm=T), n = n())
nectar.mean &lt;- nectar %&gt;% drop_na(nectar_volume) %&gt;% 
  group_by(species, site, temp, snow, plotid, plantid) %&gt;%
  summarize(across(c(nectar_volume, nectar_conc, nectar_sugar), mean, na.rm=T), n = n())
phen.max &lt;- phen %&gt;% drop_na(height_cm, temp) %&gt;% filter(date!=&quot;2021-06-23&quot;) %&gt;% #before OTCs
  group_by(species, site, temp, snow, plotid, plantid) %&gt;% 
  summarize(height_cm=max(height_cm, na.rm=T)) #use the maximum plant height instead of the mean across the year (deer browsing)
flrcol.mean &lt;- flrcol %&gt;% drop_na(redness, temp) %&gt;% 
  group_by(species, site, temp, snow, plotid, plantid) %&gt;% 
  summarize(redness=mean(redness, na.rm=T))

all.mean &lt;- morph.mean %&gt;% rename(n.morph=n) %&gt;% 
  full_join(rename(nectar.mean, n.nectar=n)) %&gt;% full_join(phen.max) %&gt;% full_join(flrcol.mean) %&gt;% full_join(sds) %&gt;% ungroup()
traits.sd &lt;- map_dbl(traits,     ~sd(all.mean[[.x]], na.rm=T)) %&gt;% set_names(traits)

all.mean %&gt;% count(site, temp, plotid, plantid) %&gt;% count(site, temp, plotid) %&gt;% 
  ggplot(aes(x=n, fill=temp)) + facet_grid(site~temp) + geom_histogram(binwidth=1) +
  theme_bw() + scale_fill_brewer(palette=&quot;Set1&quot;, direction=-1, guide=&quot;none&quot;) + 
  labs(x=&quot;Number of OTCs&quot;,y=&quot;Number of morphology plants&quot;)</code></pre>
<p><img src="plots-traits/n_total-1.svg" width="480" /></p>
</div>
</div>
<div id="soil-moisture" class="section level1">
<h1>Soil moisture</h1>
<pre class="r"><code>ggplot(sm, aes(x=factor(date), y=VWC, color=temp)) + 
  facet_wrap(vars(type, site), scales=&quot;free_x&quot;, labeller = as_labeller(c(atplant=&quot;Next to plant&quot;, general=&quot;General&quot;, sitenames)))+
  geom_boxplot(outlier.size = 0.5)+
  theme_minimal() + theme(axis.text.x=element_text(angle=90, hjust=0), legend.position=&quot;top&quot;, 
                          axis.title.x = element_blank()) + 
  scale_color_brewer(palette = &quot;Set1&quot;, direction=-1)+
  labs(y=&quot;Soil Volumetric Water Content (%)&quot;, x=&quot;&quot;, color=&quot;Temperature&quot;)</code></pre>
<p><img src="plots-traits/soilmoisture-1.svg" width="576" /></p>
<pre class="r"><code>sm.mean.long &lt;- sm %&gt;% group_by(type, year, site, date, temp) %&gt;% drop_na(VWC) %&gt;% 
  summarize(SE=sd(VWC, na.rm=T)/sqrt(length(VWC)), VWC=mean(VWC, na.rm=T), n=n(), .groups=&quot;drop&quot;) %&gt;% 
  left_join(select(otc_duration, year, site, OTC_start)) %&gt;% 
  mutate(days_since_OTC = date-OTC_start)

ggplot(sm.mean.long, aes(x=days_since_OTC, y=VWC, shape=type, color=temp)) + 
  facet_wrap(vars(year, site), labeller=as_labeller(c(set_names(unique(sm.mean.long$year)), sitenames)))+
  geom_point(size=2) + geom_linerange(aes(ymin=VWC-SE, ymax=VWC+SE))+  geom_line(aes(group=temp))+
  theme_minimal() +   scale_color_brewer(&quot;Temperature&quot;, palette = &quot;Set1&quot;, direction=-1) +
  scale_shape_manual(&quot;Location&quot;, values=c(19, 1), labels=c(&quot;next to plant&quot;, &quot;general&quot;))+
  labs(x=&quot;Days since OTC deployment&quot;, y=&quot;Soil volumetric water content (%)&quot;)</code></pre>
<p><img src="plots-traits/soilmoisture-2.svg" width="576" /></p>
<pre class="r"><code>sm.mean &lt;- sm.mean.long %&gt;% select(-n) %&gt;% pivot_wider(names_from=temp, values_from=c(VWC, SE)) %&gt;% 
  mutate(VWC_diff = VWC_warmed-VWC_control) %&gt;% 
  filter(days_since_OTC &gt; 0) # some baseline VWC measurements right when OTCs deployed

print(paste(&quot;Mean difference in VWC across dates and sites (mean +-SD):&quot;, round(mean(sm.mean$VWC_diff),1),&quot;+-&quot;, round(sd(sm.mean$VWC_diff),1)))</code></pre>
<pre><code>[1] &quot;Mean difference in VWC across dates and sites (mean +-SD): -2.3 +- 1.7&quot;</code></pre>
<pre class="r"><code>ggplot(sm.mean, aes(x=VWC_control, y=VWC_warmed, shape=paste(site, type), color=factor(year))) +
  #facet_wrap(vars(type, site), labeller = as_labeller(c(atplant=&quot;Next to plant&quot;, general=&quot;General&quot;, sitenames)))+
  geom_abline(intercept=0, slope=1)+ geom_smooth(aes(group=1), color=&quot;black&quot;, se=F, span=0.7)+ geom_point(size=3) + 
  geom_errorbar(aes(ymin=VWC_warmed-SE_warmed, ymax=VWC_warmed+SE_warmed))+
  geom_errorbarh(aes(xmin=VWC_control-SE_control, xmax=VWC_control+SE_control))+
  coord_fixed(xlim=c(0,17), ylim=c(0,17)) + scale_color_manual(&quot;Year&quot;, values=year_pal)+
  scale_shape_manual(&quot;Site, location&quot;, values = c(19,1, 17, 2, 15, 0), labels=~str_replace(.x, &quot;atplant&quot;,&quot;at plant&quot;)) + 
  labs(x=&quot;Soil moisture, control (%VWC)&quot;, y=&quot;Soil moisture, warmed (%VWC)&quot;)+
  theme_bw() + scale_y_continuous(expand=expansion(mult=c(0,0.05)))+scale_x_continuous(expand=expansion(mult=c(0,0.05)))+
  theme(axis.text = element_text(color=&quot;black&quot;))</code></pre>
<p><img src="plots-traits/soilmoisture-3.svg" width="576" /></p>
</div>
<div id="trait-correlations" class="section level1">
<h1>Trait correlations</h1>
<pre class="r"><code>ggplot(morph, aes(shape=site, y=corolla_width, x=corolla_length, color=temp)) + 
  facet_wrap(vars(species), labeller = as_labeller(spnames)) +
  geom_point() + geom_smooth(aes(group=species), color=&quot;black&quot;) + 
  labs(x=&quot;Corolla length&quot;, y=&quot;Corolla width&quot;, shape=&quot;Site&quot;, color=&quot;Temperature&quot;) + 
  scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) + theme_bw() + 
  theme(strip.text=element_text(face=&quot;italic&quot;))</code></pre>
<p><img src="plots-traits/corr-1.svg" width="480" /></p>
<pre class="r"><code>ggplot(nectar, aes(y=nectar_conc, x=nectar_volume, color=temp)) + 
  geom_point() + geom_smooth(color=&quot;black&quot;) + 
  labs(x=&quot;Nectar volume (uL)&quot;, y=&quot;Nectar concentration&quot;, shape=&quot;Site&quot;, color=&quot;Temperature&quot;) + 
  scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) + theme_bw() + 
  theme(strip.text=element_text(face=&quot;italic&quot;))</code></pre>
<p><img src="plots-traits/corr-2.svg" width="480" /></p>
</div>
<div id="trait-plasticity" class="section level1">
<h1>Trait plasticity</h1>
<pre class="r"><code>morph.mean %&gt;% pivot_longer(c(corolla_length, corolla_width)) %&gt;% 
ggplot(aes(x=temp, y=value, color=temp)) + #paste(spnames[species], sitenames[site], sep=&quot;\n&quot;)
  facet_grid(name~site, scales=&quot;free_y&quot;, labeller = as_labeller(c(traitnames.units, speciessitenames)))+
  geom_violin(draw_quantiles=c(0.25, 0.5, 0.75)) + 
  #geom_signif(comparisons = list(c(1,2)), test=&quot;t.test&quot;,
  #            map_signif_level=TRUE, color=&quot;black&quot;,size=0.4, textsize=3) +
  geom_point(position=position_jitterdodge(dodge.width=0.9, jitter.width=0.3), size=1) +
  labs(x=&quot;&quot;, y=&quot;&quot;, color=&quot;Temperature&quot;) + 
  scale_y_continuous(limits=c(0,NA), expand=expansion(mult=c(0,0.05)))+
  scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) + theme_bw() +
  theme(legend.position = &quot;top&quot;, axis.title.x=element_blank(), axis.text.x=element_blank(),
        panel.grid.major.x = element_blank(), axis.ticks.x=element_blank(), axis.text=element_text(color=&quot;black&quot;))</code></pre>
<p><img src="plots-traits/plasticity_multisite-1.svg" width="480" /></p>
<pre class="r"><code>morph %&gt;% pivot_longer(c(corolla_length, corolla_width)) %&gt;% filter(site==&quot;Maxfield&quot;) %&gt;% 
ggplot(aes(x=temp, y=value, color=temp)) +
  facet_grid(name~date, scales=&quot;free_y&quot;)+
  geom_violin(draw_quantiles=c(0.25, 0.5, 0.75)) + 
  geom_signif(comparisons = list(c(1,2)), test=&quot;t.test&quot;,
              map_signif_level=TRUE, color=&quot;black&quot;,size=0.4, textsize=3) +
  geom_point(position=position_jitterdodge(dodge.width=0.9, jitter.width=0.1), size=1) +
  labs(x=&quot;&quot;, y=&quot;&quot;, color=&quot;Temperature&quot;, title=&quot;Maxfield floral morphology by date&quot;, subtitle=&quot;1-2 flowers/plant/date, unaveraged. OTCs deployed 6-25&quot;) + 
  scale_y_continuous(limits=c(0,NA))+
  scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) + theme_minimal() +
  theme(legend.position = &quot;top&quot;)</code></pre>
<p><img src="plots-traits/plasticity_multisite-2.svg" width="480" /></p>
<pre class="r"><code>nectar %&gt;% pivot_longer(c(nectar_conc, nectar_volume)) %&gt;% filter(site==&quot;Maxfield&quot;) %&gt;% 
ggplot(aes(x=temp, y=value, color=temp)) +
  facet_grid(name~date, scales=&quot;free_y&quot;)+
  geom_violin(draw_quantiles=c(0.25, 0.5, 0.75)) + 
  geom_signif(comparisons = list(c(1,2)), test=&quot;t.test&quot;,
              map_signif_level=TRUE, color=&quot;black&quot;,size=0.4, textsize=3) +
  geom_point(position=position_jitterdodge(dodge.width=0.9, jitter.width=0.1), size=1) +
  labs(x=&quot;&quot;, y=&quot;&quot;, color=&quot;Temperature&quot;, title=&quot;Maxfield nectar by date&quot;, subtitle=&quot;OTCs deployed 6-25&quot;) + 
  scale_y_continuous(limits=c(0,NA))+
  scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) + theme_minimal() +
  theme(legend.position = &quot;top&quot;)</code></pre>
<p><img src="plots-traits/plasticity_multisite-3.svg" width="480" /></p>
<pre class="r"><code>morph.meandate &lt;- morph %&gt;%  filter(site==&quot;Maxfield&quot;) %&gt;% 
  group_by(plantid, date, temp) %&gt;% summarize(across(where(is.numeric), mean, na.rm=T)) %&gt;% #mean for each date
  pivot_longer(c(corolla_length, corolla_width))

ggplot(morph.meandate, aes(x=date, y=value, color=temp)) +
  facet_wrap(vars(name), scales=&quot;free_y&quot;, labeller=as_labeller(traitnames.units))+
  geom_vline(aes(xintercept=otc_duration %&gt;% filter(site==&quot;Maxfield&quot;) %&gt;% pull(OTC_start)))+
  geom_path(aes(group=plantid), alpha=0.6) +  geom_point(size=1) + 
  geom_path(data=morph.meandate %&gt;% group_by(name, date, temp) %&gt;% summarize(value=mean(value, na.rm=T)), aes(group=temp), size=2)+
  labs(x=&quot;&quot;, y=&quot;&quot;, color=&quot;Temperature&quot;, title=&quot;Maxfield floral morphology by date&quot;, subtitle=&quot;1-2 flowers/plant/date, averaged by plant&quot;) + 
  scale_y_continuous(limits=c(0,NA))+ scale_x_date(limits=c(ymd(&quot;2021-06-24&quot;), NA))+ 
  scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) + theme_minimal() +
  theme(legend.position = &quot;top&quot;)</code></pre>
<p><img src="plots-traits/plasticity_multisite-4.svg" width="480" /></p>
<pre class="r"><code>nectar.meandate &lt;- nectar %&gt;%  filter(site==&quot;Maxfield&quot;) %&gt;% 
  group_by(plantid, date, temp) %&gt;% summarize(across(where(is.numeric), mean, na.rm=T)) %&gt;% #mean for each date
  pivot_longer(c(nectar_conc, nectar_volume))

ggplot(nectar.meandate, aes(x=date, y=value, color=temp)) +
  facet_wrap(vars(name), scales=&quot;free_y&quot;, labeller=as_labeller(traitnames.units))+
  geom_vline(aes(xintercept=otc_duration %&gt;% filter(site==&quot;Maxfield&quot;) %&gt;% pull(OTC_start)))+
  geom_path(aes(group=plantid), alpha=0.6) +  geom_point(size=1) + 
  geom_path(data=nectar.meandate %&gt;% group_by(name, date, temp) %&gt;% summarize(value=mean(value, na.rm=T)), aes(group=temp), size=2)+
  labs(x=&quot;&quot;, y=&quot;&quot;, color=&quot;Temperature&quot;, title=&quot;Maxfield nectar by date&quot;, subtitle=&quot;1-2 flowers/plant/date, averaged by plant&quot;) + 
  scale_y_continuous(limits=c(0,NA))+ scale_x_date(limits=c(ymd(&quot;2021-06-24&quot;), NA))+ 
  scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) + theme_minimal() +
  theme(legend.position = &quot;top&quot;)</code></pre>
<p><img src="plots-traits/plasticity_multisite-5.svg" width="480" /></p>
<pre class="r"><code>all.mean %&gt;% pivot_longer(any_of(floraltraits[-c(1:2)])) %&gt;% 
  filter(site==&quot;Maxfield&quot;) %&gt;% 
  drop_na(value) %&gt;% 
ggplot(aes(x=temp, y=value, color=temp)) + 
  facet_wrap(vars(name), scales=&quot;free_y&quot;, labeller = as_labeller(traitnames.units), nrow=1)+
  geom_violin(draw_quantiles=c(0.25, 0.5, 0.75)) + 
  geom_point(position=position_jitterdodge(dodge.width=0.9, jitter.width=0.1), size=1) +
  geom_signif(comparisons = list(c(1,2)), test=&quot;t.test&quot;,
              map_signif_level=TRUE, color=&quot;black&quot;,size=0.4, textsize=3) +
  labs(x=&quot;&quot;, y=&quot;&quot;, color=&quot;Temperature&quot;) + 
  scale_y_continuous(limits=c(0,NA), expand=expansion(mult=c(0,0.07)))+
  scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) + theme_bw() +
  theme(legend.position = &quot;top&quot;, axis.title.x=element_blank(), axis.text.x=element_blank(),
        panel.grid.major.x = element_blank(), axis.ticks.x=element_blank(), axis.text=element_text(color=&quot;black&quot;))</code></pre>
<p><img src="plots-traits/plasticity-1.svg" width="672" /></p>
<pre class="r"><code>all.mean %&gt;% pivot_longer(any_of(seedtraits)) %&gt;% 
  filter(site==&quot;Maxfield&quot;) %&gt;% 
  drop_na(value) %&gt;% 
ggplot(aes(x=temp, y=value, color=temp)) + 
  facet_wrap(vars(name), scales=&quot;free_y&quot;, labeller = as_labeller(traitnames.units), nrow=2)+
  geom_violin(draw_quantiles=c(0.25, 0.5, 0.75)) + 
  geom_point(position=position_jitterdodge(dodge.width=0.9, jitter.width=0.1), size=1) +
  geom_signif(comparisons = list(c(1,2)), test=&quot;t.test&quot;,
              map_signif_level=TRUE, color=&quot;black&quot;,size=0.4, textsize=3) +
  labs(x=&quot;&quot;, y=&quot;&quot;, color=&quot;Temperature&quot;) + 
  scale_y_continuous(limits=c(0,NA), expand=expansion(mult=c(0,0.07)))+
  scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) + theme_bw() +
  theme(legend.position = &quot;top&quot;, axis.title.x=element_blank(), axis.text.x=element_blank(),
        panel.grid.major.x = element_blank(), axis.ticks.x=element_blank(), axis.text=element_text(color=&quot;black&quot;))</code></pre>
<p><img src="plots-traits/seedtraits-1.svg" width="624" /></p>
</div>
<div id="effect-of-snowmelt" class="section level1">
<h1>Effect of snowmelt</h1>
<pre class="r"><code>lmer(corolla_length~temp*snow+(1|plotid)+(1|plantid),data=filter(morph, site==&quot;Maxfield&quot;)) %&gt;% anova %&gt;%
  kable(caption=&quot;corolla_length&quot;)</code></pre>
<table>
<caption>corolla_length</caption>
<colgroup>
<col width="14%" />
<col width="16%" />
<col width="16%" />
<col width="8%" />
<col width="13%" />
<col width="14%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">temp</td>
<td align="right">67.7092273</td>
<td align="right">67.7092273</td>
<td align="right">1</td>
<td align="right">50.23738</td>
<td align="right">5.9467016</td>
<td align="right">0.0183217</td>
</tr>
<tr class="even">
<td align="left">snow</td>
<td align="right">0.0076964</td>
<td align="right">0.0076964</td>
<td align="right">1</td>
<td align="right">50.23738</td>
<td align="right">0.0006760</td>
<td align="right">0.9793611</td>
</tr>
<tr class="odd">
<td align="left">temp:snow</td>
<td align="right">4.4053643</td>
<td align="right">4.4053643</td>
<td align="right">1</td>
<td align="right">50.23738</td>
<td align="right">0.3869101</td>
<td align="right">0.5367410</td>
</tr>
</tbody>
</table>
<pre class="r"><code>lmer(corolla_width ~temp*snow+(1|plotid)+(1|plantid),data=filter(morph, site==&quot;Maxfield&quot;)) %&gt;% anova %&gt;%
  kable(caption=&quot;corolla_width&quot;)</code></pre>
<table>
<caption>corolla_width</caption>
<colgroup>
<col width="15%" />
<col width="15%" />
<col width="15%" />
<col width="9%" />
<col width="13%" />
<col width="15%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">temp</td>
<td align="right">0.0206937</td>
<td align="right">0.0206937</td>
<td align="right">1</td>
<td align="right">47.25554</td>
<td align="right">0.2318347</td>
<td align="right">0.6323890</td>
</tr>
<tr class="even">
<td align="left">snow</td>
<td align="right">0.1333798</td>
<td align="right">0.1333798</td>
<td align="right">1</td>
<td align="right">47.25554</td>
<td align="right">1.4942744</td>
<td align="right">0.2276166</td>
</tr>
<tr class="odd">
<td align="left">temp:snow</td>
<td align="right">0.0233401</td>
<td align="right">0.0233401</td>
<td align="right">1</td>
<td align="right">47.25554</td>
<td align="right">0.2614829</td>
<td align="right">0.6114843</td>
</tr>
</tbody>
</table>
<pre class="r"><code>lmer(nectar_volume ~temp*snow+(1|plotid)+(1|plantid),data=nectar) %&gt;% anova %&gt;% 
  kable(caption=&quot;nectar_volume&quot;)</code></pre>
<table>
<caption>nectar_volume</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">temp</td>
<td align="right">46.5024108</td>
<td align="right">46.5024108</td>
<td align="right">1</td>
<td align="right">71</td>
<td align="right">5.0485987</td>
<td align="right">0.0277561</td>
</tr>
<tr class="even">
<td align="left">snow</td>
<td align="right">6.4097818</td>
<td align="right">6.4097818</td>
<td align="right">1</td>
<td align="right">71</td>
<td align="right">0.6958868</td>
<td align="right">0.4069672</td>
</tr>
<tr class="odd">
<td align="left">temp:snow</td>
<td align="right">0.8225343</td>
<td align="right">0.8225343</td>
<td align="right">1</td>
<td align="right">71</td>
<td align="right">0.0892996</td>
<td align="right">0.7659424</td>
</tr>
</tbody>
</table>
<pre class="r"><code>lmer(nectar_conc   ~temp*snow+(1|plotid)+(1|plantid),data=nectar) %&gt;% anova %&gt;% 
  kable(caption=&quot;nectar_conc&quot;)</code></pre>
<table>
<caption>nectar_conc</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">temp</td>
<td align="right">7.17312</td>
<td align="right">7.17312</td>
<td align="right">1</td>
<td align="right">64</td>
<td align="right">0.2885804</td>
<td align="right">0.5929945</td>
</tr>
<tr class="even">
<td align="left">snow</td>
<td align="right">83.58354</td>
<td align="right">83.58354</td>
<td align="right">1</td>
<td align="right">64</td>
<td align="right">3.3626330</td>
<td align="right">0.0713417</td>
</tr>
<tr class="odd">
<td align="left">temp:snow</td>
<td align="right">40.77064</td>
<td align="right">40.77064</td>
<td align="right">1</td>
<td align="right">64</td>
<td align="right">1.6402357</td>
<td align="right">0.2049150</td>
</tr>
</tbody>
</table>
<pre class="r"><code>lmer(height_cm   ~temp*snow+(1|plotid),data=phen.max) %&gt;% anova %&gt;% 
  kable(caption=&quot;height_cm&quot;)</code></pre>
<table>
<caption>height_cm</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">temp</td>
<td align="right">20.15551</td>
<td align="right">20.15551</td>
<td align="right">1</td>
<td align="right">46.592700</td>
<td align="right">0.1764463</td>
<td align="right">0.6763760</td>
</tr>
<tr class="even">
<td align="left">snow</td>
<td align="right">28.75377</td>
<td align="right">28.75377</td>
<td align="right">1</td>
<td align="right">5.189353</td>
<td align="right">0.2517175</td>
<td align="right">0.6364279</td>
</tr>
<tr class="odd">
<td align="left">temp:snow</td>
<td align="right">30.74140</td>
<td align="right">30.74140</td>
<td align="right">1</td>
<td align="right">46.592700</td>
<td align="right">0.2691177</td>
<td align="right">0.6063795</td>
</tr>
</tbody>
</table>
<pre class="r"><code>lmer(redness     ~temp*snow+(1|plotid)+(1|plantid), data=flrcol) %&gt;% anova %&gt;% 
  kable(caption=&quot;redness&quot;)</code></pre>
<table>
<caption>redness</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">temp</td>
<td align="right">0.0034027</td>
<td align="right">0.0034027</td>
<td align="right">1</td>
<td align="right">62</td>
<td align="right">0.8620574</td>
<td align="right">0.3567643</td>
</tr>
<tr class="even">
<td align="left">snow</td>
<td align="right">0.0147175</td>
<td align="right">0.0147175</td>
<td align="right">1</td>
<td align="right">62</td>
<td align="right">3.7286085</td>
<td align="right">0.0580634</td>
</tr>
<tr class="odd">
<td align="left">temp:snow</td>
<td align="right">0.0000153</td>
<td align="right">0.0000153</td>
<td align="right">1</td>
<td align="right">62</td>
<td align="right">0.0038819</td>
<td align="right">0.9505204</td>
</tr>
</tbody>
</table>
</div>
<div id="effect-of-temperature" class="section level1">
<h1>Effect of temperature</h1>
<pre class="r"><code>temp.mod &lt;- tribble(
  ~trait,        ~species,  ~model,
  &quot;total_vols&quot;,    &quot;aggD&quot;, lmer(total_vols    ~temp+site+year+(1|plantid), data=filter(svfl, type==&quot;floral&quot;, species==&quot;agg&quot;)),
  &quot;total_vols&quot;,    &quot;tenD&quot;, lmer(total_vols    ~temp+year+(1|plantid), data=filter(svfl, type==&quot;floral&quot;, species==&quot;ten&quot;, DN==&quot;day&quot;)),
  &quot;total_vols&quot;,    &quot;tenN&quot;, lmer(total_vols    ~temp+year+(1|plantid), data=filter(svfl, type==&quot;floral&quot;, species==&quot;ten&quot;, DN==&quot;night&quot;)),
  &quot;total_vols_leaf&quot;,&quot;leafD&quot;, lm(total_vols    ~temp+species, 
                                  data=mutate(filter(svfl, type==&quot;leaf&quot;), total_vols=total_vols/1000)),#g to mg biomass
  &quot;corolla_length&quot;, &quot;agg&quot;, lmer(corolla_length~temp+site+(1|plantid), data=filter(morph, species==&quot;agg&quot;)),
  &quot;corolla_length&quot;, &quot;ten&quot;, lmer(corolla_length~temp+(1|plantid), data=filter(morph, species==&quot;ten&quot;)),
  &quot;corolla_width&quot;,  &quot;agg&quot;, lmer(corolla_width ~temp+site+(1|plantid), data=filter(morph, species==&quot;agg&quot;)),
  &quot;corolla_width&quot;,  &quot;ten&quot;, lmer(corolla_width ~temp+(1|plantid), data=filter(morph, species==&quot;ten&quot;)),
  &quot;nectar_volume&quot;,  &quot;agg&quot;, lmer(nectar_volume ~temp+(1|plantid),data=nectar),
  &quot;nectar_conc&quot;,    &quot;agg&quot;, lmer(nectar_conc   ~temp+(1|plantid),data=nectar),
  &quot;redness&quot;,        &quot;agg&quot;, lmer(redness       ~temp+(1|plantid), data=flrcol),
  &quot;height_cm&quot;,      &quot;agg&quot;, lm(height_cm       ~temp, data=phen.max),
  &quot;openbuds&quot;,       &quot;agg&quot;, lmer(I(open+buds)  ~temp*date + (1|plantid), data=mutate(filter(phen.raw, date!=&quot;2021-06-23&quot;), date=factor(date))),
  &quot;eggs_per_flower&quot;,&quot;agg&quot;,lmer(eggs_per_flower~temp*date + (1|plantid), data=mutate(filter(phen.raw, date!=&quot;2021-06-23&quot;), date=factor(date)))) %&gt;% 
  bind_rows(tibble(trait=seedtraits[-1], species=&quot;agg&quot;) %&gt;% 
              mutate(model = map(trait, ~lm(formula(paste(.x, &quot;~ temp&quot;)), data = sds)))) %&gt;% 
  mutate(test = map(model, ~tidy(anova(.x))), 
         emm = map(model, ~tidy(emmeans(.x, ~ temp))),
         data = map(model, model.frame),
         n_plants = map_int(data, ~nlevels(.x$plantid)),
         n_samples = map_int(data, nrow))

temp.mod %&gt;% select(-model,-test,-data) %&gt;% unnest(emm) %&gt;% 
  pivot_wider(names_from = temp, values_from=c(estimate, std.error), id_cols=c(trait, species)) %&gt;% 
  mutate(change=(estimate_warmed-estimate_control)/estimate_control) %&gt;% 
  left_join(temp.mod %&gt;% select(-model,-emm,-data) %&gt;% unnest(test) %&gt;% filter(term!=&quot;Residuals&quot;)) %&gt;% 
  select(trait, species, term, NumDF, DenDF, F.value=statistic, p.value, n_plants, n_samples,
         estimate_control, std.error_control, estimate_warmed, std.error_warmed, change) %&gt;% 
  mutate(trait = c(set_names(str_replace(traitnames.units,&quot;\n&quot;,&quot; &quot;), names(traitnames.units)),
                   total_vols=&quot;Total volatile emissions (ng/flower/hr)&quot;,
                   total_vols_leaf = &quot;Total volatile emissions (ng/mg/hr)&quot;,
                   openbuds = &quot;Open flowers and elongated buds&quot;,
                   eggs_per_flower = &quot;Eggs per flower&quot;)[trait], 
         species = c(spnames, aggD=&quot;I. aggregata day&quot;, 
                     tenD=&quot;I. tenuituba day&quot;, tenN = &quot;I. tenuituba night&quot;, leafD=&quot;Leaves day&quot;)[species], 
         term = recode(term, temp=&quot;Treatment&quot;, site=&quot;Site&quot;, year=&quot;Year&quot;, species=&quot;Species&quot;, date=&quot;Date&quot;,`temp:date`=&quot;Date \U00D7 Trt&quot;)) %&gt;% kable(digits=3)</code></pre>
<table style="width:100%;">
<colgroup>
<col width="20%" />
<col width="9%" />
<col width="5%" />
<col width="3%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="5%" />
<col width="8%" />
<col width="9%" />
<col width="8%" />
<col width="8%" />
<col width="3%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">trait</th>
<th align="left">species</th>
<th align="left">term</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F.value</th>
<th align="right">p.value</th>
<th align="right">n_plants</th>
<th align="right">n_samples</th>
<th align="right">estimate_control</th>
<th align="right">std.error_control</th>
<th align="right">estimate_warmed</th>
<th align="right">std.error_warmed</th>
<th align="right">change</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Total volatile emissions (ng/flower/hr)</td>
<td align="left">I. aggregata day</td>
<td align="left">Treatment</td>
<td align="right">1</td>
<td align="right">132.675</td>
<td align="right">0.104</td>
<td align="right">0.747</td>
<td align="right">153</td>
<td align="right">203</td>
<td align="right">87.268</td>
<td align="right">18.743</td>
<td align="right">93.717</td>
<td align="right">17.303</td>
<td align="right">0.074</td>
</tr>
<tr class="even">
<td align="left">Total volatile emissions (ng/flower/hr)</td>
<td align="left">I. aggregata day</td>
<td align="left">Site</td>
<td align="right">1</td>
<td align="right">99.554</td>
<td align="right">0.908</td>
<td align="right">0.343</td>
<td align="right">153</td>
<td align="right">203</td>
<td align="right">87.268</td>
<td align="right">18.743</td>
<td align="right">93.717</td>
<td align="right">17.303</td>
<td align="right">0.074</td>
</tr>
<tr class="odd">
<td align="left">Total volatile emissions (ng/flower/hr)</td>
<td align="left">I. aggregata day</td>
<td align="left">Year</td>
<td align="right">2</td>
<td align="right">172.102</td>
<td align="right">5.743</td>
<td align="right">0.004</td>
<td align="right">153</td>
<td align="right">203</td>
<td align="right">87.268</td>
<td align="right">18.743</td>
<td align="right">93.717</td>
<td align="right">17.303</td>
<td align="right">0.074</td>
</tr>
<tr class="even">
<td align="left">Total volatile emissions (ng/flower/hr)</td>
<td align="left">I. tenuituba day</td>
<td align="left">Treatment</td>
<td align="right">1</td>
<td align="right">89.000</td>
<td align="right">2.280</td>
<td align="right">0.135</td>
<td align="right">61</td>
<td align="right">92</td>
<td align="right">160.841</td>
<td align="right">34.366</td>
<td align="right">224.921</td>
<td align="right">31.586</td>
<td align="right">0.398</td>
</tr>
<tr class="odd">
<td align="left">Total volatile emissions (ng/flower/hr)</td>
<td align="left">I. tenuituba day</td>
<td align="left">Year</td>
<td align="right">1</td>
<td align="right">89.000</td>
<td align="right">0.359</td>
<td align="right">0.551</td>
<td align="right">61</td>
<td align="right">92</td>
<td align="right">160.841</td>
<td align="right">34.366</td>
<td align="right">224.921</td>
<td align="right">31.586</td>
<td align="right">0.398</td>
</tr>
<tr class="even">
<td align="left">Total volatile emissions (ng/flower/hr)</td>
<td align="left">I. tenuituba night</td>
<td align="left">Treatment</td>
<td align="right">1</td>
<td align="right">59.382</td>
<td align="right">0.245</td>
<td align="right">0.622</td>
<td align="right">58</td>
<td align="right">83</td>
<td align="right">495.035</td>
<td align="right">111.211</td>
<td align="right">425.752</td>
<td align="right">99.265</td>
<td align="right">-0.140</td>
</tr>
<tr class="odd">
<td align="left">Total volatile emissions (ng/flower/hr)</td>
<td align="left">I. tenuituba night</td>
<td align="left">Year</td>
<td align="right">1</td>
<td align="right">66.460</td>
<td align="right">5.684</td>
<td align="right">0.020</td>
<td align="right">58</td>
<td align="right">83</td>
<td align="right">495.035</td>
<td align="right">111.211</td>
<td align="right">425.752</td>
<td align="right">99.265</td>
<td align="right">-0.140</td>
</tr>
<tr class="even">
<td align="left">Total volatile emissions (ng/mg/hr)</td>
<td align="left">Leaves day</td>
<td align="left">Treatment</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1.093</td>
<td align="right">0.304</td>
<td align="right">0</td>
<td align="right">35</td>
<td align="right">17.189</td>
<td align="right">4.018</td>
<td align="right">21.520</td>
<td align="right">3.699</td>
<td align="right">0.252</td>
</tr>
<tr class="odd">
<td align="left">Total volatile emissions (ng/mg/hr)</td>
<td align="left">Leaves day</td>
<td align="left">Species</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">3.040</td>
<td align="right">0.091</td>
<td align="right">0</td>
<td align="right">35</td>
<td align="right">17.189</td>
<td align="right">4.018</td>
<td align="right">21.520</td>
<td align="right">3.699</td>
<td align="right">0.252</td>
</tr>
<tr class="even">
<td align="left">Corolla length (mm)</td>
<td align="left">I. aggregata</td>
<td align="left">Treatment</td>
<td align="right">1</td>
<td align="right">121.882</td>
<td align="right">4.525</td>
<td align="right">0.035</td>
<td align="right">126</td>
<td align="right">323</td>
<td align="right">25.560</td>
<td align="right">0.313</td>
<td align="right">26.451</td>
<td align="right">0.279</td>
<td align="right">0.035</td>
</tr>
<tr class="odd">
<td align="left">Corolla length (mm)</td>
<td align="left">I. aggregata</td>
<td align="left">Site</td>
<td align="right">1</td>
<td align="right">126.857</td>
<td align="right">0.481</td>
<td align="right">0.489</td>
<td align="right">126</td>
<td align="right">323</td>
<td align="right">25.560</td>
<td align="right">0.313</td>
<td align="right">26.451</td>
<td align="right">0.279</td>
<td align="right">0.035</td>
</tr>
<tr class="even">
<td align="left">Corolla length (mm)</td>
<td align="left">I. tenuituba</td>
<td align="left">Treatment</td>
<td align="right">1</td>
<td align="right">29.000</td>
<td align="right">0.160</td>
<td align="right">0.692</td>
<td align="right">31</td>
<td align="right">62</td>
<td align="right">30.932</td>
<td align="right">0.601</td>
<td align="right">30.632</td>
<td align="right">0.446</td>
<td align="right">-0.010</td>
</tr>
<tr class="odd">
<td align="left">Corolla width (mm)</td>
<td align="left">I. aggregata</td>
<td align="left">Treatment</td>
<td align="right">1</td>
<td align="right">113.757</td>
<td align="right">0.529</td>
<td align="right">0.469</td>
<td align="right">120</td>
<td align="right">213</td>
<td align="right">3.355</td>
<td align="right">0.042</td>
<td align="right">3.314</td>
<td align="right">0.039</td>
<td align="right">-0.012</td>
</tr>
<tr class="even">
<td align="left">Corolla width (mm)</td>
<td align="left">I. aggregata</td>
<td align="left">Site</td>
<td align="right">1</td>
<td align="right">117.148</td>
<td align="right">32.475</td>
<td align="right">0.000</td>
<td align="right">120</td>
<td align="right">213</td>
<td align="right">3.355</td>
<td align="right">0.042</td>
<td align="right">3.314</td>
<td align="right">0.039</td>
<td align="right">-0.012</td>
</tr>
<tr class="odd">
<td align="left">Corolla width (mm)</td>
<td align="left">I. tenuituba</td>
<td align="left">Treatment</td>
<td align="right">1</td>
<td align="right">29.000</td>
<td align="right">4.258</td>
<td align="right">0.048</td>
<td align="right">31</td>
<td align="right">62</td>
<td align="right">2.373</td>
<td align="right">0.089</td>
<td align="right">2.145</td>
<td align="right">0.066</td>
<td align="right">-0.096</td>
</tr>
<tr class="even">
<td align="left">Nectar production (L/day)</td>
<td align="left">I. aggregata</td>
<td align="left">Treatment</td>
<td align="right">1</td>
<td align="right">73.000</td>
<td align="right">4.790</td>
<td align="right">0.032</td>
<td align="right">51</td>
<td align="right">75</td>
<td align="right">3.790</td>
<td align="right">0.464</td>
<td align="right">5.327</td>
<td align="right">0.537</td>
<td align="right">0.406</td>
</tr>
<tr class="odd">
<td align="left">Nectar conc. (% by mass)</td>
<td align="left">I. aggregata</td>
<td align="left">Treatment</td>
<td align="right">1</td>
<td align="right">66.000</td>
<td align="right">0.054</td>
<td align="right">0.817</td>
<td align="right">49</td>
<td align="right">68</td>
<td align="right">25.405</td>
<td align="right">0.851</td>
<td align="right">25.694</td>
<td align="right">0.925</td>
<td align="right">0.011</td>
</tr>
<tr class="even">
<td align="left">Redness index</td>
<td align="left">I. aggregata</td>
<td align="left">Treatment</td>
<td align="right">1</td>
<td align="right">64.000</td>
<td align="right">0.694</td>
<td align="right">0.408</td>
<td align="right">46</td>
<td align="right">66</td>
<td align="right">0.312</td>
<td align="right">0.012</td>
<td align="right">0.298</td>
<td align="right">0.010</td>
<td align="right">-0.042</td>
</tr>
<tr class="odd">
<td align="left">Inflorescence height (cm)</td>
<td align="left">I. aggregata</td>
<td align="left">Treatment</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.144</td>
<td align="right">0.706</td>
<td align="right">0</td>
<td align="right">61</td>
<td align="right">41.935</td>
<td align="right">1.905</td>
<td align="right">42.967</td>
<td align="right">1.936</td>
<td align="right">0.025</td>
</tr>
<tr class="even">
<td align="left">Open flowers and elongated buds</td>
<td align="left">I. aggregata</td>
<td align="left">Treatment</td>
<td align="right">1</td>
<td align="right">75.670</td>
<td align="right">1.229</td>
<td align="right">0.271</td>
<td align="right">61</td>
<td align="right">256</td>
<td align="right">6.154</td>
<td align="right">0.874</td>
<td align="right">7.549</td>
<td align="right">0.906</td>
<td align="right">0.227</td>
</tr>
<tr class="odd">
<td align="left">Open flowers and elongated buds</td>
<td align="left">I. aggregata</td>
<td align="left">Date</td>
<td align="right">6</td>
<td align="right">201.443</td>
<td align="right">14.831</td>
<td align="right">0.000</td>
<td align="right">61</td>
<td align="right">256</td>
<td align="right">6.154</td>
<td align="right">0.874</td>
<td align="right">7.549</td>
<td align="right">0.906</td>
<td align="right">0.227</td>
</tr>
<tr class="even">
<td align="left">Open flowers and elongated buds</td>
<td align="left">I. aggregata</td>
<td align="left">Date  Trt</td>
<td align="right">6</td>
<td align="right">201.443</td>
<td align="right">0.273</td>
<td align="right">0.949</td>
<td align="right">61</td>
<td align="right">256</td>
<td align="right">6.154</td>
<td align="right">0.874</td>
<td align="right">7.549</td>
<td align="right">0.906</td>
<td align="right">0.227</td>
</tr>
<tr class="odd">
<td align="left">Eggs per flower</td>
<td align="left">I. aggregata</td>
<td align="left">Treatment</td>
<td align="right">1</td>
<td align="right">87.420</td>
<td align="right">5.331</td>
<td align="right">0.023</td>
<td align="right">60</td>
<td align="right">195</td>
<td align="right">0.110</td>
<td align="right">0.024</td>
<td align="right">0.035</td>
<td align="right">0.022</td>
<td align="right">-0.684</td>
</tr>
<tr class="even">
<td align="left">Eggs per flower</td>
<td align="left">I. aggregata</td>
<td align="left">Date</td>
<td align="right">6</td>
<td align="right">146.268</td>
<td align="right">13.685</td>
<td align="right">0.000</td>
<td align="right">60</td>
<td align="right">195</td>
<td align="right">0.110</td>
<td align="right">0.024</td>
<td align="right">0.035</td>
<td align="right">0.022</td>
<td align="right">-0.684</td>
</tr>
<tr class="odd">
<td align="left">Eggs per flower</td>
<td align="left">I. aggregata</td>
<td align="left">Date  Trt</td>
<td align="right">6</td>
<td align="right">146.268</td>
<td align="right">3.275</td>
<td align="right">0.005</td>
<td align="right">60</td>
<td align="right">195</td>
<td align="right">0.110</td>
<td align="right">0.024</td>
<td align="right">0.035</td>
<td align="right">0.022</td>
<td align="right">-0.684</td>
</tr>
<tr class="even">
<td align="left">Seeds per fruit</td>
<td align="left">I. aggregata</td>
<td align="left">Treatment</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.479</td>
<td align="right">0.492</td>
<td align="right">0</td>
<td align="right">51</td>
<td align="right">5.960</td>
<td align="right">0.578</td>
<td align="right">6.521</td>
<td align="right">0.567</td>
<td align="right">0.094</td>
</tr>
<tr class="odd">
<td align="left">Estimated total seeds</td>
<td align="left">I. aggregata</td>
<td align="left">Treatment</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.246</td>
<td align="right">0.622</td>
<td align="right">0</td>
<td align="right">51</td>
<td align="right">142.954</td>
<td align="right">21.340</td>
<td align="right">128.121</td>
<td align="right">20.926</td>
<td align="right">-0.104</td>
</tr>
<tr class="even">
<td align="left">Nonaborted fruits</td>
<td align="left">I. aggregata</td>
<td align="left">Treatment</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.079</td>
<td align="right">0.779</td>
<td align="right">0</td>
<td align="right">62</td>
<td align="right">36.129</td>
<td align="right">6.232</td>
<td align="right">33.645</td>
<td align="right">6.232</td>
<td align="right">-0.069</td>
</tr>
<tr class="odd">
<td align="left">Flower number</td>
<td align="left">I. aggregata</td>
<td align="left">Treatment</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.031</td>
<td align="right">0.862</td>
<td align="right">0</td>
<td align="right">62</td>
<td align="right">57.742</td>
<td align="right">7.424</td>
<td align="right">55.903</td>
<td align="right">7.424</td>
<td align="right">-0.032</td>
</tr>
<tr class="even">
<td align="left">Prop. nonaborted fruits infested</td>
<td align="left">I. aggregata</td>
<td align="left">Treatment</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1.105</td>
<td align="right">0.298</td>
<td align="right">0</td>
<td align="right">59</td>
<td align="right">0.138</td>
<td align="right">0.024</td>
<td align="right">0.103</td>
<td align="right">0.023</td>
<td align="right">-0.255</td>
</tr>
<tr class="odd">
<td align="left">Prop. fruits aborted</td>
<td align="left">I. aggregata</td>
<td align="left">Treatment</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.404</td>
<td align="right">0.527</td>
<td align="right">0</td>
<td align="right">62</td>
<td align="right">0.444</td>
<td align="right">0.050</td>
<td align="right">0.489</td>
<td align="right">0.050</td>
<td align="right">0.101</td>
</tr>
<tr class="even">
<td align="left">Estimated seeds per flower</td>
<td align="left">I. aggregata</td>
<td align="left">Treatment</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.596</td>
<td align="right">0.444</td>
<td align="right">0</td>
<td align="right">51</td>
<td align="right">2.193</td>
<td align="right">0.231</td>
<td align="right">1.942</td>
<td align="right">0.227</td>
<td align="right">-0.114</td>
</tr>
</tbody>
</table>
</div>
<div id="flower-color" class="section level1">
<h1>Flower color</h1>
<div id="spectra" class="section level2">
<h2>Spectra</h2>
<pre class="r"><code>library(pavo)
# use human range to estimate perceived color (requires interpolated 300 nm data)
flrspec.human &lt;- cbind(wl, flrcol.raw) %&gt;% as.rspec(lim = c(300,700))#no UV data below 350 nm, interpolate
#plot(flrspec.human, col = turbo(ncol(flrspec)), main=&quot;Raw data&quot;)
#plot(flrspec.human, col = spec2rgb(flrspec.human), main=&quot;Raw data&quot;)
flrspec.human.nm &lt;- procspec(flrspec.human, opt = c(&quot;smooth&quot;, &quot;max&quot;), span=0.08) #smooth and normalize
#plot(flrspec.human.nm, col = turbo(ncol(flrspec)), main=&quot;Divide by max&quot;)
flrspec.human.nm.zero &lt;- procspec(flrspec.human.nm, fixneg=&quot;zero&quot;) #throw out negative reflectance
#plot(flrspec.human.nm.zero, col = turbo(ncol(flrspec)), main=&quot;Divide by max&quot;)
#plot(flrspec.human.nm.zero, col = spec2rgb(flrspec.human.nm.zero), main=&quot;Divide by max&quot;)
flrcol$RGB &lt;- spec2rgb(flrspec.human.nm.zero)</code></pre>
<pre class="r"><code>ggplot(flrcol.long, aes(x=wl, y=values, color=ind)) + geom_line() + 
  annotate(&quot;rect&quot;, xmin=401, xmax=750, ymin=0, ymax=100, fill=NA, color=&quot;black&quot;, size=1) +
  annotate(&quot;rect&quot;, xmin=476, xmax=550, ymin=0, ymax=100, fill=NA, color=&quot;green&quot;, size=1) +
  annotate(&quot;rect&quot;, xmin=626, xmax=700, ymin=0, ymax=100, fill=NA, color=&quot;red&quot;, size=1) +
  labs(x=&quot;Wavelength (nm)&quot;, y=&quot;Reflectance (%)&quot;)+ guides(color=&quot;none&quot;) + theme_minimal() +
  scale_x_continuous(n.breaks=10, limits=c(350, 1000)) + scale_color_viridis_d(option=&quot;turbo&quot;)</code></pre>
<p><img src="plots-traits/flrcol-1.png" width="480" /></p>
<pre class="r"><code>plot_colranges &lt;- function() {
  abline(v=476, lwd=2, col=&quot;green&quot;); abline(v=550, lwd=2, col=&quot;green&quot;)
  abline(v=626, lwd=2, col=&quot;red&quot;);   abline(v=700, lwd=2, col=&quot;red&quot;)
  abline(v=401, lwd=2, col=&quot;black&quot;); abline(v=750, lwd=2, col=&quot;black&quot;)
}

flrspec &lt;- cbind(wl, flrcol.raw) %&gt;% as.rspec(lim = c(401,750))
plot(flrspec, col = turbo(ncol(flrspec)), main=&quot;Raw data&quot;); plot_colranges()</code></pre>
<p><img src="plots-traits/flrcol-2.png" width="480" /></p>
<pre class="r"><code>heatmap(t(as.matrix(flrspec)[,-1]), Rowv = NA, Colv=NA, scale=&quot;none&quot;, col=viridis(128), main=&quot;Raw data&quot;) #block of samples zeroed wrong?</code></pre>
<p><img src="plots-traits/flrcol-3.png" width="480" /></p>
<pre class="r"><code>ggplot(flrcol.total %&gt;% mutate(index=row_number()), aes(x=index, y=values, color=paste(color, total))) +
  geom_point() + geom_smooth(span=0.2) + labs(x=&quot;Sample number&quot;, y=&quot;Summed reflectance&quot;, color=&quot;Wavelength range&quot;)+
  scale_color_manual(values=c(&quot;green&quot;, &quot;grey50&quot; ,&quot;black&quot;,&quot;red&quot;), 
                     labels=c(&quot;green&quot;,&quot;outside 400-750 nm&quot;, &quot;other inside 400-750 nm&quot;, &quot;red&quot;))</code></pre>
<p><img src="plots-traits/flrcol-4.png" width="480" /></p>
<pre class="r"><code>ggplot(flrcol %&gt;% mutate(index=row_number()), aes(x=index, y=redness)) +
  geom_point() + geom_smooth(span=0.3) + labs(x=&quot;Sample number&quot;, y=&quot;Redness&quot;)</code></pre>
<p><img src="plots-traits/flrcol-5.png" width="480" /></p>
<pre class="r"><code>flrspec.nm.zero &lt;- procspec(flrspec, opt = c(&quot;smooth&quot;, &quot;max&quot;), span=0.08, fixneg=&quot;zero&quot;) #smooth, normalize, zero negatives
plot(flrspec.nm.zero, col = turbo(ncol(flrspec)), main=&quot;Divide by max&quot;); plot_colranges()</code></pre>
<p><img src="plots-traits/flrcol-6.png" width="480" /></p>
<pre class="r"><code>heatmap(t(as.matrix(flrspec.nm.zero)[,-1]), Rowv = NA, Colv=NA, scale=&quot;none&quot;, col=viridis(128), main=&quot;Divide by max&quot;) #block fixed by normalizing</code></pre>
<p><img src="plots-traits/flrcol-7.png" width="480" /></p>
<pre class="r"><code>plot(flrspec.nm.zero, col = flrcol$RGB, main=&quot;Divide by max&quot;); plot_colranges()</code></pre>
<p><img src="plots-traits/flrcol-8.png" width="480" /></p>
<pre class="r"><code>plot(flrspec.nm.zero, col = viridis(100)[300*(flrcol$redness-0.1)], main=&quot;Divide by max, color by redness&quot;); plot_colranges()</code></pre>
<p><img src="plots-traits/flrcol-9.png" width="480" /></p>
<pre class="r"><code>flrspec.sum.zero &lt;- procspec(flrspec, opt = c(&quot;smooth&quot;, &quot;sum&quot;), span=0.08, fixneg=&quot;zero&quot;) #smooth, normalize, zero negatives
plot(flrspec.sum.zero, col = viridis(100)[300*(flrcol$redness-0.1)], main=&quot;Divide by sum, color by redness&quot;); plot_colranges()</code></pre>
<p><img src="plots-traits/flrcol-10.png" width="480" /></p>
</div>
<div id="pca" class="section level2">
<h2>PCA</h2>
<pre class="r"><code>flrspec.nm.zero.bin &lt;- procspec(flrspec.nm.zero, opt = c(&quot;bin&quot;, &quot;center&quot;), bins=16) 
rownames(flrspec.nm.zero.bin) &lt;- flrspec.nm.zero.bin[,1]
library(vegan)
flrcol.pca &lt;- rda(t(flrspec.nm.zero.bin[,-1]), scale = TRUE)
flrcol &lt;- bind_cols(flrcol, scores(flrcol.pca, display=&quot;sites&quot;))
plot(flrcol.pca, type=&quot;none&quot;, main=paste(&quot;PCA of&quot;, nrow(flrspec.nm.zero.bin),&quot;wavelength bins&quot;))
ordispider(flrcol.pca, flrcol$plantid, col=&quot;grey40&quot;)
points(flrcol.pca, display=&quot;sites&quot;, col=flrcol$RGB, pch=c(17,19)[flrcol$temp])
text(flrcol.pca, display=&quot;species&quot;, col=&quot;black&quot;, cex=0.8)</code></pre>
<p><img src="plots-traits/flrcol_pca-1.svg" width="480" /></p>
<pre class="r"><code>library(GGally)
ggpairs(select(flrcol, total, red_TRUE, green_TRUE, redness, PC1), 
        lower=list(continuous=wrap(&quot;smooth&quot;, method = &quot;loess&quot;)))</code></pre>
<p><img src="plots-traits/flrcol_pca-2.svg" width="480" /></p>
</div>
<div id="cap" class="section level2">
<h2>CAP</h2>
<pre class="r"><code>flrcol.cap &lt;- capscale(t(flrspec.nm.zero.bin[,-1]) ~ temp, scale = TRUE, data=flrcol)
anova(flrcol.cap, by=&quot;term&quot;)</code></pre>
<pre><code>Permutation test for capscale under reduced model
Terms added sequentially (first to last)
Permutation: free
Number of permutations: 999

Model: capscale(formula = t(flrspec.nm.zero.bin[, -1]) ~ temp, data = flrcol, scale = TRUE)
         Df SumOfSqs      F Pr(&gt;F)
temp      1   0.0674 1.0572  0.302
Residual 64   4.0795              </code></pre>
</div>
<div id="spectrum-vs.-temp" class="section level2">
<h2>Spectrum vs.temp</h2>
<pre class="r"><code>aggplot(procspec(flrspec, opt=&quot;smooth&quot;, span=0.08), flrcol$temp, legend= T, main=&quot;Raw data&quot;)</code></pre>
<p><img src="plots-traits/flrcol_avg-1.svg" width="480" /></p>
<pre class="r"><code>aggplot(flrspec.nm.zero, flrcol$temp, legend= T,main= &quot;Divided by max&quot;)</code></pre>
<p><img src="plots-traits/flrcol_avg-2.svg" width="480" /></p>
<pre class="r"><code>aggplot(flrspec.sum.zero, flrcol$temp, legend= T, main=&quot;Divided by sum&quot;)</code></pre>
<p><img src="plots-traits/flrcol_avg-3.svg" width="480" /></p>
</div>
</div>
<div id="phenology-and-fly-eggs" class="section level1">
<h1>Phenology and fly eggs</h1>
<pre class="r"><code>phen.raw %&gt;% count(date, plantid) %&gt;% ggplot(aes(x=date, y=plantid))+ geom_tile() + geom_vline(xintercept=ymd(&quot;2021-06-25&quot;))</code></pre>
<p><img src="plots-traits/phenology_inventory-1.svg" width="480" /></p>
<div id="snowmelt-effects" class="section level2">
<h2>Snowmelt effects</h2>
<pre class="r"><code>phen %&gt;% drop_na(snow,temp) %&gt;% group_by(snow, temp, julian) %&gt;% summarize_at(c(&quot;open&quot;,&quot;buds&quot;), mean, na.rm=T) %&gt;% 
  ggplot(aes(x=julian, y=open, shape=snow, linetype=snow, color=temp))+ geom_point() + 
  geom_path(aes(group=paste(snow, temp))) +
  labs(y=&quot;Mean total flowers&quot;, 
       x=&quot;Day of year&quot;, color=&quot;Temperature&quot;, shape=&quot;Snowmelt&quot;, linetype=&quot;Snowmelt&quot;) +
  scale_x_continuous(breaks=seq(120,240, by=20))+
  scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) +
  scale_linetype_manual(values=c(2,1)) + theme_minimal() + 
  theme(legend.key.size = unit(2, &quot;lines&quot;))</code></pre>
<p><img src="plots-traits/phenology_snow-1.svg" width="480" /></p>
<pre class="r"><code>phen %&gt;% drop_na(snow,temp)%&gt;% group_by(snow, temp, julian) %&gt;% summarize_at(&quot;flowering&quot;, mean, na.rm=T) %&gt;% 
  ggplot(aes(x=julian, y=flowering, shape=snow, linetype=snow, color=temp))+ geom_point() + 
  geom_path(aes(group=paste(snow, temp))) +
  labs(y=&quot;Proportion flowering&quot;, 
       x=&quot;Day of year&quot;, color=&quot;Temperature&quot;, shape=&quot;Snowmelt&quot;, linetype=&quot;Snowmelt&quot;) +
  scale_x_continuous(breaks=seq(120,240, by=20))+
  scale_y_continuous(labels = scales::percent)+
  scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) +
  scale_linetype_manual(values=c(2,1)) + theme_minimal() + 
  theme(legend.key.size = unit(2, &quot;lines&quot;))</code></pre>
<p><img src="plots-traits/phenology_snow-2.svg" width="480" /></p>
<pre class="r"><code>phen %&gt;% drop_na(snow,temp)%&gt;% group_by(snow, temp, julian) %&gt;% summarize_at(&quot;eggs&quot;, mean, na.rm=T) %&gt;% 
  ggplot(aes(x=julian, y=eggs, shape=snow, linetype=snow, color=temp))+ geom_point() + 
  geom_path(aes(group=paste(snow, temp))) +
  labs(y=&quot;Mean total eggs&quot;, 
       x=&quot;Day of year&quot;, color=&quot;Temperature&quot;, shape=&quot;Snowmelt&quot;, linetype=&quot;Snowmelt&quot;) +
  scale_x_continuous(breaks=seq(120,240, by=20))+
  scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) +
  scale_linetype_manual(values=c(2,1)) + theme_minimal() + 
  theme(legend.key.size = unit(2, &quot;lines&quot;))</code></pre>
<p><img src="plots-traits/phenology_snow-3.svg" width="480" /></p>
<pre class="r"><code>phen%&gt;% drop_na(snow,temp) %&gt;% group_by(year, snow, temp, julian) %&gt;% summarize_at(&quot;has_egg&quot;, mean, na.rm=T) %&gt;% 
  ggplot(aes(x=julian, y=has_egg, shape=snow, linetype=snow, color=temp))+ geom_point() + 
  geom_path(aes(group=paste(snow, temp))) +
  labs(y=&quot;Proportion of plants with eggs&quot;, 
       x=&quot;Day of year&quot;, color=&quot;Temperature&quot;, shape=&quot;Snowmelt&quot;, linetype=&quot;Snowmelt&quot;) +
  scale_x_continuous(breaks=seq(120,240, by=20))+
  scale_y_continuous(labels = scales::percent)+
  scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) +
  scale_linetype_manual(values=c(2,1)) + theme_minimal() + 
  theme(legend.key.size = unit(2, &quot;lines&quot;))</code></pre>
<p><img src="plots-traits/phenology_snow-4.svg" width="480" /></p>
</div>
<div id="temperature-effects" class="section level2">
<h2>Temperature effects</h2>
<pre class="r"><code>ggplot(phen %&gt;% drop_na(height_cm, temp), aes(x=julian, y=height_cm, color=temp))+ geom_point() + geom_path(aes(group=plantid))+
  labs(y=&quot;Plant height&quot;, x=&quot;Day of year&quot;, color=&quot;Temperature&quot;) +
  scale_x_continuous(breaks=seq(120,240, by=20))+ 
  scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) +theme_minimal() + geom_vline(xintercept=yday(ymd(&quot;2021-06-25&quot;)))</code></pre>
<p><img src="plots-traits/phenology_temp-1.svg" width="480" /></p>
<pre class="r"><code>phen.raw %&gt;% drop_na(height_cm, temp) %&gt;% group_by(plantid) %&gt;% arrange(plantid, julian) %&gt;% mutate(height_diff = c(NA,diff(height_cm))) %&gt;% ggplot(aes(y=height_diff, x=factor(date), color=temp))  + geom_hline(yintercept=0)+
  geom_boxplot(position=position_dodge(0.9), outlier.shape=NA) + geom_point(position=position_jitterdodge(dodge.width=0.9, jitter.width=0.5, jitter.height=0)) + 
  theme_minimal()</code></pre>
<p><img src="plots-traits/phenology_temp-2.svg" width="480" /></p>
<pre class="r"><code>(chomped &lt;- phen.raw %&gt;% filter(str_detect(notes,&quot;herb|munch|chew|broke&quot;)) %&gt;%
  full_join(phen.raw %&gt;% drop_na(height_cm, temp) %&gt;% group_by(plantid) %&gt;% arrange(plantid, julian) %&gt;%
              mutate(height_diff = c(NA,diff(height_cm))) %&gt;% filter(height_diff &lt;= -10)) %&gt;% 
  select(plantid, temp, date, notes, scribe, height_cm, height_diff) %&gt;% arrange(temp, plantid)) </code></pre>
<pre><code># A tibble: 19  7
   plantid temp    date       notes                 scribe height_cm height_diff
   &lt;fct&gt;   &lt;fct&gt;   &lt;date&gt;     &lt;fct&gt;                 &lt;fct&gt;      &lt;int&gt;       &lt;int&gt;
 1 1B652   control 2021-07-14 OTC; Very munched     KW             6         -20
 2 1B947   control 2021-07-02 new on 7/02; chewed   DH            34          NA
 3 1B947   control 2021-07-14 OTC; herbivorized     KW            34          NA
 4 1B947   control 2021-07-07 chewed                KW            32          NA
 5 4B190   control 2021-07-14 Con; Herbivorized     KW            28         -11
 6 4B203   control 2021-08-03 chewed                XL            22          NA
 7 4B203   control 2021-07-14 Con; Herbivorized     KW            24         -11
 8 4B954   control 2021-07-14 Con; Herbivorized     KW            41         -10
 9 5B7     control 2021-08-03 chewed, height=N/A    XL            NA          NA
10 5D251   control 2021-07-20 Con; munched          KW            28          NA
11 1B684   warmed  2021-07-14 OTC; herbivorized     KW            43          NA
12 1B684   warmed  2021-07-07 chewed                KW            42          NA
13 1C901   warmed  2021-07-20 OTC; top broken at 3 KW            NA          NA
14 1C901   warmed  2021-08-03 &lt;NA&gt;                  JB            34         -16
15 3D894   warmed  2021-07-20 OTC; Top broken at 3 KW            NA          NA
16 5B909   warmed  2021-07-26 chewed                XL            31          NA
17 5D277   warmed  2021-08-03 &lt;NA&gt;                  JB            21         -18
18 6C90    warmed  2021-07-14 chewed                &lt;NA&gt;          15          NA
19 6C90    warmed  2021-07-07 chewed                KW            16          NA</code></pre>
<pre class="r"><code>chomped %&gt;% count(temp, plantid) %&gt;% count(temp)</code></pre>
<pre><code># A tibble: 2  2
  temp        n
  &lt;fct&gt;   &lt;int&gt;
1 control     7
2 warmed      6</code></pre>
<pre class="r"><code>phen %&gt;% drop_na(snow,temp) %&gt;% group_by(temp, julian) %&gt;% drop_na(open, buds) %&gt;% 
  summarize(openbuds.se = sd(open+buds)/sqrt(length(open+buds)), openbuds=mean(open+buds)) %&gt;% 
  ggplot(aes(x=julian, y=openbuds, color=temp))+ geom_point() + 
  geom_path(aes(group=temp)) + geom_linerange(aes(ymin=openbuds-openbuds.se, ymax=openbuds+openbuds.se))+
  labs(y=&quot;Mean total open flowers + elongated buds&quot;, 
       x=&quot;Day of year&quot;, color=&quot;Temperature&quot;) +
  scale_x_continuous(breaks=seq(120,240, by=20))+
  scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) + theme_minimal()+ geom_vline(xintercept=yday(ymd(&quot;2021-06-25&quot;)))</code></pre>
<p><img src="plots-traits/phenology_temp-3.svg" width="480" /></p>
<pre class="r"><code>lmer(I(open+buds) ~ factor(date) * temp + (1|plantid), data=filter(phen.raw, date!=&quot;2021-06-23&quot;)) %&gt;% anova %&gt;% kable(caption=&quot;mean open and buds&quot;)</code></pre>
<table>
<caption>mean open and buds</caption>
<colgroup>
<col width="23%" />
<col width="14%" />
<col width="14%" />
<col width="7%" />
<col width="12%" />
<col width="14%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">factor(date)</td>
<td align="right">2748.08056</td>
<td align="right">458.013427</td>
<td align="right">6</td>
<td align="right">201.44268</td>
<td align="right">14.8305003</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">temp</td>
<td align="right">37.96198</td>
<td align="right">37.961981</td>
<td align="right">1</td>
<td align="right">75.67022</td>
<td align="right">1.2292111</td>
<td align="right">0.2710719</td>
</tr>
<tr class="odd">
<td align="left">factor(date):temp</td>
<td align="right">50.65027</td>
<td align="right">8.441711</td>
<td align="right">6</td>
<td align="right">201.44268</td>
<td align="right">0.2733431</td>
<td align="right">0.9489477</td>
</tr>
</tbody>
</table>
<pre class="r"><code>phen %&gt;% drop_na(temp)%&gt;% group_by(temp, julian) %&gt;% summarize_at(&quot;flowering&quot;, mean, na.rm=T) %&gt;% 
  ggplot(aes(x=julian, y=flowering, color=temp))+ geom_point() + 
  geom_path(aes(group=temp)) + 
  labs(y=&quot;Proportion flowering&quot;, 
       x=&quot;Day of year&quot;, color=&quot;Temperature&quot;) +
  scale_x_continuous(breaks=seq(120,240, by=20))+
  scale_y_continuous(labels = scales::percent)+
  scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) + theme_minimal()</code></pre>
<p><img src="plots-traits/phenology_temp-4.svg" width="480" /></p>
<pre class="r"><code>phen %&gt;% drop_na(temp) %&gt;% group_by(temp, julian) %&gt;% drop_na(eggs) %&gt;% 
  summarize(eggs.se = sd(eggs)/sqrt(length(eggs)), eggs=mean(eggs)) %&gt;% 
  ggplot(aes(x=julian, y=eggs, color=temp))+ geom_point() + 
  geom_path(aes(group=temp)) + geom_linerange(aes(ymin=eggs-eggs.se, ymax=eggs+eggs.se))+
  labs(y=&quot;Mean total eggs&quot;, 
       x=&quot;Day of year&quot;, color=&quot;Temperature&quot;) +
  scale_x_continuous(breaks=seq(120,240, by=20))+
  scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) + theme_minimal() + geom_vline(xintercept=yday(ymd(&quot;2021-06-25&quot;)))</code></pre>
<p><img src="plots-traits/phenology_temp-5.svg" width="480" /></p>
<pre class="r"><code>lmer(eggs ~ factor(date) * temp + (1|plantid), data=filter(phen.raw, date!=&quot;2021-06-23&quot;)) %&gt;% anova %&gt;% kable(caption=&quot;mean eggs&quot;)</code></pre>
<table>
<caption>mean eggs</caption>
<colgroup>
<col width="24%" />
<col width="13%" />
<col width="13%" />
<col width="8%" />
<col width="13%" />
<col width="13%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">factor(date)</td>
<td align="right">186.95499</td>
<td align="right">31.159165</td>
<td align="right">6</td>
<td align="right">205.83789</td>
<td align="right">16.139282</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">temp</td>
<td align="right">15.06743</td>
<td align="right">15.067433</td>
<td align="right">1</td>
<td align="right">77.15736</td>
<td align="right">7.804367</td>
<td align="right">0.0065705</td>
</tr>
<tr class="odd">
<td align="left">factor(date):temp</td>
<td align="right">43.22882</td>
<td align="right">7.204803</td>
<td align="right">6</td>
<td align="right">205.83789</td>
<td align="right">3.731818</td>
<td align="right">0.0015168</td>
</tr>
</tbody>
</table>
<pre class="r"><code>phen %&gt;% drop_na(temp) %&gt;% group_by(temp, julian) %&gt;% drop_na(eggs_per_flower) %&gt;% 
  summarize(eggs_per_flower.se = sd(eggs_per_flower)/sqrt(length(eggs_per_flower)), eggs_per_flower=mean(eggs_per_flower)) %&gt;% 
  ggplot(aes(x=julian, y=eggs_per_flower, color=temp))+ geom_point() + 
  geom_path(aes(group=temp)) + geom_linerange(aes(ymin=eggs_per_flower-eggs_per_flower.se, ymax=eggs_per_flower+eggs_per_flower.se))+
  labs(y=&quot;Eggs per flower&quot;, 
       x=&quot;Day of year&quot;, color=&quot;Temperature&quot;) +
  scale_x_continuous(breaks=seq(120,240, by=20))+
  scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) + theme_minimal() + geom_vline(xintercept=yday(ymd(&quot;2021-06-25&quot;)))</code></pre>
<p><img src="plots-traits/phenology_temp-6.svg" width="480" /></p>
<pre class="r"><code>lmer(eggs_per_flower ~ factor(date) * temp + (1|plantid), data=filter(phen.raw, date!=&quot;2021-06-23&quot;)) %&gt;% anova %&gt;% kable(caption=&quot;eggs per flower&quot;)</code></pre>
<table>
<caption>eggs per flower</caption>
<colgroup>
<col width="24%" />
<col width="13%" />
<col width="13%" />
<col width="8%" />
<col width="13%" />
<col width="13%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">factor(date)</td>
<td align="right">1.0951582</td>
<td align="right">0.1825264</td>
<td align="right">6</td>
<td align="right">146.26779</td>
<td align="right">13.685155</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">temp</td>
<td align="right">0.0711076</td>
<td align="right">0.0711076</td>
<td align="right">1</td>
<td align="right">87.42029</td>
<td align="right">5.331387</td>
<td align="right">0.0233031</td>
</tr>
<tr class="odd">
<td align="left">factor(date):temp</td>
<td align="right">0.2621148</td>
<td align="right">0.0436858</td>
<td align="right">6</td>
<td align="right">146.26779</td>
<td align="right">3.275400</td>
<td align="right">0.0047243</td>
</tr>
</tbody>
</table>
<pre class="r"><code>phen.raw %&gt;% drop_na(temp) %&gt;%  group_by(temp, date) %&gt;% summarize(eggs_per_flower=mean(eggs_per_flower, na.rm=T)) %&gt;% 
  pivot_wider(names_from=&quot;temp&quot;, values_from=&quot;eggs_per_flower&quot;) %&gt;% kable(digits=3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">date</th>
<th align="right">control</th>
<th align="right">warmed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2021-06-23</td>
<td align="right">0.427</td>
<td align="right">0.419</td>
</tr>
<tr class="even">
<td align="left">2021-06-30</td>
<td align="right">0.346</td>
<td align="right">0.098</td>
</tr>
<tr class="odd">
<td align="left">2021-07-02</td>
<td align="right">0.222</td>
<td align="right">0.139</td>
</tr>
<tr class="even">
<td align="left">2021-07-07</td>
<td align="right">0.098</td>
<td align="right">0.008</td>
</tr>
<tr class="odd">
<td align="left">2021-07-14</td>
<td align="right">0.065</td>
<td align="right">0.006</td>
</tr>
<tr class="even">
<td align="left">2021-07-20</td>
<td align="right">0.048</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">2021-07-26</td>
<td align="right">0.069</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">2021-08-03</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code>phen %&gt;% drop_na(temp) %&gt;% group_by(year, temp, julian) %&gt;% summarize_at(&quot;has_egg&quot;, mean, na.rm=T) %&gt;% 
  ggplot(aes(x=julian, y=has_egg, color=temp))+ geom_point() + 
  geom_path(aes(group=temp)) +
  labs(y=&quot;Proportion of plants with eggs&quot;, 
       x=&quot;Day of year&quot;, color=&quot;Temperature&quot;) +
  scale_x_continuous(breaks=seq(120,240, by=20))+
  scale_y_continuous(labels = scales::percent)+
  scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) + theme_minimal() + geom_vline(xintercept=yday(ymd(&quot;2021-06-25&quot;)))</code></pre>
<p><img src="plots-traits/phenology_temp-7.svg" width="480" /></p>
<pre class="r"><code>bind_rows(
  buds=phen %&gt;% drop_na(snow,temp) %&gt;% group_by(temp, julian) %&gt;% drop_na(open, buds) %&gt;% 
    summarize(response.se = sd(open+buds)/sqrt(length(open+buds)), response=mean(open+buds)),
  eggs_per_flower = phen %&gt;% drop_na(temp) %&gt;% group_by(temp, julian) %&gt;% drop_na(eggs_per_flower) %&gt;% 
    summarize(response.se = sd(eggs_per_flower)/sqrt(length(eggs_per_flower)), response=mean(eggs_per_flower)), .id = &quot;variable&quot;) %&gt;% 
  ggplot(aes(x=julian, y=response, color=temp))+ geom_point() + 
  geom_path(aes(group=temp)) + geom_linerange(aes(ymin=response-response.se, ymax=response+response.se))+
  facet_wrap(vars(variable), scales=&quot;free_y&quot;, nrow=2, 
             labeller=as_labeller(c(buds=&quot;(A) Total open flowers + elongated buds&quot;, eggs_per_flower=&quot;(B) Eggs per flower&quot;)))+
  labs(x=&quot;Day of year&quot;, color=&quot;Temperature&quot;) +
  scale_y_continuous(limits=c(0,NA), expand=expansion(mult=c(0,0.05)))+
  scale_x_continuous(breaks=seq(120,240, by=10))+ geom_vline(xintercept=yday(ymd(&quot;2021-06-25&quot;)), linetype=2)+
  scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) + theme_bw()+   
  theme(legend.position = &quot;top&quot;, axis.title.y=element_blank(), axis.text=element_text(color=&quot;black&quot;))</code></pre>
<p><img src="plots-traits/phenology_temp_openeggs-1.svg" width="288" /></p>
</div>
</div>
<div id="selection" class="section level1">
<h1>Selection</h1>
<div id="seed-production" class="section level2">
<h2>Seed production</h2>
<pre class="r"><code>all.mean %&gt;% select(all_of(c(floraltraits, &quot;seeds_per_flower&quot;,&quot;temp&quot;))) %&gt;% 
  pivot_longer(any_of(floraltraits), names_to=&quot;trait&quot;) %&gt;% 
  ggplot(aes(x=value, y=seeds_per_flower, color=temp)) + 
  geom_smooth(method=&quot;lm&quot;,se=F) + # formula = y ~ poly(x, 2, raw=TRUE) 
  geom_point() + 
  facet_wrap(vars(trait), scales=&quot;free_x&quot;, labeller=as_labeller(traitnames.units)) + 
  labs(x=&quot;Trait&quot;, y=traitnames[&quot;seeds_per_flower&quot;], color=&quot;Temperature&quot;)+
  theme_bw() + scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) + theme(legend.position = &quot;top&quot;)</code></pre>
<p><img src="plots-traits/selection-1.svg" width="672" /></p>
<pre class="r"><code>#get the the standardized selection differential S&#39; (change in relative fitness / standardized trait value)
mt.mod.seeds &lt;- map(set_names(floraltraits), 
                    ~ lm(seeds_rel ~ trait.z *temp, 
                         data=all.mean %&gt;% as.data.frame() %&gt;% mutate(trait.z = all.mean[[.x]] / traits.sd[[.x]]) %&gt;% 
                           group_by(temp) %&gt;% mutate(seeds_rel = seeds_per_flower/mean(seeds_per_flower, na.rm=T)))) # mean seeds in each temp
mt.mod.seeds.coefs &lt;- map_dfr(mt.mod.seeds, tidy, .id=&quot;trait&quot;)
mt.mod.seeds.tests &lt;- map(mt.mod.seeds, car::Anova, type=3) %&gt;% map_dfr(tidy, .id=&quot;trait&quot;)
mt.mod.seeds.emm &lt;- map_dfr(mt.mod.seeds, ~summary(emtrends(.x, ~temp, var=&quot;trait.z&quot;)), .id=&quot;trait&quot;)
mt.mod.seeds.tests %&gt;% filter(!term %in% c(&quot;(Intercept)&quot;,&quot;Residuals&quot;)) %&gt;% select(-sumsq, -df, -statistic) %&gt;% 
  pivot_wider(names_from=&quot;term&quot;, values_from=&quot;p.value&quot;) %&gt;% 
  kable(caption=&quot;Seeds selection vs. temperature&quot;, digits=3)</code></pre>
<table>
<caption>Seeds selection vs.temperature</caption>
<thead>
<tr class="header">
<th align="left">trait</th>
<th align="right">trait.z</th>
<th align="right">temp</th>
<th align="right">trait.z:temp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">corolla_length</td>
<td align="right">0.254</td>
<td align="right">0.438</td>
<td align="right">0.422</td>
</tr>
<tr class="even">
<td align="left">corolla_width</td>
<td align="right">0.566</td>
<td align="right">0.237</td>
<td align="right">0.253</td>
</tr>
<tr class="odd">
<td align="left">nectar_volume</td>
<td align="right">0.779</td>
<td align="right">0.489</td>
<td align="right">0.431</td>
</tr>
<tr class="even">
<td align="left">nectar_conc</td>
<td align="right">0.455</td>
<td align="right">0.207</td>
<td align="right">0.199</td>
</tr>
<tr class="odd">
<td align="left">height_cm</td>
<td align="right">0.427</td>
<td align="right">0.196</td>
<td align="right">0.178</td>
</tr>
<tr class="even">
<td align="left">redness</td>
<td align="right">0.590</td>
<td align="right">0.225</td>
<td align="right">0.236</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ggplot(mt.mod.seeds.emm, aes(x=trait, color=temp, y=trait.z.trend, ymin=trait.z.trend-SE, ymax=trait.z.trend+SE)) + 
  geom_hline(yintercept=0)+ geom_pointrange(position=position_dodge(width=0.3)) + 
   theme_bw() + scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) + theme(legend.position = &quot;top&quot;) + 
  labs(x=&quot;&quot;, y=&quot;Standardized selection differential, seeds per flower&quot;, color=&quot;Temperature&quot;) +
  scale_x_discrete(labels=traitnames)</code></pre>
<p><img src="plots-traits/selection-2.svg" width="672" /></p>
</div>
<div id="fly-damage" class="section level2">
<h2>Fly damage</h2>
<pre class="r"><code>all.mean %&gt;% select(all_of(c(floraltraits, &quot;prop_infested&quot;,&quot;temp&quot;))) %&gt;% 
  pivot_longer(any_of(floraltraits), names_to=&quot;trait&quot;) %&gt;% 
  ggplot(aes(x=value, y=prop_infested, color=temp)) + geom_point() +
  geom_smooth(method=&quot;glm&quot;,se=F, method.args = list(family=&quot;binomial&quot;)) + 
  facet_wrap(vars(trait), scales=&quot;free_x&quot;, labeller=as_labeller(traitnames.units)) + 
  labs(x=&quot;Trait&quot;, y=traitnames[&quot;prop_infested&quot;], color=&quot;Temperature&quot;)+
  theme_bw() + scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) + theme(legend.position = &quot;top&quot;)</code></pre>
<p><img src="plots-traits/selection_fly%20-1.svg" width="672" /></p>
<pre class="r"><code>mt.mod.infested &lt;- map(set_names(floraltraits), 
                    ~ lm(infested_rel ~ trait.z * temp, 
                         data=all.mean %&gt;% as.data.frame() %&gt;% mutate(trait.z = all.mean[[.x]] / traits.sd[[.x]]) %&gt;% 
                           group_by(temp) %&gt;% mutate(infested_rel = prop_infested/mean(prop_infested, na.rm=T)))) # mean infested in each temp
mt.mod.infested.coefs &lt;- map_dfr(mt.mod.infested, tidy, .id=&quot;trait&quot;)
mt.mod.infested.tests &lt;- map(mt.mod.infested, car::Anova, type=3) %&gt;% map_dfr(tidy, .id=&quot;trait&quot;)
mt.mod.infested.emm &lt;- map_dfr(mt.mod.infested, ~summary(emtrends(.x, ~temp, var=&quot;trait.z&quot;)), .id=&quot;trait&quot;)
mt.mod.infested.tests %&gt;% filter(!term %in% c(&quot;(Intercept)&quot;,&quot;Residuals&quot;)) %&gt;% select(-sumsq, -df, -statistic) %&gt;% 
  pivot_wider(names_from=&quot;term&quot;, values_from=&quot;p.value&quot;) %&gt;% kable(caption=&quot;Fly selection vs. temperature&quot;, digits=3)</code></pre>
<table>
<caption>Fly selection vs.temperature</caption>
<thead>
<tr class="header">
<th align="left">trait</th>
<th align="right">trait.z</th>
<th align="right">temp</th>
<th align="right">trait.z:temp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">corolla_length</td>
<td align="right">0.534</td>
<td align="right">0.945</td>
<td align="right">0.943</td>
</tr>
<tr class="even">
<td align="left">corolla_width</td>
<td align="right">0.381</td>
<td align="right">0.603</td>
<td align="right">0.564</td>
</tr>
<tr class="odd">
<td align="left">nectar_volume</td>
<td align="right">0.807</td>
<td align="right">0.839</td>
<td align="right">0.980</td>
</tr>
<tr class="even">
<td align="left">nectar_conc</td>
<td align="right">0.930</td>
<td align="right">0.266</td>
<td align="right">0.227</td>
</tr>
<tr class="odd">
<td align="left">height_cm</td>
<td align="right">0.641</td>
<td align="right">0.376</td>
<td align="right">0.397</td>
</tr>
<tr class="even">
<td align="left">redness</td>
<td align="right">0.611</td>
<td align="right">0.805</td>
<td align="right">0.845</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ggplot(mt.mod.infested.emm, aes(x=trait, color=temp, y=trait.z.trend, ymin=trait.z.trend-SE, ymax=trait.z.trend+SE)) + 
  geom_hline(yintercept=0)+ geom_pointrange(position=position_dodge(width=0.3)) + 
   theme_bw() + scale_color_brewer(palette=&quot;Set1&quot;, direction=-1) + theme(legend.position = &quot;top&quot;) + 
  labs(x=&quot;&quot;, y=&quot;Standardized selection differential, proportion infested&quot;, color=&quot;Temperature&quot;) +
  scale_x_discrete(labels=traitnames)</code></pre>
<p><img src="plots-traits/selection_fly%20-2.svg" width="672" /></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
