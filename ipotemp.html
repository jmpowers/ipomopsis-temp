<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Carrie Wu, John Powers, David Hopp, Diane Campbell" />

<meta name="date" content="2023-02-09" />

<title>Volatiles - Ipomopsis temperature experiments</title>

<script src="libs/header-attrs-2.20/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/navigation-1.1/codefolding.js"></script>
<link href="libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Volatiles - Ipomopsis temperature
experiments</h1>
<h4 class="author">Carrie Wu, John Powers, David Hopp, Diane
Campbell</h4>
<h4 class="date">2023-02-09</h4>

</div>


<style type="text/css">
.main-container { max-width: 1000px; margin-left: 0; margin-right: auto; }
img{ max-width:200%; height: auto; }
td, th { padding : 6px }
</style>
<pre class="r"><code>load(&quot;data/volatiles/ipotemp181921.Rdata&quot;) 
#write(rownames(ipo.all), &quot;data/volatiles/CWu_samples.txt&quot;)
ipos &lt;- read.csv(&quot;data/volatiles/CWu_samples.csv&quot;, colClasses=list(RunDate=&quot;Date&quot;)) #TODO this filename split is outdated

# load short names and standard regessions
ipochems &lt;- read_csv(&quot;data/volatiles/Ipo volatile compounds - chemsf_ipo.csv&quot;) %&gt;% 
  select(name, shortname, standard, verdict) %&gt;%  filter(verdict != &quot;&quot;) %&gt;% 
  mutate(standard = fct_recode(standard, &quot;Methyl_salicylate&quot;=&quot;Benzaldehyde&quot;), # benzaldehyde regressions not reliable
         class = fct_recode(standard, Aliphatic=&quot;Hexenol&quot;, Benzenoid=&quot;Methyl_salicylate&quot;, Benzenoid=&quot;Indole&quot;, 
                            Sesquiterpene=&quot;Caryophyllene&quot;, Monoterpene=&quot;alpha_Pinene&quot;, Monoterpene=&quot;Linalool&quot;)) %&gt;%  
  left_join(read_csv(&quot;data/volatiles/regressions_181921_filtered_slopes.csv&quot;) %&gt;% 
              pivot_wider(id_cols=standard, names_from=&quot;year&quot;, names_prefix=&quot;area_per_ng&quot;, values_from=area_per_ng)) 
class_pal &lt;- set_names(c(&quot;#BC0060&quot;,&quot;#027B8C&quot;,&quot;#E56E00&quot;,&quot;#86D400&quot;), levels(ipochems$class))

#shorten chemical names and merge compounds with multiple names
shortnames &lt;- ipochems %&gt;% select(name, shortname) %&gt;% filter(shortname!=&quot;&quot;) %&gt;% deframe()
#shortnames[shortnames %in% shortnames[duplicated(shortnames)]]
ipo.data$Name &lt;- recode(ipo.data$Name, !!!shortnames)

ipo.all &lt;- dcast(ipo.data, Filename~Name, sum, value.var=&quot;Area&quot;)
rownames(ipo.all) &lt;- ipo.all[,1]
ipo.all[,1] &lt;- NULL</code></pre>
<div id="read-metadata" class="section level1">
<h1>Read metadata</h1>
<pre class="r"><code>#accounts for skips
verdicts &lt;- read_tsv(&quot;data/volatiles/RMBL GC-MS Data Inventory - ipogc181921.tsv&quot;) %&gt;% 
  select(Filename=FileName, sample, verdict, status) %&gt;% 
  mutate(sample = na_if(sample,&quot;&quot;) %&gt;% coalesce(Filename)) %&gt;% #fill in samples with no change
  drop_na(sample) %&gt;%  # when both Filename and Sample are NA
  filter(is.na(verdict) | verdict!=&quot;mismatched&quot;) %&gt;% # fuzzy matching misassigned these to a Markes entry
  filter(!duplicated(Filename))  # a couple nonunique filenames
#TODO one verdict = skip-lookup but no qgb to look up last filename: OTC_Z3_190805_8102019_24.qgd

##### 2018 + 2019 | bb + GNA + SC  | OTC + Perc ######
# field metadata
perc &lt;- read_csv(&quot;data/volatiles/CWu Ipomopsis Scent Metadata - Percivals2018_2019.csv&quot;)
otc &lt;- read_csv(&quot;data/volatiles/CWu Ipomopsis Scent Metadata - OTC2018_2019.csv&quot;)  %&gt;%  
  rename(temp=OI) %&gt;% mutate(temp = recode(temp,&quot;in&quot;=&quot;warmed&quot;,&quot;out&quot;=&quot;control&quot;))
# manually split filenames and drop chromatograms that were redone
files &lt;- read_tsv(&quot;data/volatiles/CWu Ipomopsis Scent Metadata - CWu_samples_text2.tsv&quot;) %&gt;% 
  rename(temp=OI) %&gt;% mutate(temp = recode(temp,&quot;in&quot;=&quot;warmed&quot;,&quot;out&quot;=&quot;control&quot;)) %&gt;% filter(is.na(Drop)) %&gt;% 
  left_join(verdicts)
# merge metadata and filenames
perc2 &lt;- left_join(perc,files, by=c(&quot;Date&quot;,&quot;DN&quot;,&quot;Tissue&quot;,&quot;Sample2&quot;), suffix=c(&quot;&quot;,&quot;.f&quot;))
otc2 &lt;-  left_join(otc, files, by=c(&quot;Date&quot;,&quot;Site&quot;,&quot;temp&quot;,&quot;DN&quot;,&quot;Tissue&quot;,&quot;Sample2&quot;), suffix=c(&quot;&quot;,&quot;.f&quot;)) %&gt;% 
  mutate(PlantType = if_else(temp == &quot;air&quot;, &quot;air&quot;, PlantType))

###### 2021 | GNA + SC | OTC ######
# field metadata
sc21 &lt;- read_tsv(&quot;data/volatiles/2021 Spring Creek Volatiles - 2021.tsv&quot;) %&gt;% 
  mutate(PlantType=if_else(plant==&quot;air&quot;, &quot;air&quot;, &quot;ten&quot;))
gna21 &lt;- read_tsv(&quot;data/volatiles/2021 GNA Volatiles - 2021.tsv&quot;) %&gt;% 
  mutate(time=&quot;day&quot;, PlantType=if_else(plant==&quot;air&quot;, &quot;air&quot;, &quot;agg&quot;))
# automatically split filenames, manually edit, drop chromatograms that were redone, and read back in
# tibble(Filename = rownames(ipo.all)) %&gt;% 
#   filter(str_detect(Filename, &quot;2021&quot;), 
#          str_detect(Filename, &quot;SC_|GNA_&quot;)) %&gt;%
#   separate(Filename, into=c(&quot;site&quot;,&quot;vial&quot;,&quot;sampledate&quot;,&quot;rundate&quot;,&quot;GCn&quot;), sep=&quot;_&quot;, remove=FALSE, convert=TRUE) %&gt;% 
#   mutate(GCn = str_remove(GCn, &quot;.qgd&quot;)) %&gt;% write_tsv(&quot;files21_auto.tsv&quot;)  
files21 &lt;- read_tsv(&quot;data/volatiles/CWu Ipomopsis Scent Metadata - files21.tsv&quot;) %&gt;% 
  filter(is.na(drop)) %&gt;% #drop samples that were redone
  left_join(verdicts)
#TODO check that the presumed redos in files21 were actually leaks/skips
#merge metadata and filenames
otc21 &lt;- bind_rows(SC=sc21, GNA=gna21, .id=&quot;site&quot;) %&gt;% 
  left_join(files21, by=c(&quot;vial&quot;,&quot;site&quot;)) %&gt;% 
  drop_na(plant) %&gt;% # two contaminated traps, not used
  mutate(sampledate = as.character(sampledate),
         Year = 2021, Tissue = if_else(plant == &quot;air&quot;, &quot;air&quot;, &quot;flower&quot;), Expt=&quot;otc&quot;,
         location = recode(location,&quot;inside&quot;=&quot;warmed&quot;,&quot;outside&quot;=&quot;control&quot;),
         PlantID = paste0(chamber, plant)) %&gt;% 
  rename(Site=site, Collector=observer, Date=date, DN=time, temp=location, Bag=bag, Pump=pump, End=end, Equil=equil, Duration=pumping,
         NumFlrs = flowers, NumBuds=buds, PumpID = pump_id, SoilVWC = VWC, Comments = notes, SampleDate_text=sampledate,
         RunDate_text=rundate,GCOrder=GCn)

####### 2021 | Maxfield | OTC  #######
#automatically split filenames. Filename2 accounts for skip
maxfiles &lt;- read_csv(&quot;data/volatiles/filenames_metadata - filenames_metadata.csv&quot;) %&gt;% 
  mutate(Is2021 = str_detect(Filename,&quot;_210&quot;)) %&gt;% 
  filter(Maxfield==1 &amp; Year==&quot;2021&quot;) %&gt;% 
  separate(Filename2, into=c(&quot;plantid&quot;,&quot;vial&quot;,&quot;date&quot;,&quot;rundate&quot;,&quot;sequence&quot;,&quot;ext&quot;),remove=F) %&gt;% 
  mutate(across(c(plantid, vial), na_if,&quot;NA&quot;)) %&gt;% 
  mutate(date = ymd(date), vial=as.character(vial),
         filament = ifelse(date&gt;ymd(&quot;2021-07-21&quot;),&quot;after&quot;,&quot;before&quot;))

#field metadata, joined with treatments
GCMS_metadata1 &lt;- read_csv(&quot;data/volatiles/2021 Maxfield Volatiles - 2021.csv&quot;) %&gt;% mutate(plotid=paste0(plot, subplot)) %&gt;% 
  left_join(read_csv(&quot;data/2021 Maxfield Rosettes - 2021OTCs.csv&quot;) %&gt;% mutate(plant=as.character(plant)),
            by=c(&quot;plotid&quot;,&quot;plant&quot;,&quot;plantid&quot;))

#look up plant IDs for each GC tube (vial column also has A/B for multiple samples)
max21.oldformat &lt;- bind_rows(
  left_join(maxfiles %&gt;% filter(vial %in% c(&quot;A&quot;,&quot;B&quot;)), GCMS_metadata1, by=c(&quot;plantid&quot;,&quot;vial&quot;,&quot;date&quot;)),
  left_join(maxfiles %&gt;% filter(!vial %in% c(&quot;A&quot;,&quot;B&quot;) &amp; is.na(plantid)), GCMS_metadata1, by=c(&quot;vial&quot;,&quot;date&quot;)), #vial numbers only
  left_join(maxfiles %&gt;% filter(!vial %in% c(&quot;A&quot;,&quot;B&quot;) &amp;!is.na(plantid)), GCMS_metadata1, by=c(&quot;plantid&quot;,&quot;date&quot;))) %&gt;%  #plantid
  mutate(type=factor(ifelse(plant==&quot;air&quot;,&quot;ambient&quot;,&quot;floral&quot;)), 
         temp=factor(temp.y), snow=factor(snow),
         plantid= coalesce(plantid, plantid.y)) 

#rename columns to match CWu metadata format
max21 &lt;- max21.oldformat %&gt;% #put in line with CWu metadata
  rename(Date=date, RunDate_text=rundate,
         Comments=notes, Collector=observer, Bag=bag, Pump=pump,End=end, 
         NumFlrs=flowers, NumBuds=buds, PumpID=pump_id, SoilVWC=VWC,
         PlantType=type, PlantID=plantid) %&gt;% 
  mutate(vial=as.integer(recode(vial, &quot;A&quot;=&quot;1001&quot;, &quot;B&quot;=&quot;1002&quot;)),
         RunDate_text = as.integer(RunDate_text),
         PlantType=recode(PlantType, &quot;ambient&quot;=&quot;air&quot;, &quot;floral&quot;=&quot;agg&quot;),
         Tissue=recode(PlantType, &quot;agg&quot;=&quot;flower&quot;),
         Expt=&quot;otc&quot;,Site=&quot;Maxfield&quot;,DN=&quot;day&quot;,
         temp=recode(temp,&quot;OTC&quot;=&quot;warmed&quot;))

######## Combine all metadata tables #########
meta &lt;- bind_rows(otc=bind_rows(otc2, otc21, max21), perc=perc2, .id=&quot;expt&quot;) %&gt;% 
  mutate_if(is.character, as.factor) %&gt;%
  mutate(Equil=Pump-Bag, Duration=End-Pump, Total=End-Bag,
         Pump_datehour = paste(Date, Pump) %&gt;% ymd_hms(tz=&quot;America/Denver&quot;) %&gt;% round_date(&quot;hour&quot;),
         Expt=expt) %&gt;% #TODO sort thru Expt==NA
  #Add mean temperature of OTCs or controls at time of sampling
  left_join(read_csv(&quot;data/hobos_mean.csv&quot;) %&gt;% select(-date) %&gt;% 
              mutate(datetime = with_tz(datetime, &quot;America/Denver&quot;)), #stored in UTC!
            by = c(&quot;Site&quot;=&quot;site&quot;, &quot;Pump_datehour&quot;=&quot;datetime&quot;)) %&gt;% 
  mutate(mean_temp_C_treatment = if_else(temp==&quot;warmed&quot;, mean_temp_C_warmed, mean_temp_C_control))

meta %&gt;% write.csv(&quot;data/volatiles/CWu_meta21.csv&quot;)

meta %&gt;% count(Year, Temp, Tissue, PlantType, Site, temp, DN, Expt) %&gt;% kable(caption=&quot;Sample size&quot;)</code></pre>
<table>
<caption>Sample size</caption>
<thead>
<tr class="header">
<th align="right">Year</th>
<th align="left">Temp</th>
<th align="left">Tissue</th>
<th align="left">PlantType</th>
<th align="left">Site</th>
<th align="left">temp</th>
<th align="left">DN</th>
<th align="left">Expt</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2018</td>
<td align="left">cool</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">cool</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">warm</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">warm</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">GNA</td>
<td align="left">air</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">bb</td>
<td align="left">air</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">31</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">bb</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">bb</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">leaf</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">leaf</td>
<td align="left">agg</td>
<td align="left">bb</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">leaf</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">leaf</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">leaf</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">leaf</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">GNA</td>
<td align="left">air</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">air</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">air</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">warmed</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">leaf</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">leaf</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">leaf</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">leaf</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">GNA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">Maxfield</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">air</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">air</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">32</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">34</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">Maxfield</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">38</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">Maxfield</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">44</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">30</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">31</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">41</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">warmed</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">46</td>
</tr>
</tbody>
</table>
<pre class="r"><code>tempcol &lt;- set_names(brewer.pal(3, &quot;Set1&quot;)[c(2,1)], c(&quot;control&quot;, &quot;warmed&quot;))#OTCs
Tempcol &lt;- set_names(brewer.pal(3, &quot;Set1&quot;)[c(2,1)], c(&quot;cool&quot;, &quot;warm&quot;))#Percivals</code></pre>
<div id="missing-files" class="section level2">
<h2>Missing files</h2>
<pre class="r"><code>#perc2 %&gt;% filter(is.na(Filename)) %&gt;% select(&quot;n&quot;) %&gt;% write.csv(&quot;perc_nomatch.csv&quot;)
#otc2 %&gt;% filter(is.na(Filename)) %&gt;% select(&quot;n&quot;) %&gt;% write.csv(&quot;otc_nomatch.csv&quot;)
meta %&gt;% filter(is.na(Filename)) %&gt;% #no filename
  filter(is.na(lost)) %&gt;% # 2021 samples &quot;lost&quot; (to what?)
  filter(is.na(nomatch) | nomatch != &quot;NR&quot;) %&gt;% # samples not run
  select(1:16) %&gt;% kable(caption = &quot;have metadata, no chromatogram&quot;)# &amp; nomatch!=&quot;NR&quot;</code></pre>
<table>
<caption>have metadata, no chromatogram</caption>
<colgroup>
<col width="4%" />
<col width="3%" />
<col width="4%" />
<col width="8%" />
<col width="4%" />
<col width="4%" />
<col width="8%" />
<col width="5%" />
<col width="6%" />
<col width="9%" />
<col width="6%" />
<col width="6%" />
<col width="6%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">expt</th>
<th align="right">n</th>
<th align="right">Year</th>
<th align="left">Date</th>
<th align="left">DN</th>
<th align="left">Site</th>
<th align="left">PlantType</th>
<th align="left">Tissue</th>
<th align="left">temp</th>
<th align="left">Sample</th>
<th align="left">Sample2</th>
<th align="left">PlantID</th>
<th align="left">nomatch</th>
<th align="left">Bag</th>
<th align="left">Pump</th>
<th align="left">End</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">otc</td>
<td align="right">184</td>
<td align="right">2018</td>
<td align="left">2018-07-25</td>
<td align="left">day</td>
<td align="left">GNA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">warmed</td>
<td align="left">KM10-B1</td>
<td align="left">KM10B1</td>
<td align="left">KM10B1</td>
<td align="left">0</td>
<td align="left">10:13:00</td>
<td align="left">10:43:00</td>
<td align="left">10:58:00</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">37</td>
<td align="right">2019</td>
<td align="left">2019-07-31</td>
<td align="left">day</td>
<td align="left">GNA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">warmed</td>
<td align="left">OTC-W1</td>
<td align="left">W1</td>
<td align="left">W1</td>
<td align="left">0</td>
<td align="left">11:53:00</td>
<td align="left">12:26:00</td>
<td align="left">12:41:00</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="right">83</td>
<td align="right">2019</td>
<td align="left">2019-08-02</td>
<td align="left">day</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">leaf</td>
<td align="left">warmed</td>
<td align="left">OTC-A2-leaf</td>
<td align="left">A2</td>
<td align="left">A2</td>
<td align="left">0</td>
<td align="left">12:50:00</td>
<td align="left">13:20:00</td>
<td align="left">13:35:00</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">84</td>
<td align="right">2019</td>
<td align="left">2019-08-02</td>
<td align="left">day</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">leaf</td>
<td align="left">warmed</td>
<td align="left">OTC-C3-leaf</td>
<td align="left">C3</td>
<td align="left">C3</td>
<td align="left">0</td>
<td align="left">13:08:00</td>
<td align="left">13:41:00</td>
<td align="left">13:56:00</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="right">62</td>
<td align="right">2019</td>
<td align="left">2019-08-02</td>
<td align="left">day</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">leaf</td>
<td align="left">warmed</td>
<td align="left">OTC-D1-leaf</td>
<td align="left">D1</td>
<td align="left">D1</td>
<td align="left">NA</td>
<td align="left">13:22:00</td>
<td align="left">13:58:00</td>
<td align="left">14:13:00</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">5</td>
<td align="right">2019</td>
<td align="left">2019-08-02</td>
<td align="left">night</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">flower</td>
<td align="left">control</td>
<td align="left">SC9</td>
<td align="left">9</td>
<td align="left">9</td>
<td align="left">0</td>
<td align="left">20:21:00</td>
<td align="left">20:51:00</td>
<td align="left">21:06:00</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="right">106</td>
<td align="right">2019</td>
<td align="left">2019-08-05</td>
<td align="left">day</td>
<td align="left">GNA</td>
<td align="left">agg</td>
<td align="left">leaf</td>
<td align="left">control</td>
<td align="left">GNA5-leaf</td>
<td align="left">5</td>
<td align="left">5</td>
<td align="left">NA</td>
<td align="left">11:49:00</td>
<td align="left">12:19:00</td>
<td align="left">12:34:00</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-15</td>
<td align="left">night</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">flower</td>
<td align="left">warmed</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">B238</td>
<td align="left">NA</td>
<td align="left">19:46:00</td>
<td align="left">20:20:00</td>
<td align="left">20:35:00</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-26</td>
<td align="left">night</td>
<td align="left">SC</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">XEair</td>
<td align="left">NA</td>
<td align="left">22:10:00</td>
<td align="left">22:26:00</td>
<td align="left">22:41:00</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-26</td>
<td align="left">night</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">flower</td>
<td align="left">warmed</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">F8</td>
<td align="left">NA</td>
<td align="left">21:47:00</td>
<td align="left">22:17:00</td>
<td align="left">22:32:00</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-16</td>
<td align="left">day</td>
<td align="left">GNA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">control</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">XL360</td>
<td align="left">NA</td>
<td align="left">09:04:00</td>
<td align="left">09:35:00</td>
<td align="left">09:50:00</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-16</td>
<td align="left">day</td>
<td align="left">GNA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">control</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">XN2</td>
<td align="left">NA</td>
<td align="left">09:44:00</td>
<td align="left">10:14:00</td>
<td align="left">10:29:00</td>
</tr>
<tr class="odd">
<td align="left">perc</td>
<td align="right">21</td>
<td align="right">2019</td>
<td align="left">2019-07-25</td>
<td align="left">day</td>
<td align="left">NA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">NA</td>
<td align="left">A38</td>
<td align="left">A38</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">10:24:00</td>
<td align="left">10:54:00</td>
<td align="left">11:09:00</td>
</tr>
<tr class="even">
<td align="left">perc</td>
<td align="right">47</td>
<td align="right">2019</td>
<td align="left">2019-07-25</td>
<td align="left">night</td>
<td align="left">NA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">NA</td>
<td align="left">A79</td>
<td align="left">A79</td>
<td align="left">NA</td>
<td align="left">nm</td>
<td align="left">21:02:00</td>
<td align="left">21:35:00</td>
<td align="left">21:50:00</td>
</tr>
</tbody>
</table>
<pre class="r"><code>#otc21 %&gt;% filter(is.na(Filename), is.na(lost)) %&gt;% select(1:18) %&gt;% kable(caption = &quot;have metadata, no chromatogram&quot;)
#max21 is not missing any files</code></pre>
</div>
<div id="missing-metadata" class="section level2">
<h2>Missing metadata</h2>
<pre class="r"><code>#files %&gt;% filter(!(Filename %in% meta$Filename)) %&gt;% select(&quot;n&quot;) %&gt;% write.csv(&quot;CWu_samples_nomatch.csv&quot;)
files %&gt;% filter(!(Filename %in% meta$Filename) &amp; Expt!=&quot;&quot;) %&gt;% select(c(&quot;Filename&quot;, &quot;Date&quot;,&quot;Site&quot;,&quot;temp&quot;,&quot;DN&quot;,&quot;Tissue&quot;,&quot;Sample2&quot;)) %&gt;% kable(caption = &quot;have chromatogram, no metadata&quot;)</code></pre>
<table>
<caption>have chromatogram, no metadata</caption>
<colgroup>
<col width="45%" />
<col width="13%" />
<col width="6%" />
<col width="10%" />
<col width="5%" />
<col width="8%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Filename</th>
<th align="left">Date</th>
<th align="left">Site</th>
<th align="left">temp</th>
<th align="left">DN</th>
<th align="left">Tissue</th>
<th align="left">Sample2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">AirlastJuly25_08312018.qgd</td>
<td align="left">2018-07-25</td>
<td align="left">GNA</td>
<td align="left">air</td>
<td align="left">day</td>
<td align="left">air</td>
<td align="left">Airlast</td>
</tr>
<tr class="even">
<td align="left">NatAreaXUP01July25_08312018.qgd</td>
<td align="left">2018-07-25</td>
<td align="left">GNA</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="left">XUP01</td>
</tr>
<tr class="odd">
<td align="left">GNA5redo_leaf_190805_8112019_17.qgd</td>
<td align="left">2019-08-05</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">leaf</td>
<td align="left">5redo</td>
</tr>
<tr class="even">
<td align="left">A188DredoAug16renamed_09022018.qgd</td>
<td align="left">2018-08-16</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="left">A188redo</td>
</tr>
<tr class="odd">
<td align="left">T196DredoAug16_09022018.qgd</td>
<td align="left">2018-08-16</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="left">T196redo</td>
</tr>
<tr class="even">
<td align="left">A38redo_day_190725_872019_03.qgd</td>
<td align="left">2019-07-25</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="left">A38redo</td>
</tr>
<tr class="odd">
<td align="left">A91_leaf_190725_882019_02.qgd</td>
<td align="left">2019-07-25</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">leaf</td>
<td align="left">A91</td>
</tr>
</tbody>
</table>
<pre class="r"><code>files21 %&gt;% filter(!(Filename %in% meta$Filename)) %&gt;% kable(caption = &quot;have chromatogram, no metadata&quot;)</code></pre>
<table>
<caption>have chromatogram, no metadata</caption>
<colgroup>
<col width="24%" />
<col width="4%" />
<col width="4%" />
<col width="8%" />
<col width="6%" />
<col width="3%" />
<col width="4%" />
<col width="4%" />
<col width="24%" />
<col width="6%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">sample</th>
<th align="left">site</th>
<th align="right">vial</th>
<th align="right">sampledate</th>
<th align="right">rundate</th>
<th align="right">GCn</th>
<th align="right">drop</th>
<th align="left">Notes</th>
<th align="left">Filename</th>
<th align="left">verdict</th>
<th align="left">status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GNA_121_210730_7312021_05.qgd</td>
<td align="left">GNA</td>
<td align="right">121</td>
<td align="right">210730</td>
<td align="right">7312021</td>
<td align="right">5</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">GNA_121_210730_7312021_05.qgd</td>
<td align="left">NA</td>
<td align="left">Desorbed NA</td>
</tr>
<tr class="even">
<td align="left">SC_25_210713_8172021_08.qgd</td>
<td align="left">SC</td>
<td align="right">25</td>
<td align="right">210713</td>
<td align="right">8172021</td>
<td align="right">8</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">SC_25_210713_8172021_08.qgd</td>
<td align="left">NA</td>
<td align="left">Desorbed NA</td>
</tr>
<tr class="odd">
<td align="left">SC_105_210727_8202021_08.qgd</td>
<td align="left">SC</td>
<td align="right">105</td>
<td align="right">210727</td>
<td align="right">8202021</td>
<td align="right">8</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">SC_105_210727_8202021_08.qgd</td>
<td align="left">NA</td>
<td align="left">Desorbed NA</td>
</tr>
<tr class="even">
<td align="left">SC_140_210727_8202021_05.qgd</td>
<td align="left">SC</td>
<td align="right">140</td>
<td align="right">210727</td>
<td align="right">8202021</td>
<td align="right">5</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">SC_140_210727_8202021_05.qgd</td>
<td align="left">NA</td>
<td align="left">Desorbed NA</td>
</tr>
<tr class="odd">
<td align="left">SC_101_210727_8202021_02.qgd</td>
<td align="left">SC</td>
<td align="right">101</td>
<td align="right">210727</td>
<td align="right">8202021</td>
<td align="right">2</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">SC_101_210727_8202021_02.qgd</td>
<td align="left">NA</td>
<td align="left">Desorbed NA</td>
</tr>
<tr class="even">
<td align="left">SC_73_210715_8202021_06.qgd</td>
<td align="left">SC</td>
<td align="right">73</td>
<td align="right">210715</td>
<td align="right">8202021</td>
<td align="right">6</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">SC_73_210715_8202021_06.qgd</td>
<td align="left">NA</td>
<td align="left">Desorbed NA</td>
</tr>
</tbody>
</table>
<pre class="r"><code># GNA_121 and SC_73 traps contaminated
#maxfiles is not missing any metadata</code></pre>
</div>
<div id="times" class="section level2">
<h2>Times</h2>
<pre class="r"><code>ggplot(meta, aes(x=paste(Expt, DN,Year), y=Pump, color=DN)) + 
  geom_boxplot() + geom_point()+
  theme_minimal() + theme(axis.text.x=element_text(angle=90))+ 
  ggtitle(&quot;Sampling time of day&quot;)</code></pre>
<p><img src="plots/times-1.svg" width="768" /></p>
<pre class="r"><code>meta %&gt;% group_by(Expt, DN, Tissue, Year) %&gt;% drop_na(Pump) %&gt;% 
  summarize(first=seconds_to_period(min(Pump)), last=seconds_to_period(max(Pump))) %&gt;% kable(caption=&quot;Pump times&quot;)</code></pre>
<table>
<caption>Pump times</caption>
<thead>
<tr class="header">
<th align="left">Expt</th>
<th align="left">DN</th>
<th align="left">Tissue</th>
<th align="right">Year</th>
<th align="right">first</th>
<th align="right">last</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">otc</td>
<td align="left">day</td>
<td align="left">air</td>
<td align="right">2018</td>
<td align="right">9H 15M 0S</td>
<td align="right">14H 14M 0S</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">day</td>
<td align="left">air</td>
<td align="right">2019</td>
<td align="right">9H 51M 0S</td>
<td align="right">13H 4M 0S</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="left">day</td>
<td align="left">air</td>
<td align="right">2021</td>
<td align="right">9H 31M 0S</td>
<td align="right">12H 3M 0S</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="right">2018</td>
<td align="right">9H 10M 0S</td>
<td align="right">14H 55M 0S</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="right">2019</td>
<td align="right">10H 10M 0S</td>
<td align="right">13H 24M 0S</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="right">2021</td>
<td align="right">9H 10M 0S</td>
<td align="right">13H 1M 0S</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="left">day</td>
<td align="left">leaf</td>
<td align="right">2018</td>
<td align="right">10H 25M 0S</td>
<td align="right">10H 47M 0S</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">day</td>
<td align="left">leaf</td>
<td align="right">2019</td>
<td align="right">9H 55M 0S</td>
<td align="right">13H 58M 0S</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="left">night</td>
<td align="left">air</td>
<td align="right">2019</td>
<td align="right">19H 43M 0S</td>
<td align="right">21H 48M 0S</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">night</td>
<td align="left">air</td>
<td align="right">2021</td>
<td align="right">20H 17M 0S</td>
<td align="right">22H 26M 0S</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="left">night</td>
<td align="left">flower</td>
<td align="right">2019</td>
<td align="right">20H 7M 0S</td>
<td align="right">21H 50M 0S</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">night</td>
<td align="left">flower</td>
<td align="right">2021</td>
<td align="right">20H 15M 0S</td>
<td align="right">22H 56M 0S</td>
</tr>
<tr class="odd">
<td align="left">perc</td>
<td align="left">day</td>
<td align="left">air</td>
<td align="right">2018</td>
<td align="right">9H 20M 0S</td>
<td align="right">13H 50M 0S</td>
</tr>
<tr class="even">
<td align="left">perc</td>
<td align="left">day</td>
<td align="left">air</td>
<td align="right">2019</td>
<td align="right">9H 21M 0S</td>
<td align="right">17H 37M 0S</td>
</tr>
<tr class="odd">
<td align="left">perc</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="right">2018</td>
<td align="right">9H 34M 0S</td>
<td align="right">13H 53M 0S</td>
</tr>
<tr class="even">
<td align="left">perc</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="right">2019</td>
<td align="right">9H 31M 0S</td>
<td align="right">12H 39M 0S</td>
</tr>
<tr class="odd">
<td align="left">perc</td>
<td align="left">day</td>
<td align="left">leaf</td>
<td align="right">2019</td>
<td align="right">14H 17M 0S</td>
<td align="right">17H 51M 0S</td>
</tr>
<tr class="even">
<td align="left">perc</td>
<td align="left">night</td>
<td align="left">air</td>
<td align="right">2018</td>
<td align="right">20H 34M 0S</td>
<td align="right">22H 43M 0S</td>
</tr>
<tr class="odd">
<td align="left">perc</td>
<td align="left">night</td>
<td align="left">air</td>
<td align="right">2019</td>
<td align="right">20H 30M 0S</td>
<td align="right">23H 32M 0S</td>
</tr>
<tr class="even">
<td align="left">perc</td>
<td align="left">night</td>
<td align="left">flower</td>
<td align="right">2018</td>
<td align="right">21H 0M 0S</td>
<td align="right">22H 50M 0S</td>
</tr>
<tr class="odd">
<td align="left">perc</td>
<td align="left">night</td>
<td align="left">flower</td>
<td align="right">2019</td>
<td align="right">20H 44M 0S</td>
<td align="right">23H 18M 0S</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ggplot(meta, aes(x=paste(Expt, Site, Year), y=Total/60, color=Tissue)) + 
  geom_point(position=position_dodge(width=0.3))+
  theme_minimal() + theme(axis.text.x=element_text(angle=90)) + 
  ggtitle(&quot;Total sampling duration&quot;)+
  ylab(&quot;Equilibration plus pumping time (min)&quot;)</code></pre>
<p><img src="plots/times-2.svg" width="768" /></p>
</div>
<div id="otc-actual-temperature" class="section level2">
<h2>OTC actual temperature</h2>
<pre class="r"><code>ggplot(meta %&gt;% filter(Expt==&quot;otc&quot;, temp !=&quot;air&quot;, Site != &quot;bb&quot;), 
       aes(y=mean_temp_C_treatment, x=paste(Year, Site, temp), color=temp)) +
  facet_grid(cols=vars(DN), scales=&quot;free_x&quot;, space=&quot;free_x&quot;)+ 
  geom_boxplot(outlier.shape=NA)+ geom_point(alpha=0.2)+ 
  geom_path(aes(group=paste(Year, Site, Pump_datehour)), color=&quot;black&quot;, alpha=0.3)+
  theme_minimal() + theme(axis.text.x=element_text(angle=90)) + 
  scale_color_brewer(palette = &quot;Set1&quot;, direction=-1)+
  labs(y=&quot;Mean hourly temperature (\u00B0C)&quot;, x=(&quot;Year, site&quot;), color=&quot;Temperature&quot;)</code></pre>
<p><img src="plots/actualtemp-1.svg" width="768" /></p>
<pre class="r"><code>ggplot(meta %&gt;% filter(Expt==&quot;otc&quot;, temp !=&quot;air&quot;, Site != &quot;bb&quot;), 
       aes(y=mean_temp_C_warmed, x=mean_temp_C_control, color=DN))+
  geom_abline(slope=1, intercept=0)+ geom_smooth(se=F)+
  geom_text(aes(label=round(mean_temp_C_warmed-mean_temp_C_control)), alpha=0.2)+ theme_minimal() +
  labs(x= &quot;Mean temperature, controls (\u00B0C)&quot;, y=&quot;Mean temperature, warmed (\u00B0C)&quot;, color=&quot;Time&quot;)</code></pre>
<p><img src="plots/actualtemp-2.svg" width="768" /></p>
<pre class="r"><code>ggplot(meta %&gt;% filter(Expt==&quot;otc&quot;, temp !=&quot;air&quot;, Site != &quot;bb&quot;), 
       aes(y=mean_temp_C_warmed-mean_temp_C_control, x=hour(Pump), color=DN))+
  geom_point(alpha=0.1)+geom_smooth(aes(group=paste(Site, Year, DN)), se=F, method=&quot;lm&quot;)+ theme_minimal() +
    labs(x= &quot;Time of day&quot;, y=&quot;Temperature difference (\u00B0C)&quot;, color=&quot;Time&quot;)</code></pre>
<p><img src="plots/actualtemp-3.svg" width="768" /></p>
<pre class="r"><code>meta %&gt;% filter(Expt==&quot;otc&quot;, temp !=&quot;air&quot;, Site != &quot;bb&quot;) %&gt;% 
  mutate(mean_temp_C_diff = mean_temp_C_warmed-mean_temp_C_control) %&gt;% 
  group_by(DN) %&gt;% summarize(mean_temp_C_diff.SD = sd(mean_temp_C_diff, na.rm=T), 
                             mean_temp_C_diff = mean(mean_temp_C_diff, na.rm=T)) %&gt;% 
  kable(caption=&quot;temp difference during sampling&quot;)</code></pre>
<table>
<caption>temp difference during sampling</caption>
<thead>
<tr class="header">
<th align="left">DN</th>
<th align="right">mean_temp_C_diff.SD</th>
<th align="right">mean_temp_C_diff</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">day</td>
<td align="right">2.5252856</td>
<td align="right">5.308540</td>
</tr>
<tr class="even">
<td align="left">night</td>
<td align="right">0.4074518</td>
<td align="right">1.033114</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ggplot(meta %&gt;% filter(Expt==&quot;otc&quot;, temp !=&quot;air&quot;, Site != &quot;bb&quot;), 
       aes(y=mean_temp_C_warmed-mean_temp_C_control, x=mean_temp_C_control, color=DN))+
  geom_point(alpha=0.1)+geom_smooth(aes(group=paste(Site, Year, DN)), se=F, method=&quot;lm&quot;)+ theme_minimal() +
      labs(x= &quot;Mean temperature, controls (\u00B0C)&quot;, y=&quot;Temperature difference (\u00B0C)&quot;, color=&quot;Time&quot;)</code></pre>
<p><img src="plots/actualtemp-4.svg" width="768" /></p>
<pre class="r"><code>ggplot(meta %&gt;% filter(Expt==&quot;otc&quot;, temp !=&quot;air&quot;, Site != &quot;bb&quot;), 
       aes(x=hour(Pump), y=mean_temp_C_control, color=DN))+
  geom_point(alpha=0.1)+geom_smooth(aes(group=paste(Site, Year, DN)), se=F, method=&quot;lm&quot;)+ theme_minimal() +
  scale_x_continuous(n.breaks=20) +
      labs(x= &quot;Time of day&quot;, y=&quot;Temperature in controls (\u00B0C)&quot;, color=&quot;Time&quot;)</code></pre>
<p><img src="plots/actualtemp-5.svg" width="768" /></p>
</div>
</div>
<div id="filtering-criteria" class="section level1">
<h1>Filtering criteria</h1>
<div id="flowers" class="section level2">
<h2>Flowers</h2>
<pre class="r"><code>sv &lt;- meta %&gt;% drop_na(Filename)
#ipo.gc &lt;- ipo.all[sv$Filename,]

library(bouquet)
ipo.data.cut &lt;- ipo.data[ipo.data$Filename %in% sv$Filename,]
ipo.data.cut$Filename &lt;- sv$Filename[match(ipo.data.cut$Filename, sv$Filename)]
ipo.data.cut &lt;- ipo.data.cut[ipo.data.cut$Name != &quot;&quot;, ] #drop unidentified peaks
ipo.data.cut$Name &lt;- droplevels(ipo.data.cut$Name)
longdata &lt;- load_longdata(ipo.data.cut, sample=&quot;Filename&quot;, RT=&quot;Ret.Time&quot;, name=&quot;Name&quot;, area=&quot;Area&quot;, match = &quot;SI&quot;, maxmatch=100)
metadata &lt;- sv %&gt;% as.data.frame() %&gt;% #tibbles break bouquet&#39;s add_count_freqs
  rename(thesample=sample) %&gt;% #name conflict with bouquet
  mutate(Tissue = fct_recode(Tissue, ambient=&quot;air&quot;, floral=&quot;flower&quot;, leaf=&quot;leaf&quot;),
         PlantType = factor(if_else(Tissue==&quot;leaf&quot;,paste0(PlantType,Tissue), as.character(PlantType)))) %&gt;% 
  load_metadata(date=&quot;Date&quot;, sample=&quot;Filename&quot;, group=&quot;PlantType&quot;, type=&quot;Tissue&quot;)
vol.all &lt;- make_sampletable(longdata, metadata)
chems &lt;- make_chemtable(longdata, metadata)

### Flower filtering
chemsf &lt;- chems %&gt;%
  filter_RT(2, 17) %&gt;% 
  filter_match(0.8) %&gt;% 
  filter_freq(0.1, group = TRUE) %&gt;% #now filter separately for each species
  filter_contaminant(cont.list = c(&quot;Hexyl chloroformate&quot;, &quot;Disulfide, di-tert-dodecyl&quot;,
                                   &quot;2,2,4-Trimethyl-1,3-pentanediol diisobutyrate&quot;, 
                                   &quot;2,4,6-trimethyloctane&quot;, 
                                   &quot;Decane, 3,8-dimethyl-&quot;,    &quot;Ethanone, 1-cyclopentyl-&quot;, 
                                   &quot;o-Xylene&quot;)) %&gt;% #&quot;Benzonitrile, 2-methyl-&quot;
  filter_area(min_maximum = 1e6) %&gt;% 
  filter_ambient_ratio(vol.all, metadata, ratio = 3) %&gt;%
  combine_filters() 
chemsf$filter_final &lt;- with(chemsf, filter_RT == &quot;OK&quot; &amp; filter_match ==&quot;OK&quot; &amp; 
                              (filter_freq.agg == &quot;OK&quot; | filter_freq.ten ==&quot;OK&quot;) &amp; 
                              filter_area == &quot;OK&quot; &amp; filter_contaminant == &quot;OK&quot;)


#now run t-tests after rarity filtering
#don&#39;t filter by ambient ratio first, see paper on problems: https://doi.org/10.1186/1471-2105-11-450
chemsf &lt;- bind_rows(chemsf %&gt;% filter(filter_final) %&gt;% 
  filter_ambient_ttest(prune_sampletable(vol.all, chemsf, metadata), 
                       metadata, alpha = 0.05, adjust = &quot;fdr&quot;), 
  chemsf %&gt;% filter(!filter_final)) %&gt;% 
  mutate(filter_ambient_ttest=fct_na_value_to_level(filter_ambient_ttest, &quot;notchecked&quot;),
         filter_final = filter_final &amp; filter_ambient_ratio ==&quot;OK&quot;) %&gt;% 
  arrange(match(name, colnames(vol.all)))

bouquet::plot_filters(chemsf, option=&quot;rarity&quot;, yrange=3.5)</code></pre>
<p><img src="plots/filtering-1.svg" width="1152" /></p>
<pre class="r"><code>bouquet::plot_filters(chemsf, option=&quot;ambient&quot;, yrange=2.5)</code></pre>
<p><img src="plots/filtering-2.svg" width="1152" /></p>
<pre class="r"><code>bouquet::plot_filters(chemsf, option=&quot;volcano&quot;, yrange=2.5, alpha_excluded = 0.5)</code></pre>
<p><img src="plots/filtering-3.svg" width="1152" /></p>
<pre class="r"><code>bouquet::plot_filters(chemsf, option=&quot;prop&quot;)</code></pre>
<p><img src="plots/filtering-4.svg" width="1152" /></p>
</div>
<div id="leaves" class="section level2">
<h2>Leaves</h2>
<pre class="r"><code>### Leaf filtering
meta.leaf &lt;- metadata %&gt;% mutate(type = fct_recode(type, floral = &quot;leaf&quot;, flower = &quot;floral&quot;))  #trick bouquet to think the leaf samples are floral TODO: hacky!
chems.leaf &lt;- make_chemtable(longdata, meta.leaf) 
chemsf.leaf &lt;- chems.leaf %&gt;%
  filter_RT(2, 17) %&gt;% 
  filter_match(0.8) %&gt;% 
  filter_freq(0.2, group = TRUE) %&gt;%  #now filter separately for each species
  filter_contaminant(cont.list = c(&quot;Hexyl chloroformate&quot;,&quot;Acetic acid, trifluoro-, undecyl ester&quot;,
                                   &quot;Hexylene glycol&quot;)) %&gt;% 
  filter_area(min_maximum = 5e5) %&gt;% 
  filter_ambient_ratio(vol.all, meta.leaf, ratio = 4) %&gt;%
  combine_filters()
chemsf.leaf$filter_final &lt;- with(chemsf.leaf, filter_RT == &quot;OK&quot; &amp; filter_match ==&quot;OK&quot; &amp; 
                              (filter_freq.aggleaf == &quot;OK&quot; | filter_freq.tenleaf ==&quot;OK&quot;) &amp; 
                              filter_area == &quot;OK&quot; &amp;
                              filter_contaminant == &quot;OK&quot;)
#TODO bouquet needs to do a one-sided t-test! some compounds lower in blanks got a pass with low p value!

chemsf.leaf &lt;- bind_rows(chemsf.leaf %&gt;% filter(filter_final) %&gt;% 
  filter_ambient_ttest(prune_sampletable(vol.all, chemsf.leaf, metadata), 
                       metadata, alpha = 0.05, adjust = &quot;fdr&quot;), 
  chemsf.leaf %&gt;% filter(!filter_final)) %&gt;% 
  mutate(filter_ambient_ttest=fct_na_value_to_level(filter_ambient_ttest, &quot;notchecked&quot;),
         filter_final = filter_final &amp; filter_ambient_ratio ==&quot;OK&quot;)  %&gt;% 
  arrange(match(name, colnames(vol.all)))

bouquet::plot_filters(chemsf.leaf, option=&quot;rarity&quot;)</code></pre>
<p><img src="plots/filtering_leaf-1.svg" width="1152" /></p>
<pre class="r"><code>bouquet::plot_filters(chemsf.leaf, option=&quot;ambient&quot;, yrange=2.5)</code></pre>
<p><img src="plots/filtering_leaf-2.svg" width="1152" /></p>
<pre class="r"><code>bouquet::plot_filters(chemsf.leaf, option=&quot;volcano&quot;, yrange=2, alpha_excluded = 0.5)</code></pre>
<p><img src="plots/filtering_leaf-3.svg" width="1152" /></p>
<pre class="r"><code>bouquet::plot_filters(chemsf.leaf, option=&quot;prop&quot;)</code></pre>
<p><img src="plots/filtering_leaf-4.svg" width="1152" /></p>
<pre class="r"><code>#compare amounts in floral vs. leaf samples
chemsf &lt;- chemsf %&gt;% mutate(filter_ambient_leaf_ratio = chemsf.leaf$filter_ambient_ratio,
                            filter_ambient_leaf_ttest = chemsf.leaf$filter_ambient_ttest,
                            leaf_not_flower = filter_ambient_leaf_ratio==&quot;OK&quot; &amp; filter_ambient_leaf_ttest==&quot;OK&quot; &amp; 
                              !(filter_ambient_ratio==&quot;OK&quot; &amp; filter_ambient_ttest==&quot;OK&quot;))

kept_either &lt;- chemsf$filter_final | chemsf.leaf$filter_final
ggplot(chemsf[kept_either,], aes(x=mean.floral, y= chemsf.leaf[kept_either,&quot;mean.floral&quot;], label=name, color=paste(filter_final,chemsf.leaf[kept_either,&quot;filter_final&quot;], sep=&quot;, &quot;)))+ theme_minimal()+
  geom_abline(slope=1, intercept=1) +   geom_point(aes(size=RT), alpha=0.3)+  geom_text()+ 
  scale_x_log10()+ scale_y_log10() + coord_fixed()+
  scale_color_manual(labels=c(&quot;leaf&quot;,&quot;floral&quot;,&quot;both&quot;),values=c(&quot;darkgreen&quot;,&quot;red&quot;,&quot;blue&quot;))+
  labs(x=&quot;Mean area in flowers&quot;, y= &quot;Mean area in leaves&quot;, color=&quot;Kept in dataset&quot;)</code></pre>
<p><img src="plots/filtering_leaf-5.svg" width="1152" /></p>
<pre class="r"><code>vol &lt;- prune_sampletable(vol.all, chemsf, metadata)
vol.leaf &lt;- prune_sampletable(vol.all, chemsf.leaf, meta.leaf)

colnames(vol)[!colnames(vol) %in% shortnames]</code></pre>
<pre><code>character(0)</code></pre>
<pre class="r"><code>#&quot;OTC_Z3_190805_8102019_24.qgd&quot; was excluded
files_exclude &lt;- c(&quot;T196DAug16_09012018.qgd&quot;, &quot;A188DAug16_09012018.qgd&quot;,  &quot;T139_day_190725_862019_06.qgd&quot;, &quot;GNA_17_210716_7202021_18.qgd&quot;,&quot;Maxfield_27_210723_822021_03.qgd&quot;, &quot;Maxfield_9_210723_822021_05.qgd&quot; , #no filtered volatiles
                   &quot;SC_91_210715_8202021_10.qgd&quot;) #Artemisia leaves
#&quot;OTC_Z2_leaf_190805_8102019_23.qgd&quot; was excluded
files_exclude_leaf &lt;- c(&quot;CWH1LeafJuly27_09022018.qgd&quot;,&quot;NatArea69leafrenamedJuly25_08312018.qgd&quot;, #lack leaf mass
                        &quot;T164_leaf_190731_882019_18.qgd&quot;) #no filtered volatiles

svf &lt;- metadata[metadata$type == &quot;floral&quot; &amp; !(metadata$sample %in% files_exclude),]
svl &lt;- metadata[metadata$type == &quot;leaf&quot; &amp; !(metadata$sample %in% files_exclude_leaf),]

svf$Year &lt;- factor(svf$Year)
svf &lt;- svf %&gt;% mutate_if(is.factor, droplevels) %&gt;% 
  mutate(Treat = paste(temp, Temp) %&gt;% 
           fct_collapse(control=c(&quot;control NA&quot;,&quot;NA cool&quot;),warmed=c(&quot;NA warm&quot;,&quot;warmed NA&quot;)))
svl &lt;- svl %&gt;% mutate_if(is.factor, droplevels) %&gt;% 
  mutate(Treat = paste(temp, Temp) %&gt;% 
           fct_collapse(control=c(&quot;control NA&quot;,&quot;NA cool&quot;),warmed=c(&quot;NA warm&quot;,&quot;warmed NA&quot;)))

vol &lt;- vol[!(rownames(vol) %in% files_exclude) ,]
vol.leaf &lt;- vol.leaf[!(rownames(vol.leaf) %in% files_exclude_leaf) ,]

vol &lt;- vol / as.numeric(svf$Total, units=&quot;hours&quot;) / svf$NumFlrs #30 min of equilibration plus 15 minpumping, one flower 
vol.leaf &lt;- vol.leaf / as.numeric(svl$Total, units=&quot;hours&quot;) / svl$LeafDryWtGrams #area per hour per dry gram leaf</code></pre>
<pre class="r"><code># convert peak areas to nanograms using standards run in each year
ipochemsf &lt;- ipochems[match(colnames(vol), ipochems$shortname),]
for(yr in levels(svf$Year)) {
  thisyr &lt;- svf$Year==yr
  vol[thisyr,] &lt;- sweep(vol[thisyr,], 2, pull(ipochemsf, paste0(&quot;area_per_ng&quot;,yr)), FUN = &#39;/&#39;)
}
svf$Total &lt;- rowSums(vol)

ipochemsl &lt;- ipochems[match(colnames(vol.leaf), ipochems$shortname),]
vol.leaf &lt;- sweep(vol.leaf, 2, ipochemsl$area_per_ng2019, FUN = &#39;/&#39;)
svl$Total &lt;- rowSums(vol.leaf)</code></pre>
</div>
<div id="ambient-heatmap-and-nmds" class="section level2">
<h2>Ambient heatmap and NMDS</h2>
<pre class="r"><code>vol.pruned &lt;- vol.all[,chemsf$filter_final]
metadata$zeroSum &lt;- rowSums(vol.pruned)==0
vol.pruned &lt;- vol.pruned[!metadata$zeroSum,]

ph  &lt;- pheatmap(as.matrix(t(vol.pruned))^(1/3), 
         cluster_cols=T, show_colnames=F,
         clustering_method=&quot;mcquitty&quot;, clustering_distance_rows=&quot;correlation&quot;,
         clustering_distance_cols=vegdist(vol.pruned, method = &quot;bray&quot;),
         clustering_callback = function(hc, ...){dendsort(hc, type=&quot;average&quot;)},
         scale=&quot;none&quot;, color=inferno(512),
         annotation_col = data.frame(metadata %&gt;% filter(!zeroSum) %&gt;% select(&quot;Year&quot;, &quot;PlantType&quot;, &quot;expt&quot;, &quot;temp&quot;,&quot;DN&quot;,&quot;Site&quot;), row.names=rownames(vol.pruned)), 
   fontsize = 10, border_color = NA, legend=F, annotation_legend=T, cutree_rows=6
)</code></pre>
<p><img src="plots/heatmap_air-1.png" width="1152" /></p>
<pre class="r"><code>set.seed(1)
nmds.vol &lt;- metaMDS(sqrt(vol.pruned), dist=&quot;bray&quot;, autotransform = FALSE, trace=F, trymax=3)
ordiplot(nmds.vol, type = &quot;n&quot;)
text(nmds.vol, display=&quot;species&quot;, cex=0.7, col=&quot;grey20&quot;)
points(nmds.vol, display=&quot;sites&quot;, col=metadata$type, pch=as.integer(factor(metadata$Year)))</code></pre>
<p><img src="plots/nmds_air-1.svg" width="768" /></p>
</div>
</div>
<div id="all-filtered-samples" class="section level1">
<h1>All filtered samples</h1>
<div id="flower-heatmap" class="section level2">
<h2>Flower heatmap</h2>
<pre class="r"><code>#cairo_pdf(&quot;ipo_heatmap.pdf&quot;, width=12, height=12)
ph  &lt;- pheatmap(as.matrix(t(vol))^(1/3), 
         cluster_cols=T, show_colnames=F,
         clustering_method=&quot;mcquitty&quot;, clustering_distance_rows=&quot;correlation&quot;,
         clustering_distance_cols=vegdist(vol, method = &quot;bray&quot;),
         clustering_callback = function(hc, ...){dendsort(hc, type=&quot;average&quot;)},
         scale=&quot;none&quot;, color=inferno(512),
         annotation_col = data.frame(svf %&gt;% select(&quot;Year&quot;, &quot;PlantType&quot;, &quot;expt&quot;, &quot;Treat&quot;,&quot;DN&quot;,&quot;Site&quot;), row.names=rownames(vol)), 
   fontsize = 10, border_color = NA, legend=F, annotation_legend=T, cutree_rows=6
)</code></pre>
<p><img src="plots/heatmap-1.png" width="1152" /></p>
<pre class="r"><code>#dev.off()</code></pre>
</div>
<div id="flower-nmds" class="section level2">
<h2>Flower NMDS</h2>
<pre class="r"><code>set.seed(1)
nmds.vol &lt;- metaMDS(sqrt(vol), dist=&quot;bray&quot;, autotransform = FALSE, trace=F, trymax=3)

TEY &lt;- with(svf, factor(paste(PlantType,expt,Year)))
TEYcols &lt;- brewer.pal(9, &quot;Paired&quot;)#[c(1:4,8,5:6)]
spcols &lt;- c(agg=&quot;red&quot;, ten=&quot;violet&quot;)
ordiplot(nmds.vol, type = &quot;n&quot;)
text(nmds.vol, display=&quot;species&quot;, cex=0.7, col=&quot;grey20&quot;)
legend(&quot;topleft&quot;, levels(svf$DN), pch=c(1,4))
#legend(&quot;topright&quot;, levels(svf$PlantType), fill=spcols)
legend(&quot;bottomright&quot;, levels(svf$Year), fill=1:3)
#legend(&quot;bottomleft&quot;, levels(TEY), fill=TEYcols, cex=0.9)
#points(nmds.vol, display=&quot;sites&quot;, col=TEYcols[TEY], pch=c(13,19)[svf$DN])
#points(nmds.vol, display=&quot;sites&quot;, col=spcols[svf$PlantType], pch=c(13,19)[svf$DN])
points(nmds.vol, display=&quot;sites&quot;, col=svf$Year, pch=c(1,4)[svf$DN])</code></pre>
<p><img src="plots/nmds_filtered-1.svg" width="768" /></p>
<pre class="r"><code>#points(nmds.vol, display=&quot;sites&quot;, col=viridis(100)[sqrt(rowSums(vol))/100], pch=19)</code></pre>
</div>
</div>
<div id="otcs-vs.-ambient" class="section level1">
<h1>OTCs vs.Ambient</h1>
<div id="inventory" class="section level2">
<h2>Inventory</h2>
<pre class="r"><code>svf %&gt;% filter(expt==&quot;otc&quot;) %&gt;% count(PlantType, DN, temp,Year, Site, is.na(mean_temp_C_treatment)) %&gt;% 
  pivot_wider(names_from=temp, values_from=n) %&gt;%  kable(caption=&quot;Sample size&quot;)</code></pre>
<table>
<caption>Sample size</caption>
<colgroup>
<col width="13%" />
<col width="8%" />
<col width="6%" />
<col width="12%" />
<col width="39%" />
<col width="10%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">PlantType</th>
<th align="left">DN</th>
<th align="left">Year</th>
<th align="left">Site</th>
<th align="left">is.na(mean_temp_C_treatment)</th>
<th align="right">control</th>
<th align="right">warmed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2018</td>
<td align="left">GNA</td>
<td align="left">FALSE</td>
<td align="right">16</td>
<td align="right">29</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2018</td>
<td align="left">bb</td>
<td align="left">TRUE</td>
<td align="right">13</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2019</td>
<td align="left">GNA</td>
<td align="left">FALSE</td>
<td align="right">7</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2019</td>
<td align="left">GNA</td>
<td align="left">TRUE</td>
<td align="right">3</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">GNA</td>
<td align="left">FALSE</td>
<td align="right">26</td>
<td align="right">30</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">Maxfield</td>
<td align="left">FALSE</td>
<td align="right">38</td>
<td align="right">42</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">2019</td>
<td align="left">SC</td>
<td align="left">FALSE</td>
<td align="right">10</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="left">FALSE</td>
<td align="right">30</td>
<td align="right">41</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">2019</td>
<td align="left">SC</td>
<td align="left">FALSE</td>
<td align="right">8</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="left">FALSE</td>
<td align="right">27</td>
<td align="right">39</td>
</tr>
</tbody>
</table>
<pre class="r"><code>samplesperplant &lt;- svf %&gt;% filter(Expt==&quot;otc&quot;) %&gt;% count(PlantType, DN, temp, Year, Site, PlantID)
samplesperplant %&gt;% count(PlantType, DN, Year, Site, temp) %&gt;%  pivot_wider(names_from=temp, values_from=n) %&gt;% kable(caption=&quot;Number of plants&quot;)</code></pre>
<table>
<caption>Number of plants</caption>
<thead>
<tr class="header">
<th align="left">PlantType</th>
<th align="left">DN</th>
<th align="left">Year</th>
<th align="left">Site</th>
<th align="right">control</th>
<th align="right">warmed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2018</td>
<td align="left">GNA</td>
<td align="right">16</td>
<td align="right">28</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2018</td>
<td align="left">bb</td>
<td align="right">13</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2019</td>
<td align="left">GNA</td>
<td align="right">10</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">GNA</td>
<td align="right">18</td>
<td align="right">18</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">Maxfield</td>
<td align="right">26</td>
<td align="right">27</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">2019</td>
<td align="left">SC</td>
<td align="right">10</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="right">16</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">2019</td>
<td align="left">SC</td>
<td align="right">8</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="right">16</td>
<td align="right">25</td>
</tr>
</tbody>
</table>
<pre class="r"><code>samplesperplant %&gt;% count(PlantType, DN, Year, Site, n) %&gt;% kable(caption=&quot;Sample size per plant&quot;)</code></pre>
<table>
<caption>Sample size per plant</caption>
<thead>
<tr class="header">
<th align="left">PlantType</th>
<th align="left">DN</th>
<th align="left">Year</th>
<th align="left">Site</th>
<th align="right">n</th>
<th align="right">nn</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2018</td>
<td align="left">GNA</td>
<td align="right">1</td>
<td align="right">43</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2018</td>
<td align="left">GNA</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2018</td>
<td align="left">bb</td>
<td align="right">1</td>
<td align="right">26</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2019</td>
<td align="left">GNA</td>
<td align="right">1</td>
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">GNA</td>
<td align="right">1</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">GNA</td>
<td align="right">2</td>
<td align="right">20</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">Maxfield</td>
<td align="right">1</td>
<td align="right">28</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">Maxfield</td>
<td align="right">2</td>
<td align="right">23</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">Maxfield</td>
<td align="right">3</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">2019</td>
<td align="left">SC</td>
<td align="right">1</td>
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="right">1</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="right">2</td>
<td align="right">31</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">2019</td>
<td align="left">SC</td>
<td align="right">1</td>
<td align="right">17</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="right">1</td>
<td align="right">19</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="right">2</td>
<td align="right">19</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="right">3</td>
<td align="right">3</td>
</tr>
</tbody>
</table>
<pre class="r"><code>samplesperplant %&gt;% ggplot(aes(x=n, fill=Site)) + facet_grid(Site ~ Year) + geom_histogram(binwidth=1) + 
  stat_bin(aes(label=stat(count)), y=3, geom=&quot;text&quot;, binwidth=1) + guides(fill=&quot;none&quot;) + theme_minimal()</code></pre>
<p><img src="plots/otc-1.svg" width="768" /></p>
<pre class="r"><code>ggplot(svf %&gt;% filter(Expt==&quot;otc&quot;) %&gt;% mutate(site=paste(Site,DN))) + facet_wrap(vars(Year), ncol=1)+
  geom_bar(aes(x=yday(date), color=site, fill=site)) +
  geom_vline(data=read_csv(&quot;./data/CWu OTC Hobos - duration.csv&quot;) %&gt;% 
    mutate(begin=OTC_start-days(1), end=OTC_end+days(1), #start/end were trimmed 1 day for hobos
           Year=year, site=paste(site,&quot;day&quot;), .keep=&quot;unused&quot;), 
    aes(xintercept=yday(begin), color=site), size=1, linetype=2)+
  theme_minimal() + labs(x=&quot;Day of year&quot;, y=&quot;Number of floral volatile samples&quot;, color=&quot;Site&quot;, fill=&quot;Site&quot;)</code></pre>
<p><img src="plots/otc-2.svg" width="768" /></p>
<pre class="r"><code>plot.otc &lt;- function(svf.otc, cap.terms=c(&quot;mean_temp_C_treatment&quot;, &quot;temp&quot;), plot.chems=T) {
  vol.otc &lt;- vol[svf.otc$sample,]
  cap.formula &lt;- reformulate(cap.terms, response = &quot;sqrt(vol.otc)&quot;)
  cap.otc &lt;- capscale(cap.formula, distance=&quot;bray&quot;, data=svf.otc)
  summ.cap &lt;- summary(cap.otc)
  prop.expl &lt;- summ.cap$cont$importance
  ax.labs &lt;- paste0(colnames(prop.expl)[1:2], &quot; (&quot;,round(100*prop.expl[2,1:2]),&quot;% explained)&quot;)
  cap.terms.int &lt;- str_subset(cap.terms, &quot;:&quot;)
  anova.cap &lt;- anova(cap.otc, by=ifelse(length(cap.terms.int)&gt;0, &quot;term&quot;, &quot;margin&quot;))
  
  plot(cap.otc, type=&quot;n&quot;, xlim=range(cap.otc$CCA$wa[,1]), xlab=ax.labs[1], ylab=ax.labs[2])
  with(svf.otc, 
       title(main=paste(&quot;OTC warming:&quot;,&quot;I.&quot;,unique(PlantType), &quot;at&quot;, paste(unique(Site), collapse=&quot; &amp; &quot;),unique(Year),
                            do.call(paste0, list(unique(DN), collapse=&quot;/&quot;)), &quot;n =&quot;,nrow(svf.otc))))
  if(&quot;temp&quot; %in% cap.terms) legend(&quot;topleft&quot;, title=paste(&quot;Treatment&quot;,&quot;\nP =&quot;,anova.cap[&quot;temp&quot;,&quot;Pr(&gt;F)&quot;]), 
                                   levels(svf.otc$temp), fill=tempcol)
  if(&quot;DN&quot; %in% cap.terms) legend(&quot;topright&quot;, title=paste(&quot;Time&quot;,&quot;\nP =&quot;,anova.cap[&quot;DN&quot;,&quot;Pr(&gt;F)&quot;]), 
                                 levels(svf.otc$DN), pch=c(1,19))
  if(length(cap.terms.int)&gt;0) legend(&quot;bottomleft&quot;, title= paste(&quot;Interaction\nP =&quot;, anova.cap[cap.terms.int,&quot;Pr(&gt;F)&quot;]), legend=&quot;&quot;)
  temprange &lt;- round(c(max(svf.otc$mean_temp_C_treatment), min(svf.otc$mean_temp_C_treatment)))
  if(&quot;mean_temp_C_treatment&quot; %in% cap.terms) legend(&quot;bottomleft&quot;, 
                                                    title=paste(&quot;Temperature&quot;,&quot;\nP =&quot;,anova.cap[&quot;mean_temp_C_treatment&quot;,&quot;Pr(&gt;F)&quot;]),
                                                    paste(temprange, &quot; C&quot;), fill=rev(viridis(2)))
  if(&quot;Site&quot; %in% cap.terms) legend(&quot;bottomright&quot;,  title=paste(&quot;Site&quot;,&quot;\nP =&quot;,anova.cap[&quot;Site&quot;,&quot;Pr(&gt;F)&quot;]),
                                   unique(svf.otc$Site))
  ordispider(cap.otc, with(svf.otc, paste(Year, Site, temp, PlantID)), col=&quot;grey80&quot;)
  points(cap.otc, display=&quot;sites&quot;, col=c(tempcol)[svf.otc$temp], pch=c(1,19)[svf.otc$DN]) 
  text(cap.otc, display=&quot;cn&quot;)
  if(plot.chems) {
    if(length(cap.terms)&gt;1) text(cap.otc, display=&quot;species&quot;, cex=0.8, srt=45,
                     col=ifelse(sqrt(cap.otc$CCA$v[,1]^2 + cap.otc$CCA$v[,2]^2)&gt;0.25, alpha(&quot;purple&quot;,1),alpha(&quot;purple&quot;,0)))
    else text(cap.otc, display=&quot;species&quot;, cex=0.8, srt=45,
              col=ifelse(abs(cap.otc$CCA$v[,1])&gt;0.1, alpha(&quot;purple&quot;,1),alpha(&quot;purple&quot;,0)))
  }
  return(cap.otc)
}

plot.terms &lt;-c(&quot;mean_temp_C_treatment&quot;, &quot;temp&quot;)</code></pre>
</div>
<div id="cap-of-i.-aggregata" class="section level2">
<h2>CAP of <em>I. aggregata</em></h2>
<div id="each-year-and-site" class="section level3">
<h3>Each year and site</h3>
<pre class="r"><code>cap.siteyr.agg &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, PlantType==&quot;agg&quot;) %&gt;% 
  drop_na(mean_temp_C_treatment) %&gt;% 
  group_by(Site, Year) %&gt;% summarize(meta = list(cur_data_all()), .groups = &quot;drop&quot;) %&gt;% 
  arrange(Site, Year) %&gt;% #nest that keeps groups
  mutate(samples = map_int(meta, nrow),
         cap = map(meta, plot.otc),
         anova = map(cap, ~tidy(anova(.x, by=&quot;margin&quot;))))</code></pre>
<p><img src="plots/otc_agg-1.svg" width="768" /><img src="plots/otc_agg-2.svg" width="768" /><img src="plots/otc_agg-3.svg" width="768" /><img src="plots/otc_agg-4.svg" width="768" /></p>
<pre class="r"><code>cap.siteyr.agg %&gt;% select(-c(meta,cap)) %&gt;% unnest(anova) %&gt;% 
  filter(term!=&quot;Residual&quot;) %&gt;% select(-c(df, SumOfSqs,statistic)) %&gt;% 
  pivot_wider(names_from=term, values_from=p.value) %&gt;% 
  rename(N=samples, Temperature=mean_temp_C_treatment, Treatment=temp) %&gt;% 
  kable(caption=&quot;I. aggregata site-year CAP p-values&quot;)</code></pre>
<table>
<caption>I. aggregata site-year CAP p-values</caption>
<thead>
<tr class="header">
<th align="left">Site</th>
<th align="left">Year</th>
<th align="right">N</th>
<th align="right">Temperature</th>
<th align="right">Treatment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GNA</td>
<td align="left">2018</td>
<td align="right">45</td>
<td align="right">0.001</td>
<td align="right">0.464</td>
</tr>
<tr class="even">
<td align="left">GNA</td>
<td align="left">2019</td>
<td align="right">14</td>
<td align="right">0.829</td>
<td align="right">0.739</td>
</tr>
<tr class="odd">
<td align="left">GNA</td>
<td align="left">2021</td>
<td align="right">56</td>
<td align="right">0.235</td>
<td align="right">0.142</td>
</tr>
<tr class="even">
<td align="left">Maxfield</td>
<td align="left">2021</td>
<td align="right">80</td>
<td align="right">0.001</td>
<td align="right">0.005</td>
</tr>
</tbody>
</table>
</div>
<div id="both-sites" class="section level3">
<h3>2021 both sites</h3>
<pre class="r"><code>cap.yr.agg &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, PlantType==&quot;agg&quot;, year == &quot;2021&quot;) %&gt;% 
  drop_na(mean_temp_C_treatment) %&gt;% 
  group_by(Year) %&gt;% summarize(meta = list(cur_data_all()), .groups = &quot;drop&quot;) %&gt;% 
  mutate(samples = map_int(meta, nrow),
         cap = map(meta, plot.otc, cap.terms=c(plot.terms, &quot;Site&quot;)),
         anova = map(cap, ~tidy(anova(.x, by=&quot;margin&quot;))))</code></pre>
<p><img src="plots/otc_comb_year-1.svg" width="768" /></p>
<pre class="r"><code>cap.yr.agg %&gt;% select(-c(meta,cap)) %&gt;% unnest(anova) %&gt;% 
  filter(term!=&quot;Residual&quot;) %&gt;% select(-c(df, SumOfSqs,statistic)) %&gt;% 
  pivot_wider(names_from=term, values_from=p.value) %&gt;% 
  rename(N=samples, Temperature=mean_temp_C_treatment, Treatment=temp) %&gt;% 
  kable(caption=&quot;I. aggregata year CAP p-values&quot;)</code></pre>
<table>
<caption>I. aggregata year CAP p-values</caption>
<thead>
<tr class="header">
<th align="left">Year</th>
<th align="right">N</th>
<th align="right">Temperature</th>
<th align="right">Treatment</th>
<th align="right">Site</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2021</td>
<td align="right">136</td>
<td align="right">0.006</td>
<td align="right">0.02</td>
<td align="right">0.048</td>
</tr>
</tbody>
</table>
</div>
<div id="all-years" class="section level3">
<h3>All years</h3>
<pre class="r"><code>svf.otc &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, PlantType==&quot;agg&quot;, Site!=&quot;bb&quot;) %&gt;% drop_na(mean_temp_C_treatment)
vol.otc &lt;- vol[svf.otc$sample,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ Year + Site + Site*mean_temp_C_treatment + Year*mean_temp_C_treatment + temp, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ Year + Site + Site *
mean_temp_C_treatment + Year * mean_temp_C_treatment + temp, data =
svf.otc, distance = &quot;bray&quot;)

               Inertia Proportion Rank
Total          39.5929     1.0000     
Constrained     6.2318     0.1574    8
Unconstrained  45.1402     1.1401   64
Imaginary     -11.7792    -0.2975  130
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
 CAP1  CAP2  CAP3  CAP4  CAP5  CAP6  CAP7  CAP8 
3.176 1.284 0.690 0.372 0.234 0.197 0.162 0.116 

Eigenvalues for unconstrained axes:
 MDS1  MDS2  MDS3  MDS4  MDS5  MDS6  MDS7  MDS8 
7.968 4.384 3.958 2.697 2.500 2.082 2.005 1.727 
(Showing 8 of 64 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>(anova.cap &lt;- anova(cap.otc.comb, by=&quot;term&quot;))</code></pre>
<pre><code>Permutation test for capscale under reduced model
Terms added sequentially (first to last)
Permutation: free
Number of permutations: 999

Model: capscale(formula = sqrt(vol.otc) ~ Year + Site + Site * mean_temp_C_treatment + Year * mean_temp_C_treatment + temp, data = svf.otc, distance = &quot;bray&quot;)
                            Df SumOfSqs      F Pr(&gt;F)    
Year                         2    2.888 5.9499  0.001 ***
Site                         1    0.906 3.7335  0.001 ***
mean_temp_C_treatment        1    0.798 3.2885  0.001 ***
temp                         1    0.517 2.1284  0.018 *  
Site:mean_temp_C_treatment   1    0.596 2.4548  0.008 ** 
Year:mean_temp_C_treatment   2    0.527 1.0867  0.298    
Residual                   186   45.140                  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summ.cap &lt;- summary(cap.otc.comb)
prop.expl &lt;- summ.cap$cont$importance
ax.labs &lt;- paste0(colnames(prop.expl)[1:2], &quot; (&quot;,round(100*prop.expl[2,1:2]),&quot;% explained)&quot;)

yearpch &lt;- c(`2018`=15,`2019`=19,`2021`=17)
plot(cap.otc.comb, type=&quot;n&quot;, xlab=ax.labs[1], ylab=ax.labs[2])
title(paste(&quot;OTC warming: I. agg at all sites, all years&quot;, &quot;n =&quot;, nrow(svf.otc)))
temprange &lt;- round(c(max(svf.otc$mean_temp_C_treatment), min(svf.otc$mean_temp_C_treatment)))
legend(&quot;topleft&quot;,  title=paste(&quot;Temperature&quot;,&quot;\nP =&quot;,anova.cap[&quot;mean_temp_C_treatment&quot;,&quot;Pr(&gt;F)&quot;]), legend=paste(temprange, &quot; C&quot;), fill=rev(viridis(2)))
legend(&quot;topright&quot;,  title=paste(&quot;Year&quot;,&quot;\nP =&quot;,anova.cap[&quot;Year&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.otc$Year), pch=yearpch)
legend(&quot;bottomright&quot;,  title=paste(&quot;Site&quot;,&quot;\nP =&quot;,anova.cap[&quot;Site&quot;,&quot;Pr(&gt;F)&quot;]), legend=unique(svf.otc$Site))
legend(&quot;bottomleft&quot;,  title=paste(&quot;Treatment&quot;,&quot;\nP =&quot;,anova.cap[&quot;temp&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.otc$temp))
ordispider(cap.otc.comb, with(svf.otc, paste(Year, Site, temp, PlantID)), col=&quot;grey80&quot;)
points(cap.otc.comb, display=&quot;sites&quot;, col=inferno(round(temprange[1]-temprange[2]))[round(svf.otc$mean_temp_C_treatment-temprange[2])+1], pch=yearpch[svf.otc$Year]) 
text(cap.otc.comb, display=&quot;cn&quot;)
text(cap.otc.comb, display=&quot;species&quot;, cex=0.7, srt=45,
                     col=ifelse(sqrt(cap.otc.comb$CCA$v[,1]^2 + cap.otc.comb$CCA$v[,2]^2)&gt;0.25, alpha(&quot;purple&quot;,0.7),alpha(&quot;purple&quot;,0)))</code></pre>
<p><img src="plots/otc_comb_temp-1.svg" width="768" /></p>
<pre class="r"><code>lmer(sqrt(Total) ~ Year + Site + temp + (1|PlantID), data = svf.otc) %&gt;% anova %&gt;% kable(caption=&quot;total emissions&quot;)</code></pre>
<table>
<caption>total emissions</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Year</td>
<td align="right">600.44286</td>
<td align="right">300.22143</td>
<td align="right">2</td>
<td align="right">171.1342</td>
<td align="right">14.284306</td>
<td align="right">0.0000018</td>
</tr>
<tr class="even">
<td align="left">Site</td>
<td align="right">31.20738</td>
<td align="right">31.20738</td>
<td align="right">1</td>
<td align="right">108.7635</td>
<td align="right">1.484823</td>
<td align="right">0.2256579</td>
</tr>
<tr class="odd">
<td align="left">temp</td>
<td align="right">16.88730</td>
<td align="right">16.88730</td>
<td align="right">1</td>
<td align="right">136.2373</td>
<td align="right">0.803485</td>
<td align="right">0.3716346</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cap-of-i.-tenuituba" class="section level2">
<h2>CAP of <em>I. tenuituba</em></h2>
<div id="each-year" class="section level3">
<h3>Each year</h3>
<pre class="r"><code>cap.yr.ten &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, PlantType==&quot;ten&quot;) %&gt;% 
  group_by(Year) %&gt;% summarize(meta = list(cur_data_all()), .groups = &quot;drop&quot;) %&gt;% 
  mutate(samples = map_int(meta, nrow),
         cap = map(meta, plot.otc, cap.terms=c(&quot;DN&quot;,&quot;temp&quot;,&quot;DN:temp&quot;)),
         anova = map(cap, ~tidy(anova(.x, by=&quot;term&quot;))))</code></pre>
<p><img src="plots/otc_ten-1.svg" width="768" /><img src="plots/otc_ten-2.svg" width="768" /></p>
<pre class="r"><code>cap.yr.ten %&gt;% select(-c(meta,cap)) %&gt;% unnest(anova) %&gt;% 
  filter(term!=&quot;Residual&quot;) %&gt;% select(-c(df, SumOfSqs,statistic)) %&gt;% 
  pivot_wider(names_from=term, values_from=p.value) %&gt;% 
  rename(N=samples, Time=DN, Treatment=temp, &quot;Time:Treatment&quot;=&quot;DN:temp&quot;) %&gt;% 
  kable(caption=&quot;I. tenuituba year CAP p-values&quot;)</code></pre>
<table>
<caption>I. tenuituba year CAP p-values</caption>
<thead>
<tr class="header">
<th align="left">Year</th>
<th align="right">N</th>
<th align="right">Time</th>
<th align="right">Treatment</th>
<th align="right">Time:Treatment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2019</td>
<td align="right">38</td>
<td align="right">0.179</td>
<td align="right">0.146</td>
<td align="right">0.038</td>
</tr>
<tr class="even">
<td align="left">2021</td>
<td align="right">137</td>
<td align="right">0.001</td>
<td align="right">0.452</td>
<td align="right">0.773</td>
</tr>
</tbody>
</table>
</div>
<div id="both-years-day" class="section level3">
<h3>Both years, day</h3>
<pre class="r"><code>svf.otc &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, PlantType==&quot;ten&quot;, DN==&quot;day&quot;) %&gt;% drop_na(mean_temp_C_treatment)
vol.otc &lt;- vol[svf.otc$sample,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ Year*mean_temp_C_treatment + temp, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ Year * mean_temp_C_treatment +
temp, data = svf.otc, distance = &quot;bray&quot;)

              Inertia Proportion Rank
Total         16.8074     1.0000     
Constrained    1.3966     0.0831    4
Unconstrained 19.3694     1.1524   38
Imaginary     -3.9586    -0.2355   51
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
  CAP1   CAP2   CAP3   CAP4 
0.6071 0.4481 0.1996 0.1418 

Eigenvalues for unconstrained axes:
 MDS1  MDS2  MDS3  MDS4  MDS5  MDS6  MDS7  MDS8 
3.924 2.617 1.732 1.414 1.174 1.070 0.903 0.767 
(Showing 8 of 38 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>(anova.cap &lt;- anova(cap.otc.comb, by=&quot;term&quot;))</code></pre>
<pre><code>Permutation test for capscale under reduced model
Terms added sequentially (first to last)
Permutation: free
Number of permutations: 999

Model: capscale(formula = sqrt(vol.otc) ~ Year * mean_temp_C_treatment + temp, data = svf.otc, distance = &quot;bray&quot;)
                           Df SumOfSqs      F Pr(&gt;F)   
Year                        1   0.4880 2.1917  0.015 * 
mean_temp_C_treatment       1   0.2384 1.0710  0.372   
temp                        1   0.1594 0.7159  0.745   
Year:mean_temp_C_treatment  1   0.5108 2.2945  0.009 **
Residual                   87  19.3694                 
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summ.cap &lt;- summary(cap.otc.comb)
prop.expl &lt;- summ.cap$cont$importance
ax.labs &lt;- paste0(colnames(prop.expl)[1:2], &quot; (&quot;,round(100*prop.expl[2,1:2]),&quot;% explained)&quot;)

yearpch &lt;- c(`2018`=15,`2019`=19,`2021`=17)
plot(cap.otc.comb, type=&quot;n&quot;, xlab=ax.labs[1], ylab=ax.labs[2])
title(paste(&quot;OTC warming: I. ten, 2019/2021 day&quot;,&quot;n =&quot;, nrow(svf.otc)))
temprange &lt;- round(c(max(svf.otc$mean_temp_C_treatment), min(svf.otc$mean_temp_C_treatment)))
legend(&quot;topleft&quot;,  title=paste(&quot;Temperature&quot;,&quot;\nP =&quot;,anova.cap[&quot;mean_temp_C_treatment&quot;,&quot;Pr(&gt;F)&quot;]), legend=paste(temprange, &quot; C&quot;), fill=rev(viridis(2)))
legend(&quot;topright&quot;,  title=paste(&quot;Year&quot;,&quot;\nP =&quot;,anova.cap[&quot;Year&quot;,&quot;Pr(&gt;F)&quot;]), legend=unique(svf.otc$Year), pch=yearpch[unique(svf.otc$Year)])
legend(&quot;left&quot;,  title=paste(&quot;Treatment&quot;,&quot;\nP =&quot;,anova.cap[&quot;temp&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.otc$temp))
ordispider(cap.otc.comb, with(svf.otc, paste(Year, Site, temp, PlantID)), col=&quot;grey80&quot;)
points(cap.otc.comb, display=&quot;sites&quot;, col=inferno(round(temprange[1]-temprange[2]))[round(svf.otc$mean_temp_C_treatment-temprange[2])+1], pch=yearpch[svf.otc$Year]) 
text(cap.otc.comb, display=&quot;cn&quot;)
text(cap.otc.comb, display=&quot;species&quot;, cex=0.7, srt=45,
                     col=ifelse(sqrt(cap.otc.comb$CCA$v[,1]^2 + cap.otc.comb$CCA$v[,2]^2)&gt;0.25, alpha(&quot;purple&quot;,0.7),alpha(&quot;purple&quot;,0)))</code></pre>
<p><img src="plots/otc_comb_temp_tenD-1.svg" width="768" /></p>
<pre class="r"><code>lmer(sqrt(Total) ~ Year + temp + (1|PlantID), data = svf.otc) %&gt;% anova %&gt;% kable(caption=&quot;total emissions&quot;)</code></pre>
<table>
<caption>total emissions</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Year</td>
<td align="right">0.070742</td>
<td align="right">0.070742</td>
<td align="right">1</td>
<td align="right">89</td>
<td align="right">0.0021563</td>
<td align="right">0.9630669</td>
</tr>
<tr class="even">
<td align="left">temp</td>
<td align="right">153.919709</td>
<td align="right">153.919709</td>
<td align="right">1</td>
<td align="right">89</td>
<td align="right">4.6916152</td>
<td align="right">0.0329835</td>
</tr>
</tbody>
</table>
</div>
<div id="both-years-night" class="section level3">
<h3>Both years, night</h3>
<pre class="r"><code>svf.otc &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, PlantType==&quot;ten&quot;, DN==&quot;night&quot;)
vol.otc &lt;- vol[svf.otc$sample,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ Year*temp, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ Year * temp, data = svf.otc,
distance = &quot;bray&quot;)

              Inertia Proportion Rank
Total          12.351      1.000     
Constrained     1.062      0.086    3
Unconstrained  13.598      1.101   37
Imaginary      -2.309     -0.187   43
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
  CAP1   CAP2   CAP3 
0.8141 0.1691 0.0790 

Eigenvalues for unconstrained axes:
 MDS1  MDS2  MDS3  MDS4  MDS5  MDS6  MDS7  MDS8 
3.449 1.980 1.420 0.937 0.674 0.597 0.546 0.489 
(Showing 8 of 37 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>(anova.cap &lt;- anova(cap.otc.comb, by=&quot;term&quot;))</code></pre>
<pre><code>Permutation test for capscale under reduced model
Terms added sequentially (first to last)
Permutation: free
Number of permutations: 999

Model: capscale(formula = sqrt(vol.otc) ~ Year * temp, data = svf.otc, distance = &quot;bray&quot;)
          Df SumOfSqs      F Pr(&gt;F)    
Year       1   0.7808 4.5364  0.001 ***
temp       1   0.1486 0.8635  0.543    
Year:temp  1   0.1327 0.7711  0.623    
Residual  79  13.5979                  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summ.cap &lt;- summary(cap.otc.comb)
prop.expl &lt;- summ.cap$cont$importance
ax.labs &lt;- paste0(colnames(prop.expl)[1:2], &quot; (&quot;,round(100*prop.expl[2,1:2]),&quot;% explained)&quot;)

yearpch &lt;- c(`2018`=15,`2019`=19,`2021`=17)
plot(cap.otc.comb, type=&quot;n&quot;, xlab=ax.labs[1], ylab=ax.labs[2])
title(paste(&quot;OTC warming: I. ten, 2019/2021 night&quot;,&quot;n =&quot;, nrow(svf.otc)))
legend(&quot;topright&quot;,  title=paste(&quot;Year&quot;,&quot;\nP =&quot;,anova.cap[&quot;Year&quot;,&quot;Pr(&gt;F)&quot;]), legend=unique(svf.otc$Year), pch=yearpch[unique(svf.otc$Year)])
legend(&quot;left&quot;,  title=paste(&quot;Treatment&quot;,&quot;\nP =&quot;,anova.cap[&quot;temp&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.otc$temp), fill=tempcol)
ordispider(cap.otc.comb, with(svf.otc, paste(Year, Site, temp, PlantID)), col=&quot;grey80&quot;)
points(cap.otc.comb, display=&quot;sites&quot;, col=tempcol[svf.otc$temp], pch=yearpch[svf.otc$Year]) 
text(cap.otc.comb, display=&quot;cn&quot;)
text(cap.otc.comb, display=&quot;species&quot;, cex=0.7, srt=45,
                     col=ifelse(sqrt(cap.otc.comb$CCA$v[,1]^2 + cap.otc.comb$CCA$v[,2]^2)&gt;0.25, alpha(&quot;purple&quot;,0.7),alpha(&quot;purple&quot;,0)))</code></pre>
<p><img src="plots/otc_comb_temp_tenN-1.svg" width="768" /></p>
<pre class="r"><code>lmer(sqrt(Total) ~ Year + temp + (1|PlantID), data = svf.otc) %&gt;% anova %&gt;% kable(caption=&quot;total emissions&quot;)</code></pre>
<table>
<caption>total emissions</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Year</td>
<td align="right">292.9771190</td>
<td align="right">292.9771190</td>
<td align="right">1</td>
<td align="right">65.64451</td>
<td align="right">8.6134855</td>
<td align="right">0.0045942</td>
</tr>
<tr class="even">
<td align="left">temp</td>
<td align="right">0.6975349</td>
<td align="right">0.6975349</td>
<td align="right">1</td>
<td align="right">55.64252</td>
<td align="right">0.0205074</td>
<td align="right">0.8866463</td>
</tr>
</tbody>
</table>
</div>
<div id="night-vwc" class="section level3">
<h3>2021, night, VWC</h3>
<pre class="r"><code>svf.otc &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, PlantType==&quot;ten&quot;, DN==&quot;night&quot;) %&gt;% drop_na(SoilVWC)
vol.otc &lt;- vol[svf.otc$sample,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ temp + SoilVWC, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ temp + SoilVWC, data =
svf.otc, distance = &quot;bray&quot;)

               Inertia Proportion Rank
Total          8.13548    1.00000     
Constrained    0.25567    0.03143    2
Unconstrained  9.19223    1.12989   31
Imaginary     -1.31242   -0.16132   30
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
   CAP1    CAP2 
0.14623 0.10944 

Eigenvalues for unconstrained axes:
  MDS1   MDS2   MDS3   MDS4   MDS5   MDS6   MDS7   MDS8 
2.5205 1.5928 1.0585 0.7059 0.4707 0.4103 0.3691 0.3047 
(Showing 8 of 31 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>(anova.cap &lt;- anova(cap.otc.comb, by=&quot;margin&quot;))</code></pre>
<pre><code>Permutation test for capscale under reduced model
Marginal effects of terms
Permutation: free
Number of permutations: 999

Model: capscale(formula = sqrt(vol.otc) ~ temp + SoilVWC, data = svf.otc, distance = &quot;bray&quot;)
         Df SumOfSqs     F Pr(&gt;F)
temp      1   0.1117 0.741  0.678
SoilVWC   1   0.1388 0.921  0.473
Residual 61   9.1922             </code></pre>
</div>
</div>
<div id="both-species-day" class="section level2">
<h2>Both species, day</h2>
<pre class="r"><code>svf.otc &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, DN==&quot;day&quot;, Site!=&quot;bb&quot;) %&gt;% drop_na(mean_temp_C_treatment)
vol.otc &lt;- vol[svf.otc$sample,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ Year + Site + mean_temp_C_treatment + temp, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ Year + Site +
mean_temp_C_treatment + temp, data = svf.otc, distance = &quot;bray&quot;)

               Inertia Proportion Rank
Total          59.4419     1.0000     
Constrained     8.0787     0.1359    6
Unconstrained  71.7054     1.2063   81
Imaginary     -20.3422    -0.3422  203
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
 CAP1  CAP2  CAP3  CAP4  CAP5  CAP6 
4.161 1.548 1.304 0.735 0.173 0.158 

Eigenvalues for unconstrained axes:
  MDS1   MDS2   MDS3   MDS4   MDS5   MDS6   MDS7   MDS8 
12.059  6.761  4.891  4.089  3.685  3.076  2.941  2.575 
(Showing 8 of 81 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>(anova.cap &lt;- anova(cap.otc.comb, by=&quot;margin&quot;))</code></pre>
<pre><code>Permutation test for capscale under reduced model
Marginal effects of terms
Permutation: free
Number of permutations: 999

Model: capscale(formula = sqrt(vol.otc) ~ Year + Site + mean_temp_C_treatment + temp, data = svf.otc, distance = &quot;bray&quot;)
                       Df SumOfSqs      F Pr(&gt;F)    
Year                    2    2.145 4.1882  0.001 ***
Site                    2    2.683 5.2378  0.001 ***
mean_temp_C_treatment   1    0.781 3.0491  0.001 ***
temp                    1    0.497 1.9410  0.022 *  
Residual              280   71.705                  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summ.cap &lt;- summary(cap.otc.comb)
prop.expl &lt;- summ.cap$cont$importance
ax.labs &lt;- paste0(colnames(prop.expl)[1:2], &quot; (&quot;,round(100*prop.expl[2,1:2]),&quot;% explained)&quot;)

yearpch &lt;- c(`2018`=15,`2019`=19,`2021`=17)
plot(cap.otc.comb, type=&quot;n&quot;, xlab=ax.labs[1], ylab=ax.labs[2])
title(paste(&quot;OTC warming: I. agg &amp; ten at all sites, all years, day&quot;,&quot;n =&quot;, nrow(svf.otc)))
temprange &lt;- round(c(max(svf.otc$mean_temp_C_treatment), min(svf.otc$mean_temp_C_treatment)))
legend(&quot;topleft&quot;,  title=paste(&quot;Temperature&quot;,&quot;\nP =&quot;,anova.cap[&quot;mean_temp_C_treatment&quot;,&quot;Pr(&gt;F)&quot;]), legend=paste(temprange, &quot; C&quot;), fill=rev(viridis(2)))
legend(&quot;topright&quot;,  title=paste(&quot;Year&quot;,&quot;\nP =&quot;,anova.cap[&quot;Year&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.otc$Year), pch=yearpch)
legend(&quot;bottomright&quot;,  title=paste(&quot;Site&quot;,&quot;\nP =&quot;,anova.cap[&quot;Site&quot;,&quot;Pr(&gt;F)&quot;]), legend=unique(svf.otc$Site))
legend(&quot;bottomleft&quot;,  title=paste(&quot;Treatment&quot;,&quot;\nP =&quot;,anova.cap[&quot;temp&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.otc$temp))
ordispider(cap.otc.comb, with(svf.otc, paste(Year, Site, temp, PlantID)), col=&quot;grey80&quot;)
points(cap.otc.comb, display=&quot;sites&quot;, col=inferno(round(temprange[1]-temprange[2]))[round(svf.otc$mean_temp_C_treatment-temprange[2])+1], pch=yearpch[svf.otc$Year]) 
text(cap.otc.comb, display=&quot;cn&quot;)
text(cap.otc.comb, display=&quot;species&quot;, cex=0.7, srt=45,
                     col=ifelse(sqrt(cap.otc.comb$CCA$v[,1]^2 + cap.otc.comb$CCA$v[,2]^2)&gt;0.25, alpha(&quot;red&quot;,0.7),alpha(&quot;red&quot;,0)))</code></pre>
<p><img src="plots/otc_both_species-1.svg" width="768" /></p>
<pre class="r"><code>lmer(sqrt(Total) ~ Year + Site + temp + (1|PlantID), data = svf.otc) %&gt;% anova %&gt;% kable(caption=&quot;total emissions&quot;)</code></pre>
<table>
<caption>total emissions</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Year</td>
<td align="right">512.1807</td>
<td align="right">256.0904</td>
<td align="right">2</td>
<td align="right">281</td>
<td align="right">10.146432</td>
<td align="right">0.0000556</td>
</tr>
<tr class="even">
<td align="left">Site</td>
<td align="right">436.0691</td>
<td align="right">218.0346</td>
<td align="right">2</td>
<td align="right">281</td>
<td align="right">8.638642</td>
<td align="right">0.0002286</td>
</tr>
<tr class="odd">
<td align="left">temp</td>
<td align="right">107.4270</td>
<td align="right">107.4270</td>
<td align="right">1</td>
<td align="right">281</td>
<td align="right">4.256314</td>
<td align="right">0.0400232</td>
</tr>
</tbody>
</table>
</div>
<div id="both-species-day-by-week" class="section level2">
<h2>2021 both species, day, by week</h2>
<pre class="r"><code>svf.otc &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, DN==&quot;day&quot;, Year==&quot;2021&quot;) %&gt;% drop_na(mean_temp_C_treatment)  %&gt;% 
  mutate(sampround = factor(ifelse(yday(date)&gt;200, &quot;4wks&quot;, &quot;2wks&quot;)))
vol.otc &lt;- vol[svf.otc$sample,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ Site + sampround * temp, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ Site + sampround * temp, data
= svf.otc, distance = &quot;bray&quot;)

                Inertia Proportion Rank
Total          41.14161    1.00000     
Constrained     3.94631    0.09592    5
Unconstrained  50.21089    1.22044   65
Imaginary     -13.01559   -0.31636  139
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
  CAP1   CAP2   CAP3   CAP4   CAP5 
2.0690 0.9001 0.5081 0.2739 0.1951 

Eigenvalues for unconstrained axes:
 MDS1  MDS2  MDS3  MDS4  MDS5  MDS6  MDS7  MDS8 
8.673 5.277 4.149 2.765 2.367 2.271 2.136 1.903 
(Showing 8 of 65 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>(anova.cap &lt;- anova(cap.otc.comb, by=&quot;term&quot;))</code></pre>
<pre><code>Permutation test for capscale under reduced model
Terms added sequentially (first to last)
Permutation: free
Number of permutations: 999

Model: capscale(formula = sqrt(vol.otc) ~ Site + sampround * temp, data = svf.otc, distance = &quot;bray&quot;)
                Df SumOfSqs      F Pr(&gt;F)    
Site             2    2.546 5.0969  0.001 ***
sampround        1    0.770 3.0840  0.002 ** 
temp             1    0.302 1.2104  0.212    
sampround:temp   1    0.327 1.3092  0.159    
Residual       201   50.211                  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ Site + sampround + temp, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ Site + sampround + temp, data
= svf.otc, distance = &quot;bray&quot;)

                Inertia Proportion Rank
Total          41.14161    1.00000     
Constrained     3.61926    0.08797    4
Unconstrained  50.53794    1.22839   65
Imaginary     -13.01559   -0.31636  139
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
  CAP1   CAP2   CAP3   CAP4 
2.0690 0.8406 0.4359 0.2738 

Eigenvalues for unconstrained axes:
 MDS1  MDS2  MDS3  MDS4  MDS5  MDS6  MDS7  MDS8 
8.739 5.344 4.158 2.793 2.418 2.301 2.140 1.903 
(Showing 8 of 65 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>summ.cap &lt;- summary(cap.otc.comb)
prop.expl &lt;- summ.cap$cont$importance
ax.labs &lt;- paste0(colnames(prop.expl)[1:2], &quot; (&quot;,round(100*prop.expl[2,1:2]),&quot;% explained)&quot;)

plot(cap.otc.comb, type=&quot;n&quot;, xlab=ax.labs[1], ylab=ax.labs[2])
title(paste(&quot;OTC warming, week: I. agg &amp; ten at all sites, 2021, day&quot;,&quot;n =&quot;, nrow(svf.otc)))
legend(&quot;bottomright&quot;,  title=paste(&quot;Site&quot;,&quot;\nP =&quot;,anova.cap[&quot;Site&quot;,&quot;Pr(&gt;F)&quot;]), legend=unique(svf.otc$Site))
legend(&quot;bottomleft&quot;,  title=paste(&quot;Treatment&quot;,&quot;\nP =&quot;,anova.cap[&quot;temp&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.otc$temp))
legend(&quot;topleft&quot;,  title=paste(&quot;Week&quot;,&quot;\nP =&quot;,anova.cap[&quot;sampround&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.otc$sampround), pch=c(1,2))
ordispider(cap.otc.comb, with(svf.otc, paste(Year, Site, temp, PlantID)), col=&quot;grey80&quot;)
points(cap.otc.comb, display=&quot;sites&quot;, col=tempcol[svf.otc$temp], pch=as.integer(svf.otc$sampround))
text(cap.otc.comb, display=&quot;cn&quot;)
text(cap.otc.comb, display=&quot;species&quot;, cex=0.7, srt=45,
                     col=ifelse(sqrt(cap.otc.comb$CCA$v[,1]^2 + cap.otc.comb$CCA$v[,2]^2)&gt;0.25, alpha(&quot;purple&quot;,0.7),alpha(&quot;purple&quot;,0)))</code></pre>
<p><img src="plots/otc_week-1.svg" width="768" /></p>
</div>
<div id="both-species-vwctemp-day" class="section level2">
<h2>Both species, VWC+temp, day</h2>
<pre class="r"><code>svf %&gt;% mutate(hasVWC=!is.na(SoilVWC+mean_temp_C_treatment)) %&gt;% filter(Expt==&quot;otc&quot;)%&gt;% count(Year, Site, DN, hasVWC) %&gt;% pivot_wider(names_from=hasVWC, values_from=n) %&gt;%   kable(caption=&quot;VOC samples with soil moisture and temp&quot;)</code></pre>
<table>
<caption>VOC samples with soil moisture and temp</caption>
<thead>
<tr class="header">
<th align="left">Year</th>
<th align="left">Site</th>
<th align="left">DN</th>
<th align="right">FALSE</th>
<th align="right">TRUE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2018</td>
<td align="left">GNA</td>
<td align="left">day</td>
<td align="right">3</td>
<td align="right">42</td>
</tr>
<tr class="even">
<td align="left">2018</td>
<td align="left">bb</td>
<td align="left">day</td>
<td align="right">26</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">2019</td>
<td align="left">GNA</td>
<td align="left">day</td>
<td align="right">12</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">2019</td>
<td align="left">SC</td>
<td align="left">day</td>
<td align="right">6</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="left">2019</td>
<td align="left">SC</td>
<td align="left">night</td>
<td align="right">17</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">2021</td>
<td align="left">GNA</td>
<td align="left">day</td>
<td align="right">NA</td>
<td align="right">56</td>
</tr>
<tr class="odd">
<td align="left">2021</td>
<td align="left">Maxfield</td>
<td align="left">day</td>
<td align="right">NA</td>
<td align="right">80</td>
</tr>
<tr class="even">
<td align="left">2021</td>
<td align="left">SC</td>
<td align="left">day</td>
<td align="right">NA</td>
<td align="right">71</td>
</tr>
<tr class="odd">
<td align="left">2021</td>
<td align="left">SC</td>
<td align="left">night</td>
<td align="right">2</td>
<td align="right">64</td>
</tr>
</tbody>
</table>
<pre class="r"><code>svf.otc &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, DN==&quot;day&quot;, Site!=&quot;bb&quot;) %&gt;% drop_na(SoilVWC, mean_temp_C_treatment)
vol.otc &lt;- vol[svf.otc$sample,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ Year + Site + SoilVWC + mean_temp_C_treatment, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ Year + Site + SoilVWC +
mean_temp_C_treatment, data = svf.otc, distance = &quot;bray&quot;)

               Inertia Proportion Rank
Total          56.5760     1.0000     
Constrained     7.6368     0.1350    6
Unconstrained  67.9098     1.2003   79
Imaginary     -18.9706    -0.3353  191
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
 CAP1  CAP2  CAP3  CAP4  CAP5  CAP6 
3.625 1.540 1.323 0.602 0.434 0.113 

Eigenvalues for unconstrained axes:
  MDS1   MDS2   MDS3   MDS4   MDS5   MDS6   MDS7   MDS8 
11.571  6.528  4.784  3.842  3.549  2.900  2.830  2.474 
(Showing 8 of 79 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>(anova.cap &lt;- anova(cap.otc.comb, by=&quot;margin&quot;))</code></pre>
<pre><code>Permutation test for capscale under reduced model
Marginal effects of terms
Permutation: free
Number of permutations: 999

Model: capscale(formula = sqrt(vol.otc) ~ Year + Site + SoilVWC + mean_temp_C_treatment, data = svf.otc, distance = &quot;bray&quot;)
                       Df SumOfSqs      F Pr(&gt;F)    
Year                    2    2.232 4.3720  0.001 ***
Site                    2    2.514 4.9235  0.001 ***
SoilVWC                 1    0.649 2.5426  0.004 ** 
mean_temp_C_treatment   1    0.735 2.8801  0.002 ** 
Residual              266   67.910                  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summ.cap &lt;- summary(cap.otc.comb)
prop.expl &lt;- summ.cap$cont$importance
ax.labs &lt;- paste0(colnames(prop.expl)[1:2], &quot; (&quot;,round(100*prop.expl[2,1:2]),&quot;% explained)&quot;)

yearpch &lt;- c(`2018`=15,`2019`=19,`2021`=17)
plot(cap.otc.comb, type=&quot;n&quot;, xlab=ax.labs[1], ylab=ax.labs[2])
title(paste(&quot;Soil moisture + temperature: I. agg &amp; ten at all sites, all years, day&quot;,&quot;n =&quot;, nrow(svf.otc)))
VWCrange &lt;- round(c(max(svf.otc$SoilVWC), min(svf.otc$SoilVWC)))
legend(&quot;left&quot;,  title=paste(&quot;VWC&quot;,&quot;\nP =&quot;,anova.cap[&quot;SoilVWC&quot;,&quot;Pr(&gt;F)&quot;]), legend=paste(VWCrange, &quot;%&quot;), fill=rev(viridis(2)))
legend(&quot;topright&quot;,  title=paste(&quot;Year&quot;,&quot;\nP =&quot;,anova.cap[&quot;Year&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.otc$Year), pch=yearpch)
legend(&quot;bottomleft&quot;,  title=paste(&quot;Site&quot;,&quot;\nP =&quot;,anova.cap[&quot;Site&quot;,&quot;Pr(&gt;F)&quot;]), legend=unique(svf.otc$Site))
temprange &lt;- round(c(max(svf.otc$mean_temp_C_treatment), min(svf.otc$mean_temp_C_treatment)))
legend(&quot;topleft&quot;,  title=paste(&quot;Temperature&quot;,&quot;\nP =&quot;,anova.cap[&quot;mean_temp_C_treatment&quot;,&quot;Pr(&gt;F)&quot;]), legend=paste(temprange, &quot; C&quot;))
ordispider(cap.otc.comb, with(svf.otc, paste(Year, Site, temp, PlantID)), col=&quot;grey80&quot;)
points(cap.otc.comb, display=&quot;sites&quot;, col=viridis(round(VWCrange[1]-VWCrange[2]))[round(svf.otc$SoilVWC-VWCrange[2])+1], pch=yearpch[svf.otc$Year]) 
text(cap.otc.comb, display=&quot;cn&quot;)
text(cap.otc.comb, display=&quot;species&quot;, cex=0.7, srt=45,
                     col=ifelse(sqrt(cap.otc.comb$CCA$v[,1]^2 + cap.otc.comb$CCA$v[,2]^2)&gt;0.25, alpha(&quot;red&quot;,1),alpha(&quot;red&quot;,0)))</code></pre>
<p><img src="plots/otc_both_species_VWC_temp-1.svg" width="768" /></p>
<pre class="r"><code>ggplot(svf.otc, aes(x=mean_temp_C_treatment, y=SoilVWC))+ geom_point() + geom_smooth()</code></pre>
<p><img src="plots/otc_both_species_VWC_temp-2.svg" width="768" /></p>
</div>
<div id="selection-gradients" class="section level2">
<h2>Selection gradients</h2>
<p>Following method of <a href="https://doi.org/10.1002/evl3.63">Chong
et al.2018</a> for reconstructing selection estimates from estimates of
selection on PCs: Beta = E * A.</p>
<pre class="r"><code>minsamples &lt;- 70
vol.top &lt;- vol[,colSums(decostand(vol,&quot;pa&quot;))&gt; minsamples]#occur in more than minsamples

sds &lt;- read_csv(&quot;data/2021_Maxfield_sds.csv&quot;) %&gt;% 
  mutate(prop_uninfested = 1 - prop_infested, 
         plant=as.character(plant))

fitnesstraits &lt;- c(&quot;seeds_est&quot;, &quot;seeds_per_flower&quot;, &quot;prop_uninfested&quot;) #&quot;eggs_per_flower&quot;
fitnessnames &lt;- set_names(c(&quot;Estimated total seeds&quot;, &quot;Estimated seeds per flower&quot;, &quot;Prop. nonaborted fruits uninfested&quot;), fitnesstraits)

# Run PCA on traits
vols.PCA &lt;- vol.top %&gt;% mutate(across(everything(), ~ (.x-mean(.x, na.rm=T))/sd(.x, na.rm=T))) %&gt;% 
  prcomp() 
summary(vols.PCA) # PCs 1 - 5 explain 63% of the variation, #PCs total = top volatiles</code></pre>
<pre><code>Importance of components:
                          PC1    PC2    PC3     PC4     PC5     PC6    PC7
Standard deviation     2.0284 1.3499 1.2389 1.06111 1.02133 0.97036 0.9558
Proportion of Variance 0.2743 0.1215 0.1023 0.07506 0.06954 0.06277 0.0609
Cumulative Proportion  0.2743 0.3958 0.4981 0.57316 0.64271 0.70548 0.7664
                           PC8     PC9    PC10    PC11    PC12    PC13    PC14
Standard deviation     0.83796 0.80518 0.74892 0.71616 0.62563 0.58439 0.43806
Proportion of Variance 0.04681 0.04322 0.03739 0.03419 0.02609 0.02277 0.01279
Cumulative Proportion  0.81319 0.85641 0.89380 0.92799 0.95409 0.97686 0.98965
                          PC15
Standard deviation     0.39405
Proportion of Variance 0.01035
Cumulative Proportion  1.00000</code></pre>
<pre class="r"><code>vols.PCA.E &lt;- vols.PCA$rotation[,1:5] #min(4, ncol(vols.PCA$rotation))

calculate_beta &lt;- function(E, slopes) {
  data.frame(B = E %*% slopes$A,
             SE = sqrt(E ^ 2 %*% slopes$SE ^ 2)) %&gt;% 
    mutate(not_zero = abs(B) - SE &gt; 0) %&gt;% 
    rownames_to_column(&quot;trait&quot;)
}

selection_pca &lt;- function(temp=c(&quot;control&quot;,&quot;warmed&quot;), fitnesstrait = &quot;seeds_est&quot;) {
  vols.std.PCA &lt;- svf %&gt;% bind_cols(as.data.frame(vols.PCA$x)) %&gt;% 
    filter(temp %in% .env$temp) %&gt;% 
    mutate(plant=as.character(plant)) %&gt;% 
    left_join(sds, by=c(&quot;plotid&quot;, &quot;plant&quot;,&quot;temp&quot;)) %&gt;% 
    select(all_of(fitnesstrait), &quot;temp&quot;, starts_with(&quot;PC&quot;)) %&gt;% 
    rename(&quot;fitness&quot; = fitnesstrait) %&gt;% 
    mutate(relfitness = fitness/mean(fitness, na.rm=T), .keep=&quot;unused&quot;) %&gt;% ungroup %&gt;% 
    drop_na(relfitness) %&gt;% 
    select(where(~sum(is.na(.))==0))
  
  # Regress relative fitness on PCs
  vols.PCA.regression &lt;- lm(relfitness ~ PC1 + PC2 + PC3 + PC4 + PC5, data = vols.std.PCA)
  vols.PCA.slopes &lt;- tidy(vols.PCA.regression) %&gt;% filter(term != &quot;(Intercept)&quot;) %&gt;% rename(A=estimate, SE=std.error)
  
  # Convert selection gradients on PCs to gradients on traits
  calculate_beta(vols.PCA.E, vols.PCA.slopes)
}

plot_beta &lt;- function(betas) {
  bs &lt;- betas %&gt;% left_join(ipochems, by=c(&quot;trait&quot;=&quot;name&quot;)) %&gt;% 
    mutate(trait = fct_reorder(trait, map_dbl(vol.top[,trait], mean)))#order graph by mean emissions
  ggplot(bs, aes(y=trait, x = B, xmin=B-SE, xmax=B+SE)) + 
    geom_vline(xintercept=0)+ 
    geom_pointrange(aes(color=temp), position=position_dodge(width=0.5)) + 
    labs(x = &quot;Selection gradient (beta) estimated from PCs&quot;, y = &quot;&quot;,   color=&quot;Temperature&quot;) +
    scale_color_manual(values=tempcol) + theme_minimal() + #+ scale_x_continuous(limits=c(-0.55,0.55), n.breaks=10)  +
    theme(legend.position=&quot;bottom&quot;)
}

vols.beta.temp &lt;- expand_grid(temp=c(&quot;control&quot;,&quot;warmed&quot;),  fitnesstrait=fitnesstraits)  %&gt;% 
  mutate(betas = pmap(., selection_pca)) %&gt;% unnest(betas)

walk(fitnesstraits, ~print(plot_beta(filter(vols.beta.temp, fitnesstrait==.x)) + ggtitle(fitnessnames[.x])))</code></pre>
<p><img src="plots/gradients-1.svg" width="768" /><img src="plots/gradients-2.svg" width="768" /><img src="plots/gradients-3.svg" width="768" /></p>
</div>
</div>
<div id="percivals-warm-vs.-cool" class="section level1">
<h1>Percivals warm vs.cool</h1>
<div id="cap-analysis-of-each-percival-dataset" class="section level2">
<h2>CAP analysis of each Percival dataset</h2>
<pre class="r"><code>#inventory of samples
svf %&gt;% filter(expt==&quot;perc&quot;) %&gt;%  count(PlantType, DN, Temp,Year) %&gt;% kable(caption=&quot;Sample size&quot;)</code></pre>
<table>
<caption>Sample size</caption>
<thead>
<tr class="header">
<th align="left">PlantType</th>
<th align="left">DN</th>
<th align="left">Temp</th>
<th align="left">Year</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">cool</td>
<td align="left">2018</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">cool</td>
<td align="left">2019</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">warm</td>
<td align="left">2018</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">warm</td>
<td align="left">2019</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">night</td>
<td align="left">cool</td>
<td align="left">2018</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">night</td>
<td align="left">cool</td>
<td align="left">2019</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">night</td>
<td align="left">warm</td>
<td align="left">2018</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">night</td>
<td align="left">warm</td>
<td align="left">2019</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">cool</td>
<td align="left">2018</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">cool</td>
<td align="left">2019</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">warm</td>
<td align="left">2018</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">warm</td>
<td align="left">2019</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">cool</td>
<td align="left">2018</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">cool</td>
<td align="left">2019</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">warm</td>
<td align="left">2018</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">warm</td>
<td align="left">2019</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<pre class="r"><code>plot.perc &lt;- function(svf.perc, plot.chems=T) {
    vol.perc &lt;- vol[svf.perc$sample,]
    cap.perc &lt;- capscale(sqrt(vol.perc) ~ DN+Temp, distance=&quot;bray&quot;, data=svf.perc)
    summ.cap &lt;- summary(cap.perc)
    prop.expl &lt;- summ.cap$cont$importance[2,c(&quot;CAP1&quot;,&quot;CAP2&quot;)]
    ax.labs &lt;- paste0(&quot;CAP&quot;, 1:2, &quot; (&quot;,round(100*prop.expl),&quot;% explained)&quot;)
    anova.cap &lt;- anova(cap.perc, by=&quot;margin&quot;)
    
    plot(cap.perc, type=&quot;n&quot;, xlim=range(cap.perc$CCA$wa[,1]), xlab=ax.labs[1], ylab=ax.labs[2])
    with(svf.perc, title(paste0(&quot;Percivals: I. &quot;, unique(PlantType),&quot; in &quot;, unique(Year), &quot; n = &quot;, nrow(svf.perc))))
    #, &quot; (&quot;,round(100*summ.cap$constr.chi / summ.cap$tot.chi),&quot;% explained)&quot;)
    legend(&quot;topleft&quot;, title=paste(&quot;Temperature&quot;,&quot;\nP =&quot;,anova.cap[&quot;Temp&quot;,&quot;Pr(&gt;F)&quot;]), 
           levels(svf.perc$Temp), fill=Tempcol)
    legend(&quot;topright&quot;, title=paste(&quot;Time&quot;,&quot;\nP =&quot;,anova.cap[&quot;DN&quot;,&quot;Pr(&gt;F)&quot;]), 
           levels(svf.perc$DN), pch=c(1,19))
    if(plot.chems) text(cap.perc, display=&quot;species&quot;, cex=0.7, srt=45,
                     col=ifelse(sqrt(cap.perc$CCA$v[,1]^2 + cap.perc$CCA$v[,2]^2)&gt;0.25, alpha(&quot;purple&quot;,0.7),alpha(&quot;purple&quot;,0)))
    ordispider(cap.perc, with(svf.perc, paste(Year, Temp, Sample2)), col=&quot;grey80&quot;)
    points(cap.perc, display=&quot;sites&quot;, col=Tempcol[svf.perc$Temp], pch=c(1,19)[svf.perc$DN]) 
    text(cap.perc, display=&quot;cn&quot;)
    return(cap.perc)
}
cap.perc.agg18 &lt;-  plot.perc(svf %&gt;% filter(expt==&quot;perc&quot;,Year==&quot;2018&quot;,PlantType==&quot;agg&quot;))</code></pre>
<p><img src="plots/perc-1.svg" width="768" /></p>
<pre class="r"><code>cap.perc.agg19 &lt;-  plot.perc(svf %&gt;% filter(expt==&quot;perc&quot;,Year==&quot;2019&quot;,PlantType==&quot;agg&quot;))</code></pre>
<p><img src="plots/perc-2.svg" width="768" /></p>
<pre class="r"><code>cap.perc.ten18 &lt;-  plot.perc(svf %&gt;% filter(expt==&quot;perc&quot;,Year==&quot;2018&quot;,PlantType==&quot;ten&quot;))</code></pre>
<p><img src="plots/perc-3.svg" width="768" /></p>
<pre class="r"><code>cap.perc.ten19 &lt;-  plot.perc(svf %&gt;% filter(expt==&quot;perc&quot;,Year==&quot;2019&quot;,PlantType==&quot;ten&quot;))</code></pre>
<p><img src="plots/perc-4.svg" width="768" /></p>
<pre class="r"><code>#cap.perc.all &lt;- list(agg18=cap.perc.agg18, agg19=cap.perc.agg19, ten18=cap.perc.ten18, ten19=cap.perc.ten19)
#lapply(cap.perc.all, anova, by=&quot;margin&quot;)</code></pre>
</div>
<div id="cap-of-percival-dataset-combined-for-each-species"
class="section level2">
<h2>CAP of Percival dataset combined for each species</h2>
<pre class="r"><code>plot.perc.comb &lt;- function(svf.perc, plot.chems=F) {
  vol.perc &lt;- vol[svf.perc$sample,]
  cap.perc.comb &lt;- capscale(sqrt(vol.perc) ~ Year+DN+Temp, distance=&quot;bray&quot;, data=svf.perc)
    summ.cap &lt;- summary(cap.perc.comb)
    prop.expl &lt;- summ.cap$cont$importance[2,c(&quot;CAP1&quot;,&quot;CAP2&quot;)]
    ax.labs &lt;- paste0(&quot;CAP&quot;, 1:2, &quot; (&quot;,round(100*prop.expl),&quot;% explained)&quot;)
    anova.cap &lt;- anova(cap.perc.comb, by=&quot;margin&quot;)
    
    plot(cap.perc.comb, type=&quot;n&quot;, xlim=range(cap.perc.comb$CCA$wa[,1]), xlab=ax.labs[1], ylab=ax.labs[2])
    title(paste(&quot;Percivals: I.&quot;,unique(svf.perc$PlantType), &quot;2018/2019&quot;,&quot;n =&quot;, nrow(svf.perc)))
    legend(&quot;bottomleft&quot;, title=paste(&quot;Temperature&quot;,&quot;\nP =&quot;,anova.cap[&quot;Temp&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.perc$Temp), fill=Tempcol)
  legend(&quot;bottomright&quot;, title=paste(&quot;Time&quot;,&quot;\nP =&quot;,anova.cap[&quot;DN&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.perc$DN), fil=c(0,1))
  legend(&quot;topright&quot;, title=paste(&quot;Year&quot;,&quot;\nP =&quot;,anova.cap[&quot;Year&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.perc$Year), pch=c(19,15))
  ordispider(cap.perc.comb, with(svf.perc, paste(Year, Temp, Sample2)), col=&quot;grey80&quot;)
  points(cap.perc.comb, display=&quot;sites&quot;, col=Tempcol[svf.perc$Temp], pch=c(1,0,19,15)[factor(paste(svf.perc$DN, svf.perc$Year))]) 
  text(cap.perc.comb, display=&quot;cn&quot;)
  text(cap.perc.comb, display=&quot;species&quot;, cex=0.7, srt=45, col=ifelse(sqrt(cap.perc.comb$CCA$v[,1]^2 + cap.perc.comb$CCA$v[,2]^2)&gt;0.2, alpha(&quot;purple&quot;,1),alpha(&quot;purple&quot;,0)))
  return(cap.perc.comb)
}
svf.perc.agg &lt;- plot.perc.comb(svf %&gt;% filter(expt==&quot;perc&quot;, PlantType==&quot;agg&quot;))</code></pre>
<p><img src="plots/perc_comb-1.svg" width="768" /></p>
<pre class="r"><code>svf.perc.ten &lt;- plot.perc.comb(svf %&gt;% filter(expt==&quot;perc&quot;, PlantType==&quot;ten&quot;))</code></pre>
<p><img src="plots/perc_comb-2.svg" width="768" /></p>
<pre class="r"><code>#svf.perc.both &lt;- plot.perc.comb(svf %&gt;% filter(expt==&quot;perc&quot;))</code></pre>
</div>
</div>
<div id="individual-volatiles" class="section level1">
<h1>Individual volatiles</h1>
<div id="treatment-effects" class="section level2">
<h2>Treatment effects</h2>
<pre class="r"><code>vols.plot &lt;- chemsf %&gt;% filter(filter_final, freq.floral&gt;0.3) %&gt;% pull(&quot;name&quot;) %&gt;% as.character
#vols.plot[vols.plot==&quot;b-caryophyllene&quot;] &lt;- &quot;b-caryophyllene.1&quot;#c(&quot;b-ocimene&quot;,&quot;a-pinene&quot;,&quot;a-farnesene&quot;,&quot;b-caryophyllene.1&quot;,&quot;petasitene&quot;,&quot;b-myrcene&quot;,&quot;longifolene&quot;,&quot;tridec-1-ene  &quot;,&quot;benzophenone&quot;)
vol.long &lt;- gather(cbind(sample=rownames(vol[,vols.plot]), total=rowSums(vol), vol[,vols.plot]), key=&quot;chem&quot;,value=&quot;area&quot;, 2:(length(vols.plot)+2), factor_key=T)
vol.plot &lt;- left_join(vol.long, svf)

specDNcols &lt;- c( &quot;#943390&quot;,&quot;#FF5056&quot;, &quot;#A894FF&quot;,&quot;#FC8C97&quot;)
#Treatcols &lt;- c(&quot;#DA9E18&quot;,&quot;#6B744F&quot;)
DNcols &lt;- c(&quot;grey90&quot;,&quot;grey20&quot;)
ggplot(vol.plot %&gt;% drop_na(PlantType, expt) %&gt;% filter(expt==&quot;otc&quot;, Site!=&quot;bb&quot;),#TODO track down NAs
       aes(x=paste(Site, Year),y=area,  fill=DN, color=paste(Treat))) +
  geom_boxplot(size=0.7, outlier.size=0.7, position=position_dodge2(preserve=&quot;total&quot;)) + 
  facet_wrap(vars(chem), scales=&quot;free&quot;) + 
  scale_y_sqrt(&quot;Emissions (ng/flower/hr)&quot;) + 
  scale_color_brewer(&quot;Treatment&quot;, palette = &quot;Set1&quot;, direction=-1)+
  scale_x_discrete(&quot;Site, year&quot;)+
  scale_fill_manual(&quot;Time of day&quot;,values=DNcols) + 
  theme_minimal() + theme(axis.text.x=element_text(angle=20, vjust=0.5))</code></pre>
<p><img src="plots/barplots-1.svg" width="1152" /></p>
</div>
<div id="actual-temperature-effects" class="section level2">
<h2>Actual temperature effects</h2>
<pre class="r"><code>ggplot(drop_na(vol.plot, PlantType, expt) %&gt;% filter(expt==&quot;otc&quot;, Site!=&quot;bb&quot;),#TODO track down NAs
       aes(x=mean_temp_C_treatment, y=area, shape=DN, color=paste(PlantType, Site, Year))) +
  geom_point() + geom_smooth(se=F, method=&quot;lm&quot;)+
  facet_wrap(vars(chem), scales=&quot;free_y&quot;) + 
  scale_y_sqrt(&quot;Emissions (ng/flower/hr)&quot;) + 
  scale_x_continuous(&quot;Mean temperature in controls or OTCs (\u00B0C)&quot;)+
  scale_color_brewer(&quot;Species, site, year&quot;, palette = &quot;Dark2&quot;, direction=-1)+#scale_color_manual(&quot;Species&quot;, values=spcols) + 
  scale_shape_manual(&quot;Time of day&quot;,values=c(1,19)) + 
  theme_minimal() + theme(axis.text.x=element_text(angle=20, vjust=0.5))</code></pre>
<p><img src="plots/temptrend-1.svg" width="1152" /></p>
</div>
<div id="soil-moisture-effects" class="section level2">
<h2>Soil moisture effects</h2>
<pre class="r"><code>ggplot(drop_na(vol.plot, PlantType, expt) %&gt;% filter(expt==&quot;otc&quot;, Site!=&quot;bb&quot;),#TODO track down NAs
       aes(x=SoilVWC, y=area, shape=DN, color=paste(PlantType, Site, Year))) +
  geom_point() + geom_smooth(se=F, method=&quot;lm&quot;)+
  facet_wrap(vars(chem), scales=&quot;free_y&quot;) + 
  scale_y_sqrt(&quot;Emissions (ng/flower/hr)&quot;) + 
  scale_x_continuous(&quot;Soil volumetric water content (%)&quot;)+
  scale_color_brewer(&quot;Species, site, year&quot;, palette = &quot;Dark2&quot;, direction=-1)+#scale_color_manual(&quot;Species&quot;, values=spcols) + 
  scale_shape_manual(&quot;Time of day&quot;,values=c(1,19)) + 
  theme_minimal() + theme(axis.text.x=element_text(angle=20, vjust=0.5))</code></pre>
<p><img src="plots/VWCtrend-1.svg" width="1152" /></p>
</div>
</div>
<div id="leaf-volatiles" class="section level1">
<h1>Leaf volatiles</h1>
<div id="inventory-1" class="section level2">
<h2>Inventory</h2>
<p>Dropped 2 samples from 2018 without leaf mass. Volatiles units are ng
per hour per gram dry leaf.</p>
<pre class="r"><code>svl %&gt;% count(PlantType, Treat, expt, Year) %&gt;% kable(caption=&quot;Sample size&quot;)</code></pre>
<table>
<caption>Sample size</caption>
<thead>
<tr class="header">
<th align="left">PlantType</th>
<th align="left">Treat</th>
<th align="left">expt</th>
<th align="right">Year</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">aggleaf</td>
<td align="left">control</td>
<td align="left">otc</td>
<td align="right">2019</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">aggleaf</td>
<td align="left">control</td>
<td align="left">perc</td>
<td align="right">2019</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">aggleaf</td>
<td align="left">warmed</td>
<td align="left">otc</td>
<td align="right">2019</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">aggleaf</td>
<td align="left">warmed</td>
<td align="left">perc</td>
<td align="right">2019</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">tenleaf</td>
<td align="left">control</td>
<td align="left">otc</td>
<td align="right">2019</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">tenleaf</td>
<td align="left">control</td>
<td align="left">perc</td>
<td align="right">2019</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">tenleaf</td>
<td align="left">warmed</td>
<td align="left">otc</td>
<td align="right">2019</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">tenleaf</td>
<td align="left">warmed</td>
<td align="left">perc</td>
<td align="right">2019</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<pre class="r"><code>sort(colSums(vol.leaf)/sum(colSums(vol.leaf)) )</code></pre>
<pre><code>                          undecanal 2,2,4,7-tetramethyloctane-3,5-dione 
                        0.003324109                         0.004331124 
                         hexan-1-ol  (E)-12-cyclopropyldodec-11-en-1-ol 
                        0.005104214                         0.008142296 
        [(Z)-hex-3-enyl] pentanoate                   (Z)-hex-2-en-1-ol 
                        0.009254631                         0.009665173 
                       pseudoionone                          hex-2-enal 
                        0.010054265                         0.010948649 
                 3,7-dimethyldecane                       1-penten-3-ol 
                        0.011143115                         0.012114888 
                         petasitene                     b-caryophyllene 
                        0.014337289                         0.015472479 
                4-methylpentan-1-ol                       a-campholenal 
                        0.016658658                         0.017406487 
                (E)-4-oxohex-2-enal                       5-butylnonane 
                        0.022019752                         0.023643530 
                     (E)-hex-2-enal            [(E)-hex-3-enyl] acetate 
                        0.078366194                         0.110428093 
                  (E)-hex-3-en-1-ol                            a-pinene 
                        0.303096782                         0.314488272 </code></pre>
</div>
<div id="heatmap" class="section level2">
<h2>Heatmap</h2>
<pre class="r"><code>#cairo_pdf(&quot;ipo_heatmap_leaf.pdf&quot;, width=12, height=12)
ph_leaf  &lt;- pheatmap(as.matrix(t(vol.leaf))^(1/3), 
         cluster_cols=T, show_colnames=F,
         clustering_method=&quot;mcquitty&quot;, clustering_distance_rows=&quot;correlation&quot;,
         clustering_distance_cols=vegdist(vol.leaf, method = &quot;bray&quot;),
         clustering_callback = function(hc, ...){dendsort(hc, type=&quot;average&quot;)},
         scale=&quot;none&quot;, color=inferno(512),
         annotation_col = data.frame(svl %&gt;% select(&quot;PlantType&quot;, &quot;expt&quot;, &quot;Treat&quot;), row.names=rownames(vol.leaf)), 
   fontsize = 10, border_color = NA, legend=F, annotation_legend=T, cutree_rows=6
)</code></pre>
<p><img src="plots/heatmap_leaf-1.png" width="1152" /></p>
<pre class="r"><code>#dev.off()</code></pre>
</div>
<div id="leaf-nmds" class="section level2">
<h2>Leaf NMDS</h2>
<pre class="r"><code>set.seed(1)
nmds.vol_leaf &lt;- metaMDS(sqrt(vol.leaf), dist=&quot;bray&quot;, autotransform = FALSE, trace=F)

TEY &lt;- with(svl, factor(paste(PlantType,expt,Year)))
TEYcols &lt;- brewer.pal(9, &quot;Paired&quot;)#[c(1:4,8,5:6)]
spcols &lt;- c(aggleaf=&quot;red&quot;, tenleaf=&quot;violet&quot;)
ordiplot(nmds.vol_leaf, type = &quot;n&quot;)
legend(&quot;bottomleft&quot;, levels(TEY), fill=TEYcols, cex=0.9)
points(nmds.vol_leaf, display=&quot;sites&quot;, col=TEYcols[TEY], pch=19)
text(nmds.vol_leaf, display=&quot;species&quot;, cex=0.7, col=&quot;grey20&quot;)</code></pre>
<p><img src="plots/nmds_filtered_leaf-1.svg" width="768" /></p>
<pre class="r"><code>#points(nmds.vol_leaf, display=&quot;sites&quot;, col=viridis(100)[sqrt(rowSums(vol.leaf))/26], pch=19)</code></pre>
</div>
<div id="cap---otcs" class="section level2">
<h2>CAP - OTCs</h2>
<pre class="r"><code>svl.otc &lt;- svl %&gt;% filter(expt==&quot;otc&quot;)
cap.leaf &lt;- capscale(sqrt(vol.leaf[svl$expt==&quot;otc&quot;,]) ~ PlantType+temp, distance=&quot;bray&quot;, data=svl.otc)
summ.cap &lt;- summary(cap.leaf)
prop.expl &lt;- summ.cap$cont$importance[2,c(&quot;CAP1&quot;,&quot;CAP2&quot;)]
ax.labs &lt;- paste0(&quot;CAP&quot;, 1:2, &quot; (&quot;,round(100*prop.expl),&quot;% explained)&quot;)
(anova.cap &lt;- anova(cap.leaf, by=&quot;margin&quot;))</code></pre>
<pre><code>Permutation test for capscale under reduced model
Marginal effects of terms
Permutation: free
Number of permutations: 999

Model: capscale(formula = sqrt(vol.leaf[svl$expt == &quot;otc&quot;, ]) ~ PlantType + temp, data = svl.otc, distance = &quot;bray&quot;)
          Df SumOfSqs      F Pr(&gt;F)  
PlantType  1   0.4686 3.1215  0.012 *
temp       1   0.1415 0.9426  0.415  
Residual  32   4.8038                
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>plot(cap.leaf, type=&quot;n&quot;, xlim=range(cap.leaf$CCA$wa[,1]), xlab=ax.labs[1], ylab=ax.labs[2])
title(paste(&quot;OTCs: I. agg and I. ten leaves 2019&quot;,&quot;n =&quot;, nrow(svl.otc)))
legend(&quot;bottomleft&quot;, title=paste(&quot;Treatment&quot;,&quot;\nP =&quot;,anova.cap[&quot;temp&quot;,&quot;Pr(&gt;F)&quot;]), levels(svl.otc$temp), fill=tempcol)
legend(&quot;bottomright&quot;, title=paste(&quot;Species&quot;,&quot;\nP =&quot;,anova.cap[&quot;PlantType&quot;,&quot;Pr(&gt;F)&quot;]), levels(svl.otc$PlantType), pch=c(19,15))
points(cap.leaf, display=&quot;sites&quot;, col=tempcol[svl.otc$temp], pch=c(19,15)[svl.otc$PlantType]) 
text(cap.leaf, display=&quot;cn&quot;)
text(cap.leaf, display=&quot;species&quot;, cex=0.7, col=ifelse(sqrt(cap.leaf$CCA$v[,1]^2 + cap.leaf$CCA$v[,2]^2)&gt;0.2, alpha(&quot;purple&quot;,1),alpha(&quot;purple&quot;,0)))</code></pre>
<p><img src="plots/cap_leaf_otc-1.svg" width="768" /></p>
</div>
<div id="cap---percivals" class="section level2">
<h2>CAP - Percivals</h2>
<pre class="r"><code>svl.perc &lt;- svl %&gt;% filter(expt==&quot;perc&quot;)
cap.leaf.perc &lt;- capscale(sqrt(vol.leaf[svl$expt==&quot;perc&quot;,]) ~ PlantType+Temp, distance=&quot;bray&quot;, data=svl.perc)
summ.cap &lt;- summary(cap.leaf.perc)
prop.expl &lt;- summ.cap$cont$importance[2,c(&quot;CAP1&quot;,&quot;CAP2&quot;)]
ax.labs &lt;- paste0(&quot;CAP&quot;, 1:2, &quot; (&quot;,round(100*prop.expl),&quot;% explained)&quot;)
(anova.cap &lt;- anova(cap.leaf.perc, by=&quot;margin&quot;))</code></pre>
<pre><code>Permutation test for capscale under reduced model
Marginal effects of terms
Permutation: free
Number of permutations: 999

Model: capscale(formula = sqrt(vol.leaf[svl$expt == &quot;perc&quot;, ]) ~ PlantType + Temp, data = svl.perc, distance = &quot;bray&quot;)
          Df SumOfSqs      F Pr(&gt;F)
PlantType  1  0.13529 0.4714  0.873
Temp       1  0.31019 1.0807  0.325
Residual  10  2.87023              </code></pre>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
