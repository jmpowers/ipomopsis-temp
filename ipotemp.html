<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Carrie Wu, John Powers, David Hopp, Diane Campbell" />

<meta name="date" content="2023-04-27" />

<title>Volatiles - Ipomopsis temperature experiments</title>

<script src="libs/header-attrs-2.20/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/navigation-1.1/codefolding.js"></script>
<link href="libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Volatiles - Ipomopsis temperature
experiments</h1>
<h4 class="author">Carrie Wu, John Powers, David Hopp, Diane
Campbell</h4>
<h4 class="date">2023-04-27</h4>

</div>


<style type="text/css">
.main-container { max-width: 1000px; margin-left: 0; margin-right: auto; }
img{ max-width:200%; height: auto; }
td, th { padding : 6px }
</style>
<pre class="r"><code>load(&quot;data/volatiles/ipotemp181921.Rdata&quot;) 
#write(rownames(ipo.all), &quot;data/volatiles/CWu_samples.txt&quot;)
ipos &lt;- read.csv(&quot;data/volatiles/CWu_samples.csv&quot;, colClasses=list(RunDate=&quot;Date&quot;)) #TODO this filename split is outdated

# load short names and standard regessions
ipochems &lt;- read_csv(&quot;data/volatiles/Ipo volatile compounds - chemsf_ipo.csv&quot;) %&gt;% 
  select(name, shortname, standard, verdict) %&gt;%  filter(verdict != &quot;&quot;) %&gt;% 
  mutate(standard = fct_recode(standard, &quot;Methyl_salicylate&quot;=&quot;Benzaldehyde&quot;), # benzaldehyde regressions not reliable
         class = fct_recode(standard, Aliphatic=&quot;Hexenol&quot;, Benzenoid=&quot;Methyl_salicylate&quot;, Benzenoid=&quot;Indole&quot;, 
                            Sesquiterpene=&quot;Caryophyllene&quot;, Monoterpene=&quot;alpha_Pinene&quot;, Monoterpene=&quot;Linalool&quot;)) %&gt;%  
  left_join(read_csv(&quot;data/volatiles/regressions_181921_filtered_slopes.csv&quot;) %&gt;% 
              pivot_wider(id_cols=standard, names_from=&quot;year&quot;, names_prefix=&quot;area_per_ng&quot;, values_from=area_per_ng)) 
class_pal &lt;- set_names(c(&quot;#BC0060&quot;,&quot;#027B8C&quot;,&quot;#E56E00&quot;,&quot;#86D400&quot;), levels(ipochems$class))

#shorten chemical names and merge compounds with multiple names
shortnames &lt;- ipochems %&gt;% select(name, shortname) %&gt;% filter(shortname!=&quot;&quot;) %&gt;% deframe()
#shortnames[shortnames %in% shortnames[duplicated(shortnames)]]
ipo.data$Name &lt;- recode(ipo.data$Name, !!!shortnames)</code></pre>
<div id="check-quant-vs.-qual-integrations" class="section level1">
<h1>Check quant vs.Â qual integrations</h1>
<pre class="r"><code>ipo.all &lt;- dcast(ipo.data, Filename~Name, sum, value.var=&quot;Area&quot;)
rownames(ipo.all) &lt;- ipo.all[,1]
ipo.all[,1] &lt;- NULL

#load quantitative integrations
quant &lt;- read_tsv(&quot;data/volatiles/quant.tsv&quot;) %&gt;%
  mutate(Name = recode(Name, !!!shortnames)) %&gt;% 
  pivot_wider(names_from = &quot;Name&quot;, values_from=&quot;Area&quot;) %&gt;% as.data.frame()

quant.meta &lt;- quant %&gt;% select(batch, Dirname, Filename) %&gt;% 
  mutate(isblank = str_detect(Filename, &quot;lank&quot;),
         Year = as.integer(str_match(Filename, &quot;(201[7-9]|202[1-2])[_.]&quot;)[,2]),
         GCOrder = as.integer(str_match(Filename, &quot;_([0-9][0-9]).qgd&quot;)[,2]),
         RunDate = str_remove(str_extract(Filename, paste0(&quot;_[0-9]{2,4}&quot;,Year)), &quot;_[0]*&quot;),
         RunDate = ymd(paste(str_sub(RunDate, -4,-1), str_sub(RunDate,1,1), str_sub(RunDate, 2, -5))))

rownames(quant) &lt;- quant$Filename
quant[,c(&quot;batch&quot;,&quot;Dirname&quot;,&quot;Filename&quot;)] &lt;- NULL
quant.all &lt;- quant[rownames(ipo.all),]#TODO 64 missing files, tho might be filtered out later anyway

par(mfrow=c(4,8))
quant.slopes &lt;- set_names(rep(0,ncol(quant.all)), colnames(quant.all))
for(compvol in colnames(quant.all)) {
  quant_wins &lt;- sum(ipo.all[,compvol] == 0 &amp; quant.all[,compvol] &gt; 0, na.rm=T)
  qual_wins &lt;-  sum(quant.all[,compvol] == 0 &amp; ipo.all[,compvol] &gt; 0, na.rm=T)
  nozeros &lt;- bind_cols(select(ipo.all,qual=compvol), select(quant.all,quant=compvol)) %&gt;% 
    filter(!(qual==0 | quant == 0))
  quant.slopes[compvol] = coef(lm(quant ~ 0 + qual, data=nozeros))[&quot;qual&quot;]
  # plot(x=sqrt(ipo.all[,compvol]), y=sqrt(quant.all[,compvol]),
  #      main=compvol, sub = paste0(&quot;quant:qual &quot;,quant_wins,&quot;:&quot;,qual_wins,
  #                                 &quot; slope &quot;,round(quant.slopes[compvol],3)),
  #      xlab=&quot;qual&quot;,ylab=&quot;quant&quot;)
  # abline(a=0, b=sqrt(quant.slopes[compvol]))
}
par(mfrow=c(1,1))

quant_betterthan_qual &lt;- colnames(quant.all) #TODO may want to exclude some of these from bouquet filtering (used below)
 #  c(&quot;b-myrcene&quot;, &quot;(Z)-b-ocimene&quot;,&quot;(E)-b-ocimene&quot;, &quot;g-terpinene&quot;,&quot;methyl benzoate&quot;, &quot;(3E)-4,8-dimethylnona-1,3,7-triene&quot;, &quot;2-methylbenzonitrile&quot;, &quot;indole&quot;, &quot;petasitene&quot;, 
 # &quot;trans-a-bergamotene&quot;,&quot;b-caryophyllene&quot; ,&quot;bergamotene&quot;,&quot;a-farnesene&quot;,&quot;pseudoionone&quot;)
write_tsv(enframe(quant.slopes) %&gt;% left_join(enframe(shortnames, name=&quot;Name&quot;, value=&quot;name&quot;)),
          &quot;data/volatiles/quant_slopes.tsv&quot;)

quant.scaled &lt;- sweep(quant.all, 2, quant.slopes, FUN = &#39;/&#39;)

ggplot(tibble(quant=quant.scaled$indole, qual=ipo.all$indole), aes(x=qual, y=quant)) + 
  geom_point(alpha=0.2) + scale_x_sqrt(limits=c(0,3e7)) + scale_y_sqrt() + 
  geom_abline(slope=1, intercept=0) + labs(title=&quot;Indole integrations&quot;,x=&quot;Qualitative&quot;,y=&quot;Quantitative&quot;)</code></pre>
<p><img src="plots/quant-1.svg" width="1152" /></p>
<pre class="r"><code>quant.meta &lt;- quant.meta %&gt;% mutate(indole_quant = quant$indole/quant.slopes[&quot;indole&quot;])

ggplot(quant.meta %&gt;% drop_na(RunDate) %&gt;% arrange(isblank), aes(y=indole_quant, x=RunDate, color=isblank)) +  
  facet_wrap(vars(Year), scales=&quot;free_x&quot;, nrow=1)+ 
  geom_point(size=0.5, alpha=0.5) + stat_summary(geom=&quot;line&quot;, fun=&quot;mean&quot;, size=1)+ scale_y_sqrt()+ theme_bw()+ theme(legend.position=&quot;top&quot;)+
  labs(x=&quot;GC run date&quot;, y=&quot;Quantitative indole integration&quot;, color=&quot;Markes blank?&quot;)</code></pre>
<p><img src="plots/quant-2.svg" width="1152" /></p>
</div>
<div id="read-metadata" class="section level1">
<h1>Read metadata</h1>
<pre class="r"><code>#accounts for skips
verdicts &lt;- read_tsv(&quot;data/volatiles/RMBL GC-MS Data Inventory - ipogc181921.tsv&quot;) %&gt;% 
  select(Filename=FileName, sample, verdict, status, FullName) %&gt;% 
  mutate(Folder = str_remove(dirname(FullName),&quot;C:/GCMSsolution/Data/Project1/&quot;), .keep=&quot;unused&quot;) %&gt;% 
  mutate(sample = na_if(sample,&quot;&quot;) %&gt;% coalesce(Filename)) %&gt;% #fill in samples with no change
  drop_na(sample) %&gt;%  # when both Filename and Sample are NA
  filter(is.na(verdict) | verdict!=&quot;mismatched&quot;) %&gt;% # fuzzy matching misassigned these to a Markes entry
  filter(!duplicated(Filename))  # a couple nonunique filenames
#TODO one verdict = skip-lookup but no qgb to look up last filename: OTC_Z3_190805_8102019_24.qgd

##### 2018 + 2019 | bb + GNA + SC  | OTC + Perc ######
# field metadata
perc &lt;- read_csv(&quot;data/volatiles/CWu Ipomopsis Scent Metadata - Percivals2018_2019.csv&quot;)
otc &lt;- read_csv(&quot;data/volatiles/CWu Ipomopsis Scent Metadata - OTC2018_2019.csv&quot;)  %&gt;%  
  rename(temp=OI) %&gt;% mutate(temp = recode(temp,&quot;in&quot;=&quot;warmed&quot;,&quot;out&quot;=&quot;control&quot;))
# manually split filenames and drop chromatograms that were redone
files &lt;- read_tsv(&quot;data/volatiles/CWu Ipomopsis Scent Metadata - CWu_samples_text2.tsv&quot;) %&gt;% 
  rename(temp=OI) %&gt;% mutate(temp = recode(temp,&quot;in&quot;=&quot;warmed&quot;,&quot;out&quot;=&quot;control&quot;)) %&gt;% filter(is.na(Drop)) %&gt;% 
  left_join(verdicts)
# merge metadata and filenames
perc2 &lt;- left_join(perc,files, by=c(&quot;Date&quot;,&quot;DN&quot;,&quot;Tissue&quot;,&quot;Sample2&quot;), suffix=c(&quot;&quot;,&quot;.f&quot;))
otc2 &lt;-  left_join(otc, files, by=c(&quot;Date&quot;,&quot;Site&quot;,&quot;temp&quot;,&quot;DN&quot;,&quot;Tissue&quot;,&quot;Sample2&quot;), suffix=c(&quot;&quot;,&quot;.f&quot;)) %&gt;% 
  mutate(PlantType = if_else(temp == &quot;air&quot;, &quot;air&quot;, PlantType))

###### 2021 | GNA + SC | OTC ######
# field metadata
sc21 &lt;- read_tsv(&quot;data/volatiles/2021 Spring Creek Volatiles - 2021.tsv&quot;) %&gt;% 
  mutate(PlantType=if_else(plant==&quot;air&quot;, &quot;air&quot;, &quot;ten&quot;))
gna21 &lt;- read_tsv(&quot;data/volatiles/2021 GNA Volatiles - 2021.tsv&quot;) %&gt;% 
  mutate(time=&quot;day&quot;, PlantType=if_else(plant==&quot;air&quot;, &quot;air&quot;, &quot;agg&quot;))
# automatically split filenames, manually edit, drop chromatograms that were redone, and read back in
# tibble(Filename = rownames(ipo.all)) %&gt;% 
#   filter(str_detect(Filename, &quot;2021&quot;), 
#          str_detect(Filename, &quot;SC_|GNA_&quot;)) %&gt;%
#   separate(Filename, into=c(&quot;site&quot;,&quot;vial&quot;,&quot;sampledate&quot;,&quot;rundate&quot;,&quot;GCn&quot;), sep=&quot;_&quot;, remove=FALSE, convert=TRUE) %&gt;% 
#   mutate(GCn = str_remove(GCn, &quot;.qgd&quot;)) %&gt;% write_tsv(&quot;files21_auto.tsv&quot;)  
files21 &lt;- read_tsv(&quot;data/volatiles/CWu Ipomopsis Scent Metadata - files21.tsv&quot;) %&gt;% 
  mutate(rundate = ymd(paste(&quot;2021&quot;, str_sub(rundate,1,1), str_sub(rundate, 2, -5))),
         sampledate = ymd(sampledate)) %&gt;% 
  filter(is.na(drop)) %&gt;% #drop samples that were redone
  left_join(verdicts)
#TODO check that the presumed redos in files21 were actually leaks/skips
#merge metadata and filenames
otc21 &lt;- bind_rows(SC=sc21, GNA=gna21, .id=&quot;site&quot;) %&gt;% 
  left_join(files21, by=c(&quot;vial&quot;,&quot;site&quot;)) %&gt;% 
  drop_na(plant) %&gt;% # two contaminated traps, not used
  mutate(sampledate = as.character(sampledate),
         Year = 2021, Tissue = if_else(plant == &quot;air&quot;, &quot;air&quot;, &quot;flower&quot;), Expt=&quot;otc&quot;,
         location = recode(location,&quot;inside&quot;=&quot;warmed&quot;,&quot;outside&quot;=&quot;control&quot;),
         PlantID = paste0(chamber, plant)) %&gt;% 
  rename(Site=site, Collector=observer, Date=date, DN=time, temp=location, Bag=bag, Pump=pump, End=end, Equil=equil, Duration=pumping,
         NumFlrs = flowers, NumBuds=buds, PumpID = pump_id, SoilVWC = VWC, Comments = notes, SampleDate=sampledate,
         RunDate=rundate,GCOrder=GCn)

####### 2021 | Maxfield | OTC  #######
#automatically split filenames. Filename2 accounts for skip
maxfiles &lt;- read_csv(&quot;data/volatiles/filenames_metadata - filenames_metadata.csv&quot;) %&gt;% 
  left_join(verdicts) %&gt;% # checked that sample matches up with old Filename2
  mutate(Is2021 = str_detect(Filename,&quot;_210&quot;)) %&gt;% 
  filter(Maxfield==1 &amp; Year==&quot;2021&quot;) %&gt;% 
  separate(Filename2, into=c(&quot;plantid&quot;,&quot;vial&quot;,&quot;date&quot;,&quot;rundate&quot;,&quot;sequence&quot;,&quot;ext&quot;),remove=F) %&gt;% 
  mutate(across(c(plantid, vial), na_if,&quot;NA&quot;)) %&gt;% 
  mutate(date = ymd(date), vial=as.character(vial),
         YearFilament = ifelse(date&gt;ymd(&quot;2021-07-21&quot;),&quot;2021fil2&quot;,&quot;2021&quot;))

#field metadata, joined with treatments
GCMS_metadata1 &lt;- read_csv(&quot;data/volatiles/2021 Maxfield Volatiles - 2021.csv&quot;) %&gt;% mutate(plotid=paste0(plot, subplot)) %&gt;% 
  left_join(read_csv(&quot;data/2021 Maxfield Rosettes - 2021OTCs.csv&quot;) %&gt;% mutate(plant=as.character(plant)),
            by=c(&quot;plotid&quot;,&quot;plant&quot;,&quot;plantid&quot;))

#look up plant IDs for each GC tube (vial column also has A/B for multiple samples)
max21.oldformat &lt;- bind_rows(
  left_join(maxfiles %&gt;% filter(vial %in% c(&quot;A&quot;,&quot;B&quot;)), GCMS_metadata1, by=c(&quot;plantid&quot;,&quot;vial&quot;,&quot;date&quot;)),
  left_join(maxfiles %&gt;% filter(!vial %in% c(&quot;A&quot;,&quot;B&quot;) &amp; is.na(plantid)), GCMS_metadata1, by=c(&quot;vial&quot;,&quot;date&quot;)), #vial numbers only
  left_join(maxfiles %&gt;% filter(!vial %in% c(&quot;A&quot;,&quot;B&quot;) &amp;!is.na(plantid)), GCMS_metadata1, by=c(&quot;plantid&quot;,&quot;date&quot;))) %&gt;%  #plantid
  mutate(type=factor(ifelse(plant==&quot;air&quot;,&quot;ambient&quot;,&quot;floral&quot;)), 
         temp=factor(temp.y), snow=factor(snow),
         plantid= coalesce(plantid, plantid.y)) 

#rename columns to match CWu metadata format
max21 &lt;- max21.oldformat %&gt;% #put in line with CWu metadata
  rename(Date=date, RunDate_text=rundate,
         Comments=notes, Collector=observer, Bag=bag, Pump=pump,End=end, 
         NumFlrs=flowers, NumBuds=buds, PumpID=pump_id, SoilVWC=VWC,
         PlantType=type, PlantID=plantid) %&gt;% 
  mutate(vial=as.integer(recode(vial, &quot;A&quot;=&quot;1001&quot;, &quot;B&quot;=&quot;1002&quot;)),
         RunDate_text = as.integer(RunDate_text),
         PlantType=recode(PlantType, &quot;ambient&quot;=&quot;air&quot;, &quot;floral&quot;=&quot;agg&quot;),
         Tissue=recode(PlantType, &quot;agg&quot;=&quot;flower&quot;),
         Expt=&quot;otc&quot;,Site=&quot;Maxfield&quot;,DN=&quot;day&quot;,
         temp=recode(temp,&quot;OTC&quot;=&quot;warmed&quot;))

######## Combine all metadata tables #########
meta &lt;- bind_rows(otc=bind_rows(otc2, otc21, max21), perc=perc2, .id=&quot;expt&quot;) %&gt;% 
  mutate_if(is.character, as.factor) %&gt;%
  mutate(Equil=Pump-Bag, Duration=End-Pump, Total=End-Bag,
         Pump_datehour = paste(Date, Pump) %&gt;% ymd_hms(tz=&quot;America/Denver&quot;) %&gt;% round_date(&quot;hour&quot;),
         Expt=expt) %&gt;% #TODO sort thru Expt==NA
  #Add mean temperature of OTCs or controls at time of sampling
  left_join(read_csv(&quot;data/hobos_mean.csv&quot;) %&gt;% select(-date) %&gt;% 
              mutate(datetime = with_tz(datetime, &quot;America/Denver&quot;)), #stored in UTC!
            by = c(&quot;Site&quot;=&quot;site&quot;, &quot;Pump_datehour&quot;=&quot;datetime&quot;)) %&gt;% 
  mutate(mean_temp_C_treatment = if_else(temp==&quot;warmed&quot;, mean_temp_C_warmed, mean_temp_C_control))

meta %&gt;% write.csv(&quot;data/volatiles/CWu_meta21.csv&quot;)

meta %&gt;% count(Year, Temp, Tissue, PlantType, Site, temp, DN, Expt) %&gt;% kable(caption=&quot;Sample size&quot;)</code></pre>
<table>
<caption>Sample size</caption>
<thead>
<tr class="header">
<th align="right">Year</th>
<th align="left">Temp</th>
<th align="left">Tissue</th>
<th align="left">PlantType</th>
<th align="left">Site</th>
<th align="left">temp</th>
<th align="left">DN</th>
<th align="left">Expt</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2018</td>
<td align="left">cool</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">cool</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">warm</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">warm</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">GNA</td>
<td align="left">air</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">bb</td>
<td align="left">air</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">31</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">bb</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">bb</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">leaf</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">leaf</td>
<td align="left">agg</td>
<td align="left">bb</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">leaf</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">leaf</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">leaf</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">leaf</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">GNA</td>
<td align="left">air</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">air</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">air</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">warmed</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">leaf</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">leaf</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">leaf</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">leaf</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">GNA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">Maxfield</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">air</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">air</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">32</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">34</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">Maxfield</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">38</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">Maxfield</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">44</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">30</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">31</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">41</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">warmed</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">46</td>
</tr>
</tbody>
</table>
<pre class="r"><code>tempcol &lt;- set_names(brewer.pal(3, &quot;Set1&quot;)[c(2,1)], c(&quot;control&quot;, &quot;warmed&quot;))#OTCs
Tempcol &lt;- set_names(brewer.pal(3, &quot;Set1&quot;)[c(2,1)], c(&quot;cool&quot;, &quot;warm&quot;))#Percivals</code></pre>
<div id="missing-files" class="section level2">
<h2>Missing files</h2>
<pre class="r"><code>#perc2 %&gt;% filter(is.na(Filename)) %&gt;% select(&quot;n&quot;) %&gt;% write.csv(&quot;perc_nomatch.csv&quot;)
#otc2 %&gt;% filter(is.na(Filename)) %&gt;% select(&quot;n&quot;) %&gt;% write.csv(&quot;otc_nomatch.csv&quot;)
meta %&gt;% filter(is.na(Filename)) %&gt;% #no filename
  filter(is.na(lost)) %&gt;% # 2021 samples &quot;lost&quot; (to what?)
  filter(is.na(nomatch) | nomatch != &quot;NR&quot;) %&gt;% # samples not run
  select(1:16) %&gt;% kable(caption = &quot;have metadata, no chromatogram&quot;)# &amp; nomatch!=&quot;NR&quot;</code></pre>
<table>
<caption>have metadata, no chromatogram</caption>
<colgroup>
<col width="4%" />
<col width="3%" />
<col width="4%" />
<col width="8%" />
<col width="4%" />
<col width="4%" />
<col width="8%" />
<col width="5%" />
<col width="6%" />
<col width="9%" />
<col width="6%" />
<col width="6%" />
<col width="6%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">expt</th>
<th align="right">n</th>
<th align="right">Year</th>
<th align="left">Date</th>
<th align="left">DN</th>
<th align="left">Site</th>
<th align="left">PlantType</th>
<th align="left">Tissue</th>
<th align="left">temp</th>
<th align="left">Sample</th>
<th align="left">Sample2</th>
<th align="left">PlantID</th>
<th align="left">nomatch</th>
<th align="left">Bag</th>
<th align="left">Pump</th>
<th align="left">End</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">otc</td>
<td align="right">184</td>
<td align="right">2018</td>
<td align="left">2018-07-25</td>
<td align="left">day</td>
<td align="left">GNA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">warmed</td>
<td align="left">KM10-B1</td>
<td align="left">KM10B1</td>
<td align="left">KM10B1</td>
<td align="left">0</td>
<td align="left">10:13:00</td>
<td align="left">10:43:00</td>
<td align="left">10:58:00</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">37</td>
<td align="right">2019</td>
<td align="left">2019-07-31</td>
<td align="left">day</td>
<td align="left">GNA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">warmed</td>
<td align="left">OTC-W1</td>
<td align="left">W1</td>
<td align="left">W1</td>
<td align="left">0</td>
<td align="left">11:53:00</td>
<td align="left">12:26:00</td>
<td align="left">12:41:00</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="right">83</td>
<td align="right">2019</td>
<td align="left">2019-08-02</td>
<td align="left">day</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">leaf</td>
<td align="left">warmed</td>
<td align="left">OTC-A2-leaf</td>
<td align="left">A2</td>
<td align="left">A2</td>
<td align="left">0</td>
<td align="left">12:50:00</td>
<td align="left">13:20:00</td>
<td align="left">13:35:00</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">84</td>
<td align="right">2019</td>
<td align="left">2019-08-02</td>
<td align="left">day</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">leaf</td>
<td align="left">warmed</td>
<td align="left">OTC-C3-leaf</td>
<td align="left">C3</td>
<td align="left">C3</td>
<td align="left">0</td>
<td align="left">13:08:00</td>
<td align="left">13:41:00</td>
<td align="left">13:56:00</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="right">62</td>
<td align="right">2019</td>
<td align="left">2019-08-02</td>
<td align="left">day</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">leaf</td>
<td align="left">warmed</td>
<td align="left">OTC-D1-leaf</td>
<td align="left">D1</td>
<td align="left">D1</td>
<td align="left">NA</td>
<td align="left">13:22:00</td>
<td align="left">13:58:00</td>
<td align="left">14:13:00</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">5</td>
<td align="right">2019</td>
<td align="left">2019-08-02</td>
<td align="left">night</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">flower</td>
<td align="left">control</td>
<td align="left">SC9</td>
<td align="left">9</td>
<td align="left">9</td>
<td align="left">0</td>
<td align="left">20:21:00</td>
<td align="left">20:51:00</td>
<td align="left">21:06:00</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="right">106</td>
<td align="right">2019</td>
<td align="left">2019-08-05</td>
<td align="left">day</td>
<td align="left">GNA</td>
<td align="left">agg</td>
<td align="left">leaf</td>
<td align="left">control</td>
<td align="left">GNA5-leaf</td>
<td align="left">5</td>
<td align="left">5</td>
<td align="left">NA</td>
<td align="left">11:49:00</td>
<td align="left">12:19:00</td>
<td align="left">12:34:00</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-15</td>
<td align="left">night</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">flower</td>
<td align="left">warmed</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">B238</td>
<td align="left">NA</td>
<td align="left">19:46:00</td>
<td align="left">20:20:00</td>
<td align="left">20:35:00</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-26</td>
<td align="left">night</td>
<td align="left">SC</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">XEair</td>
<td align="left">NA</td>
<td align="left">22:10:00</td>
<td align="left">22:26:00</td>
<td align="left">22:41:00</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-26</td>
<td align="left">night</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">flower</td>
<td align="left">warmed</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">F8</td>
<td align="left">NA</td>
<td align="left">21:47:00</td>
<td align="left">22:17:00</td>
<td align="left">22:32:00</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-16</td>
<td align="left">day</td>
<td align="left">GNA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">control</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">XL360</td>
<td align="left">NA</td>
<td align="left">09:04:00</td>
<td align="left">09:35:00</td>
<td align="left">09:50:00</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-16</td>
<td align="left">day</td>
<td align="left">GNA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">control</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">XN2</td>
<td align="left">NA</td>
<td align="left">09:44:00</td>
<td align="left">10:14:00</td>
<td align="left">10:29:00</td>
</tr>
<tr class="odd">
<td align="left">perc</td>
<td align="right">21</td>
<td align="right">2019</td>
<td align="left">2019-07-25</td>
<td align="left">day</td>
<td align="left">NA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">NA</td>
<td align="left">A38</td>
<td align="left">A38</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">10:24:00</td>
<td align="left">10:54:00</td>
<td align="left">11:09:00</td>
</tr>
<tr class="even">
<td align="left">perc</td>
<td align="right">47</td>
<td align="right">2019</td>
<td align="left">2019-07-25</td>
<td align="left">night</td>
<td align="left">NA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">NA</td>
<td align="left">A79</td>
<td align="left">A79</td>
<td align="left">NA</td>
<td align="left">nm</td>
<td align="left">21:02:00</td>
<td align="left">21:35:00</td>
<td align="left">21:50:00</td>
</tr>
</tbody>
</table>
<pre class="r"><code>#otc21 %&gt;% filter(is.na(Filename), is.na(lost)) %&gt;% select(1:18) %&gt;% kable(caption = &quot;have metadata, no chromatogram&quot;)
#max21 is not missing any files
meta %&gt;% filter(!is.na(lost)) %&gt;% select(1:16) %&gt;% kable(caption = &quot;have metadata, samples lost&quot;)</code></pre>
<table>
<caption>have metadata, samples lost</caption>
<colgroup>
<col width="4%" />
<col width="2%" />
<col width="4%" />
<col width="9%" />
<col width="5%" />
<col width="4%" />
<col width="8%" />
<col width="5%" />
<col width="6%" />
<col width="5%" />
<col width="6%" />
<col width="6%" />
<col width="6%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">expt</th>
<th align="right">n</th>
<th align="right">Year</th>
<th align="left">Date</th>
<th align="left">DN</th>
<th align="left">Site</th>
<th align="left">PlantType</th>
<th align="left">Tissue</th>
<th align="left">temp</th>
<th align="left">Sample</th>
<th align="left">Sample2</th>
<th align="left">PlantID</th>
<th align="left">nomatch</th>
<th align="left">Bag</th>
<th align="left">Pump</th>
<th align="left">End</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-15</td>
<td align="left">night</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">flower</td>
<td align="left">control</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">XI185</td>
<td align="left">NA</td>
<td align="left">19:46:00</td>
<td align="left">20:16:00</td>
<td align="left">20:31:00</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-15</td>
<td align="left">night</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">flower</td>
<td align="left">warmed</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">I196</td>
<td align="left">NA</td>
<td align="left">19:48:00</td>
<td align="left">20:18:00</td>
<td align="left">20:33:00</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-15</td>
<td align="left">night</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">flower</td>
<td align="left">warmed</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">I227</td>
<td align="left">NA</td>
<td align="left">19:50:00</td>
<td align="left">20:20:00</td>
<td align="left">20:35:00</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-15</td>
<td align="left">night</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">flower</td>
<td align="left">control</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">XI139</td>
<td align="left">NA</td>
<td align="left">19:55:00</td>
<td align="left">20:25:00</td>
<td align="left">20:40:00</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-15</td>
<td align="left">night</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">flower</td>
<td align="left">warmed</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">I192</td>
<td align="left">NA</td>
<td align="left">20:17:00</td>
<td align="left">20:47:00</td>
<td align="left">21:02:00</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-15</td>
<td align="left">night</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">flower</td>
<td align="left">control</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">XG5</td>
<td align="left">NA</td>
<td align="left">20:27:00</td>
<td align="left">20:57:00</td>
<td align="left">21:12:00</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-15</td>
<td align="left">night</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">flower</td>
<td align="left">warmed</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">G99</td>
<td align="left">NA</td>
<td align="left">20:29:00</td>
<td align="left">20:59:00</td>
<td align="left">21:14:00</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-15</td>
<td align="left">night</td>
<td align="left">SC</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Iair</td>
<td align="left">NA</td>
<td align="left">20:36:00</td>
<td align="left">21:06:00</td>
<td align="left">21:21:00</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-15</td>
<td align="left">night</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">flower</td>
<td align="left">warmed</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">B294</td>
<td align="left">NA</td>
<td align="left">19:44:00</td>
<td align="left">20:18:00</td>
<td align="left">20:33:00</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-16</td>
<td align="left">day</td>
<td align="left">GNA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">control</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">XL183</td>
<td align="left">NA</td>
<td align="left">09:06:00</td>
<td align="left">09:36:00</td>
<td align="left">09:51:00</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-16</td>
<td align="left">day</td>
<td align="left">GNA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">warmed</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">L14</td>
<td align="left">NA</td>
<td align="left">09:12:00</td>
<td align="left">09:42:00</td>
<td align="left">09:57:00</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-16</td>
<td align="left">day</td>
<td align="left">GNA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">warmed</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">N385</td>
<td align="left">NA</td>
<td align="left">09:46:00</td>
<td align="left">10:16:00</td>
<td align="left">10:31:00</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-16</td>
<td align="left">day</td>
<td align="left">GNA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">control</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">XN654</td>
<td align="left">NA</td>
<td align="left">09:49:00</td>
<td align="left">10:19:00</td>
<td align="left">10:34:00</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-16</td>
<td align="left">day</td>
<td align="left">GNA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">control</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">XP225</td>
<td align="left">NA</td>
<td align="left">10:14:00</td>
<td align="left">10:49:00</td>
<td align="left">11:04:00</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-16</td>
<td align="left">day</td>
<td align="left">GNA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">control</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">XP114</td>
<td align="left">NA</td>
<td align="left">10:25:00</td>
<td align="left">10:55:00</td>
<td align="left">11:10:00</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">NA</td>
<td align="right">2021</td>
<td align="left">2021-07-16</td>
<td align="left">day</td>
<td align="left">GNA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">warmed</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">P195</td>
<td align="left">NA</td>
<td align="left">10:28:00</td>
<td align="left">10:58:00</td>
<td align="left">11:13:00</td>
</tr>
</tbody>
</table>
</div>
<div id="missing-metadata" class="section level2">
<h2>Missing metadata</h2>
<pre class="r"><code>#files %&gt;% filter(!(Filename %in% meta$Filename)) %&gt;% select(&quot;n&quot;) %&gt;% write.csv(&quot;CWu_samples_nomatch.csv&quot;)
files %&gt;% filter(!(Filename %in% meta$Filename) &amp; Expt!=&quot;&quot;) %&gt;% select(c(&quot;Filename&quot;, &quot;Date&quot;,&quot;Site&quot;,&quot;temp&quot;,&quot;DN&quot;,&quot;Tissue&quot;,&quot;Sample2&quot;)) %&gt;% kable(caption = &quot;have chromatogram, no metadata&quot;)</code></pre>
<table>
<caption>have chromatogram, no metadata</caption>
<colgroup>
<col width="45%" />
<col width="13%" />
<col width="6%" />
<col width="10%" />
<col width="5%" />
<col width="8%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Filename</th>
<th align="left">Date</th>
<th align="left">Site</th>
<th align="left">temp</th>
<th align="left">DN</th>
<th align="left">Tissue</th>
<th align="left">Sample2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">AirlastJuly25_08312018.qgd</td>
<td align="left">2018-07-25</td>
<td align="left">GNA</td>
<td align="left">air</td>
<td align="left">day</td>
<td align="left">air</td>
<td align="left">Airlast</td>
</tr>
<tr class="even">
<td align="left">NatAreaXUP01July25_08312018.qgd</td>
<td align="left">2018-07-25</td>
<td align="left">GNA</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="left">XUP01</td>
</tr>
<tr class="odd">
<td align="left">GNA5redo_leaf_190805_8112019_17.qgd</td>
<td align="left">2019-08-05</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">leaf</td>
<td align="left">5redo</td>
</tr>
<tr class="even">
<td align="left">A188DredoAug16renamed_09022018.qgd</td>
<td align="left">2018-08-16</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="left">A188redo</td>
</tr>
<tr class="odd">
<td align="left">T196DredoAug16_09022018.qgd</td>
<td align="left">2018-08-16</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="left">T196redo</td>
</tr>
<tr class="even">
<td align="left">A38redo_day_190725_872019_03.qgd</td>
<td align="left">2019-07-25</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="left">A38redo</td>
</tr>
<tr class="odd">
<td align="left">A91_leaf_190725_882019_02.qgd</td>
<td align="left">2019-07-25</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">leaf</td>
<td align="left">A91</td>
</tr>
</tbody>
</table>
<pre class="r"><code>files21 %&gt;% filter(!(Filename %in% meta$Filename)) %&gt;% kable(caption = &quot;have chromatogram, no metadata&quot;)</code></pre>
<table>
<caption>have chromatogram, no metadata</caption>
<colgroup>
<col width="18%" />
<col width="3%" />
<col width="3%" />
<col width="6%" />
<col width="6%" />
<col width="2%" />
<col width="3%" />
<col width="3%" />
<col width="18%" />
<col width="4%" />
<col width="7%" />
<col width="21%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">sample</th>
<th align="left">site</th>
<th align="right">vial</th>
<th align="left">sampledate</th>
<th align="left">rundate</th>
<th align="right">GCn</th>
<th align="right">drop</th>
<th align="left">Notes</th>
<th align="left">Filename</th>
<th align="left">verdict</th>
<th align="left">status</th>
<th align="left">Folder</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GNA_121_210730_7312021_05.qgd</td>
<td align="left">GNA</td>
<td align="right">121</td>
<td align="left">2021-07-30</td>
<td align="left">2021-07-31</td>
<td align="right">5</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">GNA_121_210730_7312021_05.qgd</td>
<td align="left">NA</td>
<td align="left">Desorbed NA</td>
<td align="left">Campbell RMBL Data/Ipomopsis 2020</td>
</tr>
<tr class="even">
<td align="left">SC_140_210727_8202021_05.qgd</td>
<td align="left">SC</td>
<td align="right">140</td>
<td align="left">2021-07-27</td>
<td align="left">2021-08-20</td>
<td align="right">5</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">SC_140_210727_8202021_05.qgd</td>
<td align="left">NA</td>
<td align="left">Desorbed NA</td>
<td align="left">Campbell RMBL Data/Ipomopsis 2020</td>
</tr>
<tr class="odd">
<td align="left">SC_101_210727_8202021_02.qgd</td>
<td align="left">SC</td>
<td align="right">101</td>
<td align="left">2021-07-27</td>
<td align="left">2021-08-20</td>
<td align="right">2</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">SC_101_210727_8202021_02.qgd</td>
<td align="left">NA</td>
<td align="left">Desorbed NA</td>
<td align="left">Campbell RMBL Data/Ipomopsis 2020</td>
</tr>
</tbody>
</table>
<p>GNA_121 and SC_101 traps contaminated, no metadata for SC_140.
maxfiles is not missing any metadata. ## Times</p>
<pre class="r"><code>ggplot(meta, aes(x=paste(Expt, DN,Year), y=Pump, color=DN)) + 
  geom_boxplot() + geom_point()+
  theme_minimal() + theme(axis.text.x=element_text(angle=90))+ 
  ggtitle(&quot;Sampling time of day&quot;)</code></pre>
<p><img src="plots/times-1.svg" width="768" /></p>
<pre class="r"><code>meta %&gt;% group_by(Expt, DN, Tissue, Year) %&gt;% drop_na(Pump) %&gt;% 
  summarize(first=seconds_to_period(min(Pump)), last=seconds_to_period(max(Pump))) %&gt;% kable(caption=&quot;Pump times&quot;)</code></pre>
<table>
<caption>Pump times</caption>
<thead>
<tr class="header">
<th align="left">Expt</th>
<th align="left">DN</th>
<th align="left">Tissue</th>
<th align="right">Year</th>
<th align="right">first</th>
<th align="right">last</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">otc</td>
<td align="left">day</td>
<td align="left">air</td>
<td align="right">2018</td>
<td align="right">9H 15M 0S</td>
<td align="right">14H 14M 0S</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">day</td>
<td align="left">air</td>
<td align="right">2019</td>
<td align="right">9H 51M 0S</td>
<td align="right">13H 4M 0S</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="left">day</td>
<td align="left">air</td>
<td align="right">2021</td>
<td align="right">9H 31M 0S</td>
<td align="right">12H 3M 0S</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="right">2018</td>
<td align="right">9H 10M 0S</td>
<td align="right">14H 55M 0S</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="right">2019</td>
<td align="right">10H 10M 0S</td>
<td align="right">13H 24M 0S</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="right">2021</td>
<td align="right">9H 10M 0S</td>
<td align="right">13H 1M 0S</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="left">day</td>
<td align="left">leaf</td>
<td align="right">2018</td>
<td align="right">10H 25M 0S</td>
<td align="right">10H 47M 0S</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">day</td>
<td align="left">leaf</td>
<td align="right">2019</td>
<td align="right">9H 55M 0S</td>
<td align="right">13H 58M 0S</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="left">night</td>
<td align="left">air</td>
<td align="right">2019</td>
<td align="right">19H 43M 0S</td>
<td align="right">21H 48M 0S</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">night</td>
<td align="left">air</td>
<td align="right">2021</td>
<td align="right">20H 17M 0S</td>
<td align="right">22H 26M 0S</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="left">night</td>
<td align="left">flower</td>
<td align="right">2019</td>
<td align="right">20H 7M 0S</td>
<td align="right">21H 50M 0S</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">night</td>
<td align="left">flower</td>
<td align="right">2021</td>
<td align="right">20H 15M 0S</td>
<td align="right">22H 56M 0S</td>
</tr>
<tr class="odd">
<td align="left">perc</td>
<td align="left">day</td>
<td align="left">air</td>
<td align="right">2018</td>
<td align="right">9H 20M 0S</td>
<td align="right">13H 50M 0S</td>
</tr>
<tr class="even">
<td align="left">perc</td>
<td align="left">day</td>
<td align="left">air</td>
<td align="right">2019</td>
<td align="right">9H 21M 0S</td>
<td align="right">17H 37M 0S</td>
</tr>
<tr class="odd">
<td align="left">perc</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="right">2018</td>
<td align="right">9H 34M 0S</td>
<td align="right">13H 53M 0S</td>
</tr>
<tr class="even">
<td align="left">perc</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="right">2019</td>
<td align="right">9H 31M 0S</td>
<td align="right">12H 39M 0S</td>
</tr>
<tr class="odd">
<td align="left">perc</td>
<td align="left">day</td>
<td align="left">leaf</td>
<td align="right">2019</td>
<td align="right">14H 17M 0S</td>
<td align="right">17H 51M 0S</td>
</tr>
<tr class="even">
<td align="left">perc</td>
<td align="left">night</td>
<td align="left">air</td>
<td align="right">2018</td>
<td align="right">20H 34M 0S</td>
<td align="right">22H 43M 0S</td>
</tr>
<tr class="odd">
<td align="left">perc</td>
<td align="left">night</td>
<td align="left">air</td>
<td align="right">2019</td>
<td align="right">20H 30M 0S</td>
<td align="right">23H 32M 0S</td>
</tr>
<tr class="even">
<td align="left">perc</td>
<td align="left">night</td>
<td align="left">flower</td>
<td align="right">2018</td>
<td align="right">21H 0M 0S</td>
<td align="right">22H 50M 0S</td>
</tr>
<tr class="odd">
<td align="left">perc</td>
<td align="left">night</td>
<td align="left">flower</td>
<td align="right">2019</td>
<td align="right">20H 44M 0S</td>
<td align="right">23H 18M 0S</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ggplot(meta, aes(x=paste(Expt, Site, Year), y=Total/60, color=Tissue)) + 
  geom_point(position=position_dodge(width=0.3))+
  theme_minimal() + theme(axis.text.x=element_text(angle=90)) + 
  ggtitle(&quot;Total sampling duration&quot;)+
  ylab(&quot;Equilibration plus pumping time (min)&quot;)</code></pre>
<p><img src="plots/times-2.svg" width="768" /></p>
</div>
<div id="otc-actual-temperature" class="section level2">
<h2>OTC actual temperature</h2>
<pre class="r"><code>ggplot(meta %&gt;% filter(Expt==&quot;otc&quot;, temp !=&quot;air&quot;, Site != &quot;bb&quot;), 
       aes(y=mean_temp_C_treatment, x=paste(Year, Site, temp), color=temp)) +
  facet_grid(cols=vars(DN), scales=&quot;free_x&quot;, space=&quot;free_x&quot;)+ 
  geom_boxplot(outlier.shape=NA)+ geom_point(alpha=0.2)+ 
  geom_path(aes(group=paste(Year, Site, Pump_datehour)), color=&quot;black&quot;, alpha=0.3)+
  theme_minimal() + theme(axis.text.x=element_text(angle=90)) + 
  scale_color_brewer(palette = &quot;Set1&quot;, direction=-1)+
  labs(y=&quot;Mean hourly temperature (\u00B0C)&quot;, x=(&quot;Year, site&quot;), color=&quot;Temperature&quot;)</code></pre>
<p><img src="plots/actualtemp-1.svg" width="768" /></p>
<pre class="r"><code>ggplot(meta %&gt;% filter(Expt==&quot;otc&quot;, temp !=&quot;air&quot;, Site != &quot;bb&quot;), 
       aes(y=mean_temp_C_warmed, x=mean_temp_C_control, color=DN))+
  geom_abline(slope=1, intercept=0)+ geom_smooth(se=F)+
  geom_text(aes(label=round(mean_temp_C_warmed-mean_temp_C_control)), alpha=0.2)+ theme_minimal() +
  labs(x= &quot;Mean temperature, controls (\u00B0C)&quot;, y=&quot;Mean temperature, warmed (\u00B0C)&quot;, color=&quot;Time&quot;)</code></pre>
<p><img src="plots/actualtemp-2.svg" width="768" /></p>
<pre class="r"><code>ggplot(meta %&gt;% filter(Expt==&quot;otc&quot;, temp !=&quot;air&quot;, Site != &quot;bb&quot;), 
       aes(y=mean_temp_C_warmed-mean_temp_C_control, x=hour(Pump), color=DN))+
  geom_point(alpha=0.1)+geom_smooth(aes(group=paste(Site, Year, DN)), se=F, method=&quot;lm&quot;)+ theme_minimal() +
    labs(x= &quot;Time of day&quot;, y=&quot;Temperature difference (\u00B0C)&quot;, color=&quot;Time&quot;)</code></pre>
<p><img src="plots/actualtemp-3.svg" width="768" /></p>
<pre class="r"><code>meta %&gt;% filter(Expt==&quot;otc&quot;, temp !=&quot;air&quot;, Site != &quot;bb&quot;) %&gt;% 
  mutate(mean_temp_C_diff = mean_temp_C_warmed-mean_temp_C_control) %&gt;% 
  group_by(DN) %&gt;% summarize(mean_temp_C_diff.SD = sd(mean_temp_C_diff, na.rm=T), 
                             mean_temp_C_diff = mean(mean_temp_C_diff, na.rm=T)) %&gt;% 
  kable(caption=&quot;temp difference during sampling&quot;)</code></pre>
<table>
<caption>temp difference during sampling</caption>
<thead>
<tr class="header">
<th align="left">DN</th>
<th align="right">mean_temp_C_diff.SD</th>
<th align="right">mean_temp_C_diff</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">day</td>
<td align="right">2.5252856</td>
<td align="right">5.308540</td>
</tr>
<tr class="even">
<td align="left">night</td>
<td align="right">0.4074518</td>
<td align="right">1.033114</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ggplot(meta %&gt;% filter(Expt==&quot;otc&quot;, temp !=&quot;air&quot;, Site != &quot;bb&quot;), 
       aes(y=mean_temp_C_warmed-mean_temp_C_control, x=mean_temp_C_control, color=DN))+
  geom_point(alpha=0.1)+geom_smooth(aes(group=paste(Site, Year, DN)), se=F, method=&quot;lm&quot;)+ theme_minimal() +
      labs(x= &quot;Mean temperature, controls (\u00B0C)&quot;, y=&quot;Temperature difference (\u00B0C)&quot;, color=&quot;Time&quot;)</code></pre>
<p><img src="plots/actualtemp-4.svg" width="768" /></p>
<pre class="r"><code>ggplot(meta %&gt;% filter(Expt==&quot;otc&quot;, temp !=&quot;air&quot;, Site != &quot;bb&quot;), 
       aes(x=hour(Pump), y=mean_temp_C_control, color=DN))+
  geom_point(alpha=0.1)+geom_smooth(aes(group=paste(Site, Year, DN)), se=F, method=&quot;lm&quot;)+ theme_minimal() +
  scale_x_continuous(n.breaks=20) +
      labs(x= &quot;Time of day&quot;, y=&quot;Temperature in controls (\u00B0C)&quot;, color=&quot;Time&quot;)</code></pre>
<p><img src="plots/actualtemp-5.svg" width="768" /></p>
</div>
</div>
<div id="filtering-criteria" class="section level1">
<h1>Filtering criteria</h1>
<div id="flowers" class="section level2">
<h2>Flowers</h2>
<pre class="r"><code>sv &lt;- meta %&gt;% drop_na(Filename)
#ipo.gc &lt;- ipo.all[sv$Filename,]

library(bouquet)
ipo.data.cut &lt;- ipo.data[ipo.data$Filename %in% sv$Filename,]
ipo.data.cut$Filename &lt;- sv$Filename[match(ipo.data.cut$Filename, sv$Filename)]
ipo.data.cut &lt;- ipo.data.cut[ipo.data.cut$Name != &quot;&quot;, ] #drop unidentified peaks
ipo.data.cut$Name &lt;- droplevels(ipo.data.cut$Name)
longdata &lt;- load_longdata(ipo.data.cut, sample=&quot;Filename&quot;, RT=&quot;Ret.Time&quot;, name=&quot;Name&quot;, area=&quot;Area&quot;, match = &quot;SI&quot;, maxmatch=100)
metadata &lt;- sv %&gt;% as.data.frame() %&gt;% #tibbles break bouquet&#39;s add_count_freqs
  rename(thesample=sample) %&gt;% #name conflict with bouquet
  mutate(Tissue = fct_recode(Tissue, ambient=&quot;air&quot;, floral=&quot;flower&quot;, leaf=&quot;leaf&quot;),
         PlantType = factor(if_else(Tissue==&quot;leaf&quot;,paste0(PlantType,Tissue), as.character(PlantType)))) %&gt;% 
  load_metadata(date=&quot;Date&quot;, sample=&quot;Filename&quot;, group=&quot;PlantType&quot;, type=&quot;Tissue&quot;)
vol.all &lt;- make_sampletable(longdata, metadata)
chems &lt;- make_chemtable(longdata, metadata)

### Flower filtering
chemsf &lt;- chems %&gt;%
  filter_RT(2, 17) %&gt;% 
  filter_match(0.8) %&gt;% 
  filter_freq(0.1, group = TRUE) %&gt;% #now filter separately for each species
  filter_contaminant(cont.list = c(&quot;Hexyl chloroformate&quot;, &quot;Disulfide, di-tert-dodecyl&quot;,
                                   &quot;2,2,4-Trimethyl-1,3-pentanediol diisobutyrate&quot;, 
                                   &quot;2,4,6-trimethyloctane&quot;, 
                                   &quot;Decane, 3,8-dimethyl-&quot;,    &quot;Ethanone, 1-cyclopentyl-&quot;, 
                                   &quot;o-Xylene&quot;,
                                   &quot;3,5-dimethyloctane&quot;,&quot;2-hexyldecan-1-ol&quot;,
                                   &quot;nonylcyclopropane&quot;,&quot;nonyl prop-1-en-2-yl carbonate&quot;)) %&gt;% 
  filter_area(min_maximum = 1e6) %&gt;% 
  filter_ambient_ratio(vol.all, metadata, ratio = 3) %&gt;%
  combine_filters() 
chemsf$filter_final &lt;- with(chemsf, (filter_RT == &quot;OK&quot; &amp; filter_match ==&quot;OK&quot; &amp; 
                              (filter_freq.agg == &quot;OK&quot; | filter_freq.ten ==&quot;OK&quot;) &amp; 
                              filter_area == &quot;OK&quot; &amp; filter_contaminant == &quot;OK&quot;) | 
                              name %in% c(&quot;indole&quot;))#quant_betterthan_qual #manually include indole (rare)

#now run t-tests after rarity filtering
#don&#39;t filter by ambient ratio first, see paper on problems: https://doi.org/10.1186/1471-2105-11-450
chemsf &lt;- bind_rows(chemsf %&gt;% filter(filter_final) %&gt;% 
  filter_ambient_ttest(prune_sampletable(vol.all, chemsf, metadata), 
                       metadata, alpha = 0.05, adjust = &quot;fdr&quot;), 
  chemsf %&gt;% filter(!filter_final)) %&gt;% 
  mutate(filter_ambient_ttest=fct_na_value_to_level(filter_ambient_ttest, &quot;notchecked&quot;),
         filter_final = filter_final &amp; filter_ambient_ratio ==&quot;OK&quot;) %&gt;% 
  arrange(match(name, colnames(vol.all)))

bouquet::plot_filters(chemsf, option=&quot;rarity&quot;, yrange=3.5)</code></pre>
<p><img src="plots/filtering-1.svg" width="1152" /></p>
<pre class="r"><code>bouquet::plot_filters(chemsf, option=&quot;ambient&quot;, yrange=2.5)</code></pre>
<p><img src="plots/filtering-2.svg" width="1152" /></p>
<pre class="r"><code>bouquet::plot_filters(chemsf, option=&quot;volcano&quot;, yrange=2.5, alpha_excluded = 0.5)</code></pre>
<p><img src="plots/filtering-3.svg" width="1152" /></p>
<pre class="r"><code>bouquet::plot_filters(chemsf, option=&quot;prop&quot;)</code></pre>
<p><img src="plots/filtering-4.svg" width="1152" /></p>
<div id="retention-times" class="section level3">
<h3>Retention times</h3>
<pre class="r"><code>longdata.RT &lt;- longdata %&gt;% filter(name %in% chemsf$name[chemsf$filter_final]) %&gt;% 
  left_join(select(metadata, sample, Year)) %&gt;%
  group_by(name) %&gt;%  mutate(n=n(), RT.sd=sd(RT)) %&gt;% ungroup() %&gt;% 
  mutate(name=fct_reorder(name, RT))

RT.year &lt;- longdata.RT %&gt;% group_by(name, Year) %&gt;% summarize(RT=median(RT)) %&gt;% pivot_wider(names_from=Year, values_from=RT) %&gt;% 
  mutate(mean1821 = (`2018`+`2021`)/2, diff1819=`2018`-`2019`, diff1921=`2019`-`2021`,
         mean1821 = replace_na(mean1821, `2019`))

RT.tol &lt;- 0.17  # 10 seconds before or after in quantitative params
ggplot(longdata.RT, aes(x=RT, y=name,color=RT.sd)) + geom_point(position=position_jitter(width=0, height=0.5)) + 
  scale_color_viridis_c(option=&quot;magma&quot;) + theme_dark()+
  geom_text(aes(x=4.5, label=n), color=&quot;grey80&quot;) +
  stat_summary(fun=&quot;median&quot;, fun.max=~median(.x)+RT.tol, fun.min=~median(.x)-RT.tol, geom=&quot;pointrange&quot;, color=&quot;white&quot;, size=0.5, shape=15)</code></pre>
<p><img src="plots/retention-1.svg" width="1152" /></p>
<pre class="r"><code>ggplot(longdata.RT,  aes(y=RT, x=factor(Year), color=RT.sd)) + 
  facet_wrap(vars(name), scales=&quot;free_y&quot;) + geom_boxplot() + scale_color_viridis_c(option=&quot;magma&quot;) + theme_dark() +
  geom_pointrange(data=RT.year, aes(y=mean1821, ymin=mean1821-0.1, ymax=mean1821+0.1, x=&quot;2019&quot;), color=&quot;blue&quot;)</code></pre>
<p><img src="plots/retention-2.svg" width="1152" /></p>
<pre class="r"><code>#RT fixes
longdata.bergamotene &lt;- longdata %&gt;% filter(str_detect(name , &quot;bergamotene&quot;)) %&gt;% 
    left_join(select(metadata, sample, Year)) 
ggplot(longdata.bergamotene, aes(x=RT, fill=factor(Year))) + geom_histogram(binwidth=0.02) + 
  facet_wrap(vars(name), ncol=1) + scale_x_continuous(limits=c(NA,16))</code></pre>
<p><img src="plots/retention-3.svg" width="1152" /></p>
<pre class="r"><code>longdata.bergamotene %&gt;% filter(RT &lt; 15) %&gt;%  group_by(Year) %&gt;% summarize(RT=median(RT)) %&gt;% kable(digits=2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">Year</th>
<th align="right">RT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2018</td>
<td align="right">14.70</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="right">14.67</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="right">14.64</td>
</tr>
</tbody>
</table>
<pre class="r"><code>longdata.butanoate &lt;- longdata %&gt;% filter(str_detect(name , &quot;\\)-hex-3-enyl\\] butanoate&quot;)) %&gt;% 
    left_join(select(metadata, sample, Year)) 
ggplot(longdata.butanoate, aes(x=RT, fill=factor(Year))) + geom_histogram(binwidth=0.02) + 
  facet_wrap(vars(name), ncol=1) + scale_x_continuous(limits=c(NA,NA))</code></pre>
<p><img src="plots/retention-4.svg" width="1152" /></p>
<pre class="r"><code>longdata.butanoate %&gt;% mutate(EZ=ifelse(RT&gt;11, &quot;Z&quot;,&quot;E&quot;)) %&gt;% group_by(EZ, Year) %&gt;% 
  summarize(RT=median(RT)) %&gt;% kable(digits=2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">EZ</th>
<th align="right">Year</th>
<th align="right">RT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">E</td>
<td align="right">2018</td>
<td align="right">10.69</td>
</tr>
<tr class="even">
<td align="left">E</td>
<td align="right">2019</td>
<td align="right">10.66</td>
</tr>
<tr class="odd">
<td align="left">E</td>
<td align="right">2021</td>
<td align="right">10.64</td>
</tr>
<tr class="even">
<td align="left">Z</td>
<td align="right">2018</td>
<td align="right">11.35</td>
</tr>
<tr class="odd">
<td align="left">Z</td>
<td align="right">2019</td>
<td align="right">11.32</td>
</tr>
<tr class="even">
<td align="left">Z</td>
<td align="right">2021</td>
<td align="right">11.30</td>
</tr>
</tbody>
</table>
</div>
<div id="quant-filtering" class="section level3">
<h3>Quant filtering</h3>
<pre class="r"><code>indole_quantqual &lt;- left_join(quant.meta, 
                              bind_cols(metadata %&gt;% select(Year, Folder, type, Expt, PlantType, DN, RunDate, Filename=sample),
                              indole_quant=quant.scaled[as.character(metadata$sample),&quot;indole&quot;], 
                              indole_qual=vol.all[as.character(metadata$sample),&quot;indole&quot;]) %&gt;%
  mutate(GCOrder = as.integer(str_match(Filename, &quot;_([0-9][0-9]).qgd&quot;)[,2]),
         Folder=str_remove(Folder,&quot;Campbell RMBL Data/&quot;))) %&gt;% 
  mutate(type=coalesce(type, c(&quot;other&quot;,&quot;blank&quot;)[isblank+1]) %&gt;% fct_relevel(&quot;other&quot;,&quot;blank&quot;))
  
indole_quantqual %&gt;% arrange(RunDate, GCOrder) %&gt;%
  select(Year, Folder, type, Expt, PlantType, DN, Filename, 
         RunDate, GCOrder, indole_quant, indole_qual) %&gt;% 
  write_tsv(&quot;~/Downloads/indole_quant_qual.tsv&quot;, na=&quot;&quot;)

typecols &lt;- c(other=&quot;orange&quot;, blank=&quot;grey&quot;, ambient=&quot;blue&quot;,floral=&quot;red&quot;,leaf=&quot;limegreen&quot;)
ggplot(filter(indole_quantqual, type!=&quot;leaf&quot;), aes(color=type, fill=type, x=indole_quant)) + 
  facet_wrap(vars(Year), ncol=1) + geom_density(alpha=0.1, size=0.7) + 
  geom_point(aes(y=0.07-as.integer(factor(type))/100), size=3, shape=&quot;|&quot;) +
  scale_x_sqrt() + coord_cartesian(ylim=c(0,0.06)) + theme_minimal() + theme(legend.position=&quot;top&quot;) +
  scale_color_manual(values=typecols) +  scale_fill_manual(values=typecols) + 
  labs(x=&quot;Quantitative indole integration&quot;, y=&quot;Density&quot;) </code></pre>
<p><img src="plots/filtering_quant-1.svg" width="1152" /></p>
<pre class="r"><code>ggplot(filter(indole_quantqual, type!=&quot;leaf&quot;) %&gt;% drop_na(Year), aes(color=type, y=indole_quant, x=RunDate)) + 
  facet_wrap(vars(Year), nrow=1, scales=&quot;free_x&quot;) + geom_hline(yintercept=0) + geom_point(alpha=0.5) + 
  stat_summary(geom=&quot;line&quot;, fun=&quot;mean&quot;, size=1)+
  scale_y_sqrt()  + theme_bw()+ scale_x_date(guide = guide_axis(angle=90))+
  scale_color_manual(values=typecols) +
  labs(y=&quot;Quantitative indole integration&quot;, &quot;Date of GC run&quot;) </code></pre>
<p><img src="plots/filtering_quant-2.svg" width="1152" /></p>
<pre class="r"><code>ggplot(indole_quantqual %&gt;% filter(type!=&quot;leaf&quot;, Year!=2018), aes(color=type, y=indole_quant, x=GCOrder)) + 
  facet_wrap(vars(Year), nrow=1, scales=&quot;free_x&quot;) + geom_hline(yintercept=0) + geom_point(alpha=0.5) + 
  stat_summary(aes(group=paste(type)), geom=&quot;line&quot;, fun=&quot;mean&quot;, size=1.5)+
  scale_y_sqrt()  + theme_bw()+ 
  scale_color_manual(values=typecols)+
  labs(y=&quot;Quantitative indole integration&quot;, x=&quot;Order in GC run&quot;)</code></pre>
<p><img src="plots/filtering_quant-3.svg" width="1152" /></p>
<pre class="r"><code>indole_quantqual %&gt;% group_by(Year, type) %&gt;% summarize(indole_quant=mean(indole_quant)) %&gt;%
  pivot_wider(names_from=&quot;type&quot;,values_from=indole_quant) %&gt;% 
  kable(caption=&quot;means&quot;, digits=0)</code></pre>
<table>
<caption>means</caption>
<thead>
<tr class="header">
<th align="right">Year</th>
<th align="right">other</th>
<th align="right">blank</th>
<th align="right">ambient</th>
<th align="right">floral</th>
<th align="right">leaf</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2017</td>
<td align="right">445340</td>
<td align="right">107545</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="right">1072603</td>
<td align="right">53192</td>
<td align="right">1976</td>
<td align="right">2528</td>
<td align="right">5108</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="right">305741</td>
<td align="right">24008</td>
<td align="right">11590</td>
<td align="right">25322</td>
<td align="right">14682</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="right">1716607</td>
<td align="right">39394</td>
<td align="right">83865</td>
<td align="right">90400</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">2022</td>
<td align="right">69020</td>
<td align="right">11404</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">NA</td>
<td align="right">5064119</td>
<td align="right">7321</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<pre class="r"><code>indole_quantqual %&gt;% group_by(Year, type) %&gt;% summarize(nonzero=mean(indole_quant&gt;0)) %&gt;%
  pivot_wider(names_from=&quot;type&quot;,values_from=nonzero) %&gt;% 
  kable(caption=&quot;proportion indole detection (nonzero)&quot;, digits=3)</code></pre>
<table>
<caption>proportion indole detection (nonzero)</caption>
<thead>
<tr class="header">
<th align="right">Year</th>
<th align="right">other</th>
<th align="right">blank</th>
<th align="right">ambient</th>
<th align="right">floral</th>
<th align="right">leaf</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2017</td>
<td align="right">0.929</td>
<td align="right">0.523</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="right">0.714</td>
<td align="right">0.358</td>
<td align="right">0.462</td>
<td align="right">0.478</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="right">0.577</td>
<td align="right">0.607</td>
<td align="right">0.952</td>
<td align="right">1.000</td>
<td align="right">0.98</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="right">0.929</td>
<td align="right">0.859</td>
<td align="right">1.000</td>
<td align="right">0.986</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">2022</td>
<td align="right">0.901</td>
<td align="right">0.585</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">NA</td>
<td align="right">0.699</td>
<td align="right">0.812</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<pre class="r"><code>quant.scaled.meta &lt;- left_join(quant.meta,  
                       bind_cols(metadata %&gt;% select(Year, Folder, type, Expt, PlantType, DN, RunDate, Filename=sample),
                                 quant.scaled[as.character(metadata$sample),])) %&gt;% 
  drop_na(type) %&gt;% 
  pivot_longer(all_of(colnames(quant.scaled))) 

LoA.cutoff &lt;- 0.8
quant.loa &lt;- quant.scaled.meta %&gt;%
  group_by(Year, type, name) %&gt;% summarize(value=quantile(value, LoA.cutoff), .groups=&quot;drop&quot;)

ggplot(quant.loa, aes(y=fct_reorder(name, value, max), color=type, x=value, shape=factor(Year), group=factor(Year))) +
  geom_point(position=position_dodge(width=0.5)) + theme_minimal() +
  scale_x_sqrt() +  scale_color_manual(values=c(&quot;blue&quot;,&quot;red&quot;,&quot;green&quot;))</code></pre>
<p><img src="plots/calc_LoA-1.svg" width="1056" /></p>
<pre class="r"><code>quant.loa %&gt;% pivot_wider(names_from=type, values_from=value) %&gt;%
  ggplot(aes(x=floral/ambient, y=fct_reorder(name, floral/ambient, min)))  + 
  geom_point(aes(color=factor(Year), shape=name %in% (chemsf %&gt;% filter(filter_final) %&gt;% pull(name))), size=2) + 
  scale_x_log10() + scale_shape_manual(values=c(1, 19))+
  labs(x=paste0(&quot;Ratio of &quot;,round(LoA.cutoff*100,0),&quot;th percentile floral/ambient&quot;), y=&quot;&quot;, color=&quot;Year&quot;, shape=&quot;Keep&quot;)</code></pre>
<p><img src="plots/calc_LoA-2.svg" width="1056" /></p>
<pre class="r"><code>prop.above &lt;- left_join(quant.scaled.meta %&gt;% filter(type==&quot;floral&quot;),
          quant.loa %&gt;% filter(type==&quot;ambient&quot;) %&gt;% rename(LoA=value) %&gt;% select(-type)) %&gt;% 
  group_by(Year, name) %&gt;% summarize(above_LoA = mean(value &gt; LoA),
                                     above_zero = mean(value &gt; 0)) %&gt;% 
  mutate(name=fct_reorder(name, above_LoA, max))

ggplot(prop.above %&gt;%   pivot_longer(starts_with(&quot;above_&quot;), names_to=&quot;limit&quot;), 
       aes(y=name, x=value, color=limit, shape=factor(Year), group=limit)) + 
  geom_point(size=2, position=position_dodge(width=0.5)) + theme_minimal()</code></pre>
<p><img src="plots/calc_LoA-3.svg" width="1056" /></p>
<pre class="r"><code>ggplot(prop.above, aes(x=above_zero, y=above_LoA, color=factor(Year))) + 
  geom_path(aes(group=name), color=&quot;grey90&quot;) + geom_text(aes(label=name)) +theme_minimal()</code></pre>
<p><img src="plots/calc_LoA-4.svg" width="1056" /></p>
<pre class="r"><code>ggplot(quant.scaled.meta %&gt;% filter(name==&quot;a-pinene&quot;), aes(x=factor(Year), color=type, y=value)) + geom_boxplot() + scale_y_sqrt()  + scale_color_manual(values=c(&quot;blue&quot;,&quot;red&quot;,&quot;green&quot;)) + labs(title=&quot;quant&quot;)
ggplot(metadata, aes(x=factor(Year), color=type, y=vol.all$`a-pinene`)) + geom_boxplot() + scale_y_sqrt() + scale_color_manual(values=c(&quot;blue&quot;,&quot;red&quot;,&quot;green&quot;)) + labs(title=&quot;qual&quot;)
#ggplot(svf, aes(x=Year, y=vol$`a-pinene`)) + geom_boxplot(color=&quot;red&quot;) + scale_y_sqrt() + labs(title=&quot;qual or quant&quot;)
pinene_quantqual &lt;- left_join(quant.meta, 
                              bind_cols(metadata %&gt;% select(Year, Folder, type, Expt, PlantType, DN, RunDate, Filename=sample),
                              pinene_quant=quant.scaled[as.character(metadata$sample),&quot;a-pinene&quot;], 
                              pinene_qual=vol.all[as.character(metadata$sample),&quot;a-pinene&quot;]) )
ggplot(pinene_quantqual %&gt;% filter(Year %in% c(2018, 2019,2021)), aes(x=pinene_qual, y=pinene_quant)) + geom_point() + facet_wrap(vars(Year))</code></pre>
</div>
</div>
<div id="leaves" class="section level2">
<h2>Leaves</h2>
<pre class="r"><code>### Leaf filtering
meta.leaf &lt;- metadata %&gt;% mutate(type = fct_recode(type, floral = &quot;leaf&quot;, flower = &quot;floral&quot;))  #trick bouquet to think the leaf samples are floral TODO: hacky!
chems.leaf &lt;- make_chemtable(longdata, meta.leaf) 
chemsf.leaf &lt;- chems.leaf %&gt;%
  filter_RT(2, 17) %&gt;% 
  filter_match(0.8) %&gt;% 
  filter_freq(0.25, group = TRUE) %&gt;%  #now filter separately for each species
  filter_contaminant(cont.list = c(&quot;Hexyl chloroformate&quot;,&quot;Acetic acid, trifluoro-, undecyl ester&quot;,
                                   &quot;Hexylene glycol&quot;)) %&gt;% 
  filter_area(min_maximum = 5e5) %&gt;% 
  filter_ambient_ratio(vol.all, meta.leaf, ratio = 4) %&gt;%
  combine_filters()
chemsf.leaf$filter_final &lt;- with(chemsf.leaf, filter_RT == &quot;OK&quot; &amp; filter_match ==&quot;OK&quot; &amp; 
                              (filter_freq.aggleaf == &quot;OK&quot; | filter_freq.tenleaf ==&quot;OK&quot;) &amp; 
                              filter_area == &quot;OK&quot; &amp;
                              filter_contaminant == &quot;OK&quot;)
#TODO bouquet needs to do a one-sided t-test! some compounds lower in blanks got a pass with low p value!

chemsf.leaf &lt;- bind_rows(chemsf.leaf %&gt;% filter(filter_final) %&gt;% 
  filter_ambient_ttest(prune_sampletable(vol.all, chemsf.leaf, metadata), 
                       metadata, alpha = 0.05, adjust = &quot;fdr&quot;), 
  chemsf.leaf %&gt;% filter(!filter_final)) %&gt;% 
  mutate(filter_ambient_ttest=fct_na_value_to_level(filter_ambient_ttest, &quot;notchecked&quot;),
         filter_final = filter_final &amp; filter_ambient_ratio ==&quot;OK&quot;)  %&gt;% 
  arrange(match(name, colnames(vol.all)))

bouquet::plot_filters(chemsf.leaf, option=&quot;rarity&quot;)</code></pre>
<p><img src="plots/filtering_leaf-1.svg" width="1152" /></p>
<pre class="r"><code>bouquet::plot_filters(chemsf.leaf, option=&quot;ambient&quot;, yrange=2.5)</code></pre>
<p><img src="plots/filtering_leaf-2.svg" width="1152" /></p>
<pre class="r"><code>bouquet::plot_filters(chemsf.leaf, option=&quot;volcano&quot;, yrange=2, alpha_excluded = 0.5)</code></pre>
<p><img src="plots/filtering_leaf-3.svg" width="1152" /></p>
<pre class="r"><code>bouquet::plot_filters(chemsf.leaf, option=&quot;prop&quot;)</code></pre>
<p><img src="plots/filtering_leaf-4.svg" width="1152" /></p>
<pre class="r"><code>#compare amounts in floral vs. leaf samples
chemsf &lt;- chemsf %&gt;% mutate(filter_ambient_leaf_ratio = chemsf.leaf$filter_ambient_ratio,
                            filter_ambient_leaf_ttest = chemsf.leaf$filter_ambient_ttest,
                            leaf_not_flower = filter_ambient_leaf_ratio==&quot;OK&quot; &amp; filter_ambient_leaf_ttest==&quot;OK&quot; &amp; 
                              !(filter_ambient_ratio==&quot;OK&quot; &amp; filter_ambient_ttest==&quot;OK&quot;))

kept_either &lt;- chemsf$filter_final | chemsf.leaf$filter_final
ggplot(chemsf[kept_either,], aes(x=mean.floral, y= chemsf.leaf[kept_either,&quot;mean.floral&quot;], label=name, color=paste(filter_final,chemsf.leaf[kept_either,&quot;filter_final&quot;], sep=&quot;, &quot;)))+ theme_minimal()+
  geom_abline(slope=1, intercept=1) +   geom_point(aes(size=RT), alpha=0.3)+  geom_text()+ 
  scale_x_log10()+ scale_y_log10() + coord_fixed()+
  scale_color_manual(labels=c(&quot;leaf&quot;,&quot;floral&quot;,&quot;both&quot;),values=c(&quot;darkgreen&quot;,&quot;red&quot;,&quot;blue&quot;))+
  labs(x=&quot;Mean area in flowers&quot;, y= &quot;Mean area in leaves&quot;, color=&quot;Kept in dataset&quot;)</code></pre>
<p><img src="plots/filtering_leaf-5.svg" width="1152" /></p>
</div>
<div id="pruning" class="section level2">
<h2>Pruning</h2>
<pre class="r"><code>vol &lt;- prune_sampletable(vol.all, chemsf, metadata)
vol.leaf &lt;- prune_sampletable(vol.all, chemsf.leaf, meta.leaf)

colnames(vol)[!colnames(vol) %in% shortnames]</code></pre>
<pre><code>character(0)</code></pre>
<pre class="r"><code>names(head(sort(rowSums(vol&gt;0)), 5))</code></pre>
<pre><code>[1] &quot;A188DAug16_09012018.qgd&quot;          &quot;GNA_17_210716_7202021_18.qgd&quot;    
[3] &quot;Maxfield_27_210723_822021_03.qgd&quot; &quot;Maxfield_9_210723_822021_05.qgd&quot; 
[5] &quot;T196DAug16_09012018.qgd&quot;         </code></pre>
<pre class="r"><code>files_exclude &lt;- c(&quot;GNA_17_210716_7202021_18.qgd&quot;, &quot;A188DAug16_09012018.qgd&quot;, &quot;T196DAug16_09012018.qgd&quot;,
                   &quot;T145DWarmAug10_08292018.qgd&quot;, &quot;Maxfield_27_210723_822021_03.qgd&quot;, #filtered volatiles near zero
                   &quot;SC_91_210715_8202021_10.qgd&quot;) #Artemisia leaves
#&quot;OTC_Z2_leaf_190805_8102019_23.qgd&quot; was excluded
files_exclude_leaf &lt;- c(&quot;CWH1LeafJuly27_09022018.qgd&quot;,&quot;NatArea69leafrenamedJuly25_08312018.qgd&quot;, #lack leaf mass
                        &quot;T164_leaf_190731_882019_18.qgd&quot;) #no filtered volatiles

svf &lt;- metadata[metadata$type == &quot;floral&quot; &amp; !(metadata$sample %in% files_exclude),]
svl &lt;- metadata[metadata$type == &quot;leaf&quot; &amp; !(metadata$sample %in% files_exclude_leaf),]

svf$Year &lt;- factor(svf$Year)
svf &lt;- svf %&gt;% mutate_if(is.factor, droplevels) %&gt;% 
  mutate(Treat = paste(temp, Temp) %&gt;% 
           fct_collapse(control=c(&quot;control NA&quot;,&quot;NA cool&quot;),warmed=c(&quot;NA warm&quot;,&quot;warmed NA&quot;)))
svl &lt;- svl %&gt;% mutate_if(is.factor, droplevels) %&gt;% 
  mutate(Treat = paste(temp, Temp) %&gt;% 
           fct_collapse(control=c(&quot;control NA&quot;,&quot;NA cool&quot;),warmed=c(&quot;NA warm&quot;,&quot;warmed NA&quot;)))

vol &lt;- vol[!(rownames(vol) %in% files_exclude) ,]
vol.leaf &lt;- vol.leaf[!(rownames(vol.leaf) %in% files_exclude_leaf) ,]</code></pre>
<pre class="r"><code>#TODO quant integrate these leaf volatiles: setdiff(colnames(vol.leaf), quant_betterthan_qual)

#quantitative integrations (scaled up to match qual integrations)
#this method only replaces compounds where the quant method did better than the qual method
quant.scaled.vol &lt;- quant.scaled[rownames(vol), 
                                 colnames(quant.scaled) %in% 
                                   intersect(quant_betterthan_qual, colnames(vol))] 

#TODO found that E/Z isomers of b-ocimene were accurate underneath LoA, dropping this step for all but indole (the manual addition to the auto filtering)
# Subtract limit of ambient (LoA) from each compound/year
quant.loa.use &lt;- left_join(tibble(name= colnames(quant.scaled.vol)),
                           quant.loa %&gt;% filter(type==&quot;ambient&quot;, name %in% quant_betterthan_qual) %&gt;%
                             pivot_wider(names_from=Year, values_from=value))
# for(yr in levels(svf$Year)) {
#   thisyr &lt;- svf$Year==yr
#   quant.scaled.vol[thisyr,] &lt;- sweep(quant.scaled.vol[thisyr,], 2, pull(quant.loa.use, yr), FUN = &#39;-&#39;)
# }

for(yr in levels(svf$Year)) {
  thisyr &lt;- svf$Year==yr
  quant.scaled.vol[thisyr,&quot;indole&quot;] &lt;- quant.scaled.vol[thisyr,&quot;indole&quot;] - (quant.loa.use %&gt;% filter(name==&quot;indole&quot;) %&gt;% pull(yr))
}

#Set resulting negative values to zero
quant.scaled.vol[quant.scaled.vol&lt;0] &lt;- 0

#plot(x=unlist(sqrt(vol[,colnames(quant.scaled.vol)])), y=sqrt(unlist(quant.scaled.vol)), xlab=&quot;qual&quot;, ylab=&quot;quant&quot;)
# svf %&gt;% as_tibble() %&gt;% select(sample, Year, PlantType, Expt, DN) %&gt;% 
#   bind_cols(indole_qual = vol$indole, indole_quant = quant.all[rownames(vol),]$indole) %&gt;% 
#   filter(PlantType==&quot;ten&quot;) %&gt;% drop_na(PlantType) %&gt;% 
#   arrange(Year, Expt, DN) %&gt;% View()
#   write_tsv(&quot;~/Downloads/indole_quant_qual_comparison.tsv&quot;) %&gt;% 
#   ggplot(aes(x=indole_qual, y=indole_quant/0.325))+geom_point() + geom_abline(slope=1, intercept = 0)

#swap in scaled and subtracted quant integrations
vol[,colnames(quant.scaled.vol)] &lt;- quant.scaled.vol

# ggplot(bind_cols(vol, svf), aes(y=`indole`, x=`methyl benzoate`, col=Year)) + 
#   geom_point() + geom_smooth(se=F) + scale_x_sqrt(limits=c(0,1.1e6)) + scale_y_sqrt(limits=c(0,6e5)) + geom_rug() + 
#   geom_hline(data=quant.loa %&gt;% filter(name==&quot;indole&quot;, type==&quot;ambient&quot;), aes(yintercept=value, color=as.character(Year))) +
#   geom_vline(data=quant.loa %&gt;% filter(name==&quot;methyl benzoate&quot;, type==&quot;ambient&quot;), aes(xintercept=value, color=as.character(Year))) 

ggplot(bind_cols(vol, svf), aes(y=`(Z)-b-ocimene`, x=`(E)-b-ocimene`, color=Year)) + 
  geom_point() + geom_smooth(se=F) + scale_x_sqrt() + scale_y_sqrt() + geom_rug() + 
  geom_hline(data=quant.loa %&gt;% filter(name==&quot;(Z)-b-ocimene&quot;, type==&quot;ambient&quot;), aes(yintercept=value, color=as.factor(Year))) +
  geom_vline(data=quant.loa %&gt;% filter(name==&quot;(E)-b-ocimene&quot;, type==&quot;ambient&quot;), aes(xintercept=value, color=as.factor(Year)))</code></pre>
<p><img src="plots/swapquant-1.svg" width="768" /></p>
<pre class="r"><code>ggplot(bind_cols(vol, svf), aes(y=`trans-a-bergamotene`, x=`a-farnesene`, color=Year, shape=PlantType)) + 
  geom_point() + geom_smooth(aes(linetype=PlantType), se=F, span=1) + scale_x_sqrt() + scale_y_sqrt() + geom_rug()</code></pre>
<p><img src="plots/swapquant-2.svg" width="768" /></p>
<pre class="r"><code>ggplot(bind_cols(vol, svf), aes(y=`(1Z,4Z,7Z)-1,5,9,9-tetramethylcycloundeca-1,4,7-triene`, x=`b-caryophyllene`, color=Year)) + 
  geom_point() + geom_smooth(se=F, span=1) + scale_x_sqrt() + scale_y_sqrt() + geom_rug() +
  geom_hline(data=quant.loa %&gt;% filter(name==&quot;(1Z,4Z,7Z)-1,5,9,9-tetramethylcycloundeca-1,4,7-triene&quot;, type==&quot;ambient&quot;), aes(yintercept=value, color=as.factor(Year))) +
  geom_vline(data=quant.loa %&gt;% filter(name==&quot;b-caryophyllene&quot;, type==&quot;ambient&quot;), aes(xintercept=value, color=as.factor(Year)))</code></pre>
<p><img src="plots/swapquant-3.svg" width="768" /></p>
</div>
<div id="convert-areas-to-mass" class="section level2">
<h2>Convert areas to mass</h2>
<pre class="r"><code>#Normalize emissions by equilibration and pumping time and sample
vol &lt;- vol / as.numeric(svf$Total, units=&quot;hours&quot;) / svf$NumFlrs #30 min of equilibration plus 15 minpumping, one flower 
vol.leaf &lt;- vol.leaf / as.numeric(svl$Total, units=&quot;hours&quot;) / svl$LeafDryWtGrams #area per hour per dry gram leaf

regressions &lt;- read_csv(&quot;data/volatiles/regressions_181921_filtered_slopes.csv&quot;)
ggplot(regressions, aes(x=year, y=standard, fill=area_per_ng))+ geom_tile() + scale_fill_viridis_c() + geom_text(aes(label=paste0(round(area_per_ng/1000),&quot;k&quot;))) + labs(x=&quot;Year, filament&quot;,y=&quot;Standard&quot;,fill=&quot;Area per ng&quot;) + theme_minimal()</code></pre>
<p><img src="plots/convert_areas-1.svg" width="768" /></p>
<pre class="r"><code># convert peak areas to nanograms using standards run in each year
ipochemsf &lt;- ipochems[match(colnames(vol), ipochems$shortname),]
svf$YearFilament &lt;- coalesce(svf$YearFilament, svf$Year) #if_else(svf$Year==&quot;2021&quot; &amp; date&gt;ymd(&quot;2021-07-21&quot;), &quot;2021fil2&quot;, as.character(svf$Year))
for(yr in levels(svf$YearFilament)) {
  thisyr &lt;- svf$YearFilament==yr
  #TODO these slopes are leading to most of the year effects. try using one year for now. 
  vol[thisyr,] &lt;- sweep(vol[thisyr,], 2, pull(ipochemsf, paste0(&quot;area_per_ng&quot;,&quot;2019&quot;)), FUN = &#39;/&#39;)
}
svf$Total &lt;- rowSums(vol)

ipochemsl &lt;- ipochems[match(colnames(vol.leaf), ipochems$shortname),]
vol.leaf &lt;- sweep(vol.leaf, 2, ipochemsl$area_per_ng2019, FUN = &#39;/&#39;)
svl$Total &lt;- rowSums(vol.leaf)</code></pre>
</div>
<div id="ambient-heatmap-and-nmds" class="section level2">
<h2>Ambient heatmap and NMDS</h2>
<pre class="r"><code>vol.pruned &lt;- vol.all[,chemsf$filter_final]
metadata$zeroSum &lt;- rowSums(vol.pruned)==0
vol.pruned &lt;- vol.pruned[!metadata$zeroSum,]

ph  &lt;- pheatmap(as.matrix(t(vol.pruned))^(1/3), 
         cluster_cols=T, show_colnames=F,
         clustering_method=&quot;mcquitty&quot;, clustering_distance_rows=&quot;correlation&quot;,
         clustering_distance_cols=vegdist(vol.pruned, method = &quot;bray&quot;),
         clustering_callback = function(hc, ...){dendsort(hc, type=&quot;average&quot;)},
         scale=&quot;none&quot;, color=inferno(512),
         annotation_col = data.frame(metadata %&gt;% filter(!zeroSum) %&gt;% select(&quot;Year&quot;, &quot;PlantType&quot;, &quot;expt&quot;, &quot;temp&quot;,&quot;DN&quot;,&quot;Site&quot;), row.names=rownames(vol.pruned)), 
   fontsize = 10, border_color = NA, legend=F, annotation_legend=T, cutree_rows=6
)</code></pre>
<p><img src="plots/heatmap_air-1.png" width="1152" /></p>
<pre class="r"><code>set.seed(1)
nmds.vol &lt;- metaMDS(sqrt(vol.pruned), dist=&quot;bray&quot;, autotransform = FALSE, trace=F, trymax=3)
ordiplot(nmds.vol, type = &quot;n&quot;)
text(nmds.vol, display=&quot;species&quot;, cex=0.7, col=&quot;grey20&quot;)
points(nmds.vol, display=&quot;sites&quot;, col=metadata$type, pch=as.integer(factor(metadata$Year)))</code></pre>
<p><img src="plots/nmds_air-1.svg" width="768" /></p>
<pre class="r"><code>best &lt;- list()
i &lt;- 1
vol.left &lt;- vol^(1/4) # halfway between areas and presence-absence
while(ncol(vol.left)&gt;0) {
  print(dim(vol.left))
  best[[i]] &lt;- which.max(rowSums(vol.left))
  vol.left &lt;- vol.left[ , !decostand(vol.left[best[[i]],], method=&quot;pa&quot;), drop=FALSE]
  i &lt;- i+1
}
best.vol &lt;- as.data.frame(t(vol[unlist(best),])) %&gt;% rownames_to_column(&quot;name&quot;)

#get quant.ratios from ipo_gc.R
full_join(quant.ratios %&gt;% mutate(name = shortnames[Name]), full_join(RT.year, best.vol)) %&gt;% relocate(name) %&gt;% 
  write_tsv(&quot;data/volatiles/quant_RT_ratios.tsv&quot;)</code></pre>
</div>
</div>
<div id="all-filtered-samples" class="section level1">
<h1>All filtered samples</h1>
<div id="flower-heatmap" class="section level2">
<h2>Flower heatmap</h2>
<pre class="r"><code>#cairo_pdf(&quot;ipo_heatmap.pdf&quot;, width=12, height=12)
ph  &lt;- pheatmap(as.matrix(t(decostand(vol, method=&quot;max&quot;)))^(1/3), 
         cluster_cols=T, show_colnames=F,
         clustering_method=&quot;mcquitty&quot;, clustering_distance_rows=&quot;correlation&quot;,
         clustering_distance_cols=vegdist(decostand(vol, method=&quot;max&quot;), method = &quot;bray&quot;),
         clustering_callback = function(hc, ...){dendsort(hc, type=&quot;average&quot;)},
         scale=&quot;none&quot;, color=inferno(512),
         annotation_col = data.frame(svf %&gt;% select(&quot;Year&quot;, &quot;PlantType&quot;, &quot;expt&quot;, &quot;Treat&quot;,&quot;DN&quot;,&quot;Site&quot;), row.names=rownames(vol)), 
   fontsize = 10, border_color = NA, legend=F, annotation_legend=T, cutree_rows=6
)</code></pre>
<p><img src="plots/heatmap-1.png" width="1152" /></p>
<pre class="r"><code>#dev.off()</code></pre>
</div>
<div id="flower-nmds" class="section level2">
<h2>Flower NMDS</h2>
<pre class="r"><code>set.seed(1)
nmds.vol &lt;- metaMDS(sqrt(vol), dist=&quot;bray&quot;, autotransform = FALSE, trace=F, trymax=3)

TEY &lt;- with(svf, factor(paste(PlantType,expt,Year)))
TEYcols &lt;- brewer.pal(9, &quot;Paired&quot;)#[c(1:4,8,5:6)]
spcols &lt;- c(agg=&quot;red&quot;, ten=&quot;violet&quot;)
ordiplot(nmds.vol, type = &quot;n&quot;)
text(nmds.vol, display=&quot;species&quot;, cex=0.7, col=&quot;grey20&quot;)
legend(&quot;topleft&quot;, levels(svf$DN), pch=c(1,4))
#legend(&quot;topright&quot;, levels(svf$PlantType), fill=spcols)
legend(&quot;bottomright&quot;, levels(svf$Year), fill=1:3)
#legend(&quot;bottomleft&quot;, levels(TEY), fill=TEYcols, cex=0.9)
#points(nmds.vol, display=&quot;sites&quot;, col=TEYcols[TEY], pch=c(13,19)[svf$DN])
#points(nmds.vol, display=&quot;sites&quot;, col=spcols[svf$PlantType], pch=c(13,19)[svf$DN])
points(nmds.vol, display=&quot;sites&quot;, col=svf$Year, pch=c(1,4)[svf$DN])</code></pre>
<p><img src="plots/nmds_filtered-1.svg" width="768" /></p>
<pre class="r"><code>#points(nmds.vol, display=&quot;sites&quot;, col=viridis(100)[sqrt(rowSums(vol))/100], pch=19)</code></pre>
</div>
<div id="average-composition" class="section level2">
<h2>Average composition</h2>
<pre class="r"><code>relamounts &lt;- svf %&gt;% select(expt, PlantType, DN) %&gt;% 
  bind_cols(decostand(vol, method=&quot;tot&quot;)) %&gt;% pivot_longer(all_of(colnames(vol))) %&gt;%
  group_by(expt, PlantType, DN, name) %&gt;% 
  summarize(mean=mean(value), se=sd(value)/sqrt(n())) %&gt;% arrange(expt, PlantType, DN, desc(mean))

ggplot(relamounts, aes(y=fct_reorder(name, mean, base::mean), x=mean, color=paste(PlantType, expt), shape=DN))+ 
  geom_pointrange(aes(xmin=mean-se, xmax=mean+se), position=position_dodge2(width=0.4)) + 
  scale_shape_manual(values=c(1,19)) +   scale_x_sqrt(expand=c(0,0), labels=scales::percent_format())+ 
  labs(x=&quot;Mean percentage&quot;,y=&quot;&quot;,color=&quot;Species&quot;, shape=&quot;Time&quot;)+
  scale_color_manual(values=c(&quot;orange&quot;,&quot;red&quot;,&quot;cyan&quot;,&quot;blue&quot;)) + theme_dark()</code></pre>
<p><img src="plots/comp-1.svg" width="1344" /></p>
<pre class="r"><code>relamounts %&gt;% slice_head(n=6) %&gt;% filter(expt==&quot;otc&quot;) %&gt;%  kable(digits=3)</code></pre>
<table>
<colgroup>
<col width="7%" />
<col width="14%" />
<col width="8%" />
<col width="52%" />
<col width="8%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">expt</th>
<th align="left">PlantType</th>
<th align="left">DN</th>
<th align="left">name</th>
<th align="right">mean</th>
<th align="right">se</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">otc</td>
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">a-pinene</td>
<td align="right">0.510</td>
<td align="right">0.019</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">(E)-hex-3-en-1-ol</td>
<td align="right">0.072</td>
<td align="right">0.007</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">(E)-b-ocimene</td>
<td align="right">0.060</td>
<td align="right">0.006</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">(Z)-b-ocimene</td>
<td align="right">0.054</td>
<td align="right">0.006</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">(2E)-2,7-dimethylocta-2,6-dien-1-ol</td>
<td align="right">0.051</td>
<td align="right">0.005</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">a-campholenal</td>
<td align="right">0.041</td>
<td align="right">0.006</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">a-pinene</td>
<td align="right">0.525</td>
<td align="right">0.030</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">(E)-hex-3-en-1-ol</td>
<td align="right">0.067</td>
<td align="right">0.010</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">b-myrcene</td>
<td align="right">0.053</td>
<td align="right">0.005</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">(2E)-2,7-dimethylocta-2,6-dien-1-ol</td>
<td align="right">0.050</td>
<td align="right">0.007</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">(Z)-b-ocimene</td>
<td align="right">0.038</td>
<td align="right">0.007</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">petasitene</td>
<td align="right">0.038</td>
<td align="right">0.006</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">a-pinene</td>
<td align="right">0.379</td>
<td align="right">0.027</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">(E)-b-ocimene</td>
<td align="right">0.374</td>
<td align="right">0.026</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">a-farnesene</td>
<td align="right">0.064</td>
<td align="right">0.010</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">b-myrcene</td>
<td align="right">0.041</td>
<td align="right">0.004</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">(2E)-2,7-dimethylocta-2,6-dien-1-ol</td>
<td align="right">0.036</td>
<td align="right">0.004</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">(Z)-b-ocimene</td>
<td align="right">0.029</td>
<td align="right">0.002</td>
</tr>
</tbody>
</table>
<pre class="r"><code>absamounts &lt;- svf %&gt;% select(expt, PlantType, DN) %&gt;% 
  bind_cols(vol) %&gt;% pivot_longer(all_of(colnames(vol))) %&gt;%
  group_by(expt, PlantType, DN, name) %&gt;% 
  summarize(mean=mean(value), se=sd(value)/sqrt(n())) %&gt;% arrange(expt, PlantType, DN, desc(mean))

ggplot(absamounts, aes(y=fct_reorder(name, mean, base::mean), x=mean, color=paste(PlantType, expt), shape=DN))+ 
  geom_pointrange(aes(xmin=mean-se, xmax=mean+se), position=position_dodge2(width=0.4)) + 
  scale_shape_manual(values=c(1,19)) +   scale_x_sqrt(expand=c(0,0))+ 
  labs(x=&quot;Mean nanograms per hour&quot;,y=&quot;&quot;,color=&quot;Species, experiment&quot;, shape=&quot;Time&quot;)+
  scale_color_manual(values=c(&quot;orange&quot;,&quot;red&quot;,&quot;cyan&quot;,&quot;blue&quot;)) + theme_dark()</code></pre>
<p><img src="plots/comp-2.svg" width="1344" /></p>
<pre class="r"><code>absamounts %&gt;% pivot_wider(names_from=DN, values_from=c(mean, se)) %&gt;% 
  ggplot(aes(x=mean_day, y=mean_night)) +  
  geom_path(aes(group=name), color=&quot;grey&quot;) + geom_text(aes(label=name, color=paste(expt, PlantType))) +
  scale_x_log10() + scale_y_log10() + geom_abline(slope=1, intercept=0) + scale_color_manual(values=c(NA,&quot;cornflowerblue&quot;,&quot;red&quot;,&quot;blue&quot;))</code></pre>
<p><img src="plots/comp-3.svg" width="1344" /></p>
<pre class="r"><code>freqamounts &lt;- svf %&gt;% select(expt, PlantType, DN) %&gt;% 
  bind_cols(decostand(vol, method=&quot;pa&quot;)) %&gt;% pivot_longer(all_of(colnames(vol))) %&gt;%
  group_by(expt, PlantType, DN, name) %&gt;% 
  summarize(mean=mean(value), se=sd(value)/sqrt(n())) %&gt;% arrange(expt, PlantType, DN, desc(mean))

ggplot(freqamounts, aes(y=fct_reorder(name, mean, base::mean), x=mean, color=paste(PlantType, expt), shape=DN))+ 
  geom_pointrange(aes(xmin=mean-se, xmax=mean+se), position=position_dodge2(width=0.4)) + 
  scale_shape_manual(values=c(1,19)) +   scale_x_continuous(expand=c(0,0))+ 
  labs(x=&quot;Frequency of detection&quot;,y=&quot;&quot;,color=&quot;Species, experiment&quot;, shape=&quot;Time&quot;)+
  scale_color_manual(values=c(&quot;orange&quot;,&quot;red&quot;,&quot;cyan&quot;,&quot;blue&quot;)) + theme_dark()</code></pre>
<p><img src="plots/comp-4.svg" width="1344" /></p>
</div>
<div id="compare-to-bischoff-et-al.-2014" class="section level2">
<h2>Compare to Bischoff et al.Â 2014</h2>
<pre class="r"><code>b14 &lt;- read_tsv(&quot;data/volatiles/bischoff14_comparison.xlsx - S1B.tsv&quot;)
b14.long &lt;- b14 %&gt;% pivot_longer(contains(&quot;.&quot;), names_to=&quot;group&quot;) %&gt;% 
  separate(group, c(&quot;species&quot;,&quot;site&quot;,&quot;DN&quot;,&quot;meanse&quot;)) %&gt;% 
  pivot_wider(names_from = meanse)
ggplot(b14.long, aes(y=fct_reorder(name, mean, base::mean), x=mean, xmin=mean-se, xmax=mean+se, color=paste(species,site), shape=DN))+
  geom_pointrange(position=position_dodge2(width=0.9)) +  scale_x_sqrt(expand=c(0,0)) + scale_shape_manual(values=c(1,19)) +
  scale_color_manual(values=c(&quot;orange&quot;,&quot;red&quot;,&quot;pink&quot;,&quot;cyan&quot;,&quot;blue&quot;)) + theme_dark()</code></pre>
<p><img src="plots/bischoff-1.svg" width="1344" /></p>
<pre class="r"><code>b14.long %&gt;% pivot_wider(names_from=DN, values_from=c(mean, se)) %&gt;% 
  ggplot(aes(x=sqrt(mean_day), y=sqrt(mean_night))) +  
  geom_path(aes(group=paste(name, species)), color=&quot;grey&quot;) + geom_text(aes(label=name, color=paste(species, site))) +
  scale_x_sqrt() + scale_y_sqrt() + geom_abline(slope=1, intercept=0) +
  scale_color_manual(values=c(&quot;orange&quot;,&quot;red&quot;,&quot;pink&quot;,&quot;cyan&quot;,&quot;blue&quot;)) + theme_dark()</code></pre>
<p><img src="plots/bischoff-2.svg" width="1344" /></p>
</div>
</div>
<div id="otcs-vs.-ambient" class="section level1">
<h1>OTCs vs.Â Ambient</h1>
<div id="inventory" class="section level2">
<h2>Inventory</h2>
<pre class="r"><code>svf %&gt;% filter(expt==&quot;otc&quot;) %&gt;% count(PlantType, DN, temp,Year, Site, is.na(mean_temp_C_treatment)) %&gt;% 
  pivot_wider(names_from=temp, values_from=n) %&gt;%  kable(caption=&quot;Sample size&quot;)</code></pre>
<table>
<caption>Sample size</caption>
<colgroup>
<col width="13%" />
<col width="8%" />
<col width="6%" />
<col width="12%" />
<col width="39%" />
<col width="10%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">PlantType</th>
<th align="left">DN</th>
<th align="left">Year</th>
<th align="left">Site</th>
<th align="left">is.na(mean_temp_C_treatment)</th>
<th align="right">control</th>
<th align="right">warmed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2018</td>
<td align="left">GNA</td>
<td align="left">FALSE</td>
<td align="right">16</td>
<td align="right">29</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2018</td>
<td align="left">bb</td>
<td align="left">TRUE</td>
<td align="right">13</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2019</td>
<td align="left">GNA</td>
<td align="left">FALSE</td>
<td align="right">7</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2019</td>
<td align="left">GNA</td>
<td align="left">TRUE</td>
<td align="right">3</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">GNA</td>
<td align="left">FALSE</td>
<td align="right">26</td>
<td align="right">30</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">Maxfield</td>
<td align="left">FALSE</td>
<td align="right">38</td>
<td align="right">43</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">2019</td>
<td align="left">SC</td>
<td align="left">FALSE</td>
<td align="right">10</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="left">FALSE</td>
<td align="right">30</td>
<td align="right">41</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">2019</td>
<td align="left">SC</td>
<td align="left">FALSE</td>
<td align="right">8</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="left">FALSE</td>
<td align="right">27</td>
<td align="right">39</td>
</tr>
</tbody>
</table>
<pre class="r"><code>samplesperplant &lt;- svf %&gt;% filter(Expt==&quot;otc&quot;) %&gt;% count(PlantType, DN, temp, Year, Site, PlantID)
samplesperplant %&gt;% count(PlantType, DN, Year, Site, temp) %&gt;%  pivot_wider(names_from=temp, values_from=n) %&gt;% kable(caption=&quot;Number of plants&quot;)</code></pre>
<table>
<caption>Number of plants</caption>
<thead>
<tr class="header">
<th align="left">PlantType</th>
<th align="left">DN</th>
<th align="left">Year</th>
<th align="left">Site</th>
<th align="right">control</th>
<th align="right">warmed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2018</td>
<td align="left">GNA</td>
<td align="right">16</td>
<td align="right">28</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2018</td>
<td align="left">bb</td>
<td align="right">13</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2019</td>
<td align="left">GNA</td>
<td align="right">10</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">GNA</td>
<td align="right">18</td>
<td align="right">18</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">Maxfield</td>
<td align="right">26</td>
<td align="right">27</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">2019</td>
<td align="left">SC</td>
<td align="right">10</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="right">16</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">2019</td>
<td align="left">SC</td>
<td align="right">8</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="right">16</td>
<td align="right">25</td>
</tr>
</tbody>
</table>
<pre class="r"><code>samplesperplant %&gt;% count(PlantType, DN, Year, Site, n) %&gt;% kable(caption=&quot;Sample size per plant&quot;)</code></pre>
<table>
<caption>Sample size per plant</caption>
<thead>
<tr class="header">
<th align="left">PlantType</th>
<th align="left">DN</th>
<th align="left">Year</th>
<th align="left">Site</th>
<th align="right">n</th>
<th align="right">nn</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2018</td>
<td align="left">GNA</td>
<td align="right">1</td>
<td align="right">43</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2018</td>
<td align="left">GNA</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2018</td>
<td align="left">bb</td>
<td align="right">1</td>
<td align="right">26</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2019</td>
<td align="left">GNA</td>
<td align="right">1</td>
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">GNA</td>
<td align="right">1</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">GNA</td>
<td align="right">2</td>
<td align="right">20</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">Maxfield</td>
<td align="right">1</td>
<td align="right">27</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">Maxfield</td>
<td align="right">2</td>
<td align="right">24</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">Maxfield</td>
<td align="right">3</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">2019</td>
<td align="left">SC</td>
<td align="right">1</td>
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="right">1</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="right">2</td>
<td align="right">31</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">2019</td>
<td align="left">SC</td>
<td align="right">1</td>
<td align="right">17</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="right">1</td>
<td align="right">19</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="right">2</td>
<td align="right">19</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="right">3</td>
<td align="right">3</td>
</tr>
</tbody>
</table>
<pre class="r"><code>samplesperplant %&gt;% ggplot(aes(x=n, fill=Site)) + facet_grid(Site ~ Year) + geom_histogram(binwidth=1) + 
  stat_bin(aes(label=stat(count)), y=3, geom=&quot;text&quot;, binwidth=1) + guides(fill=&quot;none&quot;) + theme_minimal()</code></pre>
<p><img src="plots/otc-1.svg" width="768" /></p>
<pre class="r"><code>ggplot(svf %&gt;% filter(Expt==&quot;otc&quot;) %&gt;% mutate(site=paste(Site,DN))) + facet_wrap(vars(Year), ncol=1)+
  geom_bar(aes(x=yday(date), color=site, fill=site)) +
  geom_vline(data=read_csv(&quot;./data/CWu OTC Hobos - duration.csv&quot;) %&gt;% 
    mutate(begin=OTC_start-days(1), end=OTC_end+days(1), #start/end were trimmed 1 day for hobos
           Year=year, site=paste(site,&quot;day&quot;), .keep=&quot;unused&quot;), 
    aes(xintercept=yday(begin), color=site), size=1, linetype=2)+
  theme_minimal() + labs(x=&quot;Day of year&quot;, y=&quot;Number of floral volatile samples&quot;, color=&quot;Site&quot;, fill=&quot;Site&quot;)</code></pre>
<p><img src="plots/otc-2.svg" width="768" /></p>
<pre class="r"><code>plot.otc &lt;- function(svf.otc, cap.terms=c(&quot;mean_temp_C_treatment&quot;, &quot;temp&quot;), plot.chems=T) {
  vol.otc &lt;- vol[svf.otc$sample,]
  cap.formula &lt;- reformulate(cap.terms, response = &quot;sqrt(vol.otc)&quot;)
  cap.otc &lt;- capscale(cap.formula, distance=&quot;bray&quot;, data=svf.otc)
  summ.cap &lt;- summary(cap.otc)
  prop.expl &lt;- summ.cap$cont$importance
  ax.labs &lt;- paste0(colnames(prop.expl)[1:2], &quot; (&quot;,round(100*prop.expl[2,1:2]),&quot;% explained)&quot;)
  cap.terms.int &lt;- str_subset(cap.terms, &quot;:&quot;)
  anova.cap &lt;- anova(cap.otc, by=ifelse(length(cap.terms.int)&gt;0, &quot;term&quot;, &quot;margin&quot;))
  
  plot(cap.otc, type=&quot;n&quot;, xlim=range(cap.otc$CCA$wa[,1]), xlab=ax.labs[1], ylab=ax.labs[2])
  with(svf.otc, 
       title(main=paste(&quot;OTC warming:&quot;,&quot;I.&quot;,unique(PlantType), &quot;at&quot;, paste(unique(Site), collapse=&quot; &amp; &quot;),unique(Year),
                            do.call(paste0, list(unique(DN), collapse=&quot;/&quot;)), &quot;n =&quot;,nrow(svf.otc))))
  if(&quot;temp&quot; %in% cap.terms) legend(&quot;topleft&quot;, title=paste(&quot;Treatment&quot;,&quot;\nP =&quot;,anova.cap[&quot;temp&quot;,&quot;Pr(&gt;F)&quot;]), 
                                   levels(svf.otc$temp), fill=tempcol)
  if(&quot;DN&quot; %in% cap.terms) legend(&quot;topright&quot;, title=paste(&quot;Time&quot;,&quot;\nP =&quot;,anova.cap[&quot;DN&quot;,&quot;Pr(&gt;F)&quot;]), 
                                 levels(svf.otc$DN), pch=c(1,19))
  if(length(cap.terms.int)&gt;0) legend(&quot;bottomleft&quot;, title= paste(&quot;Interaction\nP =&quot;, anova.cap[cap.terms.int,&quot;Pr(&gt;F)&quot;]), legend=&quot;&quot;)
  temprange &lt;- round(c(max(svf.otc$mean_temp_C_treatment), min(svf.otc$mean_temp_C_treatment)))
  if(&quot;mean_temp_C_treatment&quot; %in% cap.terms) legend(&quot;bottomleft&quot;, 
                                                    title=paste(&quot;Temperature&quot;,&quot;\nP =&quot;,anova.cap[&quot;mean_temp_C_treatment&quot;,&quot;Pr(&gt;F)&quot;]),
                                                    paste(temprange, &quot; C&quot;), fill=rev(viridis(2)))
  if(&quot;Site&quot; %in% cap.terms) legend(&quot;bottomright&quot;,  title=paste(&quot;Site&quot;,&quot;\nP =&quot;,anova.cap[&quot;Site&quot;,&quot;Pr(&gt;F)&quot;]),
                                   unique(svf.otc$Site))
  ordispider(cap.otc, with(svf.otc, paste(Year, Site, temp, PlantID)), col=&quot;grey80&quot;)
  points(cap.otc, display=&quot;sites&quot;, col=c(tempcol)[svf.otc$temp], pch=c(1,19)[svf.otc$DN]) 
  text(cap.otc, display=&quot;cn&quot;)
  if(plot.chems) {
    if(length(cap.terms)&gt;1) text(cap.otc, display=&quot;species&quot;, cex=0.8, srt=45,
                     col=ifelse(sqrt(cap.otc$CCA$v[,1]^2 + cap.otc$CCA$v[,2]^2)&gt;0.25, alpha(&quot;purple&quot;,1),alpha(&quot;purple&quot;,0)))
    else text(cap.otc, display=&quot;species&quot;, cex=0.8, srt=45,
              col=ifelse(abs(cap.otc$CCA$v[,1])&gt;0.1, alpha(&quot;purple&quot;,1),alpha(&quot;purple&quot;,0)))
  }
  return(cap.otc)
}

plot.terms &lt;-c(&quot;mean_temp_C_treatment&quot;, &quot;temp&quot;)</code></pre>
</div>
<div id="cap-of-i.-aggregata" class="section level2">
<h2>CAP of <em>I. aggregata</em></h2>
<div id="each-year-and-site" class="section level3">
<h3>Each year and site</h3>
<pre class="r"><code>cap.siteyr.agg &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, PlantType==&quot;agg&quot;) %&gt;% 
  drop_na(mean_temp_C_treatment) %&gt;% 
  group_by(Site, Year) %&gt;% summarize(meta = list(cur_data_all()), .groups = &quot;drop&quot;) %&gt;% 
  arrange(Site, Year) %&gt;% #nest that keeps groups
  mutate(samples = map_int(meta, nrow),
         cap = map(meta, plot.otc),
         anova = map(cap, ~tidy(anova(.x, by=&quot;margin&quot;))))</code></pre>
<p><img src="plots/otc_agg-1.svg" width="768" /><img src="plots/otc_agg-2.svg" width="768" /><img src="plots/otc_agg-3.svg" width="768" /><img src="plots/otc_agg-4.svg" width="768" /></p>
<pre class="r"><code>cap.siteyr.agg %&gt;% select(-c(meta,cap)) %&gt;% unnest(anova) %&gt;% 
  filter(term!=&quot;Residual&quot;) %&gt;% select(-c(df, SumOfSqs,statistic)) %&gt;% 
  pivot_wider(names_from=term, values_from=p.value) %&gt;% 
  rename(N=samples, Temperature=mean_temp_C_treatment, Treatment=temp) %&gt;% 
  kable(caption=&quot;I. aggregata site-year CAP p-values&quot;)</code></pre>
<table>
<caption>I. aggregata site-year CAP p-values</caption>
<thead>
<tr class="header">
<th align="left">Site</th>
<th align="left">Year</th>
<th align="right">N</th>
<th align="right">Temperature</th>
<th align="right">Treatment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GNA</td>
<td align="left">2018</td>
<td align="right">45</td>
<td align="right">0.002</td>
<td align="right">0.322</td>
</tr>
<tr class="even">
<td align="left">GNA</td>
<td align="left">2019</td>
<td align="right">14</td>
<td align="right">0.460</td>
<td align="right">0.801</td>
</tr>
<tr class="odd">
<td align="left">GNA</td>
<td align="left">2021</td>
<td align="right">56</td>
<td align="right">0.007</td>
<td align="right">0.176</td>
</tr>
<tr class="even">
<td align="left">Maxfield</td>
<td align="left">2021</td>
<td align="right">81</td>
<td align="right">0.001</td>
<td align="right">0.013</td>
</tr>
</tbody>
</table>
</div>
<div id="both-sites" class="section level3">
<h3>2021 both sites</h3>
<pre class="r"><code>cap.yr.agg &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, PlantType==&quot;agg&quot;, year == &quot;2021&quot;) %&gt;% 
  drop_na(mean_temp_C_treatment) %&gt;% 
  group_by(Year) %&gt;% summarize(meta = list(cur_data_all()), .groups = &quot;drop&quot;) %&gt;% 
  mutate(samples = map_int(meta, nrow),
         cap = map(meta, plot.otc, cap.terms=c(plot.terms, &quot;Site&quot;)),
         anova = map(cap, ~tidy(anova(.x, by=&quot;margin&quot;))))</code></pre>
<p><img src="plots/otc_comb_year-1.svg" width="768" /></p>
<pre class="r"><code>cap.yr.agg %&gt;% select(-c(meta,cap)) %&gt;% unnest(anova) %&gt;% 
  filter(term!=&quot;Residual&quot;) %&gt;% select(-c(df, SumOfSqs,statistic)) %&gt;% 
  pivot_wider(names_from=term, values_from=p.value) %&gt;% 
  rename(N=samples, Temperature=mean_temp_C_treatment, Treatment=temp) %&gt;% 
  kable(caption=&quot;I. aggregata year CAP p-values&quot;)</code></pre>
<table>
<caption>I. aggregata year CAP p-values</caption>
<thead>
<tr class="header">
<th align="left">Year</th>
<th align="right">N</th>
<th align="right">Temperature</th>
<th align="right">Treatment</th>
<th align="right">Site</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2021</td>
<td align="right">137</td>
<td align="right">0.043</td>
<td align="right">0.206</td>
<td align="right">0.031</td>
</tr>
</tbody>
</table>
</div>
<div id="all-years" class="section level3">
<h3>All years</h3>
<pre class="r"><code>svf.otc &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, PlantType==&quot;agg&quot;, Site!=&quot;bb&quot;) %&gt;% drop_na(mean_temp_C_treatment)
vol.otc &lt;- vol[svf.otc$sample,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ Year + mean_temp_C_treatment + temp + Site, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ Year + mean_temp_C_treatment +
temp + Site, data = svf.otc, distance = &quot;bray&quot;)

              Inertia Proportion Rank
Total         27.4235     1.0000     
Constrained    3.8391     0.1400    5
Unconstrained 31.2936     1.1411   71
Imaginary     -7.7093    -0.2811  124
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
  CAP1   CAP2   CAP3   CAP4   CAP5 
1.8795 0.9897 0.5831 0.2521 0.1346 

Eigenvalues for unconstrained axes:
 MDS1  MDS2  MDS3  MDS4  MDS5  MDS6  MDS7  MDS8 
6.533 3.790 2.105 1.804 1.617 1.439 1.273 0.997 
(Showing 8 of 71 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>anova(cap.otc.comb, by=&quot;margin&quot;) %&gt;% kable(caption=&quot;CAP&quot;)</code></pre>
<table>
<caption>CAP</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Df</th>
<th align="right">SumOfSqs</th>
<th align="right">F</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Year</td>
<td align="right">2</td>
<td align="right">1.7859180</td>
<td align="right">5.421623</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">mean_temp_C_treatment</td>
<td align="right">1</td>
<td align="right">0.5534893</td>
<td align="right">3.360524</td>
<td align="right">0.002</td>
</tr>
<tr class="odd">
<td align="left">temp</td>
<td align="right">1</td>
<td align="right">0.3270523</td>
<td align="right">1.985706</td>
<td align="right">0.036</td>
</tr>
<tr class="even">
<td align="left">Site</td>
<td align="right">1</td>
<td align="right">0.4427976</td>
<td align="right">2.688457</td>
<td align="right">0.003</td>
</tr>
<tr class="odd">
<td align="left">Residual</td>
<td align="right">190</td>
<td align="right">31.2936190</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<pre class="r"><code>prop.expl &lt;- summary(cap.otc.comb)$cont$importance
ax.labs &lt;- paste0(colnames(prop.expl)[1:2], &quot; (&quot;,round(100*prop.expl[2,1:2]),&quot;% explained)&quot;)
cap.df &lt;- fortify(cap.otc.comb) 
arrowvars &lt;- c(Temp=&quot;mean_temp_C_treatment&quot;, Warming=&quot;tempwarmed&quot;)
ggplot(mapping=aes(x=CAP1, y=CAP2, label=Label)) + 
  geom_path(data=cap.df %&gt;% filter(Score==&quot;sites&quot;) %&gt;% bind_cols(svf.otc), aes(group=paste(Year, Site, temp, PlantID)), color=&quot;grey60&quot;)+
  geom_point(data=cap.df %&gt;% filter(Score==&quot;sites&quot;) %&gt;% bind_cols(svf.otc), aes(shape=Year, color=mean_temp_C_treatment), size=3)+
  geom_segment(data=cap.df %&gt;% filter(Score==&quot;biplot&quot;, Label %in% arrowvars), aes(x=0,y=0,xend=CAP1*3.5, yend=CAP2*3.5), 
               arrow=arrow(length=unit(0.5, &quot;lines&quot;)), color=&quot;white&quot;)+
  geom_text(data=cap.df %&gt;% filter(Score==&quot;biplot&quot;, Label %in% arrowvars)%&gt;% mutate(Label=names(arrowvars)),
            aes(x=CAP1*3.6, y=CAP2*3.6, angle=atan(CAP2/CAP1)*180/pi, hjust=c(1,1)), fontface=&quot;bold&quot;, color=&quot;white&quot;, size=5) +
  geom_text(data=cap.df %&gt;% filter(Score==&quot;centroids&quot;) %&gt;% mutate(Label=c(&quot;2018&quot;,&quot;2019&quot;,&quot;2021&quot;,&quot;&quot;,&quot;&quot;,&quot;GNA&quot;,&quot;Maxfield&quot;)),
            aes(x=CAP1, y=CAP2), fontface=&quot;bold&quot;, color=&quot;white&quot;, size=5) +
  geom_text_repel(data=cap.df %&gt;% left_join(ipochems, by=c(&quot;Label&quot;=&quot;name&quot;)) %&gt;% filter(Score==&quot;species&quot;, sqrt(CAP1^2+CAP2^2)&gt;0.2), 
            aes(x=CAP1*1.5, y=CAP2*1.5), size=4, color=&quot;black&quot;, point.size=NA, box.padding=0)+ 
  scale_color_viridis_c(&quot;Temp (\u00B0C)&quot;, option=&quot;inferno&quot;, breaks=seq(0, 60, by=4)) + 
  scale_shape_manual(values=c(`2018`=15,`2019`=19,`2021`=17)) +  labs(x=ax.labs[1], y=ax.labs[2])+
  coord_fixed() + theme_bw() + theme(panel.grid = element_blank(), panel.background = element_rect(fill=&quot;grey70&quot;))</code></pre>
<p><img src="plots/otc_comb_temp-1.svg" width="768" /></p>
<pre class="r"><code>lmer(sqrt(Total) ~ Year + Site + temp + (1|PlantID), data = svf.otc) %&gt;% anova %&gt;% kable(caption=&quot;total emissions&quot;)</code></pre>
<table>
<caption>total emissions</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Year</td>
<td align="right">264.48715</td>
<td align="right">132.24357</td>
<td align="right">2</td>
<td align="right">169.4197</td>
<td align="right">4.8893190</td>
<td align="right">0.0086221</td>
</tr>
<tr class="even">
<td align="left">Site</td>
<td align="right">36.86346</td>
<td align="right">36.86346</td>
<td align="right">1</td>
<td align="right">106.2981</td>
<td align="right">1.3629183</td>
<td align="right">0.2456444</td>
</tr>
<tr class="odd">
<td align="left">temp</td>
<td align="right">14.42245</td>
<td align="right">14.42245</td>
<td align="right">1</td>
<td align="right">133.9442</td>
<td align="right">0.5332278</td>
<td align="right">0.4665282</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cap-of-i.-tenuituba" class="section level2">
<h2>CAP of <em>I. tenuituba</em></h2>
<div id="each-year" class="section level3">
<h3>Each year</h3>
<pre class="r"><code>cap.yr.ten &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, PlantType==&quot;ten&quot;) %&gt;% 
  group_by(Year) %&gt;% summarize(meta = list(cur_data_all()), .groups = &quot;drop&quot;) %&gt;% 
  mutate(samples = map_int(meta, nrow),
         cap = map(meta, plot.otc, cap.terms=c(&quot;DN&quot;,&quot;temp&quot;,&quot;DN:temp&quot;)),
         anova = map(cap, ~tidy(anova(.x, by=&quot;term&quot;))))</code></pre>
<p><img src="plots/otc_ten-1.svg" width="768" /><img src="plots/otc_ten-2.svg" width="768" /></p>
<pre class="r"><code>cap.yr.ten %&gt;% select(-c(meta,cap)) %&gt;% unnest(anova) %&gt;% 
  filter(term!=&quot;Residual&quot;) %&gt;% select(-c(df, SumOfSqs,statistic)) %&gt;% 
  pivot_wider(names_from=term, values_from=p.value) %&gt;% 
  rename(N=samples, Time=DN, Treatment=temp, &quot;Time:Treatment&quot;=&quot;DN:temp&quot;) %&gt;% 
  kable(caption=&quot;I. tenuituba year CAP p-values&quot;)</code></pre>
<table>
<caption>I. tenuituba year CAP p-values</caption>
<thead>
<tr class="header">
<th align="left">Year</th>
<th align="right">N</th>
<th align="right">Time</th>
<th align="right">Treatment</th>
<th align="right">Time:Treatment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2019</td>
<td align="right">38</td>
<td align="right">0.001</td>
<td align="right">0.247</td>
<td align="right">0.691</td>
</tr>
<tr class="even">
<td align="left">2021</td>
<td align="right">137</td>
<td align="right">0.001</td>
<td align="right">0.128</td>
<td align="right">0.198</td>
</tr>
</tbody>
</table>
</div>
<div id="both-years-day" class="section level3">
<h3>Both years, day</h3>
<pre class="r"><code>svf.otc &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, PlantType==&quot;ten&quot;, DN==&quot;day&quot;) %&gt;% drop_na(mean_temp_C_treatment)
vol.otc &lt;- vol[svf.otc$sample,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ Year + mean_temp_C_treatment + temp, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ Year + mean_temp_C_treatment +
temp, data = svf.otc, distance = &quot;bray&quot;)

               Inertia Proportion Rank
Total         10.67003    1.00000     
Constrained    0.82772    0.07757    3
Unconstrained 12.05535    1.12983   42
Imaginary     -2.21304   -0.20741   49
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
  CAP1   CAP2   CAP3 
0.3425 0.2837 0.2016 

Eigenvalues for unconstrained axes:
  MDS1   MDS2   MDS3   MDS4   MDS5   MDS6   MDS7   MDS8 
2.8783 2.1447 0.8114 0.7685 0.6296 0.4905 0.4704 0.4068 
(Showing 8 of 42 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>anova(cap.otc.comb, by=&quot;margin&quot;) %&gt;% kable(caption=&quot;CAP&quot;)</code></pre>
<table>
<caption>CAP</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Df</th>
<th align="right">SumOfSqs</th>
<th align="right">F</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Year</td>
<td align="right">1</td>
<td align="right">0.3091642</td>
<td align="right">2.256795</td>
<td align="right">0.019</td>
</tr>
<tr class="even">
<td align="left">mean_temp_C_treatment</td>
<td align="right">1</td>
<td align="right">0.2090617</td>
<td align="right">1.526080</td>
<td align="right">0.109</td>
</tr>
<tr class="odd">
<td align="left">temp</td>
<td align="right">1</td>
<td align="right">0.2708108</td>
<td align="right">1.976829</td>
<td align="right">0.032</td>
</tr>
<tr class="even">
<td align="left">Residual</td>
<td align="right">88</td>
<td align="right">12.0553471</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<pre class="r"><code>prop.expl &lt;- summary(cap.otc.comb)$cont$importance
ax.labs &lt;- paste0(colnames(prop.expl)[1:2], &quot; (&quot;,round(100*prop.expl[2,1:2]),&quot;% explained)&quot;)
cap.df &lt;- fortify(cap.otc.comb) 
ggplot(mapping=aes(x=CAP1, y=CAP2, label=Label)) + 
  geom_path(data=cap.df %&gt;% filter(Score==&quot;sites&quot;) %&gt;% bind_cols(svf.otc), aes(group=paste(Year, Site, temp, PlantID)), color=&quot;grey60&quot;)+
  geom_point(data=cap.df %&gt;% filter(Score==&quot;sites&quot;) %&gt;% bind_cols(svf.otc), aes(shape=Year, color=mean_temp_C_treatment), size=3)+
  geom_segment(data=cap.df %&gt;% filter(Score==&quot;biplot&quot;, Label %in% arrowvars), aes(x=0,y=0,xend=CAP1*2.5, yend=CAP2*2.5), 
               arrow=arrow(length=unit(0.5, &quot;lines&quot;)), color=&quot;white&quot;)+
  geom_text(data=cap.df %&gt;% filter(Score==&quot;biplot&quot;, Label %in% arrowvars) %&gt;% mutate(Label=names(arrowvars)),
            aes(x=CAP1*2.6, y=CAP2*2.6, angle=atan(CAP2/CAP1)*180/pi, hjust=c(1,1)), fontface=&quot;bold&quot;, color=&quot;white&quot;, size=5) +
  geom_text(data=cap.df %&gt;% filter(Score==&quot;centroids&quot;) %&gt;% mutate(Label=c(&quot;2019&quot;,&quot;2021&quot;,&quot;&quot;,&quot;&quot;)),
            aes(x=CAP1, y=CAP2), fontface=&quot;bold&quot;, color=&quot;white&quot;, size=5) +
  geom_text_repel(data=cap.df %&gt;% left_join(ipochems, by=c(&quot;Label&quot;=&quot;name&quot;)) %&gt;% filter(Score==&quot;species&quot;, sqrt(CAP1^2+CAP2^2)&gt;0.2), 
            aes(x=CAP1*4, y=CAP2*4), size=4, color=&quot;black&quot;, point.size=NA, box.padding=0)+ 
  scale_color_viridis_c(&quot;Temp (\u00B0C)&quot;, option=&quot;inferno&quot;, breaks=seq(0, 60, by=4)) + 
  scale_shape_manual(values=c(`2018`=15,`2019`=19,`2021`=17)) +  labs(x=ax.labs[1], y=ax.labs[2])+
  coord_fixed() + theme_bw() + theme(panel.grid = element_blank(), panel.background = element_rect(fill=&quot;grey70&quot;))</code></pre>
<p><img src="plots/otc_comb_temp_tenD-1.svg" width="768" /></p>
<pre class="r"><code>lmer(sqrt(Total) ~ Year + temp + (1|PlantID), data = svf.otc) %&gt;% anova %&gt;% kable(caption=&quot;total emissions&quot;)</code></pre>
<table>
<caption>total emissions</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Year</td>
<td align="right">2.673962</td>
<td align="right">2.673962</td>
<td align="right">1</td>
<td align="right">89</td>
<td align="right">0.0696173</td>
<td align="right">0.7925048</td>
</tr>
<tr class="even">
<td align="left">temp</td>
<td align="right">129.620625</td>
<td align="right">129.620625</td>
<td align="right">1</td>
<td align="right">89</td>
<td align="right">3.3747065</td>
<td align="right">0.0695419</td>
</tr>
</tbody>
</table>
</div>
<div id="both-years-night" class="section level3">
<h3>Both years, night</h3>
<pre class="r"><code>svf.otc &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, PlantType==&quot;ten&quot;, DN==&quot;night&quot;) %&gt;% drop_na(mean_temp_C_treatment)
vol.otc &lt;- vol[svf.otc$sample,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ Year + mean_temp_C_treatment + temp, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ Year + mean_temp_C_treatment +
temp, data = svf.otc, distance = &quot;bray&quot;)

              Inertia Proportion Rank
Total          8.2222     1.0000     
Constrained    1.0590     0.1288    3
Unconstrained  8.6743     1.0550   39
Imaginary     -1.5110    -0.1838   43
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
  CAP1   CAP2   CAP3 
0.8070 0.1538 0.0982 

Eigenvalues for unconstrained axes:
  MDS1   MDS2   MDS3   MDS4   MDS5   MDS6   MDS7   MDS8 
2.5679 1.1460 0.7525 0.6839 0.4967 0.4268 0.3458 0.2590 
(Showing 8 of 39 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>anova(cap.otc.comb, by=&quot;margin&quot;) %&gt;% kable(caption=&quot;CAP&quot;)</code></pre>
<table>
<caption>CAP</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Df</th>
<th align="right">SumOfSqs</th>
<th align="right">F</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Year</td>
<td align="right">1</td>
<td align="right">0.7139697</td>
<td align="right">6.5023982</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">mean_temp_C_treatment</td>
<td align="right">1</td>
<td align="right">0.2708502</td>
<td align="right">2.4667378</td>
<td align="right">0.013</td>
</tr>
<tr class="odd">
<td align="left">temp</td>
<td align="right">1</td>
<td align="right">0.1088660</td>
<td align="right">0.9914846</td>
<td align="right">0.397</td>
</tr>
<tr class="even">
<td align="left">Residual</td>
<td align="right">79</td>
<td align="right">8.6742775</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<pre class="r"><code>prop.expl &lt;- summary(cap.otc.comb)$cont$importance
ax.labs &lt;- paste0(colnames(prop.expl)[1:2], &quot; (&quot;,round(100*prop.expl[2,1:2]),&quot;% explained)&quot;)
cap.df &lt;- fortify(cap.otc.comb) 
ggplot(mapping=aes(x=CAP1, y=CAP2, label=Label)) + 
  geom_path(data=cap.df %&gt;% filter(Score==&quot;sites&quot;) %&gt;% bind_cols(svf.otc), aes(group=paste(Year, Site, temp, PlantID)), color=&quot;grey60&quot;)+
  geom_point(data=cap.df %&gt;% filter(Score==&quot;sites&quot;) %&gt;% bind_cols(svf.otc), aes(shape=Year, color=mean_temp_C_treatment), size=3)+
  geom_segment(data=cap.df %&gt;% filter(Score==&quot;biplot&quot;, Label %in% arrowvars), aes(x=0,y=0,xend=CAP1*3, yend=CAP2*3), 
               arrow=arrow(length=unit(0.5, &quot;lines&quot;)), color=&quot;white&quot;)+
  geom_text(data=cap.df %&gt;% filter(Score==&quot;biplot&quot;, Label %in% arrowvars) %&gt;% mutate(Label=names(arrowvars)),
            aes(x=CAP1*3.1, y=CAP2*3.1, angle=atan(CAP2/CAP1)*180/pi, hjust=c(1,0)), fontface=&quot;bold&quot;, color=&quot;white&quot;, size=5) +
  geom_text(data=cap.df %&gt;% filter(Score==&quot;centroids&quot;) %&gt;% mutate(Label=c(&quot;2019&quot;,&quot;2021&quot;,&quot;&quot;,&quot;&quot;)),
            aes(x=CAP1, y=CAP2), fontface=&quot;bold&quot;, color=&quot;white&quot;, size=5) +
  geom_text_repel(data=cap.df %&gt;% left_join(ipochems, by=c(&quot;Label&quot;=&quot;name&quot;)) %&gt;% filter(Score==&quot;species&quot;, sqrt(CAP1^2+CAP2^2)&gt;0.2), 
            aes(x=CAP1*3, y=CAP2*3), size=4, color=&quot;black&quot;, point.size=NA, box.padding=0)+ 
  scale_color_viridis_c(&quot;Temp (\u00B0C)&quot;, option=&quot;inferno&quot;, breaks=seq(0, 60, by=4)) + 
  scale_shape_manual(values=c(`2018`=15,`2019`=19,`2021`=17)) +  labs(x=ax.labs[1], y=ax.labs[2])+
  coord_fixed() + theme_bw() + theme(panel.grid = element_blank(), panel.background = element_rect(fill=&quot;grey70&quot;))</code></pre>
<p><img src="plots/otc_comb_temp_tenN-1.svg" width="768" /></p>
<pre class="r"><code>lmer(sqrt(Total) ~ Year + temp + (1|PlantID), data = svf.otc) %&gt;% anova %&gt;% kable(caption=&quot;total emissions&quot;)</code></pre>
<table>
<caption>total emissions</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Year</td>
<td align="right">376.551261</td>
<td align="right">376.551261</td>
<td align="right">1</td>
<td align="right">64.69350</td>
<td align="right">8.7603738</td>
<td align="right">0.0042983</td>
</tr>
<tr class="even">
<td align="left">temp</td>
<td align="right">1.152037</td>
<td align="right">1.152037</td>
<td align="right">1</td>
<td align="right">56.48877</td>
<td align="right">0.0268019</td>
<td align="right">0.8705416</td>
</tr>
</tbody>
</table>
</div>
<div id="night-vwc" class="section level3">
<h3>2021, night, VWC</h3>
<pre class="r"><code>svf.otc &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, PlantType==&quot;ten&quot;, DN==&quot;night&quot;) %&gt;% drop_na(SoilVWC)
vol.otc &lt;- vol[svf.otc$sample,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ temp + SoilVWC, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ temp + SoilVWC, data =
svf.otc, distance = &quot;bray&quot;)

               Inertia Proportion Rank
Total          5.84260    1.00000     
Constrained    0.18274    0.03128    2
Unconstrained  6.58529    1.12712   31
Imaginary     -0.92542   -0.15839   32
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
   CAP1    CAP2 
0.11651 0.06623 

Eigenvalues for unconstrained axes:
  MDS1   MDS2   MDS3   MDS4   MDS5   MDS6   MDS7   MDS8 
2.1454 1.0567 0.6296 0.4879 0.3552 0.2988 0.2255 0.1844 
(Showing 8 of 31 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>anova.cap &lt;- anova(cap.otc.comb, by=&quot;margin&quot;)
kable(anova.cap, caption=&quot;CAP tenuituba night - treatment&quot;)</code></pre>
<table>
<caption>CAP tenuituba night - treatment</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Df</th>
<th align="right">SumOfSqs</th>
<th align="right">F</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">temp</td>
<td align="right">1</td>
<td align="right">0.1000644</td>
<td align="right">0.9269041</td>
<td align="right">0.463</td>
</tr>
<tr class="even">
<td align="left">SoilVWC</td>
<td align="right">1</td>
<td align="right">0.0934534</td>
<td align="right">0.8656660</td>
<td align="right">0.544</td>
</tr>
<tr class="odd">
<td align="left">Residual</td>
<td align="right">61</td>
<td align="right">6.5852871</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<pre class="r"><code>svf.otc &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, PlantType==&quot;ten&quot;, DN==&quot;night&quot;) %&gt;% drop_na(SoilVWC, mean_temp_C_treatment)
vol.otc &lt;- vol[svf.otc$sample,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ mean_temp_C_treatment + SoilVWC, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ mean_temp_C_treatment +
SoilVWC, data = svf.otc, distance = &quot;bray&quot;)

               Inertia Proportion Rank
Total          5.84260    1.00000     
Constrained    0.28665    0.04906    2
Unconstrained  6.48138    1.10933   31
Imaginary     -0.92542   -0.15839   32
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
   CAP1    CAP2 
0.21323 0.07342 

Eigenvalues for unconstrained axes:
  MDS1   MDS2   MDS3   MDS4   MDS5   MDS6   MDS7   MDS8 
2.0161 1.0851 0.6246 0.4957 0.3676 0.2936 0.2044 0.1866 
(Showing 8 of 31 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>anova.cap &lt;- anova(cap.otc.comb, by=&quot;margin&quot;)
kable(anova.cap, caption=&quot;CAP tenuituba night - temperature&quot;)</code></pre>
<table>
<caption>CAP tenuituba night - temperature</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Df</th>
<th align="right">SumOfSqs</th>
<th align="right">F</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">mean_temp_C_treatment</td>
<td align="right">1</td>
<td align="right">0.2039732</td>
<td align="right">1.9197101</td>
<td align="right">0.08</td>
</tr>
<tr class="even">
<td align="left">SoilVWC</td>
<td align="right">1</td>
<td align="right">0.0799091</td>
<td align="right">0.7520708</td>
<td align="right">0.66</td>
</tr>
<tr class="odd">
<td align="left">Residual</td>
<td align="right">61</td>
<td align="right">6.4813783</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
</div>
<div id="all-years-day-and-night" class="section level3">
<h3>All years, day and night</h3>
<pre class="r"><code>svf.otc &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, PlantType==&quot;ten&quot;)
vol.otc &lt;- vol[svf.otc$sample,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ Year * DN + temp, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ Year * DN + temp, data =
svf.otc, distance = &quot;bray&quot;)

              Inertia Proportion Rank
Total         23.0080     1.0000     
Constrained    5.4487     0.2368    4
Unconstrained 23.7593     1.0327   65
Imaginary     -6.2001    -0.2695  109
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
 CAP1  CAP2  CAP3  CAP4 
4.267 0.687 0.338 0.157 

Eigenvalues for unconstrained axes:
 MDS1  MDS2  MDS3  MDS4  MDS5  MDS6  MDS7  MDS8 
4.790 3.135 1.624 1.281 1.112 1.071 0.968 0.916 
(Showing 8 of 65 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>anova(cap.otc.comb, by=&quot;term&quot;) %&gt;% kable(caption=&quot;CAP&quot;)</code></pre>
<table>
<caption>CAP</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Df</th>
<th align="right">SumOfSqs</th>
<th align="right">F</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Year</td>
<td align="right">1</td>
<td align="right">0.6263415</td>
<td align="right">4.481522</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">DN</td>
<td align="right">1</td>
<td align="right">4.0890598</td>
<td align="right">29.257542</td>
<td align="right">0.001</td>
</tr>
<tr class="odd">
<td align="left">temp</td>
<td align="right">1</td>
<td align="right">0.2534728</td>
<td align="right">1.813618</td>
<td align="right">0.046</td>
</tr>
<tr class="even">
<td align="left">Year:DN</td>
<td align="right">1</td>
<td align="right">0.4798699</td>
<td align="right">3.433507</td>
<td align="right">0.002</td>
</tr>
<tr class="odd">
<td align="left">Residual</td>
<td align="right">170</td>
<td align="right">23.7593495</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<pre class="r"><code>prop.expl &lt;- summary(cap.otc.comb)$cont$importance
ax.labs &lt;- paste0(colnames(prop.expl)[1:2], &quot; (&quot;,round(100*prop.expl[2,1:2]),&quot;% explained)&quot;)
cap.df &lt;- fortify(cap.otc.comb) 
ggplot(mapping=aes(x=CAP1, y=CAP2, label=Label)) + 
  geom_path(data=cap.df %&gt;% filter(Score==&quot;sites&quot;) %&gt;% bind_cols(svf.otc), aes(group=paste(Year, Site, temp, PlantID, week(date)), color=temp))+
  geom_point(data=cap.df %&gt;% filter(Score==&quot;sites&quot;) %&gt;% bind_cols(svf.otc), aes(shape=paste(Year,DN), color=temp), size=3)+
  geom_segment(data=cap.df %&gt;% filter(Score==&quot;biplot&quot;), aes(x=0,y=0,xend=CAP1*1.8, yend=CAP2*1.8), 
               arrow=arrow(length=unit(0.5, &quot;lines&quot;)), color=&quot;white&quot;)+
  geom_text(data=cap.df %&gt;% filter(Score==&quot;biplot&quot;) %&gt;% mutate(Label=c(&quot;2021&quot;,&quot;Night&quot;,&quot;Warming&quot;,&quot;2021:night&quot;)),
            aes(x=CAP1*1.9, y=CAP2*1.9, angle=atan(CAP2/CAP1)*180/pi, hjust=0), fontface=&quot;bold&quot;, color=&quot;white&quot;, size=5) +
  geom_text_repel(data=cap.df %&gt;% left_join(ipochems, by=c(&quot;Label&quot;=&quot;name&quot;)) %&gt;% filter(Score==&quot;species&quot;, sqrt(CAP1^2+CAP2^2)&gt;0.28), 
            aes(x=CAP1*0.8, y=CAP2*0.8), size=4, color=&quot;black&quot;, point.size=NA, box.padding=0)+  labs(x=ax.labs[1], y=ax.labs[2])+
  scale_color_manual(&quot;Treatment&quot;, values=tempcol)+ scale_shape_manual(&quot;Year, time&quot;, values=c(0,15,1,19))+
  coord_fixed() + theme_bw() + theme(panel.grid = element_blank(), panel.background = element_rect(fill=&quot;grey70&quot;))</code></pre>
<p><img src="plots/otc_comb_ten-1.svg" width="768" /></p>
<pre class="r"><code>lmer(sqrt(Total) ~ Year * DN + temp + (1|PlantID), data = svf.otc) %&gt;% anova %&gt;% kable(caption=&quot;total emissions&quot;)</code></pre>
<table>
<caption>total emissions</caption>
<colgroup>
<col width="12%" />
<col width="15%" />
<col width="15%" />
<col width="9%" />
<col width="15%" />
<col width="16%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Year</td>
<td align="right">356.2809</td>
<td align="right">356.2809</td>
<td align="right">1</td>
<td align="right">91.50065</td>
<td align="right">6.5530340</td>
<td align="right">0.0121098</td>
</tr>
<tr class="even">
<td align="left">DN</td>
<td align="right">1100.7920</td>
<td align="right">1100.7920</td>
<td align="right">1</td>
<td align="right">131.64161</td>
<td align="right">20.2467417</td>
<td align="right">0.0000148</td>
</tr>
<tr class="odd">
<td align="left">temp</td>
<td align="right">19.3537</td>
<td align="right">19.3537</td>
<td align="right">1</td>
<td align="right">66.56212</td>
<td align="right">0.3559704</td>
<td align="right">0.5527766</td>
</tr>
<tr class="even">
<td align="left">Year:DN</td>
<td align="right">442.1140</td>
<td align="right">442.1140</td>
<td align="right">1</td>
<td align="right">131.64403</td>
<td align="right">8.1317527</td>
<td align="right">0.0050520</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="both-species-day" class="section level2">
<h2>Both species, day</h2>
<pre class="r"><code>svf.otc &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, DN==&quot;day&quot;, Site!=&quot;bb&quot;) %&gt;% drop_na(mean_temp_C_treatment)
vol.otc &lt;- vol[svf.otc$sample,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ Year + Site + mean_temp_C_treatment + temp, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ Year + Site +
mean_temp_C_treatment + temp, data = svf.otc, distance = &quot;bray&quot;)

               Inertia Proportion Rank
Total          40.7467     1.0000     
Constrained     6.4695     0.1588    6
Unconstrained  47.6764     1.1701   94
Imaginary     -13.3991    -0.3288  193
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
  CAP1   CAP2   CAP3   CAP4   CAP5   CAP6 
2.8171 1.8417 0.8417 0.5257 0.2875 0.1558 

Eigenvalues for unconstrained axes:
 MDS1  MDS2  MDS3  MDS4  MDS5  MDS6  MDS7  MDS8 
8.716 6.229 2.994 2.698 2.157 1.936 1.803 1.505 
(Showing 8 of 94 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>(anova.cap &lt;- anova(cap.otc.comb, by=&quot;margin&quot;))</code></pre>
<pre><code>Permutation test for capscale under reduced model
Marginal effects of terms
Permutation: free
Number of permutations: 999

Model: capscale(formula = sqrt(vol.otc) ~ Year + Site + mean_temp_C_treatment + temp, data = svf.otc, distance = &quot;bray&quot;)
                       Df SumOfSqs      F Pr(&gt;F)    
Year                    2    1.711 5.0423  0.001 ***
Site                    2    3.040 8.9577  0.001 ***
mean_temp_C_treatment   1    0.477 2.8119  0.008 ** 
temp                    1    0.493 2.9041  0.006 ** 
Residual              281   47.676                  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>summ.cap &lt;- summary(cap.otc.comb)
prop.expl &lt;- summ.cap$cont$importance
ax.labs &lt;- paste0(colnames(prop.expl)[1:2], &quot; (&quot;,round(100*prop.expl[2,1:2]),&quot;% explained)&quot;)

yearpch &lt;- c(`2018`=15,`2019`=19,`2021`=17)
plot(cap.otc.comb, type=&quot;n&quot;, xlab=ax.labs[1], ylab=ax.labs[2])
title(paste(&quot;OTC warming: I. agg &amp; ten at all sites, all years, day&quot;,&quot;n =&quot;, nrow(svf.otc)))
temprange &lt;- round(c(max(svf.otc$mean_temp_C_treatment), min(svf.otc$mean_temp_C_treatment)))
legend(&quot;topleft&quot;,  title=paste(&quot;Temperature&quot;,&quot;\nP =&quot;,anova.cap[&quot;mean_temp_C_treatment&quot;,&quot;Pr(&gt;F)&quot;]), legend=paste(temprange, &quot; C&quot;), fill=rev(viridis(2)))
legend(&quot;topright&quot;,  title=paste(&quot;Year&quot;,&quot;\nP =&quot;,anova.cap[&quot;Year&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.otc$Year), pch=yearpch)
legend(&quot;bottomright&quot;,  title=paste(&quot;Site&quot;,&quot;\nP =&quot;,anova.cap[&quot;Site&quot;,&quot;Pr(&gt;F)&quot;]), legend=unique(svf.otc$Site))
legend(&quot;bottomleft&quot;,  title=paste(&quot;Treatment&quot;,&quot;\nP =&quot;,anova.cap[&quot;temp&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.otc$temp))
ordispider(cap.otc.comb, with(svf.otc, paste(Year, Site, temp, PlantID)), col=&quot;grey80&quot;)
points(cap.otc.comb, display=&quot;sites&quot;, col=inferno(round(temprange[1]-temprange[2])+1)[round(svf.otc$mean_temp_C_treatment-temprange[2])+1], pch=yearpch[svf.otc$Year]) 
text(cap.otc.comb, display=&quot;cn&quot;)
text(cap.otc.comb, display=&quot;species&quot;, cex=0.7, srt=45,
                     col=ifelse(sqrt(cap.otc.comb$CCA$v[,1]^2 + cap.otc.comb$CCA$v[,2]^2)&gt;0.25, alpha(&quot;red&quot;,0.7),alpha(&quot;red&quot;,0)))</code></pre>
<p><img src="plots/otc_both_species-1.svg" width="768" /></p>
<pre class="r"><code>lmer(sqrt(Total) ~ Year + Site + temp + (1|PlantID), data = svf.otc) %&gt;% anova %&gt;% kable(caption=&quot;total emissions&quot;)</code></pre>
<table>
<caption>total emissions</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Year</td>
<td align="right">182.32990</td>
<td align="right">91.16495</td>
<td align="right">2</td>
<td align="right">282</td>
<td align="right">2.844900</td>
<td align="right">0.0598102</td>
</tr>
<tr class="even">
<td align="left">Site</td>
<td align="right">520.28455</td>
<td align="right">260.14227</td>
<td align="right">2</td>
<td align="right">282</td>
<td align="right">8.118018</td>
<td align="right">0.0003734</td>
</tr>
<tr class="odd">
<td align="left">temp</td>
<td align="right">91.96233</td>
<td align="right">91.96233</td>
<td align="right">1</td>
<td align="right">282</td>
<td align="right">2.869783</td>
<td align="right">0.0913611</td>
</tr>
</tbody>
</table>
</div>
<div id="by-week" class="section level2">
<h2>2021 by week</h2>
<pre class="r"><code>#Night, tenuituba
svf.otc &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, DN==&quot;night&quot;, Year==&quot;2021&quot;) %&gt;% 
  mutate(sampround = factor(ifelse(yday(date)&gt;200, &quot;4wks&quot;, &quot;2wks&quot;)))
vol.otc &lt;- vol[svf.otc$sample,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ sampround * temp, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ sampround * temp, data =
svf.otc, distance = &quot;bray&quot;)

               Inertia Proportion Rank
Total          5.90666    1.00000     
Constrained    0.25845    0.04376    3
Unconstrained  6.60597    1.11839   32
Imaginary     -0.95776   -0.16215   33
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
   CAP1    CAP2    CAP3 
0.12362 0.08432 0.05051 

Eigenvalues for unconstrained axes:
  MDS1   MDS2   MDS3   MDS4   MDS5   MDS6   MDS7   MDS8 
2.1598 1.0425 0.6220 0.5002 0.3549 0.2873 0.2273 0.1819 
(Showing 8 of 32 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>anova.cap &lt;- anova(cap.otc.comb, by=&quot;term&quot;)
kable(anova.cap, caption=&quot;CAP tenuituba night by week&quot;)</code></pre>
<table>
<caption>CAP tenuituba night by week</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Df</th>
<th align="right">SumOfSqs</th>
<th align="right">F</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">sampround</td>
<td align="right">1</td>
<td align="right">0.1104880</td>
<td align="right">1.0369793</td>
<td align="right">0.347</td>
</tr>
<tr class="even">
<td align="left">temp</td>
<td align="right">1</td>
<td align="right">0.0839481</td>
<td align="right">0.7878900</td>
<td align="right">0.566</td>
</tr>
<tr class="odd">
<td align="left">sampround:temp</td>
<td align="right">1</td>
<td align="right">0.0640108</td>
<td align="right">0.6007697</td>
<td align="right">0.798</td>
</tr>
<tr class="even">
<td align="left">Residual</td>
<td align="right">62</td>
<td align="right">6.6059728</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<pre class="r"><code>#Day, both species
svf.otc &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, DN==&quot;day&quot;, Year==&quot;2021&quot;) %&gt;% 
  mutate(sampround = factor(ifelse(yday(date)&gt;200, &quot;4wks&quot;, &quot;2wks&quot;)))
vol.otc &lt;- vol[svf.otc$sample,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ Site + sampround * temp, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ Site + sampround * temp, data
= svf.otc, distance = &quot;bray&quot;)

              Inertia Proportion Rank
Total         29.8190     1.0000     
Constrained    4.2000     0.1408    5
Unconstrained 33.8562     1.1354   75
Imaginary     -8.2372    -0.2762  132
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
  CAP1   CAP2   CAP3   CAP4   CAP5 
2.5423 0.9402 0.4642 0.1644 0.0888 

Eigenvalues for unconstrained axes:
 MDS1  MDS2  MDS3  MDS4  MDS5  MDS6  MDS7  MDS8 
6.688 4.822 2.283 2.075 1.591 1.386 1.186 1.098 
(Showing 8 of 75 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>anova.cap &lt;- anova(cap.otc.comb, by=&quot;term&quot;)
kable(anova.cap, caption=&quot;CAP both species day by week&quot;)</code></pre>
<table>
<caption>CAP both species day by week</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Df</th>
<th align="right">SumOfSqs</th>
<th align="right">F</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Site</td>
<td align="right">2</td>
<td align="right">2.8197144</td>
<td align="right">8.4117816</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">sampround</td>
<td align="right">1</td>
<td align="right">1.0302387</td>
<td align="right">6.1468231</td>
<td align="right">0.001</td>
</tr>
<tr class="odd">
<td align="left">temp</td>
<td align="right">1</td>
<td align="right">0.2373937</td>
<td align="right">1.4163875</td>
<td align="right">0.128</td>
</tr>
<tr class="even">
<td align="left">sampround:temp</td>
<td align="right">1</td>
<td align="right">0.1126442</td>
<td align="right">0.6720811</td>
<td align="right">0.812</td>
</tr>
<tr class="odd">
<td align="left">Residual</td>
<td align="right">202</td>
<td align="right">33.8562231</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<pre class="r"><code>(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ Site + sampround + temp, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ Site + sampround + temp, data
= svf.otc, distance = &quot;bray&quot;)

              Inertia Proportion Rank
Total         29.8190     1.0000     
Constrained    4.0873     0.1371    4
Unconstrained 33.9689     1.1392   75
Imaginary     -8.2372    -0.2762  132
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
  CAP1   CAP2   CAP3   CAP4 
2.5421 0.9364 0.4459 0.1630 

Eigenvalues for unconstrained axes:
 MDS1  MDS2  MDS3  MDS4  MDS5  MDS6  MDS7  MDS8 
6.691 4.829 2.298 2.075 1.595 1.387 1.190 1.106 
(Showing 8 of 75 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>summ.cap &lt;- summary(cap.otc.comb)
prop.expl &lt;- summ.cap$cont$importance
ax.labs &lt;- paste0(colnames(prop.expl)[1:2], &quot; (&quot;,round(100*prop.expl[2,1:2]),&quot;% explained)&quot;)

plot(cap.otc.comb, type=&quot;n&quot;, xlab=ax.labs[1], ylab=ax.labs[2])
title(paste(&quot;OTC warming, week: I. agg &amp; ten at all sites, 2021, day&quot;,&quot;n =&quot;, nrow(svf.otc)))
legend(&quot;bottomright&quot;,  title=paste(&quot;Site&quot;,&quot;\nP =&quot;,anova.cap[&quot;Site&quot;,&quot;Pr(&gt;F)&quot;]), legend=unique(svf.otc$Site))
legend(&quot;bottomleft&quot;,  title=paste(&quot;Treatment&quot;,&quot;\nP =&quot;,anova.cap[&quot;temp&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.otc$temp))
legend(&quot;topleft&quot;,  title=paste(&quot;Week&quot;,&quot;\nP =&quot;,anova.cap[&quot;sampround&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.otc$sampround), pch=c(1,2))
ordispider(cap.otc.comb, with(svf.otc, paste(Year, Site, temp, PlantID)), col=&quot;grey80&quot;)
points(cap.otc.comb, display=&quot;sites&quot;, col=tempcol[svf.otc$temp], pch=as.integer(svf.otc$sampround))
text(cap.otc.comb, display=&quot;cn&quot;)
text(cap.otc.comb, display=&quot;species&quot;, cex=0.7, srt=45,
                     col=ifelse(sqrt(cap.otc.comb$CCA$v[,1]^2 + cap.otc.comb$CCA$v[,2]^2)&gt;0.25, alpha(&quot;purple&quot;,0.7),alpha(&quot;purple&quot;,0)))</code></pre>
<p><img src="plots/otc_week-1.svg" width="768" /></p>
</div>
<div id="both-species-vwctemp-day" class="section level2">
<h2>Both species, VWC+temp, day</h2>
<pre class="r"><code>svf %&gt;% mutate(hasVWC=!is.na(SoilVWC+mean_temp_C_treatment)) %&gt;% filter(Expt==&quot;otc&quot;)%&gt;% count(Year, Site, DN, hasVWC) %&gt;% pivot_wider(names_from=hasVWC, values_from=n) %&gt;%   kable(caption=&quot;VOC samples with soil moisture and temp&quot;)</code></pre>
<table>
<caption>VOC samples with soil moisture and temp</caption>
<thead>
<tr class="header">
<th align="left">Year</th>
<th align="left">Site</th>
<th align="left">DN</th>
<th align="right">FALSE</th>
<th align="right">TRUE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2018</td>
<td align="left">GNA</td>
<td align="left">day</td>
<td align="right">3</td>
<td align="right">42</td>
</tr>
<tr class="even">
<td align="left">2018</td>
<td align="left">bb</td>
<td align="left">day</td>
<td align="right">26</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">2019</td>
<td align="left">GNA</td>
<td align="left">day</td>
<td align="right">12</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">2019</td>
<td align="left">SC</td>
<td align="left">day</td>
<td align="right">6</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="left">2019</td>
<td align="left">SC</td>
<td align="left">night</td>
<td align="right">17</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">2021</td>
<td align="left">GNA</td>
<td align="left">day</td>
<td align="right">NA</td>
<td align="right">56</td>
</tr>
<tr class="odd">
<td align="left">2021</td>
<td align="left">Maxfield</td>
<td align="left">day</td>
<td align="right">NA</td>
<td align="right">81</td>
</tr>
<tr class="even">
<td align="left">2021</td>
<td align="left">SC</td>
<td align="left">day</td>
<td align="right">NA</td>
<td align="right">71</td>
</tr>
<tr class="odd">
<td align="left">2021</td>
<td align="left">SC</td>
<td align="left">night</td>
<td align="right">2</td>
<td align="right">64</td>
</tr>
</tbody>
</table>
<pre class="r"><code>svf.otc &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, DN==&quot;day&quot;, Site!=&quot;bb&quot;) %&gt;% drop_na(SoilVWC, mean_temp_C_treatment)
vol.otc &lt;- vol[svf.otc$sample,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ Year + Site + SoilVWC + mean_temp_C_treatment, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ Year + Site + SoilVWC +
mean_temp_C_treatment, data = svf.otc, distance = &quot;bray&quot;)

               Inertia Proportion Rank
Total          39.1231     1.0000     
Constrained     5.8474     0.1495    6
Unconstrained  45.8134     1.1710   91
Imaginary     -12.5377    -0.3205  182
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
  CAP1   CAP2   CAP3   CAP4   CAP5   CAP6 
2.5524 1.7385 0.8798 0.3519 0.2162 0.1086 

Eigenvalues for unconstrained axes:
 MDS1  MDS2  MDS3  MDS4  MDS5  MDS6  MDS7  MDS8 
8.697 5.945 2.764 2.654 2.057 1.889 1.754 1.430 
(Showing 8 of 91 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>anova.cap &lt;- anova(cap.otc.comb, by=&quot;margin&quot;)
kable(anova.cap, caption=&quot;CAP both species, soil moisture and temperature&quot;)</code></pre>
<table>
<caption>CAP both species, soil moisture and temperature</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Df</th>
<th align="right">SumOfSqs</th>
<th align="right">F</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Year</td>
<td align="right">2</td>
<td align="right">1.4659382</td>
<td align="right">4.271738</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">Site</td>
<td align="right">2</td>
<td align="right">2.8941539</td>
<td align="right">8.433553</td>
<td align="right">0.001</td>
</tr>
<tr class="odd">
<td align="left">SoilVWC</td>
<td align="right">1</td>
<td align="right">0.2149235</td>
<td align="right">1.252572</td>
<td align="right">0.196</td>
</tr>
<tr class="even">
<td align="left">mean_temp_C_treatment</td>
<td align="right">1</td>
<td align="right">0.3330982</td>
<td align="right">1.941294</td>
<td align="right">0.027</td>
</tr>
<tr class="odd">
<td align="left">Residual</td>
<td align="right">267</td>
<td align="right">45.8133761</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<pre class="r"><code>summ.cap &lt;- summary(cap.otc.comb)
prop.expl &lt;- summ.cap$cont$importance
ax.labs &lt;- paste0(colnames(prop.expl)[1:2], &quot; (&quot;,round(100*prop.expl[2,1:2]),&quot;% explained)&quot;)

yearpch &lt;- c(`2018`=15,`2019`=19,`2021`=17)
plot(cap.otc.comb, type=&quot;n&quot;, xlab=ax.labs[1], ylab=ax.labs[2])
title(paste(&quot;Soil moisture + temperature: I. agg &amp; ten at all sites, all years&quot;,&quot;n =&quot;, nrow(svf.otc)))
VWCrange &lt;- round(c(max(svf.otc$SoilVWC), min(svf.otc$SoilVWC)))
legend(&quot;left&quot;,  title=paste(&quot;VWC&quot;,&quot;\nP =&quot;,anova.cap[&quot;SoilVWC&quot;,&quot;Pr(&gt;F)&quot;]), legend=paste(VWCrange, &quot;%&quot;), fill=rev(viridis(2)))
legend(&quot;topright&quot;,  title=paste(&quot;Year&quot;,&quot;\nP =&quot;,anova.cap[&quot;Year&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.otc$Year), pch=yearpch)
legend(&quot;bottomleft&quot;,  title=paste(&quot;Site&quot;,&quot;\nP =&quot;,anova.cap[&quot;Site&quot;,&quot;Pr(&gt;F)&quot;]), legend=unique(svf.otc$Site))
temprange &lt;- round(c(max(svf.otc$mean_temp_C_treatment), min(svf.otc$mean_temp_C_treatment)))
legend(&quot;topleft&quot;,  title=paste(&quot;Temperature&quot;,&quot;\nP =&quot;,anova.cap[&quot;mean_temp_C_treatment&quot;,&quot;Pr(&gt;F)&quot;]), legend=paste(temprange, &quot; C&quot;))
ordispider(cap.otc.comb, with(svf.otc, paste(Year, Site, temp, PlantID)), col=&quot;grey80&quot;)
points(cap.otc.comb, display=&quot;sites&quot;, col=viridis(round(VWCrange[1]-VWCrange[2])+1)[round(svf.otc$SoilVWC-VWCrange[2])+1], pch=yearpch[svf.otc$Year]) 
text(cap.otc.comb, display=&quot;cn&quot;)
text(cap.otc.comb, display=&quot;species&quot;, cex=0.7, srt=45,
                     col=ifelse(sqrt(cap.otc.comb$CCA$v[,1]^2 + cap.otc.comb$CCA$v[,2]^2)&gt;0.25, alpha(&quot;red&quot;,1),alpha(&quot;red&quot;,0)))</code></pre>
<p><img src="plots/otc_both_species_VWC_temp-1.svg" width="768" /></p>
<pre class="r"><code>ggplot(svf.otc, aes(x=mean_temp_C_treatment, y=SoilVWC))+ geom_point() + geom_smooth()</code></pre>
<p><img src="plots/otc_both_species_VWC_temp-2.svg" width="768" /></p>
</div>
<div id="selection-gradients" class="section level2">
<h2>Selection gradients</h2>
<p>Following method of <a href="https://doi.org/10.1002/evl3.63">Chong
et al.Â 2018</a> for reconstructing selection estimates from estimates of
selection on PCs: Beta = E * A.</p>
<pre class="r"><code>minsamples &lt;- 70
vol.top &lt;- vol[,colSums(decostand(vol,&quot;pa&quot;))&gt; minsamples]#occur in more than minsamples

sds &lt;- read_csv(&quot;data/2021_Maxfield_sds.csv&quot;) %&gt;% 
  mutate(prop_uninfested = 1 - prop_infested, 
         plant=as.character(plant))

fitnesstraits &lt;- c(&quot;seeds_est&quot;, &quot;seeds_per_flower&quot;, &quot;prop_uninfested&quot;) #&quot;eggs_per_flower&quot;
fitnessnames &lt;- set_names(c(&quot;Estimated total seeds&quot;, &quot;Estimated seeds per flower&quot;, &quot;Prop. nonaborted fruits uninfested&quot;), fitnesstraits)

# Run PCA on traits
vols.PCA &lt;- vol.top %&gt;% mutate(across(everything(), ~ (.x-mean(.x, na.rm=T))/sd(.x, na.rm=T))) %&gt;% 
  prcomp() 
summary(vols.PCA) # PCs 1 - 5 explain 63% of the variation, #PCs total = top volatiles</code></pre>
<pre><code>Importance of components:
                          PC1    PC2     PC3     PC4    PC5    PC6     PC7
Standard deviation     2.5918 1.7353 1.51401 1.29422 1.1672 1.0995 1.02406
Proportion of Variance 0.2584 0.1158 0.08816 0.06442 0.0524 0.0465 0.04033
Cumulative Proportion  0.2584 0.3742 0.46234 0.52676 0.5792 0.6257 0.66599
                           PC8    PC9    PC10    PC11    PC12    PC13    PC14
Standard deviation     1.00040 0.9913 0.96627 0.93446 0.86470 0.80196 0.77942
Proportion of Variance 0.03849 0.0378 0.03591 0.03359 0.02876 0.02474 0.02337
Cumulative Proportion  0.70448 0.7423 0.77819 0.81178 0.84053 0.86527 0.88864
                          PC15    PC16    PC17    PC18    PC19    PC20    PC21
Standard deviation     0.73450 0.69010 0.64039 0.54285 0.49078 0.46831 0.45172
Proportion of Variance 0.02075 0.01832 0.01577 0.01133 0.00926 0.00844 0.00785
Cumulative Proportion  0.90938 0.92770 0.94347 0.95481 0.96407 0.97251 0.98036
                          PC22    PC23    PC24    PC25    PC26
Standard deviation     0.38933 0.37997 0.31728 0.29021 0.17289
Proportion of Variance 0.00583 0.00555 0.00387 0.00324 0.00115
Cumulative Proportion  0.98619 0.99174 0.99561 0.99885 1.00000</code></pre>
<pre class="r"><code>vols.PCA.E &lt;- vols.PCA$rotation[,1:5] #min(4, ncol(vols.PCA$rotation))

calculate_beta &lt;- function(E, slopes) {
  data.frame(B = E %*% slopes$A,
             SE = sqrt(E ^ 2 %*% slopes$SE ^ 2)) %&gt;% 
    mutate(not_zero = abs(B) - SE &gt; 0) %&gt;% 
    rownames_to_column(&quot;trait&quot;)
}

selection_pca &lt;- function(temp=c(&quot;control&quot;,&quot;warmed&quot;), fitnesstrait = &quot;seeds_est&quot;) {
  vols.std.PCA &lt;- svf %&gt;% bind_cols(as.data.frame(vols.PCA$x)) %&gt;% 
    filter(temp %in% .env$temp) %&gt;% 
    mutate(plant=as.character(plant)) %&gt;% 
    left_join(sds, by=c(&quot;plotid&quot;, &quot;plant&quot;,&quot;temp&quot;)) %&gt;% 
    select(all_of(fitnesstrait), &quot;temp&quot;, starts_with(&quot;PC&quot;)) %&gt;% 
    rename(&quot;fitness&quot; = fitnesstrait) %&gt;% 
    mutate(relfitness = fitness/mean(fitness, na.rm=T), .keep=&quot;unused&quot;) %&gt;% ungroup %&gt;% 
    drop_na(relfitness) %&gt;% 
    select(where(~sum(is.na(.))==0))
  
  # Regress relative fitness on PCs
  vols.PCA.regression &lt;- lm(relfitness ~ PC1 + PC2 + PC3 + PC4 + PC5, data = vols.std.PCA)
  vols.PCA.slopes &lt;- tidy(vols.PCA.regression) %&gt;% filter(term != &quot;(Intercept)&quot;) %&gt;% rename(A=estimate, SE=std.error)
  
  # Convert selection gradients on PCs to gradients on traits
  calculate_beta(vols.PCA.E, vols.PCA.slopes)
}

plot_beta &lt;- function(betas) {
  bs &lt;- betas %&gt;% left_join(ipochems, by=c(&quot;trait&quot;=&quot;name&quot;)) %&gt;% 
    mutate(trait = fct_reorder(trait, map_dbl(vol.top[,trait], mean)))#order graph by mean emissions
  ggplot(bs, aes(y=trait, x = B, xmin=B-SE, xmax=B+SE)) + 
    geom_vline(xintercept=0)+ 
    geom_pointrange(aes(color=temp), position=position_dodge(width=0.5)) + 
    labs(x = &quot;Selection gradient (beta) estimated from PCs&quot;, y = &quot;&quot;,   color=&quot;Temperature&quot;) +
    scale_color_manual(values=tempcol) + theme_minimal() + #+ scale_x_continuous(limits=c(-0.55,0.55), n.breaks=10)  +
    theme(legend.position=&quot;bottom&quot;)
}

vols.beta.temp &lt;- expand_grid(temp=c(&quot;control&quot;,&quot;warmed&quot;),  fitnesstrait=fitnesstraits)  %&gt;% 
  mutate(betas = pmap(., selection_pca)) %&gt;% unnest(betas)

walk(fitnesstraits, ~print(plot_beta(filter(vols.beta.temp, fitnesstrait==.x)) + ggtitle(fitnessnames[.x])))</code></pre>
<p><img src="plots/gradients-1.svg" width="768" /><img src="plots/gradients-2.svg" width="768" /><img src="plots/gradients-3.svg" width="768" /></p>
</div>
</div>
<div id="percivals-warm-vs.-cool" class="section level1">
<h1>Percivals warm vs.Â cool</h1>
<div id="cap-analysis-of-each-percival-dataset" class="section level2">
<h2>CAP analysis of each Percival dataset</h2>
<pre class="r"><code>#inventory of samples
svf %&gt;% filter(expt==&quot;perc&quot;) %&gt;%  count(PlantType, DN, Temp,Year) %&gt;% kable(caption=&quot;Sample size&quot;)</code></pre>
<table>
<caption>Sample size</caption>
<thead>
<tr class="header">
<th align="left">PlantType</th>
<th align="left">DN</th>
<th align="left">Temp</th>
<th align="left">Year</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">cool</td>
<td align="left">2018</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">cool</td>
<td align="left">2019</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">warm</td>
<td align="left">2018</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">warm</td>
<td align="left">2019</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">night</td>
<td align="left">cool</td>
<td align="left">2018</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">night</td>
<td align="left">cool</td>
<td align="left">2019</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">night</td>
<td align="left">warm</td>
<td align="left">2018</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">night</td>
<td align="left">warm</td>
<td align="left">2019</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">cool</td>
<td align="left">2018</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">cool</td>
<td align="left">2019</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">warm</td>
<td align="left">2018</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">warm</td>
<td align="left">2019</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">cool</td>
<td align="left">2018</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">cool</td>
<td align="left">2019</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">warm</td>
<td align="left">2018</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">warm</td>
<td align="left">2019</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<pre class="r"><code>plot.perc &lt;- function(svf.perc, plot.chems=T) {
    vol.perc &lt;- vol[svf.perc$sample,]
    cap.perc &lt;- capscale(sqrt(vol.perc) ~ DN+Temp, distance=&quot;bray&quot;, data=svf.perc)
    summ.cap &lt;- summary(cap.perc)
    prop.expl &lt;- summ.cap$cont$importance[2,c(&quot;CAP1&quot;,&quot;CAP2&quot;)]
    ax.labs &lt;- paste0(&quot;CAP&quot;, 1:2, &quot; (&quot;,round(100*prop.expl),&quot;% explained)&quot;)
    anova.cap &lt;- anova(cap.perc, by=&quot;margin&quot;)
    
    plot(cap.perc, type=&quot;n&quot;, xlim=range(cap.perc$CCA$wa[,1]), xlab=ax.labs[1], ylab=ax.labs[2])
    with(svf.perc, title(paste0(&quot;Percivals: I. &quot;, unique(PlantType),&quot; in &quot;, unique(Year), &quot; n = &quot;, nrow(svf.perc))))
    #, &quot; (&quot;,round(100*summ.cap$constr.chi / summ.cap$tot.chi),&quot;% explained)&quot;)
    legend(&quot;topleft&quot;, title=paste(&quot;Temperature&quot;,&quot;\nP =&quot;,anova.cap[&quot;Temp&quot;,&quot;Pr(&gt;F)&quot;]), 
           levels(svf.perc$Temp), fill=Tempcol)
    legend(&quot;topright&quot;, title=paste(&quot;Time&quot;,&quot;\nP =&quot;,anova.cap[&quot;DN&quot;,&quot;Pr(&gt;F)&quot;]), 
           levels(svf.perc$DN), pch=c(1,19))
    if(plot.chems) text(cap.perc, display=&quot;species&quot;, cex=0.7, srt=45,
                     col=ifelse(sqrt(cap.perc$CCA$v[,1]^2 + cap.perc$CCA$v[,2]^2)&gt;0.25, alpha(&quot;purple&quot;,0.7),alpha(&quot;purple&quot;,0)))
    ordispider(cap.perc, with(svf.perc, paste(Year, Temp, Sample2)), col=&quot;grey80&quot;)
    points(cap.perc, display=&quot;sites&quot;, col=Tempcol[svf.perc$Temp], pch=c(1,19)[svf.perc$DN]) 
    text(cap.perc, display=&quot;cn&quot;)
    return(cap.perc)
}
cap.perc.agg18 &lt;-  plot.perc(svf %&gt;% filter(expt==&quot;perc&quot;,Year==&quot;2018&quot;,PlantType==&quot;agg&quot;))</code></pre>
<p><img src="plots/perc-1.svg" width="768" /></p>
<pre class="r"><code>cap.perc.agg19 &lt;-  plot.perc(svf %&gt;% filter(expt==&quot;perc&quot;,Year==&quot;2019&quot;,PlantType==&quot;agg&quot;))</code></pre>
<p><img src="plots/perc-2.svg" width="768" /></p>
<pre class="r"><code>cap.perc.ten18 &lt;-  plot.perc(svf %&gt;% filter(expt==&quot;perc&quot;,Year==&quot;2018&quot;,PlantType==&quot;ten&quot;))</code></pre>
<p><img src="plots/perc-3.svg" width="768" /></p>
<pre class="r"><code>cap.perc.ten19 &lt;-  plot.perc(svf %&gt;% filter(expt==&quot;perc&quot;,Year==&quot;2019&quot;,PlantType==&quot;ten&quot;))</code></pre>
<p><img src="plots/perc-4.svg" width="768" /></p>
<pre class="r"><code>#cap.perc.all &lt;- list(agg18=cap.perc.agg18, agg19=cap.perc.agg19, ten18=cap.perc.ten18, ten19=cap.perc.ten19)
#lapply(cap.perc.all, anova, by=&quot;margin&quot;)</code></pre>
</div>
<div id="cap-of-percival-dataset-combined-for-each-species"
class="section level2">
<h2>CAP of Percival dataset combined for each species</h2>
<pre class="r"><code>plot.perc.comb &lt;- function(svf.perc, plot.chems=F) {
  vol.perc &lt;- vol[svf.perc$sample,]
  cap.perc.comb &lt;- capscale(sqrt(vol.perc) ~ Year+DN+Temp, distance=&quot;bray&quot;, data=svf.perc)
    summ.cap &lt;- summary(cap.perc.comb)
    prop.expl &lt;- summ.cap$cont$importance[2,c(&quot;CAP1&quot;,&quot;CAP2&quot;)]
    ax.labs &lt;- paste0(&quot;CAP&quot;, 1:2, &quot; (&quot;,round(100*prop.expl),&quot;% explained)&quot;)
    anova.cap &lt;- anova(cap.perc.comb, by=&quot;margin&quot;)
    
    plot(cap.perc.comb, type=&quot;n&quot;, xlim=range(cap.perc.comb$CCA$wa[,1]), xlab=ax.labs[1], ylab=ax.labs[2])
    title(paste(&quot;Percivals: I.&quot;,unique(svf.perc$PlantType), &quot;2018/2019&quot;,&quot;n =&quot;, nrow(svf.perc)))
    legend(&quot;bottomleft&quot;, title=paste(&quot;Temperature&quot;,&quot;\nP =&quot;,anova.cap[&quot;Temp&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.perc$Temp), fill=Tempcol)
  legend(&quot;bottomright&quot;, title=paste(&quot;Time&quot;,&quot;\nP =&quot;,anova.cap[&quot;DN&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.perc$DN), fil=c(0,1))
  legend(&quot;topright&quot;, title=paste(&quot;Year&quot;,&quot;\nP =&quot;,anova.cap[&quot;Year&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.perc$Year), pch=c(19,15))
  ordispider(cap.perc.comb, with(svf.perc, paste(Year, Temp, Sample2)), col=&quot;grey80&quot;)
  points(cap.perc.comb, display=&quot;sites&quot;, col=Tempcol[svf.perc$Temp], pch=c(1,0,19,15)[factor(paste(svf.perc$DN, svf.perc$Year))]) 
  text(cap.perc.comb, display=&quot;cn&quot;)
  text(cap.perc.comb, display=&quot;species&quot;, cex=0.7, srt=45, col=ifelse(sqrt(cap.perc.comb$CCA$v[,1]^2 + cap.perc.comb$CCA$v[,2]^2)&gt;0.2, alpha(&quot;purple&quot;,1),alpha(&quot;purple&quot;,0)))
  return(cap.perc.comb)
}
svf.perc.agg &lt;- plot.perc.comb(svf %&gt;% filter(expt==&quot;perc&quot;, PlantType==&quot;agg&quot;))</code></pre>
<p><img src="plots/perc_comb-1.svg" width="768" /></p>
<pre class="r"><code>svf.perc.ten &lt;- plot.perc.comb(svf %&gt;% filter(expt==&quot;perc&quot;, PlantType==&quot;ten&quot;))</code></pre>
<p><img src="plots/perc_comb-2.svg" width="768" /></p>
<pre class="r"><code>#svf.perc.both &lt;- plot.perc.comb(svf %&gt;% filter(expt==&quot;perc&quot;))</code></pre>
</div>
</div>
<div id="individual-volatiles" class="section level1">
<h1>Individual volatiles</h1>
<div id="treatment-effects" class="section level2">
<h2>Treatment effects</h2>
<pre class="r"><code>vols.plot &lt;- chemsf %&gt;% filter(filter_final, freq.floral&gt;0.18) %&gt;% arrange(desc(freq.floral)) %&gt;% pull(&quot;name&quot;) %&gt;% as.character
#%&gt;%union(colnames(quant.scaled.vol))
#vols.plot[vols.plot==&quot;b-caryophyllene&quot;] &lt;- &quot;b-caryophyllene.1&quot;#c(&quot;b-ocimene&quot;,&quot;a-pinene&quot;,&quot;a-farnesene&quot;,&quot;b-caryophyllene.1&quot;,&quot;petasitene&quot;,&quot;b-myrcene&quot;,&quot;longifolene&quot;,&quot;tridec-1-ene  &quot;,&quot;benzophenone&quot;)
vol.long &lt;- gather(cbind(sample=rownames(vol[,vols.plot]), total=rowSums(vol), vol[,vols.plot]), key=&quot;chem&quot;,value=&quot;area&quot;, 2:(length(vols.plot)+2), factor_key=T)
vol.plot &lt;- left_join(vol.long, svf) %&gt;% mutate(chem=factor(chem, levels=c(&quot;total&quot;,vols.plot)))

specDNcols &lt;- c( &quot;#943390&quot;,&quot;#FF5056&quot;, &quot;#A894FF&quot;,&quot;#FC8C97&quot;)
#Treatcols &lt;- c(&quot;#DA9E18&quot;,&quot;#6B744F&quot;)
DNcols &lt;- c(&quot;grey90&quot;,&quot;grey20&quot;)
ggplot(vol.plot %&gt;% drop_na(PlantType, expt) %&gt;% filter(expt==&quot;otc&quot;, Site!=&quot;bb&quot;),#TODO track down NAs
       aes(x=paste(Site, Year),y=area,  fill=DN, color=paste(Treat))) +
  geom_boxplot(size=0.7, outlier.size=0.7, position=position_dodge2(preserve=&quot;total&quot;)) + 
  facet_wrap(vars(chem), scales=&quot;free_y&quot;) + 
  scale_y_sqrt(&quot;Emissions (ng/flower/hr)&quot;) + 
  scale_color_brewer(&quot;Treatment&quot;, palette = &quot;Set1&quot;, direction=-1)+
  scale_x_discrete(&quot;Site, year&quot;)+
  scale_fill_manual(&quot;Time of day&quot;,values=DNcols) + 
  theme_minimal() + theme(axis.text.x=element_text(angle=20, vjust=0.5))</code></pre>
<p><img src="plots/barplots-1.svg" width="960" /></p>
<p>Mean change in warming treatment relative to controls.</p>
<pre class="r"><code>vol.plot.treat &lt;- vol.plot %&gt;% filter(expt==&quot;otc&quot;, Site!=&quot;bb&quot;) %&gt;% 
  group_by(chem, PlantType, Site, Year, DN) %&gt;% select(temp, area) %&gt;% nest() %&gt;% 
  mutate(model = map(data, ~ lm(area~temp, data=.x)),#TODO lmer with PlantID for 2021?
         test = map(model, ~tidy(summary(.x)))) %&gt;% select(-data, -model) %&gt;% unnest(test) %&gt;% 
  mutate(relchange = estimate[2]/estimate[1],#divide warming change by intercept (mean of controls)
         ratio = (estimate[1] + estimate[2]) / estimate[1] ) %&gt;% # warmed/control ratio 
  filter(term==&quot;tempwarmed&quot;)

ggplot(vol.plot.treat, aes(x=paste(paste(ifelse(PlantType==&quot;agg&quot;,Site,as.character(DN)), str_sub(Year,3,4))), y=fct_rev(chem))) + 
  facet_wrap(vars(PlantType), scales=&quot;free_x&quot;, 
             labeller = as_labeller(c(agg=&quot;I. aggregata&quot;, ten=&quot;I. tenuituba&quot;)))+
  geom_tile(aes(fill=sign(relchange)* abs(relchange)^(1/3))) + scale_fill_gradient2(midpoint=0, guide=&quot;none&quot;)  + 
  geom_text(aes(label=scales::percent(relchange, accuracy=1), fontface=as.integer(p.value &lt; 0.05)+1))+ labs(x=&quot;&quot;,y=&quot;&quot;)+
  theme_minimal() + theme(panel.grid = element_blank(), strip.text = element_text(face=&quot;italic&quot;),
                          axis.text=element_text(color=&quot;black&quot;))</code></pre>
<p><img src="plots/treatmentmap-1.svg" width="672" /></p>
<pre class="r"><code>lmer(indole~temp+(1|PlantID), data = filter(cbind(vol,svf), expt==&quot;otc&quot;, PlantType==&quot;ten&quot;, DN==&quot;day&quot;)) %&gt;% anova() %&gt;% 
  kable(caption=&quot;indole tenuituba day&quot;)</code></pre>
<table>
<caption>indole tenuituba day</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">temp</td>
<td align="right">0.0676582</td>
<td align="right">0.0676582</td>
<td align="right">1</td>
<td align="right">90</td>
<td align="right">0.5801704</td>
<td align="right">0.4482369</td>
</tr>
</tbody>
</table>
<pre class="r"><code>lmer(indole~temp+(1|PlantID), data = filter(cbind(vol,svf), expt==&quot;otc&quot;, PlantType==&quot;ten&quot;, DN==&quot;night&quot;)) %&gt;% anova() %&gt;% 
    kable(caption=&quot;indole tenuituba night&quot;)</code></pre>
<table>
<caption>indole tenuituba night</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">temp</td>
<td align="right">0.0926084</td>
<td align="right">0.0926084</td>
<td align="right">1</td>
<td align="right">55.92978</td>
<td align="right">1.016913</td>
<td align="right">0.3175954</td>
</tr>
</tbody>
</table>
</div>
<div id="actual-temperature-effects" class="section level2">
<h2>Actual temperature effects</h2>
<pre class="r"><code>ggplot(drop_na(vol.plot, PlantType, expt) %&gt;% filter(expt==&quot;otc&quot;, Site!=&quot;bb&quot;),#TODO track down NAs
       aes(x=mean_temp_C_treatment, y=area, shape=DN, color=paste(PlantType, Site, Year))) +
  geom_point() + geom_smooth(se=F, method=&quot;loess&quot;, span=1)+ 
  facet_wrap(vars(chem), scales=&quot;free_y&quot;) + 
  scale_y_sqrt(&quot;Emissions (ng/flower/hr)&quot;) + 
  scale_x_continuous(&quot;Mean temperature in controls or OTCs (\u00B0C)&quot;)+
  scale_color_brewer(&quot;Species, site, year&quot;, palette = &quot;Dark2&quot;, direction=-1)+#scale_color_manual(&quot;Species&quot;, values=spcols) + 
  scale_shape_manual(&quot;Time of day&quot;,values=c(1,19)) + 
  theme_minimal() + theme(axis.text.x=element_text(angle=20, vjust=0.5))</code></pre>
<p><img src="plots/temptrend-1.svg" width="960" /></p>
<pre class="r"><code>vol.plot %&gt;% filter(expt==&quot;otc&quot;, Site!=&quot;bb&quot;) %&gt;% drop_na(mean_temp_C_treatment) %&gt;% 
  group_by(chem, PlantType, Site, Year, DN) %&gt;% select(mean_temp_C_treatment, area) %&gt;% nest() %&gt;% 
  mutate(model = map(data, ~ lm(area~poly(mean_temp_C_treatment, 2), data=.x)),
         test = map(model, ~tidy(summary(.x)))) %&gt;% select(-data, -model) %&gt;% unnest(test) %&gt;% 
  filter(term==&quot;poly(mean_temp_C_treatment, 2)2&quot;, p.value &lt; 0.05) %&gt;% select(-term, -std.error, -statistic) %&gt;% 
  arrange(p.value) %&gt;%  kable(caption=&quot;Temperature curves with a significant quadratic term&quot;)</code></pre>
<table>
<caption>Temperature curves with a significant quadratic term</caption>
<colgroup>
<col width="26%" />
<col width="14%" />
<col width="13%" />
<col width="7%" />
<col width="5%" />
<col width="16%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">chem</th>
<th align="left">PlantType</th>
<th align="left">Site</th>
<th align="left">Year</th>
<th align="left">DN</th>
<th align="right">estimate</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">linalool</td>
<td align="left">agg</td>
<td align="left">Maxfield</td>
<td align="left">2021</td>
<td align="left">day</td>
<td align="right">9.845211</td>
<td align="right">0.0060282</td>
</tr>
<tr class="even">
<td align="left">a-pinene</td>
<td align="left">agg</td>
<td align="left">Maxfield</td>
<td align="left">2021</td>
<td align="left">day</td>
<td align="right">251.561188</td>
<td align="right">0.0272190</td>
</tr>
<tr class="odd">
<td align="left">total</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">2021</td>
<td align="left">day</td>
<td align="right">507.931118</td>
<td align="right">0.0344669</td>
</tr>
<tr class="even">
<td align="left">linalool</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">2018</td>
<td align="left">day</td>
<td align="right">1.600831</td>
<td align="right">0.0356243</td>
</tr>
<tr class="odd">
<td align="left">(E)-hex-3-en-1-ol</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">2021</td>
<td align="left">day</td>
<td align="right">143.327999</td>
<td align="right">0.0434185</td>
</tr>
<tr class="even">
<td align="left">b-caryophyllene</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">2021</td>
<td align="left">day</td>
<td align="right">73.502472</td>
<td align="right">0.0482241</td>
</tr>
</tbody>
</table>
<p>Units are change (relative to the mean) per degree Celsius</p>
<pre class="r"><code>vol.plot.temp &lt;- vol.plot %&gt;% filter(expt==&quot;otc&quot;, Site!=&quot;bb&quot;) %&gt;% drop_na(mean_temp_C_treatment) %&gt;% 
  group_by(chem, PlantType, Site, Year, DN) %&gt;% select(mean_temp_C_treatment, area) %&gt;% 
  mutate(area=area/mean(area)) %&gt;% nest() %&gt;% 
  mutate(model = map(data, ~ lm(area~mean_temp_C_treatment, data=.x)),
         test = map(model, ~tidy(summary(.x)))) %&gt;% select(-data, -model) %&gt;% unnest(test) %&gt;% 
  filter(term==&quot;mean_temp_C_treatment&quot;)

ggplot(vol.plot.temp, aes(x=paste(ifelse(PlantType==&quot;agg&quot;,Site,as.character(DN)), str_sub(Year,3,4)), y=fct_rev(chem))) + 
  facet_wrap(vars(PlantType), scales=&quot;free_x&quot;, 
             labeller = as_labeller(c(agg=&quot;I. aggregata&quot;, ten=&quot;I. tenuituba&quot;)))+
  geom_tile(aes(fill=estimate)) + scale_fill_gradient2(guide=&quot;none&quot;)  + 
  geom_text(aes(label=scales::percent(estimate, accuracy=1), fontface=as.integer(p.value &lt; 0.05)+1))+ labs(x=&quot;&quot;,y=&quot;&quot;)+
  theme_minimal() + theme(panel.grid = element_blank(), strip.text = element_text(face=&quot;italic&quot;),
                          axis.text=element_text(color=&quot;black&quot;))</code></pre>
<p><img src="plots/temperaturemap-1.svg" width="672" /></p>
<p>Both temperature and treatment</p>
<pre class="r"><code>safe_lmer &lt;- function(formula, data) {
 if(length(unique(pull(data,as.character(findbars(formula)[[1]])[3]))) &lt; nrow(data)*(2/3)) {
   lmer(formula, data=data) #run only if there are more random effect levels than rows
 } else {
   lm(nobars(formula), data=data) #else drop the random effects and run an lm
 }
}
library(broom.mixed)
vol.plot.temptreat &lt;- vol.plot %&gt;% filter(expt==&quot;otc&quot;, Site!=&quot;bb&quot;) %&gt;% drop_na(mean_temp_C_treatment) %&gt;% 
  group_by(chem, PlantType, Site, Year, DN) %&gt;% select(temp, mean_temp_C_treatment, area, PlantID) %&gt;% 
  mutate(area=area/mean(area), PlantID=as.character(PlantID)) %&gt;% nest() %&gt;% 
  mutate(coef = map(data, ~tidy(safe_lmer(area ~ temp + mean_temp_C_treatment + (1|PlantID), data=.x)))) %&gt;% 
  select(coef) %&gt;% unnest(coef) %&gt;% filter(term %in% c(&quot;tempwarmed&quot;,&quot;mean_temp_C_treatment&quot;))

ggplot(vol.plot.temptreat, aes(x=paste(ifelse(PlantType==&quot;agg&quot;,Site,as.character(DN)), str_sub(Year,3,4)), y=fct_rev(chem))) + 
  facet_grid(term ~PlantType, scales=&quot;free_x&quot;, 
             labeller = as_labeller(c(agg=&quot;I. aggregata&quot;, ten=&quot;I. tenuituba&quot;, mean_temp_C_treatment=&quot;Temperature&quot;, tempwarmed=&quot;Treatment&quot;)))+
  geom_tile(aes(fill=estimate)) + scale_fill_gradient2(guide=&quot;none&quot;)  + 
  geom_text(aes(label=scales::percent(estimate, accuracy=1), fontface=as.integer(p.value &lt; 0.05)+1))+ labs(x=&quot;&quot;,y=&quot;&quot;)+
  theme_minimal() + theme(panel.grid = element_blank(), strip.text = element_text(face=&quot;italic&quot;),
                          axis.text=element_text(color=&quot;black&quot;))</code></pre>
<p><img src="plots/temptreatmap-1.svg" width="672" /></p>
<pre class="r"><code>vol.plot %&gt;% filter(expt==&quot;otc&quot;, Site!=&quot;bb&quot;, chem==&quot;total&quot;) %&gt;% 
  ggplot(aes(x=mean_temp_C_treatment, y=area, color=temp)) + geom_point() +
  facet_wrap(vars(PlantType, Site,  DN, Year)) + geom_smooth(method=&quot;lm&quot;) + scale_color_brewer(palette = &quot;Set1&quot;, direction = -1)</code></pre>
<p><img src="plots/temptreatmap-2.svg" width="672" /></p>
<pre class="r"><code>#TODO may need to add temp*treat interaction, since fixed slope is giving misleading conclusions
#TODO temperature range is very short in 2019 (fewer sampling days) and at night - not very informative
#TODO most of the temp variation in among sampling days, confounded if scent changes with season
#TODO no sqrt transformation, so outliers have more influence on lms</code></pre>
<pre class="r"><code>bind_rows(treat=vol.plot.treat %&gt;% rename(value=relchange), 
          temp=vol.plot.temp %&gt;% rename(value=estimate), .id=&quot;variable&quot;) %&gt;% 
  select(-term, -std.error, -statistic, -p.value, -ratio, -estimate) %&gt;% 
  pivot_wider(names_from =variable, values_from=value) %&gt;% 
  ggplot(aes(y=treat, x=temp, color=paste(PlantType, Site, DN, Year))) + 
  geom_hline(yintercept=0) + geom_vline(xintercept=0) +  
  geom_smooth(se=F, method=&quot;lm&quot;) +
  geom_text(aes(label=chem), show.legend = F)+
  theme_minimal() + scale_y_continuous(labels=scales::percent_format(),limits=c(NA,4)) +
  scale_x_continuous(labels=scales::percent_format()) + scale_color_brewer(palette = &quot;Set2&quot;) +
  labs(x=&quot;Change in emissions per degree C&quot;, y=&quot;Change in emissions in warming treatment&quot;,
       color=&quot;Species, site, time, year&quot;)</code></pre>
<p><img src="plots/tempvtreat-1.svg" width="768" /></p>
</div>
<div id="soil-moisture-effects" class="section level2">
<h2>Soil moisture effects</h2>
<pre class="r"><code>ggplot(drop_na(vol.plot, PlantType, expt) %&gt;% filter(expt==&quot;otc&quot;, Site!=&quot;bb&quot;),#TODO track down NAs
       aes(x=SoilVWC, y=area, shape=DN, color=paste(PlantType, Site, Year))) +
  geom_point() + geom_smooth(se=F, method=&quot;loess&quot;, span=1)+
  facet_wrap(vars(chem), scales=&quot;free_y&quot;) + 
  scale_y_sqrt(&quot;Emissions (ng/flower/hr)&quot;) + 
  scale_x_continuous(&quot;Soil volumetric water content (%)&quot;)+
  scale_color_brewer(&quot;Species, site, year&quot;, palette = &quot;Dark2&quot;, direction=-1)+#scale_color_manual(&quot;Species&quot;, values=spcols) + 
  scale_shape_manual(&quot;Time of day&quot;,values=c(1,19)) + 
  theme_minimal() + theme(axis.text.x=element_text(angle=20, vjust=0.5))</code></pre>
<p><img src="plots/VWCtrend-1.svg" width="960" /></p>
<pre class="r"><code>vol.plot %&gt;% filter(expt==&quot;otc&quot;, Site!=&quot;bb&quot;) %&gt;% drop_na(SoilVWC) %&gt;% 
  group_by(chem, PlantType, Site, Year, DN) %&gt;% select(SoilVWC, area) %&gt;% nest() %&gt;% 
  mutate(model = map(data, ~ lm(area~poly(SoilVWC, 2), data=.x)),
         test = map(model, ~tidy(summary(.x)))) %&gt;% select(-data, -model) %&gt;% unnest(test) %&gt;% 
  filter(term==&quot;poly(SoilVWC, 2)2&quot;, p.value &lt; 0.05) %&gt;% select(-term, -std.error, -statistic) %&gt;% 
  arrange(p.value) %&gt;%  kable(caption=&quot;Soil moisture curves with a significant quadratic term&quot;)</code></pre>
<table>
<caption>Soil moisture curves with a significant quadratic
term</caption>
<thead>
<tr class="header">
<th align="left">chem</th>
<th align="left">PlantType</th>
<th align="left">Site</th>
<th align="left">Year</th>
<th align="left">DN</th>
<th align="right">estimate</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">pseudoionone</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">2019</td>
<td align="left">day</td>
<td align="right">43.682563</td>
<td align="right">0.0022612</td>
</tr>
<tr class="even">
<td align="left">total</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">2019</td>
<td align="left">day</td>
<td align="right">324.647956</td>
<td align="right">0.0049892</td>
</tr>
<tr class="odd">
<td align="left">petasitene</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">2019</td>
<td align="left">day</td>
<td align="right">27.791966</td>
<td align="right">0.0186905</td>
</tr>
<tr class="even">
<td align="left">b-caryophyllene</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">2019</td>
<td align="left">day</td>
<td align="right">10.284161</td>
<td align="right">0.0337684</td>
</tr>
<tr class="odd">
<td align="left">(E)-b-ocimene</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">2019</td>
<td align="left">day</td>
<td align="right">2.927797</td>
<td align="right">0.0394152</td>
</tr>
<tr class="even">
<td align="left">linalool</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">2019</td>
<td align="left">day</td>
<td align="right">1.064876</td>
<td align="right">0.0432152</td>
</tr>
<tr class="odd">
<td align="left">a-pinene</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">2019</td>
<td align="left">day</td>
<td align="right">171.534654</td>
<td align="right">0.0466853</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="leaf-volatiles" class="section level1">
<h1>Leaf volatiles</h1>
<div id="inventory-1" class="section level2">
<h2>Inventory</h2>
<p>Dropped 2 samples from 2018 without leaf mass. Volatiles units are ng
per hour per gram dry leaf.</p>
<pre class="r"><code>svl %&gt;% count(PlantType, Treat, expt, Year) %&gt;% kable(caption=&quot;Sample size&quot;)</code></pre>
<table>
<caption>Sample size</caption>
<thead>
<tr class="header">
<th align="left">PlantType</th>
<th align="left">Treat</th>
<th align="left">expt</th>
<th align="right">Year</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">aggleaf</td>
<td align="left">control</td>
<td align="left">otc</td>
<td align="right">2019</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">aggleaf</td>
<td align="left">control</td>
<td align="left">perc</td>
<td align="right">2019</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">aggleaf</td>
<td align="left">warmed</td>
<td align="left">otc</td>
<td align="right">2019</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">aggleaf</td>
<td align="left">warmed</td>
<td align="left">perc</td>
<td align="right">2019</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">tenleaf</td>
<td align="left">control</td>
<td align="left">otc</td>
<td align="right">2019</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">tenleaf</td>
<td align="left">control</td>
<td align="left">perc</td>
<td align="right">2019</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">tenleaf</td>
<td align="left">warmed</td>
<td align="left">otc</td>
<td align="right">2019</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">tenleaf</td>
<td align="left">warmed</td>
<td align="left">perc</td>
<td align="right">2019</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<pre class="r"><code>sort(colSums(vol.leaf)/sum(colSums(vol.leaf)) )</code></pre>
<pre><code>                         undecanal                         hexan-1-ol 
                       0.003459435                        0.005312008 
(E)-12-cyclopropyldodec-11-en-1-ol        [(Z)-hex-3-enyl] pentanoate 
                       0.008473771                        0.009631390 
                 (Z)-hex-2-en-1-ol                       pseudoionone 
                       0.010058645                        0.010463577 
                        hex-2-enal                      1-penten-3-ol 
                       0.011394371                        0.012608089 
                        petasitene                    b-caryophyllene 
                       0.014920964                        0.016102368 
               4-methylpentan-1-ol                      a-campholenal 
                       0.017336836                        0.018115110 
               (E)-4-oxohex-2-enal                     (E)-hex-2-enal 
                       0.022916182                        0.081556502 
          [(E)-hex-3-enyl] acetate                  (E)-hex-3-en-1-ol 
                       0.114923650                        0.315435931 
                          a-pinene 
                       0.327291173 </code></pre>
</div>
<div id="heatmap" class="section level2">
<h2>Heatmap</h2>
<pre class="r"><code>#cairo_pdf(&quot;ipo_heatmap_leaf.pdf&quot;, width=12, height=12)
ph_leaf  &lt;- pheatmap(as.matrix(t(vol.leaf))^(1/3), 
         cluster_cols=T, show_colnames=F,
         clustering_method=&quot;mcquitty&quot;, clustering_distance_rows=&quot;correlation&quot;,
         clustering_distance_cols=vegdist(vol.leaf, method = &quot;bray&quot;),
         clustering_callback = function(hc, ...){dendsort(hc, type=&quot;average&quot;)},
         scale=&quot;none&quot;, color=inferno(512),
         annotation_col = data.frame(svl %&gt;% select(&quot;PlantType&quot;, &quot;expt&quot;, &quot;Treat&quot;), row.names=rownames(vol.leaf)), 
   fontsize = 10, border_color = NA, legend=F, annotation_legend=T, cutree_rows=6
)</code></pre>
<p><img src="plots/heatmap_leaf-1.png" width="1152" /></p>
<pre class="r"><code>#dev.off()</code></pre>
</div>
<div id="leaf-nmds" class="section level2">
<h2>Leaf NMDS</h2>
<pre class="r"><code>set.seed(1)
nmds.vol_leaf &lt;- metaMDS(sqrt(vol.leaf), dist=&quot;bray&quot;, autotransform = FALSE, trace=F)

TEY &lt;- with(svl, factor(paste(PlantType,expt,Year)))
TEYcols &lt;- brewer.pal(9, &quot;Paired&quot;)#[c(1:4,8,5:6)]
spcols &lt;- c(aggleaf=&quot;red&quot;, tenleaf=&quot;violet&quot;)
ordiplot(nmds.vol_leaf, type = &quot;n&quot;)
legend(&quot;bottomleft&quot;, levels(TEY), fill=TEYcols, cex=0.9)
points(nmds.vol_leaf, display=&quot;sites&quot;, col=TEYcols[TEY], pch=19)
text(nmds.vol_leaf, display=&quot;species&quot;, cex=0.7, col=&quot;grey20&quot;)</code></pre>
<p><img src="plots/nmds_filtered_leaf-1.svg" width="768" /></p>
<pre class="r"><code>#points(nmds.vol_leaf, display=&quot;sites&quot;, col=viridis(100)[sqrt(rowSums(vol.leaf))/26], pch=19)</code></pre>
</div>
<div id="cap---otcs" class="section level2">
<h2>CAP - OTCs</h2>
<pre class="r"><code>svf.otc &lt;- svl %&gt;% filter(expt==&quot;otc&quot;)
vol.otc &lt;- vol.leaf[svl$expt==&quot;otc&quot;,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ PlantType + temp, distance=&quot;bray&quot;, data=svf.otc)) #can&#39;t test temp, missing data</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ PlantType + temp, data =
svf.otc, distance = &quot;bray&quot;)

              Inertia Proportion Rank
Total          4.8289     1.0000     
Constrained    0.6177     0.1279    2
Unconstrained  4.7268     0.9789   19
Imaginary     -0.5156    -0.1068   15
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
  CAP1   CAP2 
0.4777 0.1400 

Eigenvalues for unconstrained axes:
  MDS1   MDS2   MDS3   MDS4   MDS5   MDS6   MDS7   MDS8 
1.4888 0.8541 0.5387 0.3637 0.3156 0.2593 0.2007 0.1452 
(Showing 8 of 19 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>anova(cap.otc.comb, by=&quot;margin&quot;) %&gt;% kable(caption=&quot;CAP&quot;)</code></pre>
<table>
<caption>CAP</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Df</th>
<th align="right">SumOfSqs</th>
<th align="right">F</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">PlantType</td>
<td align="right">1</td>
<td align="right">0.4673046</td>
<td align="right">3.1636345</td>
<td align="right">0.012</td>
</tr>
<tr class="even">
<td align="left">temp</td>
<td align="right">1</td>
<td align="right">0.1404073</td>
<td align="right">0.9505522</td>
<td align="right">0.412</td>
</tr>
<tr class="odd">
<td align="left">Residual</td>
<td align="right">32</td>
<td align="right">4.7267622</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<pre class="r"><code>prop.expl &lt;- summary(cap.otc.comb)$cont$importance
ax.labs &lt;- paste0(colnames(prop.expl)[1:2], &quot; (&quot;,round(100*prop.expl[2,1:2]),&quot;% explained)&quot;)
cap.df &lt;- fortify(cap.otc.comb) 
ggplot(mapping=aes(x=CAP1, y=CAP2, label=Label)) + 
  geom_point(data=cap.df %&gt;% filter(Score==&quot;sites&quot;) %&gt;% bind_cols(svf.otc), aes(color=temp, shape=PlantType), size=3)+
  geom_segment(data=cap.df %&gt;% filter(Score==&quot;biplot&quot;, Label %in% arrowvars), aes(x=0,y=0,xend=CAP1*1.2, yend=CAP2*1.2), 
               arrow=arrow(length=unit(0.5, &quot;lines&quot;)), color=&quot;white&quot;)+
  geom_text(data=cap.df %&gt;% filter(Score==&quot;biplot&quot;, Label %in% arrowvars[2]) %&gt;% mutate(Label=names(arrowvars[2])),
            aes(x=CAP1*1.3, y=CAP2*1.3, angle=atan(CAP2/CAP1)*180/pi, hjust=1), fontface=&quot;bold&quot;, color=&quot;white&quot;, size=5) +
  geom_text(data=cap.df %&gt;% filter(Score==&quot;centroids&quot;) %&gt;% mutate(Label=c(&quot;aggregata&quot;,&quot;tenuituba&quot;,&quot;&quot;,&quot;&quot;)),
            aes(x=CAP1, y=CAP2), fontface=4, color=&quot;white&quot;, size=5) +
  geom_text_repel(data=cap.df %&gt;% left_join(ipochems, by=c(&quot;Label&quot;=&quot;name&quot;)) %&gt;% filter(Score==&quot;species&quot;, sqrt(CAP1^2+CAP2^2)&gt;0.2), 
            aes(x=CAP1*3.2, y=CAP2*3.2), size=4, color=&quot;black&quot;, point.size=NA, box.padding=0)+ 
  scale_color_manual(&quot;Treatment&quot;, values=tempcol) +  
  scale_shape_manual(&quot;Species&quot;, values=c(19,15), labels=c(expression(italic(&quot;I. aggregata&quot;)),expression(italic(&quot;I. tenuituba&quot;)))) + 
  labs(x=ax.labs[1], y=ax.labs[2])+
  coord_fixed() + theme_bw() + theme(panel.grid = element_blank(), panel.background = element_rect(fill=&quot;grey70&quot;))</code></pre>
<p><img src="plots/cap_leaf_otc-1.svg" width="768" /></p>
<pre class="r"><code>lmer(sqrt(Total) ~ PlantType + temp + (1|PlantID), data = svf.otc) %&gt;% anova %&gt;% kable(caption=&quot;total emissions&quot;)</code></pre>
<table>
<caption>total emissions</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Sum Sq</th>
<th align="right">Mean Sq</th>
<th align="right">NumDF</th>
<th align="right">DenDF</th>
<th align="right">F value</th>
<th align="right">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">PlantType</td>
<td align="right">7305.962</td>
<td align="right">7305.962</td>
<td align="right">1</td>
<td align="right">21.36177</td>
<td align="right">2.395081</td>
<td align="right">0.1364056</td>
</tr>
<tr class="even">
<td align="left">temp</td>
<td align="right">3051.723</td>
<td align="right">3051.723</td>
<td align="right">1</td>
<td align="right">19.06651</td>
<td align="right">1.000433</td>
<td align="right">0.3297315</td>
</tr>
</tbody>
</table>
</div>
<div id="cap---percivals" class="section level2">
<h2>CAP - Percivals</h2>
<pre class="r"><code>svl.perc &lt;- svl %&gt;% filter(expt==&quot;perc&quot;)
cap.leaf.perc &lt;- capscale(sqrt(vol.leaf[svl$expt==&quot;perc&quot;,]) ~ PlantType+Temp, distance=&quot;bray&quot;, data=svl.perc)
summ.cap &lt;- summary(cap.leaf.perc)
prop.expl &lt;- summ.cap$cont$importance[2,c(&quot;CAP1&quot;,&quot;CAP2&quot;)]
ax.labs &lt;- paste0(&quot;CAP&quot;, 1:2, &quot; (&quot;,round(100*prop.expl),&quot;% explained)&quot;)
(anova.cap &lt;- anova(cap.leaf.perc, by=&quot;margin&quot;))</code></pre>
<pre><code>Permutation test for capscale under reduced model
Marginal effects of terms
Permutation: free
Number of permutations: 999

Model: capscale(formula = sqrt(vol.leaf[svl$expt == &quot;perc&quot;, ]) ~ PlantType + Temp, data = svl.perc, distance = &quot;bray&quot;)
          Df SumOfSqs      F Pr(&gt;F)
PlantType  1  0.07756 0.2629  0.961
Temp       1  0.18173 0.6159  0.635
Residual  10  2.95071              </code></pre>
</div>
<div id="composition" class="section level2">
<h2>Composition</h2>
<pre class="r"><code>absamounts.leaf &lt;- svl %&gt;% select(expt, PlantType, DN) %&gt;% 
  bind_cols(vol.leaf) %&gt;% pivot_longer(all_of(colnames(vol.leaf))) %&gt;%
  group_by(PlantType, name) %&gt;% 
  summarize(mean=mean(value), se=sd(value)/sqrt(n())) %&gt;% arrange(PlantType, desc(mean))

ggplot(absamounts.leaf, aes(y=fct_reorder(name, mean, base::mean), x=mean, color=PlantType))+ 
  geom_pointrange(aes(xmin=mean-se, xmax=mean+se), position=position_dodge2(width=0.4)) + scale_x_sqrt(expand=c(0,0))+ 
  labs(x=&quot;Mean nanograms per g dry mass per hour&quot;,y=&quot;&quot;,color=&quot;Species&quot;)</code></pre>
<p><img src="plots/compleaf-1.svg" width="768" /></p>
<pre class="r"><code>absamounts.leaf %&gt;% mutate(across(all_of(c(&quot;mean&quot;, &quot;se&quot;)), ~format(round(.x/1000, 2), nsmall = 2))) %&gt;%
  mutate(meanse = paste(mean,&quot;\U00B1&quot;, se), .keep=&quot;unused&quot;) %&gt;% 
  pivot_wider(names_from=PlantType, values_from=meanse) %&gt;% 
  kable(caption=&quot;Leaf volatiles, mean \U00B1 se milligrams per g dry mass per hour&quot;, digits=2)</code></pre>
<table>
<caption>Leaf volatiles, mean Â± se milligrams per g dry mass per
hour</caption>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">aggleaf</th>
<th align="left">tenleaf</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(E)-hex-3-en-1-ol</td>
<td align="left">7.33 Â± 1.69</td>
<td align="left">3.14 Â± 1.13</td>
</tr>
<tr class="even">
<td align="left">a-pinene</td>
<td align="left">5.10 Â± 1.54</td>
<td align="left">6.23 Â± 1.98</td>
</tr>
<tr class="odd">
<td align="left">(E)-hex-2-enal</td>
<td align="left">1.93 Â± 0.56</td>
<td align="left">0.77 Â± 0.20</td>
</tr>
<tr class="even">
<td align="left">[(E)-hex-3-enyl] acetate</td>
<td align="left">1.86 Â± 0.43</td>
<td align="left">2.10 Â± 0.72</td>
</tr>
<tr class="odd">
<td align="left">(E)-4-oxohex-2-enal</td>
<td align="left">0.50 Â± 0.11</td>
<td align="left">0.27 Â± 0.08</td>
</tr>
<tr class="even">
<td align="left">4-methylpentan-1-ol</td>
<td align="left">0.42 Â± 0.16</td>
<td align="left">0.15 Â± 0.08</td>
</tr>
<tr class="odd">
<td align="left">hex-2-enal</td>
<td align="left">0.33 Â± 0.14</td>
<td align="left">0.04 Â± 0.02</td>
</tr>
<tr class="even">
<td align="left">1-penten-3-ol</td>
<td align="left">0.28 Â± 0.06</td>
<td align="left">0.14 Â± 0.04</td>
</tr>
<tr class="odd">
<td align="left">(Z)-hex-2-en-1-ol</td>
<td align="left">0.24 Â± 0.07</td>
<td align="left">0.10 Â± 0.04</td>
</tr>
<tr class="even">
<td align="left">(E)-12-cyclopropyldodec-11-en-1-ol</td>
<td align="left">0.21 Â± 0.07</td>
<td align="left">0.07 Â± 0.04</td>
</tr>
<tr class="odd">
<td align="left">petasitene</td>
<td align="left">0.17 Â± 0.06</td>
<td align="left">0.35 Â± 0.13</td>
</tr>
<tr class="even">
<td align="left">b-caryophyllene</td>
<td align="left">0.17 Â± 0.05</td>
<td align="left">0.40 Â± 0.21</td>
</tr>
<tr class="odd">
<td align="left">a-campholenal</td>
<td align="left">0.13 Â± 0.08</td>
<td align="left">0.52 Â± 0.26</td>
</tr>
<tr class="even">
<td align="left">hexan-1-ol</td>
<td align="left">0.11 Â± 0.05</td>
<td align="left">0.07 Â± 0.03</td>
</tr>
<tr class="odd">
<td align="left">pseudoionone</td>
<td align="left">0.07 Â± 0.03</td>
<td align="left">0.31 Â± 0.09</td>
</tr>
<tr class="even">
<td align="left">[(Z)-hex-3-enyl] pentanoate</td>
<td align="left">0.05 Â± 0.05</td>
<td align="left">0.30 Â± 0.11</td>
</tr>
<tr class="odd">
<td align="left">undecanal</td>
<td align="left">0.02 Â± 0.01</td>
<td align="left">0.11 Â± 0.04</td>
</tr>
</tbody>
</table>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
