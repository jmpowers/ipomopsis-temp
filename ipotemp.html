<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Carrie Wu, John Powers, David Hopp, Diane Campbell" />

<meta name="date" content="2022-11-03" />

<title>Ipomopsis temperature experiments: Volatiles</title>

<script src="libs/header-attrs-2.14/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/navigation-1.1/codefolding.js"></script>
<link href="libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Ipomopsis temperature experiments:
Volatiles</h1>
<h4 class="author">Carrie Wu, John Powers, David Hopp, Diane
Campbell</h4>
<h4 class="date">2022-11-03</h4>

</div>


<style type="text/css">
.main-container { max-width: 1000px; margin-left: 0; margin-right: auto; }
img{ max-width:200%; height: auto; }
td, th { padding : 6px }
</style>
<pre class="r"><code># setwd(&quot;/media/C/GCMSsolution/Data/heather Ipo/&quot;)
# data18 &lt;- read.shimadzu(&quot;./Temperature expt CWu 2018/CWu2018.txt&quot;)
# data19 &lt;- read.shimadzu(&quot;./Temperature expt CWu 2019/CWu2019..txt&quot;)
# ipo.data &lt;- rbind(data18, data19)
# 
# files.2021 &lt;- c(&quot;Ihyb_VF_210718.txt&quot;, &quot;Ihyb_VF_210719.txt&quot;, &quot;Samples_210720.txt&quot;, 
#  &quot;Ihyb_Corydalis_210728.txt&quot;, &quot;Ihyb_Corydalis_210729.txt&quot;, &quot;Ihyb_Corydalis_210730.txt&quot;, &quot;Ihyb_Corydalis_210731.txt&quot;, &quot;Maxfield_SC_210802b.txt&quot;,  
# &quot;Maxfield_SC_210803.txt&quot;,    &quot;SC_GNA_210804.txt&quot;,  &quot;Lupinus20_SC_Lagg21_210814.txt&quot; ,&quot;SC_210817.txt&quot;, &quot;SC_210818.txt&quot;,     
# &quot;SC_210818b.txt&quot;,     &quot;SC_210818b001.txt&quot;,  &quot;SC_210820b.txt&quot;,     &quot;SC_Lagg_210821.txt&quot;  )
# 
# library(tidyverse)
# setwd(&quot;~/MyDocs/MEGA/UCI/Schiedea/Analysis/scent/rmbl/RMBL Batches&quot;)
# ipo.data.2021 &lt;- map_dfr(files.2021, read.shimadzu)
# 
# ipo.data &lt;- rbind(ipo.data, ipo.data.2021)
#     
# save(ipo.data, file=&quot;CWu_181921.Rdata&quot;)
load(&quot;data/CWu_181921.Rdata&quot;)

ipo.all &lt;- dcast(ipo.data, Filename~Name, sum, value.var=&quot;Area&quot;)
rownames(ipo.all) &lt;- ipo.all[,1]
ipo.all[,1] &lt;- NULL

ipo.cut &lt;- ipo.all[,colSums(ipo.all)&gt;4e6]

write(rownames(ipo.all), &quot;data/CWu_samples.txt&quot;)

ipos &lt;- read.csv(&quot;data/CWu_samples.csv&quot;, colClasses=list(RunDate=&quot;Date&quot;))


# Maxfield

# setwd(&quot;~/Downloads/MaxfieldVols21/batches&quot;)
# source(&quot;../read_shimadzu.R&quot;)
# datafiles &lt;- list.files(pattern=&quot;.txt&quot;) # TODO had to copy over newer Maxfield_210802.txt and add Maxfield_SC_210802b.txt
# GCMS_output &lt;- map(datafiles, read.shimadzu)
# filenames &lt;- set_names(GCMS_output,datafiles) %&gt;% bind_rows(.id=&quot;Batch&quot;) %&gt;% as_tibble %&gt;% 
#   group_by(Batch, Filename) %&gt;% tally
# setwd(&quot;~/Downloads/MaxfieldVols21/&quot;)#&quot;data&quot; folder
# write_csv(filenames, &quot;filenames.csv&quot;)
#... load in GCMS_metadata 
#GCMS_Maxfield_21 &lt;- GCMS_output %&gt;% bind_rows() %&gt;% filter(Filename %in% GCMS_metadata$Filename)
#save(GCMS_Maxfield_21, file=&quot;Maxfield_21.Rdata&quot;)

load(&quot;data/Maxfield_21.Rdata&quot;) #GCMS_Maxfield_21 output from david_gcms_ipomopsis (3).R

ipo.data &lt;- bind_rows(ipo.data, GCMS_Maxfield_21)</code></pre>
<div id="overview---no-metadata" class="section level1">
<h1>Overview - no metadata</h1>
<div id="inventory" class="section level2">
<h2>Inventory</h2>
<pre class="r"><code>#TODO merge F, G, H, I, J into GNA for 2018
with(ipos, table(Year, Type))</code></pre>
<pre><code>      Type
Year    A Air Bake bb Blank  F  G GNA  H  I  J NatArea OTC SC Schiedea  T
  2018 35  27    3 13     7  3  3   0  2  3  3      48   0  0        0 34
  2019 29  21    0  0    10  0  0  19  0  0  0       0  53 27       18 27</code></pre>
<pre class="r"><code>with(ipos, table(Type, DNLeaf))</code></pre>
<pre><code>          DNLeaf
Type          day leaf night
  A        35  12    8     9
  Air      31   9    0     8
  Bake      3   0    0     0
  bb       13   0    0     0
  Blank    17   0    0     0
  F         3   0    0     0
  G         3   0    0     0
  GNA       7   3    9     0
  H         2   0    0     0
  I         3   0    0     0
  J         3   0    0     0
  NatArea  48   0    0     0
  OTC      10  15   19     9
  SC        0  10    9     8
  Schiedea 18   0    0     0
  T        34  10    7    10</code></pre>
</div>
<div id="nmds" class="section level2">
<h2>NMDS</h2>
<pre class="r"><code>set.seed(1)
nmds.ipo &lt;- metaMDS(decostand(ipo.cut, &quot;hellinger&quot;), dist=&quot;bray&quot;, autotransform = FALSE, try=5, trymax=5)

par(bg=&quot;grey40&quot;)
ordiplot(nmds.ipo, type = &quot;n&quot;)
ipos$rs &lt;- rowSums(ipo.all)
ipos$nameBlank &lt;- ipos$Type %in% c(&quot;Blank&quot;,&quot;Bake&quot;)
ipos$nameAir &lt;- ipos$Type == &quot;Air&quot;
thisyear &lt;- ipos$Year == 2019
#with(ipos, points(nmds.ipo, display=&quot;sites&quot;, col=viridis(200)[round(200*sqrt(rs/max(rs)))], pch=as.integer(isblank)+1))
with(ipos, points(nmds.ipo, display=&quot;sites&quot;, col=rainbow(nlevels(ipos$Type))[ipos$Type], pch=as.integer(nameAir*2+nameBlank)+1))
#with(ipos, points(nmds.ipo, display=&quot;sites&quot;, col=rainbow(nlevels(ipos$Type))[ipos$Type], pch=ipos$Year-2017))
legend(&quot;topright&quot;, legend=levels(ipos$Type), fill=rainbow(nlevels(ipos$Type)), cex=0.8)</code></pre>
</div>
<div id="kmeans-clustering" class="section level2">
<h2>Kmeans clustering</h2>
<pre class="r"><code>k &lt;- 8
set.seed(1)
km &lt;- kmeans(decostand(ipo.cut, &quot;log&quot;), k, nstart=3)
ipos$Cluster &lt;- km$cluster
ipos$kBlank &lt;- kblank &lt;- km$cluster %in% c(4)
ipos$Mixup &lt;- ipos$nameBlank != ipos$kBlank
with(ipos, table(kBlank, nameBlank))

ordiplot(nmds.ipo, type = &quot;n&quot;)
points(nmds.ipo, display=&quot;sites&quot;, col=ifelse(kblank, &quot;black&quot;, rainbow(k)[km$cluster]), pch=with(ipos,as.integer(nameAir*2+nameBlank))+1) 
text(nmds.ipo, display=&quot;species&quot;,col=&quot;grey80&quot;,labels=ifelse(colSums(ipo.cut)&gt;4e8, colnames(ipo.cut), &quot;&quot;))
text(nmds.ipo, display=&quot;sites&quot;, col=with(ipos, as.integer(thisyear)*4+as.integer(nameBlank)*2+as.integer(nameAir)+1), labels=as.character(km$cluster))</code></pre>
</div>
<div id="cap---blanks-and-years" class="section level2">
<h2>CAP - blanks and years</h2>
<pre class="r"><code>ipo.cap &lt;- capscale(ipo.cut ~ as.factor(ipos$kBlank) * as.factor(thisyear), distance=&quot;bray&quot;, metaMDSdist = F)
plot(ipo.cap, type=&quot;n&quot;)
points(ipo.cap, display=&quot;sites&quot;, col=ifelse(ipos$kBlank, &quot;black&quot;, rainbow(k)[ipos$Cluster]), pch=as.integer(ipos$nameAir*2+ipos$nameBlank)+1) 
#View(ipo.cap$CCA$v)</code></pre>
</div>
<div id="cap---dnleaf" class="section level2">
<h2>CAP - DNLeaf</h2>
<pre class="r"><code>dnl &lt;- ipos$DNLeaf!=&quot;&quot; &amp; ipos$Type !=&quot;Air&quot;
ipo.cap.dnl &lt;- capscale(ipo.cut[dnl,] ~ ipos[dnl,&quot;DNLeaf&quot;], distance=&quot;bray&quot;, metaMDSdist = F)
plot(ipo.cap.dnl, type=&quot;n&quot;)
points(ipo.cap.dnl, display=&quot;sites&quot;, pch=as.integer(ipos[dnl,&quot;DNLeaf&quot;])-1, col=as.integer(factor(ipos[dnl,&quot;Type&quot;]))) 
legend(&quot;bottomleft&quot;, levels(factor(ipos[dnl,&quot;Type&quot;])), fill=1:nlevels(ipos$Type), cex=0.8)
legend(&quot;left&quot;, levels(ipos[dnl,&quot;DNLeaf&quot;]), pch=1:nlevels(ipos[dnl,&quot;DNLeaf&quot;])-1, cex=0.8)
#View(ipo.cap.dnl$CCA$v)</code></pre>
</div>
</div>
<div id="read-metadata" class="section level1">
<h1>Read metadata</h1>
<pre class="r"><code>files &lt;- read_tsv(&quot;data/CWu_samples_text2.csv&quot;) %&gt;% 
  rename(temp=OI) %&gt;% mutate(temp = recode(temp,&quot;in&quot;=&quot;warmed&quot;,&quot;out&quot;=&quot;control&quot;))
perc &lt;- read_tsv(&quot;data/Percivals2018_2019.csv&quot;)
otc &lt;- read_tsv(&quot;data/OTC2018_2019.csv&quot;)  %&gt;%  
  rename(temp=OI) %&gt;% mutate(temp = recode(temp,&quot;in&quot;=&quot;warmed&quot;,&quot;out&quot;=&quot;control&quot;))

sc21 &lt;- read_tsv(&quot;data/2021 Spring Creek Volatiles - 2021.tsv&quot;) %&gt;% 
   mutate(PlantType=if_else(plant==&quot;air&quot;, &quot;air&quot;, &quot;ten&quot;))
gna21 &lt;- read_tsv(&quot;data/2021 GNA Volatiles - 2021.tsv&quot;) %&gt;% 
  mutate(time=&quot;day&quot;, PlantType=if_else(plant==&quot;air&quot;, &quot;air&quot;, &quot;agg&quot;))
library(stringr)
files21 &lt;- tibble(Filename = rownames(ipo.all)) %&gt;% 
  filter(str_detect(Filename, &quot;2021&quot;), 
         str_detect(Filename, &quot;SC_|GNA_&quot;)) %&gt;%
  separate(Filename, into=c(&quot;site&quot;,&quot;vial&quot;,&quot;sampledate&quot;,&quot;rundate&quot;,&quot;GCn&quot;), sep=&quot;_&quot;, remove=FALSE, convert=TRUE) %&gt;% 
  mutate(GCn = str_remove(GCn, &quot;.qgd&quot;))
#write_tsv(files21, &quot;files21.tsv&quot;)  
files21 &lt;- read_tsv(&quot;data/files21.tsv&quot;)

perc2 &lt;- left_join(perc,files, by=c(&quot;Date&quot;,&quot;DN&quot;,&quot;Tissue&quot;,&quot;Sample2&quot;), suffix=c(&quot;&quot;,&quot;.f&quot;))
otc2 &lt;- left_join(otc,files, by=c(&quot;Date&quot;,&quot;Site&quot;,&quot;temp&quot;,&quot;DN&quot;,&quot;Tissue&quot;,&quot;Sample2&quot;), suffix=c(&quot;&quot;,&quot;.f&quot;)) %&gt;% 
  mutate(PlantType = if_else(temp == &quot;air&quot;, &quot;air&quot;, PlantType))

drop2021 &lt;- c(&quot;SC_126_210727_8182021_04.qgd&quot;, &quot;SC_101_210727_8202021_02.qgd&quot;, &quot;GNA_121_210730_7312021_05.qgd&quot;)#don&#39;t include these
otc21 &lt;- bind_rows(SC=sc21, GNA=gna21, .id=&quot;site&quot;) %&gt;% 
  left_join(files21, by=c(&quot;vial&quot;,&quot;site&quot;)) %&gt;% 
  filter(!Filename %in% drop2021 | is.na(Filename)) %&gt;% 
  mutate(sampledate = as.character(sampledate),
         Year = 2021, Tissue = if_else(plant == &quot;air&quot;, &quot;air&quot;, &quot;flower&quot;), Expt=&quot;otc&quot;,
         location = recode(location,&quot;inside&quot;=&quot;warmed&quot;,&quot;outside&quot;=&quot;control&quot;)) %&gt;% 
  rename(Site=site, Collector=observer, Date=date, DN=time, temp=location, Bag=bag, Pump=pump, End=end, Equil=equil, Duration=pumping,
         NumFlrs = flowers, NumBuds=buds, PumpID = pump_id, SoilVWC = VWC, Comments = notes, SampleDate_text=sampledate,
         RunDate_text=rundate,GCOrder=GCn)

#TODO find missing chromatogram files (6) and missing metdata (4)
#otc21 %&gt;% filter(is.na(FileName), is.na(lost))

# Maxfield metadata
maxfiles &lt;- read_csv(&quot;data/filenames_metadata - filenames_metadata.csv&quot;) %&gt;% 
  mutate(Is2021 = str_detect(Filename,&quot;_210&quot;)) %&gt;% 
  filter(Maxfield==1 &amp; Year==&quot;2021&quot;) %&gt;% 
  separate(Filename2, into=c(&quot;plantid&quot;,&quot;vial&quot;,&quot;date&quot;,&quot;rundate&quot;,&quot;sequence&quot;,&quot;ext&quot;),remove=F) %&gt;% 
  mutate(across(c(plantid, vial), na_if,&quot;NA&quot;)) %&gt;% 
  mutate(date = ymd(date), vial=as.character(vial),
         filament = ifelse(date&gt;ymd(&quot;2021-07-21&quot;),&quot;after&quot;,&quot;before&quot;))

GCMS_metadata1 &lt;- read_csv(&quot;data/2021 Maxfield Volatiles - 2021.csv&quot;) %&gt;% mutate(plotid=paste0(plot, subplot)) %&gt;% 
  left_join(read_csv(&quot;data/2021 Maxfield Rosettes - 2021OTCs.csv&quot;) %&gt;% mutate(plant=as.character(plant)),
            by=c(&quot;plotid&quot;,&quot;plant&quot;,&quot;plantid&quot;))

max21.oldformat &lt;- bind_rows(
left_join(maxfiles %&gt;% filter(vial %in% c(&quot;A&quot;,&quot;B&quot;)), GCMS_metadata1, by=c(&quot;plantid&quot;,&quot;vial&quot;,&quot;date&quot;)),
left_join(maxfiles %&gt;% filter(!vial %in% c(&quot;A&quot;,&quot;B&quot;) &amp; is.na(plantid)), GCMS_metadata1, by=c(&quot;vial&quot;,&quot;date&quot;)), #vial numbers only
left_join(maxfiles %&gt;% filter(!vial %in% c(&quot;A&quot;,&quot;B&quot;) &amp;!is.na(plantid)), GCMS_metadata1, by=c(&quot;plantid&quot;,&quot;date&quot;))) %&gt;%  #plantid
  mutate(type=factor(ifelse(plant==&quot;air&quot;,&quot;ambient&quot;,&quot;floral&quot;)), 
         temp=factor(temp.y), snow=factor(snow),
         plantid= coalesce(plantid, plantid.y)) 

max21 &lt;- max21.oldformat %&gt;% #put in line with CWu metadata
  rename(Date=date, RunDate_text=rundate,
         Comments=notes, Collector=observer, Bag=bag, Pump=pump,End=end, 
         NumFlrs=flowers, NumBuds=buds, PumpID=pump_id, SoilVWC=VWC,
         PlantType=type) %&gt;% 
  mutate(vial=as.integer(recode(vial, &quot;A&quot;=&quot;1001&quot;, &quot;B&quot;=&quot;1002&quot;)),
         RunDate_text = as.integer(RunDate_text),
         PlantType=recode(PlantType, &quot;ambient&quot;=&quot;air&quot;, &quot;floral&quot;=&quot;agg&quot;),
         Tissue=recode(PlantType, &quot;agg&quot;=&quot;flower&quot;),
         Expt=&quot;otc&quot;,Site=&quot;Maxfield&quot;,DN=&quot;day&quot;,
         temp=recode(temp,&quot;OTC&quot;=&quot;warmed&quot;))
  

meta &lt;- bind_rows(otc=bind_rows(otc2, otc21, max21), perc=perc2, .id=&quot;expt&quot;) %&gt;% 
  mutate_if(is.character, as.factor) %&gt;%
  mutate(Equil=Pump-Bag, Duration=End-Pump, Total=End-Bag,
         Pump_datehour = paste(Date, Pump) %&gt;% ymd_hms(tz=&quot;America/Denver&quot;) %&gt;% round_date(&quot;hour&quot;),
         Expt=expt) %&gt;% #TODO sort thru Expt==NA
  #Add mean temperature of OTCs or controls at time of sampling
  left_join(read_csv(&quot;data/hobos_mean.csv&quot;) %&gt;% select(-date) %&gt;% 
              mutate(datetime = force_tz(datetime, &quot;America/Denver&quot;)), 
            by = c(&quot;Site&quot;=&quot;site&quot;, &quot;Pump_datehour&quot;=&quot;datetime&quot;)) %&gt;% 
  mutate(mean_temp_C_treatment = if_else(temp==&quot;in&quot;, mean_temp_C_warmed, mean_temp_C_control))

meta %&gt;% write.csv(&quot;data/CWu_meta21.csv&quot;)

meta %&gt;% count(Year, Temp, Tissue, PlantType, Site, temp, DN, Expt) %&gt;% kable(caption=&quot;Sample size&quot;)</code></pre>
<table>
<caption>Sample size</caption>
<thead>
<tr class="header">
<th align="right">Year</th>
<th align="left">Temp</th>
<th align="left">Tissue</th>
<th align="left">PlantType</th>
<th align="left">Site</th>
<th align="left">temp</th>
<th align="left">DN</th>
<th align="left">Expt</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2018</td>
<td align="left">cool</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">cool</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">warm</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">warm</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">bb</td>
<td align="left">air</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">GNA</td>
<td align="left">air</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">bb</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">bb</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">32</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">leaf</td>
<td align="left">agg</td>
<td align="left">bb</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">2018</td>
<td align="left">NA</td>
<td align="left">leaf</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">leaf</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">cool</td>
<td align="left">leaf</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">perc</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">leaf</td>
<td align="left">agg</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">warm</td>
<td align="left">leaf</td>
<td align="left">ten</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">perc</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">GNA</td>
<td align="left">air</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">air</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">air</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">18</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">warmed</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">leaf</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">leaf</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">leaf</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">NA</td>
<td align="left">leaf</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">GNA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">Maxfield</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">air</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">air</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">air</td>
<td align="left">air</td>
<td align="left">SC</td>
<td align="left">NA</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">32</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">GNA</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">36</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">Maxfield</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">38</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">agg</td>
<td align="left">Maxfield</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">44</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">31</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">control</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">32</td>
</tr>
<tr class="odd">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">otc</td>
<td align="right">42</td>
</tr>
<tr class="even">
<td align="right">2021</td>
<td align="left">NA</td>
<td align="left">flower</td>
<td align="left">ten</td>
<td align="left">SC</td>
<td align="left">warmed</td>
<td align="left">night</td>
<td align="left">otc</td>
<td align="right">46</td>
</tr>
</tbody>
</table>
<pre class="r"><code>tempcol &lt;- set_names(brewer.pal(3, &quot;Set1&quot;)[c(2,1)], c(&quot;control&quot;, &quot;warmed&quot;))#OTCs
Tempcol &lt;- set_names(brewer.pal(3, &quot;Set1&quot;)[c(2,1)], c(&quot;cool&quot;, &quot;warm&quot;))#Percivals</code></pre>
<div id="missing-files" class="section level2">
<h2>Missing files</h2>
<pre class="r"><code>#perc2 %&gt;% filter(is.na(Filename)) %&gt;% select(&quot;n&quot;) %&gt;% write.csv(&quot;perc_nomatch.csv&quot;)
#otc2 %&gt;% filter(is.na(Filename)) %&gt;% select(&quot;n&quot;) %&gt;% write.csv(&quot;otc_nomatch.csv&quot;)
meta %&gt;% filter(is.na(Filename) &amp; nomatch!=&quot;NR&quot;) %&gt;% select(1:24) %&gt;% kable</code></pre>
<table style="width:100%;">
<colgroup>
<col width="2%" />
<col width="2%" />
<col width="2%" />
<col width="5%" />
<col width="3%" />
<col width="2%" />
<col width="5%" />
<col width="3%" />
<col width="4%" />
<col width="6%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="3%" />
<col width="4%" />
<col width="5%" />
<col width="4%" />
<col width="5%" />
<col width="7%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">expt</th>
<th align="right">n</th>
<th align="right">Year</th>
<th align="left">Date</th>
<th align="left">DN</th>
<th align="left">Site</th>
<th align="left">PlantType</th>
<th align="left">Tissue</th>
<th align="left">temp</th>
<th align="left">Sample</th>
<th align="left">Sample2</th>
<th align="left">nomatch</th>
<th align="left">Bag</th>
<th align="left">Pump</th>
<th align="left">End</th>
<th align="right">NumFlrs</th>
<th align="right">NumBuds</th>
<th align="right">NumLeaf</th>
<th align="left">PumpID</th>
<th align="right">SoilVWC</th>
<th align="right">SoilDepth</th>
<th align="left">Comments</th>
<th align="left">Collector</th>
<th align="right">LeafDryWtGrams</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">otc</td>
<td align="right">184</td>
<td align="right">2018</td>
<td align="left">2018-07-25</td>
<td align="left">day</td>
<td align="left">GNA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">warmed</td>
<td align="left">KM10-B1</td>
<td align="left">KM10B1</td>
<td align="left">0</td>
<td align="left">10:13:00</td>
<td align="left">10:43:00</td>
<td align="left">10:58:00</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="left">DRC5</td>
<td align="right">3.7</td>
<td align="right">1.171</td>
<td align="left">NA</td>
<td align="left">Rachel</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">37</td>
<td align="right">2019</td>
<td align="left">2019-07-31</td>
<td align="left">day</td>
<td align="left">GNA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">warmed</td>
<td align="left">OTC-W1</td>
<td align="left">W1</td>
<td align="left">0</td>
<td align="left">11:53:00</td>
<td align="left">12:26:00</td>
<td align="left">12:41:00</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">CW2</td>
<td align="right">8.6</td>
<td align="right">1.258</td>
<td align="left">NA</td>
<td align="left">Carrie</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="right">83</td>
<td align="right">2019</td>
<td align="left">2019-08-02</td>
<td align="left">day</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">leaf</td>
<td align="left">warmed</td>
<td align="left">OTC-A2-leaf</td>
<td align="left">A2</td>
<td align="left">0</td>
<td align="left">12:50:00</td>
<td align="left">13:20:00</td>
<td align="left">13:35:00</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="left">.</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">Carrie</td>
<td align="right">0.01030</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">84</td>
<td align="right">2019</td>
<td align="left">2019-08-02</td>
<td align="left">day</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">leaf</td>
<td align="left">warmed</td>
<td align="left">OTC-C3-leaf</td>
<td align="left">C3</td>
<td align="left">0</td>
<td align="left">13:08:00</td>
<td align="left">13:41:00</td>
<td align="left">13:56:00</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="left">CW2</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">Carrie</td>
<td align="right">0.00829</td>
</tr>
<tr class="odd">
<td align="left">otc</td>
<td align="right">65</td>
<td align="right">2019</td>
<td align="left">2019-08-02</td>
<td align="left">day</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">leaf</td>
<td align="left">warmed</td>
<td align="left">OTC-E1-leaf</td>
<td align="left">E1</td>
<td align="left">0</td>
<td align="left">09:42:00</td>
<td align="left">10:12:00</td>
<td align="left">10:27:00</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="left">CW2</td>
<td align="right">6.1</td>
<td align="right">1.191</td>
<td align="left">NA</td>
<td align="left">Carrie</td>
<td align="right">0.00849</td>
</tr>
<tr class="even">
<td align="left">otc</td>
<td align="right">5</td>
<td align="right">2019</td>
<td align="left">2019-08-02</td>
<td align="left">night</td>
<td align="left">SC</td>
<td align="left">ten</td>
<td align="left">flower</td>
<td align="left">control</td>
<td align="left">SC9</td>
<td align="left">9</td>
<td align="left">0</td>
<td align="left">20:21:00</td>
<td align="left">20:51:00</td>
<td align="left">21:06:00</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">CW2</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">Diane</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">perc</td>
<td align="right">47</td>
<td align="right">2019</td>
<td align="left">2019-07-25</td>
<td align="left">night</td>
<td align="left">NA</td>
<td align="left">agg</td>
<td align="left">flower</td>
<td align="left">NA</td>
<td align="left">A79</td>
<td align="left">A79</td>
<td align="left">nm</td>
<td align="left">21:02:00</td>
<td align="left">21:35:00</td>
<td align="left">21:50:00</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="left">CW2</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">Carrie</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
</div>
<div id="missing-metadata" class="section level2">
<h2>Missing metadata</h2>
<pre class="r"><code>#files %&gt;% filter(!(Filename %in% meta$Filename)) %&gt;% select(&quot;n&quot;) %&gt;% write.csv(&quot;CWu_samples_nomatch.csv&quot;)
files %&gt;% filter(!(Filename %in% meta$Filename) &amp; Expt!=&quot;&quot;) %&gt;% select(c(&quot;Filename&quot;, &quot;Date&quot;,&quot;Site&quot;,&quot;temp&quot;,&quot;DN&quot;,&quot;Tissue&quot;,&quot;Sample2&quot;)) %&gt;% kable</code></pre>
<table>
<colgroup>
<col width="45%" />
<col width="13%" />
<col width="6%" />
<col width="10%" />
<col width="5%" />
<col width="8%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Filename</th>
<th align="left">Date</th>
<th align="left">Site</th>
<th align="left">temp</th>
<th align="left">DN</th>
<th align="left">Tissue</th>
<th align="left">Sample2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">AirlastJuly25_08312018.qgd</td>
<td align="left">2018-07-25</td>
<td align="left">GNA</td>
<td align="left">air</td>
<td align="left">day</td>
<td align="left">air</td>
<td align="left">Airlast</td>
</tr>
<tr class="even">
<td align="left">NatAreaXUP01July25_08312018.qgd</td>
<td align="left">2018-07-25</td>
<td align="left">GNA</td>
<td align="left">warmed</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="left">XUP01</td>
</tr>
<tr class="odd">
<td align="left">GNA5redo_leaf_190805_8112019_17.qgd</td>
<td align="left">2019-08-05</td>
<td align="left">GNA</td>
<td align="left">control</td>
<td align="left">day</td>
<td align="left">leaf</td>
<td align="left">5redo</td>
</tr>
<tr class="even">
<td align="left">A188DredoAug16renamed_09022018.qgd</td>
<td align="left">2018-08-16</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="left">A188redo</td>
</tr>
<tr class="odd">
<td align="left">T196DredoAug16_09022018.qgd</td>
<td align="left">2018-08-16</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="left">T196redo</td>
</tr>
<tr class="even">
<td align="left">A38redo_day_190725_872019_03.qgd</td>
<td align="left">2019-07-25</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">flower</td>
<td align="left">A38redo</td>
</tr>
<tr class="odd">
<td align="left">A91_leaf_190725_882019_02.qgd</td>
<td align="left">2019-07-25</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">day</td>
<td align="left">leaf</td>
<td align="left">A91</td>
</tr>
</tbody>
</table>
</div>
<div id="times" class="section level2">
<h2>Times</h2>
<pre class="r"><code>ggplot(meta, aes(x=paste(Expt, DN,Year), y=Bag, color=DN)) + 
  geom_boxplot() + geom_point()+
  theme_minimal() + theme(axis.text.x=element_text(angle=90))+
  ggtitle(&quot;Sampling time of day&quot;)</code></pre>
<p><img src="plots/times-1.svg" width="768" /></p>
<pre class="r"><code>ggplot(meta, aes(x=paste(Expt, DN,Year), y=Total/60, color=DN)) + 
  geom_boxplot() + geom_point()+
  theme_minimal() + theme(axis.text.x=element_text(angle=90)) + 
  ggtitle(&quot;Total sampling duration&quot;)+
  ylab(&quot;Equilibration plus pumping time (min)&quot;)</code></pre>
<p><img src="plots/times-2.svg" width="768" /></p>
<pre class="r"><code>#TODO fix timings</code></pre>
</div>
<div id="otc-soil-moisture" class="section level2">
<h2>OTC Soil moisture</h2>
<pre class="r"><code>ggplot(meta %&gt;% filter(Expt==&quot;otc&quot;, temp !=&quot;air&quot;), aes(x=paste(Year, Site), y=SoilVWC, color=temp)) +
  geom_boxplot()+#geom_violin(draw_quantiles=c(0.25, 0.5, 0.75)) + #geom_point(position=position_dodge(width=0.8))+
  theme_minimal() + theme(axis.text.x=element_text(angle=90)) + 
  scale_color_brewer(palette = &quot;Set1&quot;, direction=-1)+
  labs(title=&quot;Effects of OTCs on Soil Moisture&quot;,y=&quot;Soil Volumetric Water Content (%)&quot;,
       x=&quot;Year, site&quot;, color=&quot;Temperature&quot;)</code></pre>
<p><img src="plots/soil-1.svg" width="768" /></p>
<pre class="r"><code>ggplot(meta %&gt;% filter(Expt==&quot;otc&quot;, temp !=&quot;air&quot;), aes(x=paste(Year, Site, Date), y=SoilVWC, color=temp)) +
  geom_boxplot()+#geom_violin(draw_quantiles=c(0.25, 0.5, 0.75)) + #geom_point()+
  theme_minimal() + theme(axis.text.x=element_text(angle=90)) + 
  scale_color_brewer(palette = &quot;Set1&quot;, direction=-1)+
  labs(title=&quot;Effects of OTCs on Soil Moisture&quot;,y=&quot;Soil Volumetric Water Content (%)&quot;,
       x=&quot;Year, site, date&quot;, color=&quot;Temperature&quot;)</code></pre>
<p><img src="plots/soil-2.svg" width="768" /></p>
</div>
<div id="otc-temperature-during-sampling" class="section level2">
<h2>OTC temperature during sampling</h2>
<pre class="r"><code>ggplot(meta %&gt;% filter(Expt==&quot;otc&quot;, temp !=&quot;air&quot;), aes(y=mean_temp_C_treatment, x=paste(Year, Site, temp), color=temp)) +
  facet_wrap(vars(DN), scales=&quot;free_x&quot;)+
  geom_boxplot()+#geom_violin(draw_quantiles=c(0.25, 0.5, 0.75)) + 
  geom_jitter(height=0, width=0.2)+
  theme_minimal() + theme(axis.text.x=element_text(angle=90)) + 
  scale_color_brewer(palette = &quot;Set1&quot;, direction=-1)+
  ggtitle(&quot;Effects of OTCs on Temperature during Sampling&quot;)+
  ylab(&quot;Temperature (C)&quot;) +
  xlab(&quot;Year, temperature&quot;)</code></pre>
<p><img src="plots/actualtemp-1.svg" width="768" /></p>
<pre class="r"><code>ggplot(meta %&gt;% filter(Expt==&quot;otc&quot;, temp !=&quot;air&quot;, PlantType==&quot;agg&quot;), aes(y=mean_temp_C_treatment, x=paste(Year, Site, temp), color=temp)) +
  facet_wrap(vars(Year), scales=&quot;free_x&quot;, nrow=1)+
  geom_boxplot()+#geom_violin(draw_quantiles=c(0.25, 0.5, 0.75)) + 
  geom_jitter(height=0, width=0.2)+
  theme_minimal() + theme(axis.text.x=element_text(angle=90)) + 
  scale_color_brewer(palette = &quot;Set1&quot;, direction=-1)+
  ggtitle(&quot;Effects of OTCs on Temperature during Sampling: I agg.&quot;)+
  ylab(&quot;Temperature (C)&quot;) +
  xlab(&quot;Year, temperature&quot;)</code></pre>
<p><img src="plots/actualtemp-2.svg" width="768" /></p>
</div>
</div>
<div id="filtering-criteria" class="section level1">
<h1>Filtering criteria</h1>
<div id="flowers" class="section level2">
<h2>Flowers</h2>
<pre class="r"><code>sv &lt;- meta %&gt;% drop_na(Filename)
#ipo.gc &lt;- ipo.all[sv$Filename,]

library(bouquet)
ipo.data.cut &lt;- ipo.data[ipo.data$Filename %in% sv$Filename,]
ipo.data.cut$Filename &lt;- sv$Filename[match(ipo.data.cut$Filename, sv$Filename)]
ipo.data.cut &lt;- ipo.data.cut[ipo.data.cut$Name != &quot;&quot;, ] #drop unidentified peaks
ipo.data.cut$Name &lt;- droplevels(ipo.data.cut$Name)
longdata &lt;- load_longdata(ipo.data.cut, sample=&quot;Filename&quot;, RT=&quot;Ret.Time&quot;, name=&quot;Name&quot;, area=&quot;Area&quot;, match = &quot;SI&quot;, maxmatch=100)
metadata &lt;- sv %&gt;% mutate(Tissue = fct_recode(Tissue, ambient=&quot;air&quot;, floral=&quot;flower&quot;, leaf=&quot;leaf&quot;)) %&gt;% 
  load_metadata(date=&quot;Date&quot;, sample=&quot;Filename&quot;, group=&quot;PlantType&quot;, type=&quot;Tissue&quot;)
vol.all &lt;- make_sampletable(longdata, metadata)
chems &lt;- make_chemtable(longdata, metadata)


#TODO update this code to convert to nanograms
# classes &lt;- read_csv(&quot;Ipo volatile compounds - max21_chemtable.csv&quot;)
# table(classes$class)
# stds &lt;- read_csv(&quot;shimadzu_standards.xlsx - conversions_2021.csv&quot;)
# longdata.ng &lt;- longdata %&gt;% left_join(select(GCMS_metadata, sample=Filename, filament)) %&gt;% 
#   left_join(select(classes, class, name), by=&quot;name&quot;) %&gt;% 
#   left_join(stds) %&gt;% 
#   mutate(area = area / area_per_ng) #area is no longer area!!! it&#39;s nanograms
# sampletable.ng = make_sampletable(longdata.ng, metadata)[,names(sampletable)]

### Flower filtering
chemsf &lt;- chems %&gt;%
  filter_RT(2, 17) %&gt;% 
  filter_match(0.8) %&gt;% 
  filter_freq(0.1, group = FALSE) %&gt;% 
  filter_contaminant(cont.list = c(&quot;Cyclotetrasiloxane, octamethyl-&quot;,
  &quot;2,2,4-Trimethyl-1,3-pentanediol diisobutyrate&quot;)) %&gt;% 
  filter_area(min_maximum = 1e6) %&gt;% 
  filter_ambient_ratio(vol.all, metadata, ratio = 3) %&gt;%
  filter_ambient_ttest(vol.all, metadata, alpha = 0.05, adjust = &quot;fdr&quot;) %&gt;%
  combine_filters() 
chemsf$filter_final &lt;- with(chemsf, filter_RT == &quot;OK&quot; &amp; filter_match ==&quot;OK&quot; &amp; filter_freq.floral == &quot;OK&quot; &amp; filter_area == &quot;OK&quot; &amp; 
                              (filter_ambient_ratio == &quot;OK&quot; | (filter_ambient_ttest == &quot;OK&quot; &amp; ambient_ratio &gt;1)) &amp; filter_contaminant == &quot;OK&quot;)
bouquet::plot_filters(chemsf, option=&quot;rarity&quot;)</code></pre>
<p><img src="plots/filtering-1.svg" width="1152" /></p>
<pre class="r"><code>bouquet::plot_filters(chemsf, option=&quot;ambient&quot;)</code></pre>
<p><img src="plots/filtering-2.svg" width="1152" /></p>
<pre class="r"><code>bouquet::plot_filters(chemsf, option=&quot;prop&quot;)</code></pre>
<p><img src="plots/filtering-3.svg" width="1152" /></p>
</div>
<div id="leaves" class="section level2">
<h2>Leaves</h2>
<pre class="r"><code>### Leaf filtering
meta.leaf &lt;- metadata %&gt;% mutate(type = fct_recode(type, floral = &quot;leaf&quot;, flower = &quot;floral&quot;)) #trick bouquet to think the leaf samples are floral TODO: hacky!
chems.leaf &lt;- make_chemtable(longdata, meta.leaf) 
chemsf.leaf &lt;- chems.leaf %&gt;%
  filter_RT(2, 17) %&gt;% 
  filter_match(0.8) %&gt;% 
  filter_freq(0.2, group = FALSE) %&gt;% 
  filter_contaminant(cont.list = c(&quot;Caprolactam&quot;)) %&gt;% 
  filter_area(min_maximum = 5e5) %&gt;% 
  filter_ambient_ratio(vol.all, meta.leaf, ratio = 4) %&gt;%
  filter_ambient_ttest(vol.all, meta.leaf, alpha = 0.05, adjust = &quot;fdr&quot;) %&gt;%
  combine_filters()
chemsf.leaf$filter_final &lt;- with(chemsf.leaf, filter_RT == &quot;OK&quot; &amp; filter_match ==&quot;OK&quot; &amp; filter_freq.floral == &quot;OK&quot; &amp; #floral are actually leafs
                                   filter_area == &quot;OK&quot; &amp; (filter_ambient_ratio == &quot;OK&quot; | (filter_ambient_ttest == &quot;OK&quot; &amp; ambient_ratio &gt;1)) &amp; filter_contaminant == &quot;OK&quot;)
#TODO bouquet needs to do a one-sided t-test! some compounds lower in blanks got a pass with low p value!
bouquet::plot_filters(chemsf.leaf, option=&quot;rarity&quot;)</code></pre>
<p><img src="plots/filtering_leaf-1.svg" width="768" /></p>
<pre class="r"><code>bouquet::plot_filters(chemsf.leaf, option=&quot;ambient&quot;)</code></pre>
<p><img src="plots/filtering_leaf-2.svg" width="768" /></p>
<pre class="r"><code>bouquet::plot_filters(chemsf.leaf, option=&quot;prop&quot;)</code></pre>
<p><img src="plots/filtering_leaf-3.svg" width="768" /></p>
<pre class="r"><code>#compare amounts in floral vs. leaf samples
chemsf &lt;- chemsf %&gt;% mutate(filter_ambient_leaf_ratio = chemsf.leaf$filter_ambient_ratio,
                            filter_ambient_leaf_ttest = chemsf.leaf$filter_ambient_ttest,
                            leaf_not_flower = filter_ambient_leaf_ratio==&quot;OK&quot; &amp; filter_ambient_leaf_ttest==&quot;OK&quot; &amp; 
                              !(filter_ambient_ratio==&quot;OK&quot; &amp; filter_ambient_ttest==&quot;OK&quot;))

ggplot(chemsf, aes(x=mean.floral, y= chemsf.leaf$mean.floral, label=name, color=paste(filter_final,chemsf.leaf$filter_final, sep=&quot;, &quot;),
                   alpha=filter_final|chemsf.leaf$filter_final))+ theme_minimal()+
  geom_abline(slope=1, intercept=1) + geom_text()+ scale_x_log10()+ scale_y_log10() +
  labs(x=&quot;Mean area in flowers&quot;, y= &quot;Mean area in leaves&quot;, alpha=&quot;Kept in either dataset&quot;, color=&quot;Kept in floral, leaf datasets&quot;)</code></pre>
<p><img src="plots/filtering_leaf-4.svg" width="768" /></p>
<pre class="r"><code>### Manual filtering
#write.csv(chemsf, &quot;chemsf_ipo.csv&quot;)
#annotated this in a google sheet
chemsf2 &lt;- read.csv(&quot;data/Ipo volatile compounds - chemsf_ipo.csv.csv&quot;)
keep &lt;- as.character(chemsf2[chemsf2$verdict %in% c(&quot;fvoc&quot;,&quot;keep&quot;,&quot;merge&quot;,&quot;keep-leaf&quot;),&quot;name&quot;])
#keep_leaf &lt;- as.character(chemsf2[chemsf2$verdict ==&quot;keep_leaf&quot;,&quot;name&quot;]) # &gt; 4 | chemsf3$name %in% keep_leaf)

#shorten names
shortnames &lt;- chemsf2 %&gt;% select(name, shortname) %&gt;% filter(shortname!=&quot;&quot;) %&gt;% deframe()
chemsf3 &lt;- chemsf %&gt;% 
  filter_contaminant(cont.list=as.character(chemsf2[chemsf2$verdict %in% c(&quot;ambi&quot;,&quot;bis14&quot;,&quot;cont&quot;,&quot;rare&quot;),&quot;name&quot;])) %&gt;% 
  mutate(filter_final_leaf = filter_contaminant == &quot;OK&quot; &amp; chemsf.leaf$filter_final, #&amp; chemsf2$shortname!=&quot;&quot;#four big alkanes
         name = recode(name, !!!shortnames))
#chemsf3$filter_final &lt;- with(chemsf3, filters_passed &gt; 4 &amp; filter_contaminant == &quot;OK&quot; &amp; name %in% keep)#keeps with passed&lt;=4 still excluded
colnames(vol.all) &lt;- chemsf3$name

#TODO merge the duplicate name2s - the following doesn&#39;t work
#longdata3 &lt;- longdata %&gt;% inner_join(chemsf3 %&gt;% select(c(&quot;name&quot;, &quot;name2&quot;)), by = &quot;name&quot;) %&gt;% 
  #mutate(name = factor(name2))
#vol.all3 &lt;- make_sampletable(longdata3) 

#vol &lt;- prune_sampletable(vol.all, chemsf3, metadata)
#TODO use chesf3 (manual list instead)
vol &lt;- prune_sampletable(vol.all, chemsf3, metadata)
files_exclude &lt;- c(&quot;T196DAug16_09012018.qgd&quot;, &quot;A188DAug16_09012018.qgd&quot;, &quot;OTC_Z3_190805_8102019_24.qgd&quot;, &quot;T139_day_190725_862019_06.qgd&quot;, &quot;GNA_17_210716_7202021_18.qgd&quot;,&quot;Maxfield_27_210723_822021_03.qgd&quot;)#no filtered volatiles
svf &lt;- metadata[metadata$type == &quot;floral&quot; &amp; !(metadata$sample %in% files_exclude),]
svf$Year &lt;- factor(svf$Year)
svf &lt;- svf %&gt;% mutate_if(is.factor, droplevels) %&gt;% 
  mutate(Treat = paste(temp, Temp) %&gt;% 
           fct_collapse(control=c(&quot;control NA&quot;,&quot;NA cool&quot;),warmed=c(&quot;NA warm&quot;,&quot;warmed NA&quot;)))
vol &lt;- vol[!(rownames(vol) %in% files_exclude) ,]
vol &lt;- vol / 0.75 / 1 #30 min of equilibration plus 15 minpumping, one flower 
#TODO fix svf$Total data entry errors</code></pre>
<pre class="r"><code>vol.leaf &lt;- prune_sampletable(vol.all, chemsf3 %&gt;% mutate(filter_final=filter_final_leaf), meta.leaf)
files_exclude_leaf &lt;- c(&quot;CWH1LeafJuly27_09022018.qgd&quot;,&quot;NatArea69leafrenamedJuly25_08312018.qgd&quot;, &quot;T164_leaf_190731_882019_18.qgd&quot;,&quot;OTC_Z2_leaf_190805_8102019_23.qgd&quot;)#fist two lack leaf mass, secodn two have no filtered volatiles
svl &lt;- metadata[metadata$type == &quot;leaf&quot; &amp; !(metadata$sample %in% files_exclude_leaf),]
svl &lt;- svl %&gt;% mutate_if(is.factor, droplevels) %&gt;% 
  mutate(Treat = paste(temp, Temp) %&gt;% 
           fct_collapse(control=c(&quot;control NA&quot;,&quot;NA cool&quot;),warmed=c(&quot;NA warm&quot;,&quot;warmed NA&quot;)))
vol.leaf &lt;- vol.leaf[!(rownames(vol.leaf) %in% files_exclude_leaf) ,]
svl$LeafDryWtGrams[c(8,3)] &lt;- svl$LeafDryWtGrams[c(8,3)]/10
vol.leaf &lt;- vol.leaf / 0.75 / svl$LeafDryWtGrams #area per hour per dry gram
#TODO fix svf$Total data entry errors for leaves</code></pre>
</div>
</div>
<div id="all-filtered-samples" class="section level1">
<h1>All filtered samples</h1>
<div id="flower-heatmap" class="section level2">
<h2>Flower heatmap</h2>
<pre class="r"><code>#cairo_pdf(&quot;ipo_heatmap.pdf&quot;, width=12, height=12)
ph  &lt;- pheatmap(as.matrix(t(vol))^(1/3), 
         cluster_cols=T, show_colnames=F,
         clustering_method=&quot;mcquitty&quot;, clustering_distance_rows=&quot;correlation&quot;,
         clustering_distance_cols=vegdist(vol, method = &quot;bray&quot;),
         clustering_callback = function(hc, ...){dendsort(hc, type=&quot;average&quot;)},
         scale=&quot;none&quot;, color=inferno(512),
         annotation_col = data.frame(svf %&gt;% select(&quot;Year&quot;, &quot;PlantType&quot;, &quot;expt&quot;, &quot;Treat&quot;,&quot;DN&quot;), row.names=rownames(vol)), 
   fontsize = 10, border_color = NA, legend=F, annotation_legend=T, cutree_rows=6
)</code></pre>
<p><img src="plots/heatmap-1.png" width="1152" /></p>
<pre class="r"><code>#dev.off()</code></pre>
</div>
<div id="flower-nmds" class="section level2">
<h2>Flower NMDS</h2>
<pre class="r"><code>set.seed(1)
nmds.vol &lt;- metaMDS(sqrt(vol), dist=&quot;bray&quot;, autotransform = FALSE, trace=F)

TEY &lt;- with(svf, factor(paste(PlantType,expt,Year)))
TEYcols &lt;- brewer.pal(9, &quot;Paired&quot;)#[c(1:4,8,5:6)]
spcols &lt;- c(agg=&quot;red&quot;, ten=&quot;violet&quot;)
ordiplot(nmds.vol, type = &quot;n&quot;)
text(nmds.vol, display=&quot;species&quot;, cex=0.7, col=&quot;grey20&quot;)
legend(&quot;topleft&quot;, levels(svf$DN), pch=c(13,19))
#legend(&quot;topright&quot;, levels(svf$PlantType), fill=spcols)
legend(&quot;bottomright&quot;, levels(svf$Year), fill=1:3)
#legend(&quot;bottomleft&quot;, levels(TEY), fill=TEYcols, cex=0.9)
points(nmds.vol, display=&quot;sites&quot;, col=TEYcols[TEY], pch=c(13,19)[svf$DN])
points(nmds.vol, display=&quot;sites&quot;, col=spcols[svf$PlantType], pch=c(13,19)[svf$DN])
points(nmds.vol, display=&quot;sites&quot;, col=svf$Year, pch=c(13,19)[svf$DN])</code></pre>
<p><img src="plots/nmds_filtered-1.svg" width="768" /></p>
<pre class="r"><code>#points(nmds.vol, display=&quot;sites&quot;, col=viridis(100)[sqrt(rowSums(vol))/100], pch=19)</code></pre>
</div>
</div>
<div id="otcs-vs.-ambient" class="section level1">
<h1>OTCs vs. Ambient</h1>
<div id="cap-analysis-of-each-otc-site-and-year" class="section level2">
<h2>CAP analysis of each OTC site and year</h2>
<pre class="r"><code>#inventory of samples
svf %&gt;% filter(expt==&quot;otc&quot;) %&gt;% count(PlantType, DN, temp,Year, Site) %&gt;% kable(caption=&quot;Sample size&quot;)</code></pre>
<table>
<caption>Sample size</caption>
<thead>
<tr class="header">
<th align="left">PlantType</th>
<th align="left">DN</th>
<th align="left">temp</th>
<th align="left">Year</th>
<th align="left">Site</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">control</td>
<td align="left">2018</td>
<td align="left">bb</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">control</td>
<td align="left">2018</td>
<td align="left">GNA</td>
<td align="right">16</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">control</td>
<td align="left">2019</td>
<td align="left">GNA</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">control</td>
<td align="left">2021</td>
<td align="left">GNA</td>
<td align="right">26</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">control</td>
<td align="left">2021</td>
<td align="left">Maxfield</td>
<td align="right">38</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">warmed</td>
<td align="left">2018</td>
<td align="left">bb</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">warmed</td>
<td align="left">2018</td>
<td align="left">GNA</td>
<td align="right">30</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">warmed</td>
<td align="left">2019</td>
<td align="left">GNA</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">warmed</td>
<td align="left">2021</td>
<td align="left">GNA</td>
<td align="right">32</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">warmed</td>
<td align="left">2021</td>
<td align="left">Maxfield</td>
<td align="right">43</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">control</td>
<td align="left">2019</td>
<td align="left">SC</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">control</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="right">30</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">warmed</td>
<td align="left">2019</td>
<td align="left">SC</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">warmed</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="right">42</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">control</td>
<td align="left">2019</td>
<td align="left">SC</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">control</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="right">29</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">warmed</td>
<td align="left">2019</td>
<td align="left">SC</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">warmed</td>
<td align="left">2021</td>
<td align="left">SC</td>
<td align="right">39</td>
</tr>
</tbody>
</table>
<pre class="r"><code>plot.otc &lt;- function(svf.otc, plot.DN=F, plot.chems=T) {
    vol.otc &lt;- vol[svf.otc$sample,]
    cap.otc &lt;- capscale(sqrt(vol.otc) ~ temp, distance=&quot;bray&quot;, data=svf.otc)
    if(plot.DN) cap.otc &lt;- capscale(sqrt(vol.otc) ~ DN+temp, distance=&quot;bray&quot;, data=svf.otc)
    summ.cap &lt;- summary(cap.otc)
    prop.expl &lt;- summ.cap$cont$importance
    ax.labs &lt;- paste0(colnames(prop.expl)[1:2], &quot; (&quot;,round(100*prop.expl[2,1:2]),&quot;% explained)&quot;)
    anova.cap &lt;- anova(cap.otc, by=&quot;margin&quot;)
    
    plot(cap.otc, type=&quot;n&quot;, xlim=range(cap.otc$CCA$wa[,1]), xlab=ax.labs[1], ylab=ax.labs[2])
    with(svf.otc, title(paste(&quot;OTC warming:&quot;,&quot;I.&quot;,unique(PlantType), &quot;at&quot;, unique(Site),&quot;site,&quot;,unique(Year),
                              do.call(paste0, list(unique(DN), collapse=&quot;/&quot;)))))
    legend(&quot;topleft&quot;, title=paste(&quot;Temperature&quot;,&quot;\nP =&quot;,anova.cap[&quot;temp&quot;,&quot;Pr(&gt;F)&quot;]), 
           levels(svf.otc$temp), fill=tempcol)
            if(plot.DN) legend(&quot;topright&quot;, title=paste(&quot;Time&quot;,&quot;\nP =&quot;,anova.cap[&quot;DN&quot;,&quot;Pr(&gt;F)&quot;]), 
                       levels(svf.otc$DN), pch=c(1,19))
    points(cap.otc, display=&quot;sites&quot;, col=c(tempcol)[svf.otc$temp], pch=c(1,19)[svf.otc$DN]) 
    text(cap.otc, display=&quot;cn&quot;)
    if(plot.chems) {
      if(plot.DN) text(cap.otc, display=&quot;species&quot;, cex=0.8, srt=45,
                     col=ifelse(sqrt(cap.otc$CCA$v[,1]^2 + cap.otc$CCA$v[,2]^2)&gt;0.25, alpha(&quot;purple&quot;,1),alpha(&quot;purple&quot;,0)))
      else text(cap.otc, display=&quot;species&quot;, cex=0.8, srt=45,
                     col=ifelse(abs(cap.otc$CCA$v[,1])&gt;0.1, alpha(&quot;purple&quot;,1),alpha(&quot;purple&quot;,0)))
    }
    return(cap.otc)
}

cap.otcbb18 &lt;-  plot.otc(svf %&gt;% filter(expt==&quot;otc&quot;,Year==&quot;2018&quot;,Site==&quot;bb&quot;,PlantType==&quot;agg&quot;))</code></pre>
<p><img src="plots/otc-1.svg" width="768" /></p>
<pre class="r"><code>cap.otcGNA18 &lt;- plot.otc(svf %&gt;% filter(expt==&quot;otc&quot;,Year==&quot;2018&quot;,Site==&quot;GNA&quot;,PlantType==&quot;agg&quot;))</code></pre>
<p><img src="plots/otc-2.svg" width="768" /></p>
<pre class="r"><code>cap.otcGNA19 &lt;- plot.otc(svf %&gt;% filter(expt==&quot;otc&quot;,Year==&quot;2019&quot;,Site==&quot;GNA&quot;,PlantType==&quot;agg&quot;))</code></pre>
<p><img src="plots/otc-3.svg" width="768" /></p>
<pre class="r"><code>cap.otcGNA21 &lt;- plot.otc(svf %&gt;% filter(expt==&quot;otc&quot;,Year==&quot;2021&quot;,Site==&quot;GNA&quot;,PlantType==&quot;agg&quot;))</code></pre>
<p><img src="plots/otc-4.svg" width="768" /></p>
<pre class="r"><code>cap.otcGNA21 &lt;- plot.otc(svf %&gt;% filter(expt==&quot;otc&quot;,Year==&quot;2021&quot;,Site==&quot;Maxfield&quot;,PlantType==&quot;agg&quot;))</code></pre>
<p><img src="plots/otc-5.svg" width="768" /></p>
<pre class="r"><code>cap.otcSC19 &lt;-  plot.otc(svf %&gt;% filter(expt==&quot;otc&quot;,Year==&quot;2019&quot;,Site==&quot;SC&quot;,PlantType==&quot;ten&quot;),plot.DN=T)</code></pre>
<p><img src="plots/otc-6.svg" width="768" /></p>
<pre class="r"><code>cap.otcSC21 &lt;-  plot.otc(svf %&gt;% filter(expt==&quot;otc&quot;,Year==&quot;2021&quot;,Site==&quot;SC&quot;,PlantType==&quot;ten&quot;),plot.DN=T)</code></pre>
<p><img src="plots/otc-7.svg" width="768" /></p>
<pre class="r"><code>#cap.otc.all &lt;- list(bb18=cap.otcbb18, GNA18=cap.otcGNA18, GNA19=cap.otcGNA19, SC19=cap.otcSC19)</code></pre>
</div>
<div id="cap-of-all-i.-aggregata-vs.-otcs" class="section level2">
<h2>CAP of all I. aggregata vs. OTCs</h2>
<pre class="r"><code>#Combined I. aggregata OTC CAP
svf.otc &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, PlantType==&quot;agg&quot;)
vol.otc &lt;- vol[svf.otc$sample,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ Year+Site+temp, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ Year + Site + temp, data =
svf.otc, distance = &quot;bray&quot;)

               Inertia Proportion Rank
Total          45.8059     1.0000     
Constrained     6.4160     0.1401    5
Unconstrained  54.5027     1.1899   73
Imaginary     -15.1128    -0.3299  159
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
  CAP1   CAP2   CAP3   CAP4   CAP5 
2.8122 2.1943 0.9687 0.2519 0.1889 

Eigenvalues for unconstrained axes:
 MDS1  MDS2  MDS3  MDS4  MDS5  MDS6  MDS7  MDS8 
7.777 5.119 4.205 3.625 2.811 2.389 2.240 2.017 
(Showing 8 of 73 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>summ.cap &lt;- summary(cap.otc.comb)
prop.expl &lt;- summ.cap$cont$importance
ax.labs &lt;- paste0(colnames(prop.expl)[1:2], &quot; (&quot;,round(100*prop.expl[2,1:2]),&quot;% explained)&quot;)
yearpch &lt;- c(`2018`=15,`2019`=19,`2021`=17)
(anova.cap &lt;- anova(cap.otc.comb, by=&quot;margin&quot;))</code></pre>
<pre><code>Permutation test for capscale under reduced model
Marginal effects of terms
Permutation: free
Number of permutations: 999

Model: capscale(formula = sqrt(vol.otc) ~ Year + Site + temp, data = svf.otc, distance = &quot;bray&quot;)
          Df SumOfSqs      F Pr(&gt;F)    
Year       2    4.077 8.4905  0.001 ***
Site       2    1.421 2.9599  0.001 ***
temp       1    0.449 1.8709  0.012 *  
Residual 227   54.503                  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>plot(cap.otc.comb, type=&quot;n&quot;, xlab=ax.labs[1], ylab=ax.labs[2])#xlim=range(cap.otc.comb$CCA$wa[,1])
title(&quot;OTC warming: all I. agg&quot;)
legend(&quot;bottomleft&quot;,  title=paste(&quot;Temperature&quot;,&quot;\nP =&quot;,anova.cap[&quot;temp&quot;,&quot;Pr(&gt;F)&quot;]), legend=levels(svf.otc$temp), fill=tempcol)
legend(&quot;left&quot;,  title=paste(&quot;Year&quot;,&quot;\nP =&quot;,anova.cap[&quot;Year&quot;,&quot;Pr(&gt;F)&quot;]), legend=levels(svf.otc$Year), pch=yearpch)
#legend(&quot;bottomleft&quot;,  title=paste(&quot;Site&quot;,&quot;\nP =&quot;,anova.cap[&quot;Site&quot;,&quot;Pr(&gt;F)&quot;]), legend=unique(svf.otc$Site))
text(cap.otc.comb, display=&quot;species&quot;, cex=0.7, srt=45,
                     col=ifelse(sqrt(cap.otc.comb$CCA$v[,1]^2 + cap.otc.comb$CCA$v[,2]^2)&gt;0.25, alpha(&quot;purple&quot;,0.7),alpha(&quot;purple&quot;,0)))
points(cap.otc.comb, display=&quot;sites&quot;, col=c(tempcol)[svf.otc$temp], pch=yearpch[svf.otc$Year]) 
text(cap.otc.comb, display=&quot;cn&quot;)</code></pre>
<p><img src="plots/otc_comb-1.svg" width="768" /></p>
</div>
<div id="cap-of-all-i.-aggregata-vs.-actual-temp-site-year"
class="section level2">
<h2>CAP of all I. aggregata vs. actual temp, site, year</h2>
<pre class="r"><code>#Combined I. aggregata OTC CAP
svf.otc &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, PlantType==&quot;agg&quot;) %&gt;% drop_na(mean_temp_C_treatment)
vol.otc &lt;- vol[svf.otc$sample,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ Year+Site+mean_temp_C_treatment+temp, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ Year + Site +
mean_temp_C_treatment + temp, data = svf.otc, distance = &quot;bray&quot;)

               Inertia Proportion Rank
Total          44.0127     1.0000     
Constrained     6.5590     0.1490    6
Unconstrained  51.8583     1.1783   71
Imaginary     -14.4046    -0.3273  154
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
  CAP1   CAP2   CAP3   CAP4   CAP5   CAP6 
2.8194 2.0030 1.0400 0.3512 0.2345 0.1109 

Eigenvalues for unconstrained axes:
 MDS1  MDS2  MDS3  MDS4  MDS5  MDS6  MDS7  MDS8 
7.541 4.898 4.171 3.536 2.676 2.254 2.132 1.929 
(Showing 8 of 71 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>summ.cap &lt;- summary(cap.otc.comb)
prop.expl &lt;- summ.cap$cont$importance
ax.labs &lt;- paste0(colnames(prop.expl)[1:2], &quot; (&quot;,round(100*prop.expl[2,1:2]),&quot;% explained)&quot;)
(anova.cap &lt;- anova(cap.otc.comb, by=&quot;margin&quot;))</code></pre>
<pre><code>Permutation test for capscale under reduced model
Marginal effects of terms
Permutation: free
Number of permutations: 999

Model: capscale(formula = sqrt(vol.otc) ~ Year + Site + mean_temp_C_treatment + temp, data = svf.otc, distance = &quot;bray&quot;)
                       Df SumOfSqs      F Pr(&gt;F)    
Year                    2    3.597 7.5961  0.001 ***
Site                    2    1.460 3.0828  0.001 ***
mean_temp_C_treatment   1    0.571 2.4097  0.001 ***
temp                    1    0.377 1.5903  0.054 .  
Residual              219   51.858                  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>par(bg=&quot;grey40&quot;)
plot(cap.otc.comb, type=&quot;n&quot;,xlim=range(cap.otc.comb$CCA$wa[,1]), xlab=ax.labs[1], ylab=ax.labs[2])
title(&quot;OTC actual temp: I. agg at GNA or bb sites, all years\nvol ~ Year+Site+temp+temp&quot;)
temprange &lt;- round(c(max(svf.otc$mean_temp_C_treatment), min(svf.otc$mean_temp_C_treatment)))
legend(&quot;topleft&quot;,  title=paste(&quot;Temperature&quot;,&quot;\nP =&quot;,anova.cap[&quot;mean_temp_C_treatment&quot;,&quot;Pr(&gt;F)&quot;]), legend=paste(temprange, &quot; C&quot;), fill=rev(viridis(2)))
legend(&quot;topright&quot;,  title=paste(&quot;Year&quot;,&quot;\nP =&quot;,anova.cap[&quot;Year&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.otc$Year), pch=yearpch)
legend(&quot;bottomright&quot;,  title=paste(&quot;Site&quot;,&quot;\nP =&quot;,anova.cap[&quot;Site&quot;,&quot;Pr(&gt;F)&quot;]), legend=unique(svf.otc$Site)[1:2])
legend(&quot;left&quot;,  title=paste(&quot;OTC warming&quot;,&quot;\nP =&quot;,anova.cap[&quot;temp&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.otc$temp))
text(cap.otc.comb, display=&quot;species&quot;, cex=0.7, srt=45,
                     col=ifelse(sqrt(cap.otc.comb$CCA$v[,1]^2 + cap.otc.comb$CCA$v[,2]^2)&gt;0.25, alpha(&quot;pink&quot;,0.7),alpha(&quot;pink&quot;,0)))
points(cap.otc.comb, display=&quot;sites&quot;, col=inferno(32)[round(svf.otc$mean_temp_C_treatment)-7], pch=yearpch[svf.otc$Year]) 
text(cap.otc.comb, display=&quot;cn&quot;, col=&quot;white&quot;)</code></pre>
<p><img src="plots/otc_comb_temp-1.svg" width="768" /></p>
</div>
<div id="cap-of-all-i.-aggregata-vs.-actual-temp-year"
class="section level2">
<h2>CAP of all I. aggregata vs. actual temp, year</h2>
<pre class="r"><code>#Combined I. aggregata OTC CAP
svf.otc &lt;- svf %&gt;% filter(expt==&quot;otc&quot;, PlantType==&quot;agg&quot;) %&gt;% drop_na(mean_temp_C_treatment)
vol.otc &lt;- vol[svf.otc$sample,]
(cap.otc.comb &lt;- capscale(sqrt(vol.otc) ~ Year+mean_temp_C_treatment, distance=&quot;bray&quot;, data=svf.otc))</code></pre>
<pre><code>Call: capscale(formula = sqrt(vol.otc) ~ Year + mean_temp_C_treatment,
data = svf.otc, distance = &quot;bray&quot;)

               Inertia Proportion Rank
Total          44.0127     1.0000     
Constrained     4.7280     0.1074    3
Unconstrained  53.6892     1.2199   71
Imaginary     -14.4046    -0.3273  154
Inertia is squared Bray distance 
Species scores projected from &#39;sqrt&#39; &#39;vol.otc&#39; 

Eigenvalues for constrained axes:
  CAP1   CAP2   CAP3 
2.6772 1.6324 0.4184 

Eigenvalues for unconstrained axes:
 MDS1  MDS2  MDS3  MDS4  MDS5  MDS6  MDS7  MDS8 
7.652 5.033 4.289 3.742 2.946 2.313 2.292 1.943 
(Showing 8 of 71 unconstrained eigenvalues)</code></pre>
<pre class="r"><code>summ.cap &lt;- summary(cap.otc.comb)
prop.expl &lt;- summ.cap$cont$importance
ax.labs &lt;- paste0(colnames(prop.expl)[1:2], &quot; (&quot;,round(100*prop.expl[2,1:2]),&quot;% explained)&quot;)
(anova.cap &lt;- anova(cap.otc.comb, by=&quot;margin&quot;))</code></pre>
<pre><code>Permutation test for capscale under reduced model
Marginal effects of terms
Permutation: free
Number of permutations: 999

Model: capscale(formula = sqrt(vol.otc) ~ Year + mean_temp_C_treatment, data = svf.otc, distance = &quot;bray&quot;)
                       Df SumOfSqs      F Pr(&gt;F)    
Year                    2    4.024 8.3193  0.001 ***
mean_temp_C_treatment   1    0.563 2.3264  0.002 ** 
Residual              222   53.689                  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>par(bg=&quot;grey40&quot;)
plot(cap.otc.comb, type=&quot;n&quot;, xlab=ax.labs[1], ylab=ax.labs[2])
title(&quot;OTC actual temp: I. agg at GNA or bb sites, all years\n vol ~ temp&quot;)
temprange &lt;- round(c(max(svf.otc$mean_temp_C_treatment), min(svf.otc$mean_temp_C_treatment)))
legend(&quot;bottomleft&quot;,  title=paste(&quot;Temperature&quot;,&quot;\nP =&quot;,anova.cap[&quot;mean_temp_C_treatment&quot;,&quot;Pr(&gt;F)&quot;]), legend=paste(temprange, &quot; C&quot;), fill=rev(viridis(2)))
legend(&quot;topright&quot;,  title=paste(&quot;Year&quot;,&quot;\nP =&quot;,anova.cap[&quot;Year&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.otc$Year), pch=yearpch)
text(cap.otc.comb, display=&quot;species&quot;, cex=0.7, srt=45,
                     col=ifelse(abs(cap.otc.comb$CCA$v[,1])&gt;0.1, alpha(&quot;pink&quot;,0.7),alpha(&quot;pink&quot;,0)))
points(cap.otc.comb, display=&quot;sites&quot;, col=inferno(32)[round(svf.otc$mean_temp_C_treatment)-7], pch=yearpch[svf.otc$Year])
text(cap.otc.comb, display=&quot;cn&quot;, col=&quot;white&quot;)</code></pre>
<p><img src="plots/otc_comb_tempyr-1.svg" width="768" /></p>
</div>
</div>
<div id="percivals-warm-vs.-cool" class="section level1">
<h1>Percivals warm vs. cool</h1>
<div id="cap-analysis-of-each-percival-dataset" class="section level2">
<h2>CAP analysis of each Percival dataset</h2>
<pre class="r"><code>#inventory of samples
svf %&gt;% filter(expt==&quot;perc&quot;) %&gt;%  count(PlantType, DN, Temp,Year) %&gt;% kable(caption=&quot;Sample size&quot;)</code></pre>
<table>
<caption>Sample size</caption>
<thead>
<tr class="header">
<th align="left">PlantType</th>
<th align="left">DN</th>
<th align="left">Temp</th>
<th align="left">Year</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">cool</td>
<td align="left">2018</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">cool</td>
<td align="left">2019</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">warm</td>
<td align="left">2018</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">day</td>
<td align="left">warm</td>
<td align="left">2019</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">night</td>
<td align="left">cool</td>
<td align="left">2018</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">night</td>
<td align="left">cool</td>
<td align="left">2019</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">night</td>
<td align="left">warm</td>
<td align="left">2018</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">night</td>
<td align="left">warm</td>
<td align="left">2019</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">cool</td>
<td align="left">2018</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">cool</td>
<td align="left">2019</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">warm</td>
<td align="left">2018</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">day</td>
<td align="left">warm</td>
<td align="left">2019</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">cool</td>
<td align="left">2018</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">cool</td>
<td align="left">2019</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">warm</td>
<td align="left">2018</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">night</td>
<td align="left">warm</td>
<td align="left">2019</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<pre class="r"><code>plot.perc &lt;- function(svf.perc, plot.chems=T) {
    vol.perc &lt;- vol[svf.perc$sample,]
    cap.perc &lt;- capscale(sqrt(vol.perc) ~ DN+Temp, distance=&quot;bray&quot;, data=svf.perc)
    summ.cap &lt;- summary(cap.perc)
    prop.expl &lt;- summ.cap$cont$importance[2,c(&quot;CAP1&quot;,&quot;CAP2&quot;)]
    ax.labs &lt;- paste0(&quot;CAP&quot;, 1:2, &quot; (&quot;,round(100*prop.expl),&quot;% explained)&quot;)
    anova.cap &lt;- anova(cap.perc, by=&quot;margin&quot;)
    
    plot(cap.perc, type=&quot;n&quot;, xlim=range(cap.perc$CCA$wa[,1]), xlab=ax.labs[1], ylab=ax.labs[2])
    with(svf.perc, title(paste0(&quot;Percivals: I. &quot;, unique(PlantType),&quot; in &quot;, unique(Year))))
    #, &quot; (&quot;,round(100*summ.cap$constr.chi / summ.cap$tot.chi),&quot;% explained)&quot;)
    legend(&quot;topleft&quot;, title=paste(&quot;Temperature&quot;,&quot;\nP =&quot;,anova.cap[&quot;Temp&quot;,&quot;Pr(&gt;F)&quot;]), 
           levels(svf.perc$Temp), fill=Tempcol)
    legend(&quot;topright&quot;, title=paste(&quot;Time&quot;,&quot;\nP =&quot;,anova.cap[&quot;DN&quot;,&quot;Pr(&gt;F)&quot;]), 
           levels(svf.perc$DN), pch=c(1,19))
    if(plot.chems) text(cap.perc, display=&quot;species&quot;, cex=0.7, srt=45,
                     col=ifelse(sqrt(cap.perc$CCA$v[,1]^2 + cap.perc$CCA$v[,2]^2)&gt;0.25, alpha(&quot;purple&quot;,0.7),alpha(&quot;purple&quot;,0)))
    points(cap.perc, display=&quot;sites&quot;, col=Tempcol[svf.perc$Temp], pch=c(1,19)[svf.perc$DN]) 
    text(cap.perc, display=&quot;cn&quot;)
    return(cap.perc)
}
cap.perc.agg18 &lt;-  plot.perc(svf %&gt;% filter(expt==&quot;perc&quot;,Year==&quot;2018&quot;,PlantType==&quot;agg&quot;))</code></pre>
<p><img src="plots/perc-1.svg" width="768" /></p>
<pre class="r"><code>cap.perc.agg19 &lt;-  plot.perc(svf %&gt;% filter(expt==&quot;perc&quot;,Year==&quot;2019&quot;,PlantType==&quot;agg&quot;))</code></pre>
<p><img src="plots/perc-2.svg" width="768" /></p>
<pre class="r"><code>cap.perc.ten18 &lt;-  plot.perc(svf %&gt;% filter(expt==&quot;perc&quot;,Year==&quot;2018&quot;,PlantType==&quot;ten&quot;))</code></pre>
<p><img src="plots/perc-3.svg" width="768" /></p>
<pre class="r"><code>cap.perc.ten19 &lt;-  plot.perc(svf %&gt;% filter(expt==&quot;perc&quot;,Year==&quot;2019&quot;,PlantType==&quot;ten&quot;))</code></pre>
<p><img src="plots/perc-4.svg" width="768" /></p>
<pre class="r"><code>#cap.perc.all &lt;- list(agg18=cap.perc.agg18, agg19=cap.perc.agg19, ten18=cap.perc.ten18, ten19=cap.perc.ten19)
#lapply(cap.perc.all, anova, by=&quot;margin&quot;)</code></pre>
</div>
<div id="cap-of-percival-dataset-combined-for-each-species"
class="section level2">
<h2>CAP of Percival dataset combined for each species</h2>
<pre class="r"><code>plot.perc.comb &lt;- function(svf.perc, plot.chems=F) {
  vol.perc &lt;- vol[svf.perc$sample,]
  cap.perc.comb &lt;- capscale(sqrt(vol.perc) ~ Year+DN+Temp, distance=&quot;bray&quot;, data=svf.perc)
    summ.cap &lt;- summary(cap.perc.comb)
    prop.expl &lt;- summ.cap$cont$importance[2,c(&quot;CAP1&quot;,&quot;CAP2&quot;)]
    ax.labs &lt;- paste0(&quot;CAP&quot;, 1:2, &quot; (&quot;,round(100*prop.expl),&quot;% explained)&quot;)
    anova.cap &lt;- anova(cap.perc.comb, by=&quot;margin&quot;)
    
    plot(cap.perc.comb, type=&quot;n&quot;, xlim=range(cap.perc.comb$CCA$wa[,1]), xlab=ax.labs[1], ylab=ax.labs[2])
    title(paste(&quot;Percivals: I.&quot;,unique(svf.perc$PlantType), &quot;2018/2019&quot;))
    legend(&quot;bottomleft&quot;, title=paste(&quot;Temperature&quot;,&quot;\nP =&quot;,anova.cap[&quot;Temp&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.perc$Temp), fill=Tempcol)
  legend(&quot;bottomright&quot;, title=paste(&quot;Time&quot;,&quot;\nP =&quot;,anova.cap[&quot;DN&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.perc$DN), fil=c(0,1))
  legend(&quot;topright&quot;, title=paste(&quot;Year&quot;,&quot;\nP =&quot;,anova.cap[&quot;Year&quot;,&quot;Pr(&gt;F)&quot;]), levels(svf.perc$Year), pch=c(19,15))
  points(cap.perc.comb, display=&quot;sites&quot;, col=Tempcol[svf.perc$Temp], pch=c(1,0,19,15)[factor(paste(svf.perc$DN, svf.perc$Year))]) 
  text(cap.perc.comb, display=&quot;cn&quot;)
  text(cap.perc.comb, display=&quot;species&quot;, cex=0.7, srt=45, col=ifelse(sqrt(cap.perc.comb$CCA$v[,1]^2 + cap.perc.comb$CCA$v[,2]^2)&gt;0.2, alpha(&quot;purple&quot;,1),alpha(&quot;purple&quot;,0)))
  return(cap.perc.comb)
}
svf.perc.agg &lt;- plot.perc.comb(svf %&gt;% filter(expt==&quot;perc&quot;, PlantType==&quot;agg&quot;))</code></pre>
<p><img src="plots/perc_comb-1.svg" width="768" /></p>
<pre class="r"><code>svf.perc.ten &lt;- plot.perc.comb(svf %&gt;% filter(expt==&quot;perc&quot;, PlantType==&quot;ten&quot;))</code></pre>
<p><img src="plots/perc_comb-2.svg" width="768" /></p>
<pre class="r"><code>#svf.perc.both &lt;- plot.perc.comb(svf %&gt;% filter(expt==&quot;perc&quot;))</code></pre>
</div>
</div>
<div id="individual-volatiles" class="section level1">
<h1>Individual volatiles</h1>
<div id="treatment-effects" class="section level2">
<h2>Treatment effects</h2>
<pre class="r"><code>vols.plot &lt;- chemsf3 %&gt;% filter(filter_final, freq.floral&gt;0.3) %&gt;% pull(&quot;name&quot;) %&gt;% as.character
#vols.plot[vols.plot==&quot;b-caryophyllene&quot;] &lt;- &quot;b-caryophyllene.1&quot;#c(&quot;b-ocimene&quot;,&quot;a-pinene&quot;,&quot;a-farnesene&quot;,&quot;b-caryophyllene.1&quot;,&quot;petasitene&quot;,&quot;b-myrcene&quot;,&quot;longifolene&quot;,&quot;tridec-1-ene  &quot;,&quot;benzophenone&quot;)
vol.long &lt;- gather(cbind(sample=rownames(vol[,vols.plot]), total=rowSums(vol), vol[,vols.plot]), key=&quot;chem&quot;,value=&quot;area&quot;, 2:(length(vols.plot)+2), factor_key=T)
vol.plot &lt;- left_join(vol.long, svf)

specDNcols &lt;- c( &quot;#943390&quot;,&quot;#FF5056&quot;, &quot;#A894FF&quot;,&quot;#FC8C97&quot;)
#Treatcols &lt;- c(&quot;#DA9E18&quot;,&quot;#6B744F&quot;)
DNcols &lt;- c(&quot;grey90&quot;,&quot;grey20&quot;)
ggplot(drop_na(vol.plot, PlantType, expt),#TODO track down NAs
       aes(x=paste(PlantType,ifelse(is.na(Site), &quot;&quot;, Site),expt),y=area,  fill=DN, color=paste(Year, Treat))) +
  geom_boxplot(size=0.7, outlier.size=0.7, position=position_dodge2(preserve=&quot;single&quot;)) + 
  facet_wrap(vars(chem), scales=&quot;free&quot;) + 
  scale_y_sqrt(&quot;Peak area per flower per hour&quot;) + 
  scale_color_brewer(&quot;Year, treatment&quot;, palette = &quot;Paired&quot;)+
  scale_x_discrete(&quot;Species, site, experiment&quot;)+
  #scale_color_manual(&quot;Species, Treatment&quot;, values=specDNcols) + 
  scale_fill_manual(&quot;Time of day&quot;,values=DNcols) + 
  theme_minimal() + theme(axis.text.x=element_text(angle=20, vjust=0.5))</code></pre>
<p><img src="plots/barplots-1.svg" width="1440" /></p>
</div>
<div id="actual-temperature-effects" class="section level2">
<h2>Actual temperature effects</h2>
<pre class="r"><code>ggplot(drop_na(vol.plot, PlantType, expt) %&gt;% filter(expt==&quot;otc&quot;),#TODO track down NAs
       aes(x=mean_temp_C_treatment, y=area, shape=DN, color=paste(PlantType, Site, Year))) +
  geom_point() + geom_smooth(se=F, method=&quot;lm&quot;)+
  facet_wrap(vars(chem), scales=&quot;free_y&quot;) + 
  scale_y_sqrt(&quot;Peak area per flower per hour&quot;) + 
  scale_x_continuous(&quot;Mean temperature in controls or OTCs (C)&quot;)+
  scale_color_brewer(&quot;Species, site, year&quot;, palette = &quot;Dark2&quot;, direction=-1)+#scale_color_manual(&quot;Species&quot;, values=spcols) + 
  scale_shape_manual(&quot;Time of day&quot;,values=c(1,19)) + 
  theme_minimal() + theme(axis.text.x=element_text(angle=20, vjust=0.5))</code></pre>
<p><img src="plots/temptrend-1.svg" width="1440" /></p>
</div>
</div>
<div id="leaf-volatiles" class="section level1">
<h1>Leaf volatiles</h1>
<div id="inventory-1" class="section level2">
<h2>Inventory</h2>
<p>Dropped 2 samples from 2018 without leaf mass. Volatiles units are
peak area per hour per gram dry leaf.</p>
<pre class="r"><code>svl %&gt;% count(PlantType, Treat, expt) %&gt;% kable(caption=&quot;Sample size&quot;)</code></pre>
<table>
<caption>Sample size</caption>
<thead>
<tr class="header">
<th align="left">PlantType</th>
<th align="left">Treat</th>
<th align="left">expt</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">agg</td>
<td align="left">control</td>
<td align="left">otc</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">control</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="left">warmed</td>
<td align="left">otc</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">agg</td>
<td align="left">warmed</td>
<td align="left">perc</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">control</td>
<td align="left">otc</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">control</td>
<td align="left">perc</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">ten</td>
<td align="left">warmed</td>
<td align="left">otc</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">ten</td>
<td align="left">warmed</td>
<td align="left">perc</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
</div>
<div id="heatmap" class="section level2">
<h2>Heatmap</h2>
<pre class="r"><code>#cairo_pdf(&quot;ipo_heatmap_leaf.pdf&quot;, width=12, height=12)
ph_leaf  &lt;- pheatmap(as.matrix(t(vol.leaf))^(1/3), 
         cluster_cols=T, show_colnames=F,
         clustering_method=&quot;mcquitty&quot;, clustering_distance_rows=&quot;correlation&quot;,
         clustering_distance_cols=vegdist(vol.leaf, method = &quot;bray&quot;),
         clustering_callback = function(hc, ...){dendsort(hc, type=&quot;average&quot;)},
         scale=&quot;none&quot;, color=inferno(512),
         annotation_col = data.frame(svl %&gt;% select(&quot;PlantType&quot;, &quot;expt&quot;, &quot;Treat&quot;), row.names=rownames(vol.leaf)), 
   fontsize = 10, border_color = NA, legend=F, annotation_legend=T, cutree_rows=6
)</code></pre>
<p><img src="plots/heatmap_leaf-1.png" width="1152" /></p>
<pre class="r"><code>#dev.off()</code></pre>
</div>
<div id="cap---otcs" class="section level2">
<h2>CAP - OTCs</h2>
<pre class="r"><code>svl.otc &lt;- svl %&gt;% filter(expt==&quot;otc&quot;)
cap.leaf &lt;- capscale(sqrt(vol.leaf[svl$expt==&quot;otc&quot;,]) ~ PlantType+temp, distance=&quot;bray&quot;, data=svl.otc)
summ.cap &lt;- summary(cap.leaf)
prop.expl &lt;- summ.cap$cont$importance[2,c(&quot;CAP1&quot;,&quot;CAP2&quot;)]
ax.labs &lt;- paste0(&quot;CAP&quot;, 1:2, &quot; (&quot;,round(100*prop.expl),&quot;% explained)&quot;)
(anova.cap &lt;- anova(cap.leaf, by=&quot;margin&quot;))</code></pre>
<pre><code>Permutation test for capscale under reduced model
Marginal effects of terms
Permutation: free
Number of permutations: 999

Model: capscale(formula = sqrt(vol.leaf[svl$expt == &quot;otc&quot;, ]) ~ PlantType + temp, data = svl.otc, distance = &quot;bray&quot;)
          Df SumOfSqs      F Pr(&gt;F)    
PlantType  1   0.8984 5.3916  0.001 ***
temp       1   0.1149 0.6894  0.732    
Residual  33   5.4986                  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>plot(cap.leaf, type=&quot;n&quot;, xlim=range(cap.leaf$CCA$wa[,1]), xlab=ax.labs[1], ylab=ax.labs[2])
title(paste(&quot;OTCs: I. agg and I. ten leaves 2019&quot;))
legend(&quot;bottomleft&quot;, title=paste(&quot;Temperature&quot;,&quot;\nP =&quot;,anova.cap[&quot;temp&quot;,&quot;Pr(&gt;F)&quot;]), levels(svl.otc$temp), fill=tempcol)
legend(&quot;bottomright&quot;, title=paste(&quot;Species&quot;,&quot;\nP =&quot;,anova.cap[&quot;PlantType&quot;,&quot;Pr(&gt;F)&quot;]), levels(svl.otc$PlantType), pch=c(19,15))
points(cap.leaf, display=&quot;sites&quot;, col=tempcol[svl.otc$temp], pch=c(19,15)[svl.otc$PlantType]) 
text(cap.leaf, display=&quot;cn&quot;)
text(cap.leaf, display=&quot;species&quot;, cex=0.7, col=ifelse(sqrt(cap.leaf$CCA$v[,1]^2 + cap.leaf$CCA$v[,2]^2)&gt;0.2, alpha(&quot;purple&quot;,1),alpha(&quot;purple&quot;,0)))</code></pre>
<p><img src="plots/cap_leaf_otc-1.svg" width="768" /></p>
</div>
<div id="cap---percivals" class="section level2">
<h2>CAP - Percivals</h2>
<pre class="r"><code>svl.perc &lt;- svl %&gt;% filter(expt==&quot;perc&quot;)
cap.leaf.perc &lt;- capscale(sqrt(vol.leaf[svl$expt==&quot;perc&quot;,]) ~ PlantType+Temp, distance=&quot;bray&quot;, data=svl.perc)
summ.cap &lt;- summary(cap.leaf.perc)
prop.expl &lt;- summ.cap$cont$importance[2,c(&quot;CAP1&quot;,&quot;CAP2&quot;)]
ax.labs &lt;- paste0(&quot;CAP&quot;, 1:2, &quot; (&quot;,round(100*prop.expl),&quot;% explained)&quot;)
(anova.cap &lt;- anova(cap.leaf.perc, by=&quot;margin&quot;))</code></pre>
<pre><code>Permutation test for capscale under reduced model
Marginal effects of terms
Permutation: free
Number of permutations: 999

Model: capscale(formula = sqrt(vol.leaf[svl$expt == &quot;perc&quot;, ]) ~ PlantType + Temp, data = svl.perc, distance = &quot;bray&quot;)
          Df SumOfSqs      F Pr(&gt;F)
PlantType  1   0.1145 0.3552  0.925
Temp       1   0.2044 0.6339  0.660
Residual  10   3.2237              </code></pre>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
